'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[23],{1262:function(u,F,a){u=a(0);var c=a(15),b=a(80),e=a(823),f=a(83),d=a(187),h=a(8),n=a(210),m=a(66),x=a(40),r=a(188),y=a(109),t=a(282),v=a(1),w=a(11),C=a(100),B=a(13),z=a(281),A=a(21),E=a(346);class I{constructor(J,M,Q){this.sGa=J;this.lk=M;this.GEc=Q}}Object(u.a)(I,"UserActivityLocation",null,[]);var L=a(984),V=a(60);const T=(J,M,Q,U,Z,P=null)=>{P=J.Na(1,P);return V.g(J,"GetVersionHistoryHighlightActivitiesData",
P,M,Q,U,Z,4)};var H=a(762),D=a(55);a.d(F,"a",function(){return G});class G{constructor(J,M,Q,U){this.authorColor=this.C2=this.Yea=null;this.r8a=!1;this.c2a=-1;this.g7c=0;this.jJa=100;this.W5=-1;this.v2d=null;this.cqb=h.a.L1j;this.HKe=h.a.M1j;this.hFb=!1;this.gh=Z=>{(Z=t.a(Z)?null:Z.Result)?Z.OperationWaitingForFileDownload?20>this.g7c?(this.jJa*=2,D.Task.delay(this.jJa).continueWith(()=>{this.L_d()})):(this.WDc(),c.ULS.sendTraceTag(537150406,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):
Z.ActivityList?(this.initialize(Z.ActivityList,Z.VersionAuthors),v.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")?this.YPa():this.PNb(!0),this.v2d.stop(),c.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.v2d.Ac.toString()}`)):(this.WDc(),c.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):(this.jJa*=2,D.Task.delay(this.jJa).continueWith(()=>
{this.L_d()}),c.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.xza=()=>{this.WDc();c.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.yud=Z=>{c.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.IterateMessageHandler called with MessageID:${Z.MessageId}`);switch(Z.MessageId){case L.a.iterateNext:this.iterateNext();this.W5=(this.W5+1)%this.OO.length;
this.hMb(L.a.setCurrentChangeCount,this.W5+1);break;case L.a.Uxa:this.Uxa();this.W5=0>this.W5?0:this.W5;this.W5=(this.W5+this.OO.length-1)%this.OO.length;this.hMb(L.a.setCurrentChangeCount,this.W5+1);break;case L.a.FPb:this.PNb(Z.Values.ToggleValue)}};this.K6g=(Z,P)=>this.T4b(Z.lk,P.lk);this.I6g=(Z,P)=>this.T4b(Z.lk,P);this.Pc=()=>{v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.XlOnlineVHRemovingDeselectOnSelectionChanged",!1)||this.Q7b()};this.Ln=()=>{this.Q7b()};this.uh=()=>{this.Q7b()};
c.ULS.sendTraceTag(537150411,0,50,"VersionHistoryHighlightManager::Constructor.");this.$=J;this.ariaLiveNotifier=U;this.gridView=A.h(this.$);this.gridView.ha.hH(this.Pc);this.gridView.FC(this.Ln);this.gridView.Vb.Yk(this.uh);this.XXj();this.hFb=v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.XlOnlineVHNewIterationAlgorithm",!1);M&&(this.v2d=J.Kb.Bc("UserAction","VersionHistoryDiffManagerStopWatch"),this.L_d());if(this.Cs=Q)J=b.a.dba(this.$.va.VersionHistoryActionUrl)||H.a.m$,J!==H.a.m$&&
this.Cs.vGa(J),this.Cs.so(L.a.iterateNext),this.Cs.so(L.a.Uxa),this.Cs.so(L.a.FPb),this.Cs.dm(L.a.iterateNext,this.yud),this.Cs.dm(L.a.Uxa,this.yud),this.Cs.dm(L.a.FPb,this.yud)}get bhb(){return this.C2}get bMb(){return-1===this.c2a?null:this.OO[this.c2a]}get OO(){this.r8a||(this.Yea.sort(this.K6g),this.r8a=!0);return this.Yea}dispose(){this.mRa();this.Yea=this.C2=null;this.gridView&&(this.gridView.ha&&this.gridView.ha.kG(this.Pc),this.gridView.bE(this.Ln),this.gridView.Vb&&this.gridView.Vb.Gk(this.uh),
this.Cs&&(this.Cs.cpa(L.a.Uxa),this.Cs.cpa(L.a.iterateNext),this.Cs.cpa(L.a.FPb)))}initialize(J,M){J?(this.mRa(),this.c2a=-1,this.Yea=[],this.r8a=!1,this.C2={},this.authorColor={},this.YDi(M),this.O6c(J)):c.ULS.shipAssertTag(537150410,0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}L_d(){c.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.g7c.toString()} --${this.jJa.toString()}`);this.g7c++;this.$.userOperationManager.Ic(new r.a(537,
0,(J,M,Q)=>T(this.$.pa.ya,z.b(J,this.gh),z.a(M,this.xza),Q,null),80),null)}PNb(J){const M=this.C2;for(let U in M){var Q=U;const Z=M[U];Z?Z.RNb(J):c.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+Q+"view was Null")}}mRa(){const J=this.C2;for(let Q in J){var M=Q;const U=J[Q];U?U.FLd():c.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+M+"view was Null")}this.Yea=this.C2=null}l1f(J){let M;if(this.hFb)M=J?this.X4e(this.W5):
this.Z5e(this.W5),J=this.OO[M];else if(!({Sdf:M,lkg:J}=this.dYh(J,this.c2a)).returnValue)return;c.ULS.shipAssertTag(537150402,0,!!J,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null");this.Q7b();if(J.sGa.toString()in this.C2){this.C2[J.sGa.toString()].Brj(J.lk);var Q=x.D(J.lk);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.readText(String.format(B.a.instance.mb(158),M+1,this.OO.length,Q.Ew(!1),J.GEc.DisplayName));
this.c2a=M}else c.ULS.shipAssertTag(537150401,0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${J.sGa.toString()} view not present in views dictionary`)}hMb(J,M){if(v.EwaSettings.ma(314))if(this.Cs){var Q={};Q.count=M;J=new e.a(J);J.Values=Q;this.Cs.send(J)}else c.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else c.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}dYh(J,
M){let Q,U=!1;Q=null;let Z=0;for(;!U&&Z<this.OO.length;){M=J?this.X4e(M):this.Z5e(M);Q=this.OO[M];const P=Object(f.a)(C.a,this.$.xa.getItemByName(Q.lk.SheetName));if(!P)return c.ULS.shipAssertTag(537150369,0,!1,"VersionHistoryHighlightManager.GetNextorPreviousUserActivityLocationFromIndex - useractivitylocation contains sheetrange with null sheet"),{returnValue:!1,Sdf:M,lkg:Q};P.visible&&(U=!0);Z++}return{returnValue:U,Sdf:M,lkg:Q}}X4e(J){return this.hFb||-1!==J?(J+1)%this.OO.length:this.S4e()}Z5e(J){this.hFb&&
-1===J?J=0:-1===J&&(J=this.S4e());return J=(J+this.OO.length-1)%this.OO.length}O6c(J){this.wgh(J);this.t6c()}q4h(J,M){const Q=[];if(!J.RangeList)return c.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),Q;for(const U of J.RangeList)if(!U||!this.$.xa.Qk(U.SheetName))c.ULS.shipAssertTag(537150367,0,!1,"Invalid sheet name "+U.SheetName);else if(!this.hFb||this.$.xa.getItemByName(U.SheetName).visible)J=
new I(0,U,M),Q.push(J);return Q}wgh(J){for(const M of J)if(!M||y.e(M.LocationList))c.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const Q of M.LocationList)if(Q)switch(Q.Type){case 0:this.Yea.push(...this.q4h(Q,M.Person));break;default:c.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else c.ULS.shipAssertTag(537150365,0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}t6c(){var J=
{};const M=new d.a,Q=[];for(const U of this.Yea){M.contains(U.GEc)||M.add(U.GEc);if(0!==U.sGa)continue;const Z=new E.a(x.D(U.lk),m.d(this.$.xa.getItemByName(U.lk.SheetName))),P=G.azc(Z);P in J||Q.push(Z);J[P]=this.ZPh(U.GEc)}c.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.Yea.length}, Highlightable activities: ${Q.length},Total userlist in activities : ${this.Yea.length}, Total userlist from pane: ${Q.length} `);this.WDc();0<Q.length&&
(J=new (a(1366).RangeVersionHistoryHighlightView)(this.$,Q,J,this.cqb),this.C2["0"]=J)}WDc(){const J=this.Yea?this.OO.length:0;this.hMb(L.a.setCurrentChangeCount,0);this.hMb(L.a.setTotalChangesCount,J)}YPa(){this.hMb(L.a.YPa,0)}YDi(J){if(J)for(let Z=0;Z<J.length;++Z)if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:5140301_HandleEmptyInitialsColor")&&!J[Z].InitialsColor)c.ULS.sendTraceTag(537150362,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");
else{var M=J[Z].EmailAddress;var Q=J[Z].UserName;var U=null;if(J[Z].LoginName){const P=J[Z].LoginName.split("|");3===P.length&&(U=P[2])}U?this.authorColor[U]=J[Z].InitialsColor:M?(c.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[M]=J[Z].InitialsColor):Q?(c.ULS.sendTraceTag(537150360,0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),this.authorColor[Q]=J[Z].InitialsColor):c.ULS.sendTraceTag(537150359,
0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else c.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}XXj(){if(this.$.va.VersionHistoryHighlightsSettings){var J=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.va.VersionHistoryHighlightsSettings))?Sys.Serialization.JavaScriptSerializer.deserialize(this.$.va.VersionHistoryHighlightsSettings):null;for(let Q=0;Q<J.length;Q++){var M=J[Q];const U=
M.key?M.key:M.Key?M.Key:"";M=M.value?M.value:M.Value?M.Value:"";"DefaultColor"===U?this.HKe=M:"InitialTint"===U?this.cqb=M:c.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else c.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}ZPh(J){if(J.Email in this.authorColor)return this.authorColor[J.Email];if(J.DisplayName in this.authorColor)return this.authorColor[J.DisplayName];
c.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.HKe}T4b(J,M){var Q=Object(f.a)(C.a,this.$.xa.getItemByName(J.SheetName));const U=Object(f.a)(C.a,this.$.xa.getItemByName(M.SheetName));return Q&&U?(Q=(Q=w.HelperMethods.HB(Q.index,U.index))||w.HelperMethods.HB(J.FirstRow,M.FirstRow))||w.HelperMethods.HB(J.FirstColumn,M.FirstColumn):(c.ULS.sendTraceTag(537150355,0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),
0)}S4e(){var J=x.m(this.gridView.ha.ra.activeRange,this.$.xa.oa);if(!J)return c.ULS.sendTraceTag(537150354,0,10,"VersionHistoryHighlightManager.GetNearestLocationIndexFromCurrentSelection - SelectedSharedSheetRange is null "),0;J=w.HelperMethods.jw(new n.a(this.OO),0,this.OO.length,J,this.I6g);0>J&&(J=~J);return J%this.OO.length}Q7b(){if(this.bMb){if(!(this.bMb.sGa.toString()in this.C2)){c.ULS.shipAssertTag(537150353,0,!1,`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.bMb.sGa.toString()} view not present in views dictionary`);
return}this.C2[this.bMb.sGa.toString()].okh(this.bMb.lk)}this.c2a=-1}iterateNext(){this.l1f(!0)}Uxa(){this.l1f(!1)}static azc(J){return`${J.range}${J.sheetId}`}}Object(u.a)(G,"VersionHistoryHighlightManager",null,[704,2])},1366:function(u,F,a){a.r(F);u=a(0);var c=a(15),b=a(8);class e{}e.iyh="ewa-vhr-rectinnerborder";Object(u.a)(e,"CssClassNames",null,[]);var f=a(66),d=a(40),h=a(199),n=a(21),m=a(346),x=a(1262);a.d(F,"RangeVersionHistoryHighlightView",function(){return r});class r{constructor(y,t,v,
w){this.Ojb=null;this.$=y;this.qCg=t;this.fTa=v;this.gTa={};this.cqb=w;this.kgi()}get FF(){return[r.e5]}get qb(){return this.Ojb||(this.Ojb=n.h(this.$).qb)}RNb(y){y?this.qb.Sn(this.FF):this.qb.Zg(this.FF)}FLd(){this.RNb(!1);this.qb.RSa(new m.a(null,f.d(this.$.oa)),this.FF)}Brj(y){if(this.fTa){var t=new m.a(d.D(y),f.d(this.$.xa.getItemByName(y.SheetName))),v=x.a.azc(t);if(v in this.fTa)if(v in this.gTa){t=h.a.rp(this.fTa[v]);v=this.gTa[v];for(let w in v)v[w].style.backgroundColor=`rgba(${t.r},${t.g},${t.b},${b.a.N1j})`;
n.h(this.$).ha.Sa.vH(null);n.h(this.$).t9e(y,60,!0,"RangeVersionHistoryHighlightViewSelectView.SelectView")}else c.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+v);else c.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+v)}else c.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}okh(y){y=
new m.a(d.D(y),f.d(this.$.xa.getItemByName(y.SheetName)));var t=x.a.azc(y);if(t in this.gTa)if(t in this.fTa){y=h.a.rp(this.fTa[t]);t=this.gTa[t];for(let v in t)t[v].style.backgroundColor=`rgba(${y.r},${y.g},${y.b},${this.cqb})`}else c.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+t);else c.ULS.sendTraceTag(537150425,0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+t)}kgi(){this.qb.lx(this.qCg,
[r.e5],!1,(y,t)=>{if(y&&y.range&&y.sheetId&&t){var v=new m.a(y.range,y.sheetId);v=x.a.azc(v);v in this.gTa||(this.gTa[v]={});this.gTa[v][y.paneType.toString()]=t;v in this.fTa?(y=this.fTa[v],v=h.a.rp(y),t.style.borderColor=y,t.style.backgroundColor=`rgba(${v.r},${v.g},${v.b},${this.cqb})`,y=document.createElement("div"),y.className=e.iyh,t.appendChild(y)):c.ULS.sendTraceTag(537150419,0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+v)}else c.ULS.shipAssertTag(537150423,
0,!!y,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),c.ULS.shipAssertTag(537150422,0,!y||!!y.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),c.ULS.shipAssertTag(537150421,0,!y||!!y.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),c.ULS.shipAssertTag(537150420,0,!!t,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}r.e5=23;Object(u.a)(r,"RangeVersionHistoryHighlightView",null,[749])},1430:function(u,
F,a){a.r(F);var c=a(9),b=a(0),e=a(4),f=a(222),d=a(15),h=a(114),n=a(145),m=a(41);class x extends h.a{constructor(Fb,pa,tb,Nb,vc){super(Fb,pa);this.executionContext=null;this.retryCount=0;this.ZVi=Ic=>{({COd:Ic}=this.fTj(Ic)).returnValue?Ic.Success?(n.c(2138207060,!0),d.ULS.sendTraceTag(42287318,0,15,"RestoreVersionActivity:onRestoreSuccessCallback Restore version is successful")):(n.c(2138207060,!1),d.ULS.sendTraceTag(42287317,0,10,`RestoreVersionActivity:onRestoreSuccessCallback Restore version failed with message ${Ic.Output}`),
this.ih(this.kK)):(n.c(2138207060,!1),this.ih(this.kK));(Ic=this.executionContext.activityState[x.sxd])&&Ic();this.Jp();this.executionContext.QM()};this.YVi=()=>{if(0<this.retryCount)d.ULS.sendTraceTag(537150418,0,15,`RestoreVersionActivity:onRestoreFailureCallback Retrying version restore, retry count : ${this.retryCount}`),this.retryCount--,this.bZf();else{d.ULS.sendTraceTag(42287320,0,10,"RestoreVersionActivity:onRestoreFailureCallback Restore version failed");n.c(2138207060,!1);this.ih(this.kK);
var Ic=this.executionContext.activityState[x.sxd];Ic&&Ic();this.Jp();this.executionContext.QM()}};this.kK=tb;this.x3=Nb;this.baseUrl=vc}execute(Fb){this.executionContext=Fb;this.retryCount=3;this.bZf();return 1}bZf(){var Fb=this.executionContext.activityState[x.etc];const pa=`${this.baseUrl}${"restoreversion.ashx"}`,tb={};tb.VersionId=this.executionContext.activityState[x.tlg];tb.QuerySignature=Fb;Fb=m.c(tb);this.x3.Pm(pa,2,Fb,{"Content-Type":"application/json; charset=utf-8"},!1,2,this.ZVi,this.YVi,
null)}fTj(Fb){let pa;pa=null;Fb=Fb?Fb.data?Fb.data.ve:null:null;return Fb&&Fb.length?({Ft:pa}=m.d(Fb)).returnValue?{returnValue:!0,COd:pa}:(d.ULS.sendTraceTag(537150416,0,10,"RestoreVersionActivity:TryGetRestoreResult Failed in deserialization of returned data from restore version"),{returnValue:!1,COd:pa}):(d.ULS.sendTraceTag(537150417,0,10,"RestoreVersionActivity:TryGetRestoreResult data returned from restoreversion call is null or empty"),{returnValue:!1,COd:pa})}}x.tlg="RVAvi";x.etc="RVAqs";x.sxd=
"RVlvrt";Object(b.a)(x,"RestoreVersionActivity",h.a,[]);var r=a(6);class y extends f.a{constructor(Fb,pa,tb){super();this.activityName=Fb;this.cK=pa;this.kK=tb;this.Fb()}create(){this.nb(new x(this.activityName,this.cK,this.kK,e.AFrameworkApplication.zd,e.AFrameworkApplication.ta.Pa.d0))}static la(Fb){Fb.da.Ga(320,new y(r.a.FOd,r.a.hj,r.a.GOd))}}Object(b.a)(y,"RestoreVersionActivityFactory",f.a,[]);class t extends h.a{constructor(Fb,pa){super(Fb,pa)}execute(Fb){(0,Fb.activityState[t.A9f])(()=>{this.Jp();
Fb.QM()});return 1}}t.A9f="RVEAssea";Object(b.a)(t,"RestoreVersionErrorActivity",h.a,[]);class v extends f.a{constructor(Fb,pa){super();this.activityName=Fb;this.cK=pa;this.Fb()}create(){this.nb(new t(this.activityName,this.cK))}static la(Fb){Fb.da.Ga(321,new v(r.a.GOd,r.a.hj))}}Object(b.a)(v,"RestoreVersionErrorActivityFactory",f.a,[]);var w=a(80),C=a(694),B=a(49),z=a(37),A=a(184),E=a(375),I=a(55);class L{constructor(Fb,pa){this.$=Fb;this.Q1j=pa}nc(){return e.AFrameworkApplication.fa.qa("IsAnonymousUser")?
(d.ULS.sendTraceTag(537150415,0,15,"Verison History Command Handler: Anonymous user."),!0):!1}executeCommand(Fb,pa){d.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");Fb=!1;switch(pa.command){case -1112508866:E.a(this.$)&&this.$.da.Aa(423).Yzc(!1),Fb=this.Q1j.AHj()}d.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${Fb}.`);return Fb?I.Task.Ta(Fb):A.a(pa.command)}wc(Fb,pa){return-1112508866===pa.command&&this.$.isVersionHistoryEnabled()}Kc(){return!1}}
Object(b.a)(L,"VersionHistoryCommandHandler",null,[208]);var V=a(7),T=a(252),H=a(164),D=a(386);class G{static addAppPLTEventToLog(Fb){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(Fb)}catch(pa){}}static setIsPageLoadForFirstTime(Fb){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(Fb)}catch(pa){}}}Object(b.a)(G,"VersionHistoryLogConnector",null,[]);var J=a(27),M=a(823),Q=a(1240),U=a(154),Z=a(92),P=a(29),S=a(1),ja=a(44),X=a(250),Y=a(984),va=
a(259),N=a(247),ea=a(12);class Ca{constructor(Fb){this.Ww=Fb}di(){va.a(this.Ww.$).qB(this.de)||va.a(this.Ww.$).di(this)}p8(){va.a(this.Ww.$).qB(this.de)&&va.a(this.Ww.$).Zz(this)}get de(){return N.a.qlg}get mc(){return document.querySelector('[id="vhHeader"]')}get Hf(){return!0}mh(Fb){return ea.DOMElementExtensions.Af(this.mc,Fb)}sj(){this.Ww.$.frame.Me.vk(this.Ww.$.frame.Me.pF)}dk(){}kg(Fb,pa){pa||this.Ww.cQb.then(tb=>{tb.enterHeaderFocusTrapZone();return null});return!pa}}Object(b.a)(Ca,"VersionHistoryHeader",
null,[34]);class la{constructor(Fb){this.Ww=Fb}di(){va.a(this.Ww.$).qB(this.de)||va.a(this.Ww.$).di(this)}p8(){va.a(this.Ww.$).qB(this.de)&&va.a(this.Ww.$).Zz(this)}get de(){return N.a.rlg}get mc(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get Hf(){return!0}mh(Fb){return ea.DOMElementExtensions.Af(this.mc,Fb)}sj(){this.Ww.$.frame.Me.vk(this.Ww.$.frame.Me.pF)}dk(){}kg(Fb,pa){pa||this.Ww.cQb.then(tb=>{tb.enterFocusTrapZone();return null});return!pa}}Object(b.a)(la,"VersionHistoryPane",
null,[34]);class Ra{constructor(Fb){this.Ww=Fb}di(){va.a(this.Ww.$).qB(this.de)||va.a(this.Ww.$).di(this)}p8(){va.a(this.Ww.$).qB(this.de)&&va.a(this.Ww.$).Zz(this)}get de(){return N.a.slg}get mc(){return document.querySelector('[id="vhViewer"]')}get Hf(){return!0}mh(Fb){return ea.DOMElementExtensions.Af(this.mc,Fb)}sj(){this.Ww.$.frame.Me.vk(this.Ww.$.frame.Me.pF)}dk(){}kg(Fb,pa){pa||this.Ww.cQb.then(tb=>{tb.enterViewerFocusTrapZone();return null});return!pa}}Object(b.a)(Ra,"VersionHistoryViewer",
null,[34]);var lb=a(143),Aa=a(253),da=a(70),aa=a(426),fa=a(762);class Oa{constructor(){this.actionUrl=this.ulsLogger=null;this.useFetch=this.hideEmbedFooter=!1}}Object(b.a)(Oa,"AppBootSettings",null,[]);class ba{constructor(){this.rootDiv=this.appBootSettings=null}}Object(b.a)(ba,"AppVersionControllerFactoryParameters",null,[]);class ka{constructor(){this.telemetryCollector=this.baseVersionInfo=this.selectedVersionInfo=null}}Object(b.a)(ka,"OnVersionSelectedParams",null,[]);class Pa{constructor(){this.appName=
0;this.wdEnableDownloadTokens=!1;this.retryCount=0;this.wdEnableIterator=this.wdEnableRestore=this.wdEnableSaveACopy=!1;this.uiLocale=this.wacCluster=this.userSessionId=null;this.disableSaveACopy=this.wdEnableShowVersionChanges=this.wdEnableHiddenButtonsUntilVersionLoadComplete=this.viewerRootPositionRelative=this.useXhr=this.isRtl=!1;this.disabledChangeGates=null;this.wdEnableDeleteVersions=this.wdEnableSaveACopyOverFlowMenu=!1;this.wdExperimentWithIteratorLocation=this.wdEnableAppColorUpdate=null}}
Object(b.a)(Pa,"AppSettings",null,[]);class Fa{constructor(){this.perfTelemetryInfos=this.appSettings=this.docId=this.latestStreamServiceBase=this.serviceBase=this.ulsLogger=null}}Object(b.a)(Fa,"ControllerFactoryParameters",null,[]);var oa;(function(Fb){Fb[Fb.none=0]="none";Fb[Fb.vhUnknown=1]="vhUnknown";Fb[Fb.vhFailedToLoadVersionList=100]="vhFailedToLoadVersionList";Fb[Fb.vhFailedToGetDownloadToken=101]="vhFailedToGetDownloadToken";Fb[Fb.vhFailedToParseVersionList=102]="vhFailedToParseVersionList";
Fb[Fb.vhFetchFailed=103]="vhFetchFailed";Fb[Fb.vhVersioningNotEnabled=104]="vhVersioningNotEnabled";Fb[Fb.vhFileNotFound=105]="vhFileNotFound";Fb[Fb.vhVersionTooOld=106]="vhVersionTooOld";Fb[Fb.vhFetchException=107]="vhFetchException";Fb[Fb.vhServiceUnavailable=108]="vhServiceUnavailable";Fb[Fb.vhBadGateway=109]="vhBadGateway";Fb[Fb.vhUnauthorized=110]="vhUnauthorized";Fb[Fb.vhInternalServerError=111]="vhInternalServerError";Fb[Fb.vhEmptyVersionMetadatas=112]="vhEmptyVersionMetadatas";Fb[Fb.vhFailedHostDownload=
113]="vhFailedHostDownload";Fb[Fb.vhFailedToAddDownloadToVersionStore=114]="vhFailedToAddDownloadToVersionStore";Fb[Fb.vhFailedToCacheParts=115]="vhFailedToCacheParts";Fb[Fb.vhFailedToDownloadVersionMetadata=116]="vhFailedToDownloadVersionMetadata";Fb[Fb.vhFailedToDownloadParts=117]="vhFailedToDownloadParts";Fb[Fb.vhInvalidDocID=118]="vhInvalidDocID";Fb[Fb.vhMissingDocID=119]="vhMissingDocID";Fb[Fb.vhNullDocID=120]="vhNullDocID";Fb[Fb.vhNullHashedDocID=121]="vhNullHashedDocID";Fb[Fb.vhNullGetDownloadAccessTokenRequest=
122]="vhNullGetDownloadAccessTokenRequest";Fb[Fb.vhFailedToDownloadVersionFromHost=123]="vhFailedToDownloadVersionFromHost";Fb[Fb.vhNullResponseFromFetch=124]="vhNullResponseFromFetch";Fb[Fb.vhGetTipVersionException=125]="vhGetTipVersionException";Fb[Fb.vhGetVersionsException=126]="vhGetVersionsException";Fb[Fb.vhGetDownloadTokenException=127]="vhGetDownloadTokenException";Fb[Fb.vhFetchRetryException=128]="vhFetchRetryException";Fb[Fb.vhNullResponseFromRequestVersionHistory=129]="vhNullResponseFromRequestVersionHistory";
Fb[Fb.vhNullResponseFromRequestDownloadToken=130]="vhNullResponseFromRequestDownloadToken";Fb[Fb.vhXhrJsonParseFailed=131]="vhXhrJsonParseFailed";Fb[Fb.vhXhrException=132]="vhXhrException";Fb[Fb.vhNullResponseFromXhr=133]="vhNullResponseFromXhr";Fb[Fb.vhFileGone=134]="vhFileGone";Fb[Fb.vhNullRevisionIDs=135]="vhNullRevisionIDs";Fb[Fb.vhRequestDeleteVersionsException=136]="vhRequestDeleteVersionsException";Fb[Fb.vhNullResponseFromRequestDeleteVersions=137]="vhNullResponseFromRequestDeleteVersions";
Fb[Fb.vhVersionInfoFromTipVersionException=138]="vhVersionInfoFromTipVersionException"})(oa||(oa={}));Object(b.b)("VersionHistoryFullAppErrorCode",oa);var La=a(303);class Ea{constructor(Fb){this.baseVersionInfo=this.V3=this.npa=this.wl=this.ewaAccessibilityManager=this.cQb=null;this.nLd=this.lxf=!1;this.ZJe=!0;this.dialog=this.accessTokenExpirationManager=this.fC=this.wYe=this.eE=this.y2d=this.w2d=this.x2d=null;this.WGf=pa=>{d.ULS.sendTraceTag(42553885,0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");
if(this.lEj()){var tb=vc=>{n.c(2138207060,!1);this.wl.setRestoreFailedAtServer(vc)};this.eE&&this.eE.startTimer(Ea.Pdg);var Nb=()=>{this.eE.endTimer(Ea.Pdg);this.iBe(this.eE)};this.wl.setRestoreInProgress();ja.a(this.$).Ls(new X.a(r.a.ey,5,()=>{const vc=da.a(this.$).hd.activityState;vc[Aa.a.Hq]=r.a.VDe;vc[lb.a.DY]=!0;vc[lb.a.KT]=0;vc[x.tlg]=pa;vc[x.etc]=e.AFrameworkApplication.Hi;vc[x.sxd]=Nb;vc[t.A9f]=tb;S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RestoreVersionForConvergenceExcelOnline",
!1)&&(vc[La.a.kFd]=!0)}))}else n.c(2138207060,!1)};this.BJf=pa=>{this.cQb.then(tb=>{tb.enterFocusTrapZone();return null});d.ULS.sendTraceTag(537150349,0,50,"VersionHistoryPaneActor: OnVersionsReady called");this.eE.endTimer(Ea.fZd);this.eE.incrementCounter(Ea.q$g);d.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.eE.getTimerDuration(Ea.fZd)}`);this.qlj(pa.containerDiv);pa.versions&&0<pa.versions.length&&(this.wYe=Ea.AF(pa.versions[pa.versions.length-
1]));this.V3&&this.npa&&this.rQd(this.V3);d.ULS.sendTraceTag(537150346,0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};this.onVersionSelected=pa=>{d.ULS.sendTraceTag(537150345,0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${Ea.AF(pa.currentVersion)}, LastSelected:${Ea.AF(this.V3)}`);this.eE.incrementCounter(Ea.p$g);this.V3=pa.currentVersion;this.baseVersionInfo=pa.baseVersion;this.lxf=pa.noBaseToCompareTo;this.npa&&this.i1j()&&(this.rQd(pa.currentVersion),d.ULS.sendTraceTag(537150344,
0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};this.zBf=pa=>{d.ULS.sendTraceTag(537150337,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady called. for Version:${(null===pa||void 0===pa?0:pa.versionSelected)?Ea.AF(pa.versionSelected.currentVersion):null} UpdatedVersionsCount${(null===pa||void 0===pa?0:pa.updatedVersions)?pa.updatedVersions.length:0}, LastSelected:${Ea.AF(this.V3)}`);this.eE.incrementCounter(Ea.o$g);if(this.baseVersionInfo){if((null===pa||void 0===pa?0:pa.updatedVersions)&&
2<=pa.updatedVersions.length){let tb=null,Nb=null;const vc=Ea.AF(this.V3),Ic=Ea.AF(this.baseVersionInfo);for(const kd of pa.updatedVersions)if(pa=Ea.AF(kd),vc===pa?tb=kd:Ic===pa&&(Nb=kd),tb&&Nb)break;tb&&Nb?(this.V3=tb,this.baseVersionInfo=Nb,d.ULS.sendTraceTag(537150307,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady -Calling versionsViewController:OnVersionSelected RevisionID[N]: ${Ea.AF(this.V3)}, RevisionID[N-1]: ${Ea.AF(this.baseVersionInfo)}.`),this.rQd(this.V3)):d.ULS.sendTraceTag(537150306,
0,50,`VersionHistoryPaneActor:OnDownloadTokenReady - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: ${vc}, RevisionID[N-1]: ${Ic}.`)}else d.ULS.sendTraceTag(537150305,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.");d.ULS.sendTraceTag(537150304,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady")}else d.ULS.sendTraceTag(537150336,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady baseVersionInfo is null in OnDownloadTokenReady callback.")};
this.xAf=()=>{d.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");this.U4g();const pa=new Z.a(1470556788,0,this.$.Hc,0,null);this.$.Ja.Lb(pa)};this.mHf=pa=>{d.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");let tb=new Z.a(-1244760097,0,this.$.Hc,0,null);this.$.ie.get(51)&&(d.ULS.sendTraceTag(537150301,0,50,"VersionHistoryPaneActor:OnSaveACopy for ODConsumer Called"),tb=new Z.a(-309686558,0,this.$.Hc,0,null));n.c(1604651619,!0);
this.$.Ja.Lb(tb,{["FileDownloadUrl"]:pa})};this.ABf=pa=>{d.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");if(!S.EwaSettings.isChangeGateEnabled("OfficeVSO:6794681_VHDisableDownloadACopy")||this.kEj())pa=new T.QueryStringBuilder(pa),pa.qj("fn",e.AFrameworkApplication.fileName),d.ULS.sendTraceTag(537150299,0,50,"VersionHistoryPaneActor:OnDownloadVersion URL Length is "+pa.toString().length),8===this.$.frame.j$a(pa.toString(),!0)?(d.ULS.sendTraceTag(587830283,0,10,
"VersionHistoryPaneActor:OnDownloadVersion failed"),n.c(1316171850,!1)):n.c(1316171850,!0)};this.dzf=pa=>{this.wl.setFullAppErrorCode(pa);S.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&this.wl.setViewerError(!0)};this.Iwe=pa=>{const tb=document.getElementById(Ea.GVe);!tb||this.fC&&!pa||(d.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),this.fC=new Y.a(tb.contentWindow,w.a.dba(this.$.va.VersionHistoryActionUrl)||
fa.a.m$),this.fC.dm(H.a.rVa,this.eJb),this.fC.dm(H.a.sVa,this.eJb),this.fC.so(Y.a.setCurrentChangeCount),this.fC.so(Y.a.setTotalChangesCount),S.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.fC.so(Y.a.YPa),this.fC.dm(Y.a.setCurrentChangeCount,this.eJb),this.fC.dm(Y.a.setTotalChangesCount,this.eJb),S.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.fC.dm(Y.a.YPa,this.eJb))};this.MCf=pa=>{if(S.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes"))pa=
oa[pa]?oa[pa]:"None";else switch(pa){case 101:pa="VHFailedToGetDownloadToken";break;case 100:pa="VHFailedToLoadVersionList";break;case 104:pa="VHVersioningNotEnabled";break;case 105:pa="VHFileNotFound";break;case 106:pa="VHVersionTooOld";break;default:pa="None"}this.eE.addEvent("OnFullAppError",pa);d.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${pa}`)};this.LEd=pa=>{this.ZJe=pa;d.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${pa.toString()}`);this.PQd(Y.a.FPb,
{["ToggleValue"]:pa})};this.gEf=pa=>{d.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${pa}`);n.c(1488635506,!0);const tb={};pa?this.PQd(Y.a.iterateNext,tb):this.PQd(Y.a.Uxa,tb)};this.eJb=pa=>{switch(pa.MessageId){case H.a.rVa:d.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");S.EwaSettings.ma(414)&&this.wl.setVersionLoadComplete();break;case H.a.sVa:d.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");
break;case Y.a.setCurrentChangeCount:pa=pa.Values.count;d.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${pa}`);this.wl.setCurrentChangeCount(pa);break;case Y.a.setTotalChangesCount:pa=pa.Values.count;d.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${pa}`);this.wl.setTotalChangesCount(pa);break;case Y.a.YPa:this.LEd(this.ZJe);break;default:d.ULS.sendTraceTag(537150286,
0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${pa.MessageId}`)}};this.$=Fb;this.E$b=this.$.Eb+Ea.ACh;this.mLd=!1;S.EwaSettings.ma(381)&&this.Bgh();S.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.$.da.$a(38,pa=>{this.accessTokenExpirationManager=pa;this.WPa=this.WPa.bind(this);this.accessTokenExpirationManager.Dob(this.WPa)});this.dDb="";this.nvd=0;this.perfTelemetryInfos=[]}WPa(){null!=this.wl&&(this.wl.updateDocId(e.AFrameworkApplication.Hi),
d.ULS.sendTraceTag(509699330,0,50,"VersionHistoryPaneActor:onTokenRefreshed completed Successfully"))}dispose(){S.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.accessTokenExpirationManager.Xuc(this.WPa);this.ICe()}Z3i(){this.$.da.$a(15,Fb=>{this.ewaAccessibilityManager=Fb;this.ewaAccessibilityManager.mode=2})}Bgh(){this.x2d=new la(this);this.w2d=new Ca(this);this.y2d=new Ra(this)}AHj(){d.ULS.sendTraceTag(41739649,0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");
e.AFrameworkApplication.PN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryEnableODCSaveACopy");e.AFrameworkApplication.PN("Microsoft.Office.Excel.Server.Flighting.IDenyListVersionHistorySaveACopyOverFlowMenu");e.AFrameworkApplication.PN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryRestoreSkipCoauthCheck");e.AFrameworkApplication.Ip("8492a557;72ff4572");this.eE=excelVersionHistory.FactoryGlobal.getTelemetryCollector();this.perfTelemetryInfos=[];this.eE.startTimer(Ea.Odg);
if(!this.wl&&(aa.a(()=>{this.wl=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(Object(V.a)(new Fa,{ulsLogger:new D.a,docId:e.AFrameworkApplication.Hi,appSettings:Object(V.a)(new Pa,{appName:120,userSessionId:e.AFrameworkApplication.userSessionId,wdEnableSaveACopy:S.EwaSettings.ma(350),wdEnableDownloadTokens:S.EwaSettings.ma(345),wacCluster:e.AFrameworkApplication.zd.mP,uiLocale:e.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:S.EwaSettings.ma(316)&&this.$.isEditMode,wdEnableIterator:S.EwaSettings.ma(313)&&
S.EwaSettings.ma(314),useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:S.EwaSettings.ma(414),disableSaveACopy:this.$Td(),wdEnableShowVersionChanges:S.EwaSettings.ma(313)&&S.EwaSettings.ma(315),disabledChangeGates:this.$.va.VHSDisabledChangeGates,wdEnableSaveACopyOverFlowMenu:S.EwaSettings.ma(530),isRtl:e.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",!1)}),perfTelemetryInfos:this.perfTelemetryInfos}))}),
!this.wl))return d.ULS.sendTraceTag(537150352,0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),n.c(429638140,!1),!1;this.BHj();this.eE.endTimer(Ea.Odg);this.eE.startTimer(Ea.Rdg);d.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");n.c(429638140,!0);return!0}BHj(){var Fb;this.$dj();if(!document.getElementById(this.E$b)){const pa=document.createElement("div");pa.id=this.E$b;pa.style.width=
"100%";pa.style.zIndex="998";pa.style.display="block";pa.style.position="absolute";if(e.AFrameworkApplication.ta.Pa.Ve){const tb=(null===(Fb=document.getElementById("HeaderRegion"))||void 0===Fb?void 0:Fb.offsetHeight)||0;pa.style.top=tb+"px";pa.style.bottom="0px";pa.style.height=`calc(100vh - ${tb}px)`}else pa.style.height="100%";this.$.vr.insertBefore(pa,this.$.vr.firstChild);this.cQb=this.wl.createVersionHistoryDialog(pa)}document.getElementById(this.E$b).style.display="block";this.bLd();this.eE.startTimer(Ea.fZd);
this.wl.getVersions("")}bLd(){S.EwaSettings.ma(381)&&(this.x2d.di(),this.w2d.di(),this.y2d.di(),this.Z3i())}v0d(){S.EwaSettings.ma(381)&&(this.x2d.p8(),this.w2d.p8(),this.y2d.p8(),this.ewaAccessibilityManager&&(this.ewaAccessibilityManager.mode=0))}$dj(){this.wl.getVersionsReadyEvent().addListener(this.BJf);this.wl.getVersionSelectedEvent().addListener(this.onVersionSelected);this.wl.getCloseSelectedEvent().addListener(this.xAf);this.wl.getFullAppErrorEvent().addListener(this.MCf);this.wl.getIteratorSelectedEvent().addListener(this.gEf);
this.wl.getShowVersionChangesToggledEvent().addListener(this.LEd);S.EwaSettings.ma(345)&&(this.wl.getDownloadTokenReadyEvent().addListener(this.zBf),this.mLd=!0);S.EwaSettings.ma(350)&&(this.wl.getSaveACopySelectedEvent().addListener(this.mHf),this.wl.getDownloadVersionSelectedEvent().addListener(this.ABf));S.EwaSettings.ma(316)&&this.$.isEditMode&&(this.wl.getRestoreVersionSelectedEvent().addListener(this.WGf),this.nLd=!0)}aej(){this.npa.getAppErrorEvent().addListener(this.dzf)}gk(){this.wl.getVersionsReadyEvent().removeListener(this.BJf);
this.wl.getVersionSelectedEvent().removeListener(this.onVersionSelected);this.wl.getCloseSelectedEvent().removeListener(this.xAf);this.wl.getFullAppErrorEvent().removeListener(this.MCf);this.wl.getIteratorSelectedEvent().removeListener(this.gEf);this.wl.getShowVersionChangesToggledEvent().removeListener(this.LEd);S.EwaSettings.ma(350)&&(this.wl.getSaveACopySelectedEvent().removeListener(this.mHf),this.wl.getDownloadVersionSelectedEvent().removeListener(this.ABf));this.mLd&&(this.wl.getDownloadTokenReadyEvent().removeListener(this.zBf),
this.mLd=!1);this.nLd&&(this.wl.getRestoreVersionSelectedEvent().removeListener(this.WGf),this.nLd=!1);this.npa&&this.npa.getAppErrorEvent().removeListener(this.dzf)}ZBj(){return this.$Td()||!e.AFrameworkApplication.yZ}kEj(){return this.ZBj()?(d.ULS.sendTraceTag(520180169,0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),n.c(1316171850,!1),!1):!0}lEj(){let Fb=!0;if(S.EwaSettings.ma(592)&&!this.$.AN)return d.ULS.sendTraceTag(537150350,0,15,"VersionHistoryPaneActor:ShouldTriggerRestore - Skipping coauth check with status "+
this.$.ea.amIAlone.toString()),!0;if(!this.$.ea.amIAlone&&!S.EwaSettings.ma(312)){this.xzi();this.wl.setCoauthRestoreError();Fb=!1;const pa=new Z.a(-729359593,0,this.$.Hc,0,null);this.$.Ja.Lb(pa)}this.$.AN&&(d.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),Fb&&(Fb=!1,this.zHj()));return Fb}zHj(){var Fb=P.a.$c(1,0,1894,1893,0,-1603358883,"RestoreVersionUnsavedChangesError");Fb=this.dialog||new U.ErrorDialog(this.$,Fb);Fb.initialize();
Fb.xg()}i1j(){d.ULS.sendTraceTag(537150343,0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?Ea.AF(this.baseVersionInfo):""}`);if(Ea.AF(this.V3)===this.wYe)return d.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0;if(S.EwaSettings.isChangeGateEnabled("OfficeVSO:4381797_XLVHSkipBaseVersionValidateForGroupingUI")&&!this.baseVersionInfo&&this.lxf)return d.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),
!0;if(!this.baseVersionInfo)return d.ULS.sendTraceTag(537150340,0,10,"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),!1;const Fb=Ea.uSh(this.baseVersionInfo);d.ULS.sendTraceTag(537150339,0,50,`downloadURL length ${Fb?Fb.length:0}`);return Fb?!0:(d.ULS.sendTraceTag(537150338,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters downloadURL is null"),!1)}$Td(){return!this.$.cla}U4g(){document.getElementById(this.E$b).style.display="none";const Fb=new Z.a(-1423792966,0,
this.$.Hc,0,null);this.$.Ja.Lb(Fb);this.ICe()}ICe(){this.eE&&(this.eE.endTimer(Ea.Rdg),this.iBe(this.eE),this.eE=null);this.gk();this.v0d();this.perfTelemetryInfos&&(d.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.map(Fb=>JSON.stringify(Fb)).toString()),this.perfTelemetryInfos=null);this.fC&&(this.fC.cpa(H.a.rVa),this.fC.cpa(H.a.sVa),this.fC.cpa(Y.a.setCurrentChangeCount),this.fC.cpa(Y.a.setTotalChangesCount),S.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.fC.cpa(Y.a.YPa),this.fC.dispose(),this.fC=null)}qlj(Fb){try{this.npa?(G.setIsPageLoadForFirstTime(!1),S.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&!document.getElementById(Ea.GVe)&&(this.npa.resetContainer(Fb),this.Iwe(!0))):(G.setIsPageLoadForFirstTime(!0),aa.a(()=>{const pa=new Oa;pa.ulsLogger=new D.a;pa.actionUrl=this.$.va.VersionHistoryActionUrl;pa.hideEmbedFooter=!0;pa.useFetch=S.EwaSettings.ma(409)&&!J.a.Iw;this.npa=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance(Object(V.a)(new ba,
{appBootSettings:pa,rootDiv:Fb}))})),this.aej()}catch(pa){d.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${pa}`)}}rQd(Fb){d.ULS.sendTraceTag(537150298,0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${Ea.AF(Fb)}, LastSelected:${this.dDb}`);if(Fb)if(Ea.AF(Fb).length){var pa=(new Date).getTime();if(Ea.AF(Fb)===this.dDb&&1E3>pa-this.nvd)d.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");
else{Ea.AF(Fb)!==this.dDb&&(d.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.wl.setTotalChangesCount(-1),this.wl.setCurrentChangeCount(-1));var tb=excelVersionHistory.FactoryGlobal.getTelemetryCollector();tb.addEvent("SelectVersion",Ea.AF(Fb));try{this.K3j(tb);this.nvd=pa;this.dDb=Ea.AF(Fb);const Nb=new ka;Nb.selectedVersionInfo=this.V3;Nb.baseVersionInfo=this.baseVersionInfo;Nb.telemetryCollector=tb;this.npa.onVersionSelectedWithParams(Nb);
this.wl&&S.EwaSettings.ma(350)&&this.wl.setDisableSaveACopy(this.$Td());this.Iwe(!1)}catch(Nb){this.nvd=0,this.dDb="",tb.addEvent("Exception",Nb.toString()),d.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${Nb}`)}finally{d.ULS.sendTraceTag(537150292,0,50,tb?tb.getJsonForLogging():"")}}}else d.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else d.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}K3j(Fb){for(const pa of this.perfTelemetryInfos){const tb=
pa.TelemetryEventKey?pa.TelemetryEventKey:pa.telemetryEventKey?pa.telemetryEventKey:"",Nb=pa.TelemetryEventData?pa.TelemetryEventData:pa.telemetryEventData?pa.telemetryEventData:"";tb&&Nb&&Fb.addEvent(tb,Nb)}this.perfTelemetryInfos.length=0}iBe(Fb){d.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${Fb?Fb.getJsonForLogging():""} `)}xzi(){const Fb=this.$.ea.Xm,pa={};let tb=null;for(const Nb of Fb)Nb.UserEmail&&(pa[Nb.UserEmail]=Nb.UserEmail in pa?pa[Nb.UserEmail]+
1:1),Nb.User.UserID===this.$.ea.clientId&&(tb=Nb.UserEmail);d.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${Fb.length}, TotalAuthorsAsYourself ${tb?pa[tb]:-1}`)}PQd(Fb,pa){d.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${Fb}`);if(this.fC){Fb=new M.a(Fb);Fb.Values[Q.a.c7c]=this.$.va.UserSessionId;if(pa)for(let tb in pa)Fb.Values[tb]=pa[tb];this.fC.send(Fb)}else d.ULS.sendTraceTag(537150284,
0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static AF(Fb){return Fb?Fb.RevisionID?Fb.RevisionID:Fb.revisionID?Fb.revisionID:"":""}static uSh(Fb){return Fb?Fb.DownloadUrl?Fb.DownloadUrl:Fb.downloadUrl?Fb.downloadUrl:"":""}}Ea.ACh="_excelVersionHistoryOverlay";Ea.GVe="vhs_frame";Ea.Odg="TimeTakenShowVersionHistoryDialogAction";Ea.Rdg="TimeTillVersionHistoryDialogWasOpenMs";Ea.fZd="TimeTakenGetVersionsToOnVersionsReady";Ea.p$g="CountOnVersionSelectedCalledinOneVHSession";
Ea.q$g="CountOnVersionsReadyCalledinOneVHSession";Ea.o$g="CountOnDownloadTokenReadyCalledinOneVHSession";Ea.Pdg="TimeTakenVersionRestore";Object(b.a)(Ea,"VersionHistoryPaneActor",null,[2]);var ca=a(185);class $a extends C.a{constructor(Fb){super(Fb)}ld(){const Fb=this.Hyi(),pa=B.GetServiceTaskFactory.Oa(this.$.da,21,137,this.Ya);z.TaskExtensions.za(z.TaskExtensions.Ed([Fb,pa],this.ka,3),()=>{var tb=pa.result;const Nb=w.a.dba(this.$.va.VersionHistoryActionUrl);Nb!==fa.a.m$&&tb.vGa(Nb);tb=new Ea(this.$);
this.Zc([new L(this.$,tb)])},this.ka,3)}Hyi(){const Fb=B.GetServiceTaskFactory.aka(this.$.da,283,284,this.Ya).then(pa=>pa.kn.loadScript("excelVersionHistory"),pa=>{d.ULS.sendTraceTag(537150412,0,10,`versionHistoryManagerFactory: Dynamic Script Loading failed due to exception. ${pa}`);return Promise.reject(pa)});return ca.c(Fb)}static la(Fb){C.a.Nd(304,new $a(Fb))}}Object(b.a)($a,"VersionHistoryCommandHandlerFactory",C.a,[]);var Qa=a(1262),Va=a(697);class fb extends f.a{constructor(Fb){super();this.$=
Fb;this.Fb()}create(){const Fb=B.GetServiceTaskFactory.Oa(this.$.da,211,212,this.Ya),pa=B.GetServiceTaskFactory.Oa(this.$.da,21,137,this.Ya);z.TaskExtensions.za(z.TaskExtensions.Ed([Fb,pa],this.$.ka),()=>{const tb=Object(Va.a)(this.$.da,305,()=>new Qa.a(this.$,!0,pa.result,Fb.result));this.nb(tb)},this.$.ka,3)}static la(Fb){Fb.da.Ga(306,new fb(Fb))}}Object(b.a)(fb,"VersionHistoryHighlightManagerFactory",f.a,[]);var Ka=a(513),hb=a(5),fc=a(161),dc=a(13);class wb extends h.a{constructor(Fb,pa,tb){super(Fb,
pa);this.lineageManager=tb}execute(Fb){this.lineageManager.lineageHidePreviousHistory();return super.execute(Fb)}}Object(b.a)(wb,"LineageClearHistoryConfirmedActivity",h.a,[]);var Tb=a(17),xb=a(140);class cb{constructor(Fb,pa){this.$=Fb;this.lineageManager=pa;Fb=[new Tb.a(r.a.awd,1038647878,0,0,2238),new Tb.a(r.a.idle,1038647878,0,1)];da.a(this.$).QKd(new xb.a(r.a.$vd,r.a.idle,Fb),new wb(r.a.awd,r.a.idle,pa))}nc(){return!1}executeCommand(Fb,pa,tb){Fb=!1;switch(pa.command){case 1834994092:9===pa.af&&
this.WMj();this.$Ej(pa,tb);Fb=!0;break;case -409942531:this.bFj(),Fb=!0}return Fb?I.Task.Ta(!0):A.a(pa.command)}wc(Fb,pa){return 1834994092===pa.command||-409942531===pa.command}Kc(){return!1}$Ej(Fb,pa){d.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${pa.MenuItemId||Fb.af}`);this.lineageManager.Y8f(19===Fb.af&&!!pa.MenuItemId,pa.MenuItemId,Fb.af,pa)}WMj(){const Fb=hb.a.wtc;Fb!==fc.a(this.$).Em.dA&&fc.a(this.$).Em.activateRibbonTab(Fb)}bFj(){ja.a(this.$).Ls(new X.a(r.a.$vd,
5,()=>{const Fb=da.a(this.$).hd,pa=P.a.$c(3,1,2235,2236,2237,1038647878,"LineageConfirmClearHistory");pa.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";pa.HelpDescription=dc.a.instance.ga(1315);Fb.rr([pa])}))}}Object(b.a)(cb,"LineageActivityCommandHandler",null,[208]);class jb extends C.a{constructor(Fb){super(Fb)}ld(){z.TaskExtensions.za(B.GetServiceTaskFactory.Oa(this.$.da,366,367,this.Ya),Fb=>{this.Zc([new cb(this.$,Fb.result)])},this.ka,3)}static la(Fb){C.a.Nd(363,new jb(Fb))}}Object(b.a)(jb,
"LineageActivityCommandHandlerFactory",C.a,[]);class qa{constructor(Fb){this.CTa=!0;qa.Qgf()?qa.gki()?this.CTa=!1:qa.$gf()?(d.ULS.sendTraceTag(526434368,0,50,`LineageCatchUpExperimentManager is running in hybrid mode. TUI exhausted: ${!Fb}`),this.CTa=Fb):this.CTa=!1:this.CTa=!0}E7a(){return!this.CTa}static $gf(){return qa.Qgf()&&S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationTeachingUXTreatmentToControl",!1)}static Qgf(){return S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationSummaryStringTreatment",
!1)}static gki(){return S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)}}Object(b.a)(qa,"LineageCatchUpExperimentManager",null,[595]);class za extends f.a{constructor(Fb){super();this.$=Fb;this.Fb()}create(){qa.$gf()?z.TaskExtensions.za(B.GetServiceTaskFactory.Oa(this.$.da,456,457,this.Ya),Fb=>{z.TaskExtensions.za(Fb.result.wDj(),pa=>{this.OHe(pa.result)},this.$.ka,3)},this.$.ka,3):this.OHe(!0)}OHe(Fb){this.nb(this.$.da.Aa(458)||this.$.da.Ga(458,new qa(Fb)))}static la(Fb){Fb.da.Ga(459,
new za(Fb))}}Object(b.a)(za,"LineageCatchUpExperimentManagerFactory",f.a,[]);var Na=a(420),ua=a(33),Xa=a(82),ha=a(147),ta=a(120);class wa{}Object(b.a)(wa,"LineageClientParams",null,[]);class db{}Object(b.a)(db,"LineageFilter",null,[]);var Jb=a(66),Pb=a(76),eb=a(132),Ma=a(40),ob=a(188),Ia=a(116),Da=a(109),nb=a(282),Ua=a(281),W=a(21),sa=a(133),vb=a(60);const gc=(Fb,pa,tb,Nb,vc,Ic,kd,xd=null)=>{xd=Fb.Na(1,xd);xd.clientParams=pa;xd.lineageFilter=tb;return vb.g(Fb,"LineageOpenPaneOrChangeFilter",xd,Nb,
vc,Ic,kd,0)},Bc=(Fb,pa,tb,Nb,vc,Ic,kd=null)=>{kd=Fb.Na(1,kd);kd.fetchFromBelow=pa;return vb.g(Fb,"LineageLoadMore",kd,tb,Nb,vc,Ic,0)},Sa=(Fb,pa,tb,Nb,vc,Ic=null)=>{Ic=Fb.Na(1,Ic);return vb.g(Fb,"LineageRefreshView",Ic,pa,tb,Nb,vc,0)},na=(Fb,pa,tb,Nb,vc,Ic=null)=>{Ic=Fb.Na(1,Ic);return vb.g(Fb,"LineageUpdateView",Ic,pa,tb,Nb,vc,0)},ib=(Fb,pa,tb,Nb,vc,Ic=null)=>{Ic=Fb.Na(1,Ic);return vb.g(Fb,"LineageClosePane",Ic,pa,tb,Nb,vc,0)},Ib=(Fb,pa,tb,Nb,vc,Ic=null)=>{Ic=Fb.Na(1,Ic);return vb.g(Fb,"LineageHidePreviousHistory",
Ic,pa,tb,Nb,vc,0)},ec=(Fb,pa,tb,Nb,vc,Ic=null)=>{Ic=Fb.Na(1,Ic);return vb.g(Fb,"LineageLoadInGridBlueDots",Ic,pa,tb,Nb,vc,0)};var qb=a(51),Ha=a(347);class Ab{constructor(){this.activityList=null;this.oldestActivityId=this.latestActivityId=0;this.lastSearchedActivityTimestamp=null;this.serverLastActivityId=this.serverFirstActivityId=this.serverMessageCode=0;this.docId=null;this.showLoadPrevious=!1;this.eolPersonHideHistory=this.eolDateHideHistory=this.eolCorrelationId=null}}Object(b.a)(Ab,"LineageActivitiesResponseDTO",
null,[]);class Yb extends Ab{constructor(){super();this.hasNewActivities=!1;this.filterSheetMultiRange=null}}Object(b.a)(Yb,"LineageActivitiesUpdateResponseDTO",Ab,[]);class Bb{constructor(){this.shouldShowBlueDot=this.onDisplayInGridHighlightsChanged=this.areInGridHighlightsEnabled=this.areInGridHighlightsAvailable=this.onDegradedCardGiveFeedbackButtonClicked=this.onLearnMoreLinkClicked=this.isFeatureEnabled=this.onRangeFilterInputEnabled=this.tryParseRangeInfo=this.onVersionHistoryButtonClicked=
this.onCardSelected=this.lineageUpdateViewRequest=this.lineageRefreshViewRequest=this.lineageLoadMoreRequest=this.lineageOpenPaneOrChangeFilterRequest=null}}Object(b.a)(Bb,"LineageAppCallbacks",null,[]);class Qb{constructor(){this.imageUrl=this.email=this.displayName=this.provider=this.id=null}}Object(b.a)(Qb,"LineageAuthorDTO",null,[]);class sc{constructor(){this.logger=this.uiCulture=this.dataCulture=null;this.clientBatchSize=0;this.lineageAppCallbacks=this.filterableSheetList=null}}Object(b.a)(sc,
"LineageControllerFactoryParams",null,[]);class kb{constructor(){this.lastCol=this.firstCol=this.lastRow=this.firstRow=0}}Object(b.a)(kb,"LineageSharedRangeDTO",null,[]);class Eb{constructor(){this.sheetName=this.rangeList=null}}Object(b.a)(Eb,"LineageSheetMultiRangeDTO",null,[]);class Gc{constructor(){this.activityId=0;this.displayTimestamp=this.author=this.activityGuid=null;this.activityType=0;this.rangeHighlightLocation=this.isBulkEditOverflow=this.valueChanges=this.gridLocation=this.sheetName=
this.nestedActivityList=null;this.degradedCardTypeBits=0}}Object(b.a)(Gc,"LineageUserActivityDTO",null,[]);class zc{constructor(){this.hasOldValue=this.hasNewValue=!1;this.cellLocation=this.oldValue=this.newValue=null}}Object(b.a)(zc,"LineageValueChangeDTO",null,[]);var yb;(function(Fb){Fb[Fb.default=0]="default";Fb[Fb.D48X48=1]="D48X48";Fb[Fb.D64X64=2]="D64X64";Fb[Fb.D96X96=3]="D96X96";Fb[Fb.D120X120=4]="D120X120";Fb[Fb.D240X240=5]="D240X240";Fb[Fb.D360X360=6]="D360X360";Fb[Fb.D432X432=7]="D432X432";
Fb[Fb.D504X504=8]="D504X504";Fb[Fb.D648X648=9]="D648X648"})(yb||(yb={}));Object(b.b)("ProfilePhotoDimension",yb);const gb=(Fb,pa)=>{let tb=[];for(const Od of Fb){Fb=Od;var Nb=pa,vc=Object(V.a),Ic=new Gc,kd=Number.parseLocale(Fb.UserActivity.Id),xd=Fb.Uid,ae=Fb.UserActivity.Type;var oe=Fb.UserActivity.Person;var ve=Nb;if(oe){var Ge=null;e.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(Ge=ve.Ota(oe.Email,oe.Provider,e.AFrameworkApplication.Hi,yb.default));oe=Object(V.a)(new Qb,
{id:oe.Id,provider:oe.Provider,displayName:oe.DisplayName,email:oe.Email,imageUrl:Ge})}else oe=null;ve=Fb.SheetName;Ge=new Date(Fb.UserActivity.DisplayTimestamp);var ye=Fb.DisplayLocation,qf=Fb.LineageValueChangeList;var Ja=[];for(const ie of qf)qf=Object(V.a)(new zc,{hasNewValue:ie.HasNewValue,hasOldValue:ie.HasOldValue,newValue:ie.HasNewValue?ie.NewValue:null,oldValue:ie.HasOldValue?ie.OldValue:null,cellLocation:ie.CellLocation}),Ja.push(qf);qf=Fb.IsBulkEditOverFlow;a:{var Db=Fb.UserActivity.LocationList;
var rc=Fb.UserActivity.Type;if(!Db){d.ULS.sendTraceTag(512259102,0,15,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is null");rc=null;break a}if(!Db.length){d.ULS.sendTraceTag(512259101,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is empty");rc=null;break a}var Yc=[],qd=[];let ie="";21===rc?qd.push(Db[0]):qd=Db;for(const le of qd)switch(le.Type){case 1:break;case 2:ie=le.SheetName;break;case 0:Db=le;if(!Db.RangeList){d.ULS.sendTraceTag(512259099,0,50,
"LineageManagerUtil:: RangeHighlightLocation.RangeActivityLocation is null");break}ie=Db.RangeList[0].SheetName;qd=[];21===rc?qd.push(Db.RangeList[0]):qd=Db.RangeList;for(const bf of qd)Db=Object(V.a)(new kb,{firstCol:bf.FirstColumn,firstRow:bf.FirstRow,lastRow:bf.LastRow,lastCol:bf.LastColumn}),Yc.push(Db);break;default:d.ULS.sendTraceTag(512259098,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is of type: ",le.Type)}rc=Object(V.a)(new Eb,{sheetName:ie,rangeList:Yc})}Nb=(Yc=
Fb.NestedActivityList)?gb(Yc,Nb):null;Fb=vc(Ic,{activityId:kd,activityGuid:xd,activityType:ae,author:oe,sheetName:ve,displayTimestamp:Ge,gridLocation:ye,valueChanges:Ja,isBulkEditOverflow:qf,rangeHighlightLocation:rc,nestedActivityList:Nb,degradedCardTypeBits:Fb.DegradedCardTypeBits});25===Fb.activityType?(vc=[],Kb(Fb,vc),tb=[...tb,...vc]):tb.push(Fb)}return tb},Kb=(Fb,pa)=>{25===Fb.activityType?Fb.nestedActivityList.forEach(tb=>{tb&&Kb(tb,pa)}):pa.push(Fb)};class sd{constructor(Fb,pa,tb,Nb,vc){this.J3a=
this.VF=null;this.JE=this.dwd=0;this.uGb=()=>{this.S7&&(this.S7.stop(),this.S7=null);this.INb.start();this.VF.createLineageTaskPane(this.Zvd,this.J3a,this.activityGuid)};this.lineageOpenPaneOrChangeFilterRequest=(Ic,kd)=>{this.INb.stop();sa.b(this.$).ud(eb.a.yTi,{});this.pHj();const xd=Object(V.a)(new wa,{ClientViewCapacity:Ic.clientViewCapacity});let ae=null;kd&&(ae=Object(V.a)(new db,{FilterSheetMultiRange:this.MRj(kd.filterSheetMultiRange)}));const oe=ve=>{ve=Ia.a.Pe(ve.data);d.ULS.sendTraceTag(537155481,
0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${P.a.sc(ve)}]`)};this.$.userOperationManager.Ic(new ob.a(1010,0,(ve,Ge,ye)=>gc(this.$.pa.ya,xd,ae,Ua.b(ve,this.whd("LineageOpenPaneOrChangeFilter")),Ua.a(Ge,oe),ye,null),80),null)};this.lineageLoadMoreRequest=Ic=>{sa.b(this.$).ud(eb.a.xTi,{});const kd=xd=>{xd=Ia.a.Pe(xd.data);d.ULS.sendTraceTag(537155480,0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${P.a.sc(xd)}]`)};this.$.userOperationManager.Ic(new ob.a(1011,
0,(xd,ae,oe)=>Bc(this.$.pa.ya,Ic,Ua.b(xd,this.whd("LineageLoadMore")),Ua.a(ae,kd),oe,null),80),null)};this.lineageRefreshViewRequest=()=>{sa.b(this.$).ud(eb.a.zTi,{});const Ic=kd=>{kd=Ia.a.Pe(kd.data);d.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${P.a.sc(kd)}]`)};this.$.userOperationManager.Ic(new ob.a(1012,0,(kd,xd,ae)=>Sa(this.$.pa.ya,Ua.b(kd,this.whd("LineageRefreshView")),Ua.a(xd,Ic),ae,null),80),null)};this.lineageUpdateViewRequest=()=>{na(this.$.pa.ya,
Ic=>{if(Ic=nb.a(Ic)?null:Ic.Result){var kd={["CountOfUpdatedActivities"]:Ic.LineageActivitiesResponse.ActivityList.length};sa.b(this.$).ud(eb.a.ATi,kd);Ic=Object(V.a)(new Yb,{activityList:S.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?gb(Ic.LineageActivitiesResponse.ActivityList,this.Yza):this.zId(Ic.LineageActivitiesResponse.ActivityList),latestActivityId:Ic.LineageActivitiesResponse.LastSearchedActivityId,oldestActivityId:Ic.LineageActivitiesResponse.FirstSearchedActivityId,
serverMessageCode:Ic.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(Ic.LineageActivitiesResponse.EcmaLastSearchedDate),hasNewActivities:Ic.HasNewActivities,filterSheetMultiRange:this.CRj(Ic.LineageActivitiesResponse.FilterSheetMultiRange),serverFirstActivityId:Ic.LineageActivitiesResponse.ServerFirstActivityId,serverLastActivityId:Ic.LineageActivitiesResponse.ServerLastActivityId,showLoadPrevious:Ic.LineageActivitiesResponse.ShowLoadPrevious,eolCorrelationId:Ic.LineageActivitiesResponse.EolCorrelationId,
eolDateHideHistory:new Date(Ic.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.Dxb(Ic.LineageActivitiesResponse.EolPersonHideHistory)});this.VF.onLineageActivitiesUpdateResponse(Ic)}else d.ULS.shipAssertTag(537155475,0,!!Ic,"LineageManager.LineageUpdateView returned null response.")},Ic=>{Ic=Ia.a.Pe(Ic.data);d.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${P.a.sc(Ic)}]`)},null,null)};this.areInGridHighlightsAvailable=()=>
this.blueDotManager&&this.blueDotManager.areInGridHighlightsAvailable();this.areInGridHighlightsEnabled=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled();this.onDisplayInGridHighlightsChanged=Ic=>{this.blueDotManager&&this.blueDotManager.xwj(Ic)};this.onCardSelected=(Ic,kd)=>{if(Ic=Ic.rangeHighlightLocation){if(kd){let xd;if(({range:xd}=Ma.Z(kd,S.EwaSettings.isChangeGateEnabled("OfficeVSO:7236999_passEwaSheetsInLineageManager")?this.$.xa:null)).returnValue){this.jcf(Ic.sheetName,
this.p5a([Ma.j(xd)]));return}d.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+kd+" is not valid.")}Ic.rangeList.length?this.jcf(Ic.sheetName,Ic.rangeList):this.bbi(Ic.sheetName)}};this.onLearnMoreLinkClicked=()=>{const Ic=new Z.a(-859308420,Pb.a.Db,this.$.Hc,12,null);this.$.Ja.Lb(Ic,{[Pb.a.og]:"HelpID=XLO_LineageTS",["InputMethod"]:Pb.a.Db,[Pb.a.Jc]:hb.a.wV,["ShouldCanvasTakeFocus"]:!0})};this.onVersionHistoryButtonClicked=Ic=>{this.$.Ja.Lb(new Z.a(-1112508866,Ic,this.$.Hc,
12,null))};this.onDegradedCardGiveFeedbackButtonClicked=()=>{const Ic={};Ic[hb.a.DQ]="LineageDegradedCard";this.$.Xc(802602464,0,12,Ic)};this.isFeatureEnabled=Ic=>{switch(Ic){case "FlattenListInLineageManager":return S.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager");default:return!1}};this.Bf=()=>{const Ic=this.$.ea.Ho.LineageVersion;Ic!==this.dwd&&(d.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${Ic}, this.lineageVersion: ${this.dwd}`),
this.dwd=Ic,this.Sbj())};this.Tc=(Ic,kd)=>{this.VF&&!this.lineageTaskPane.Gic&&kd.VH&&(d.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),this.onStaleActivitiesDetected())};this.No=()=>{this.VF&&!this.lineageTaskPane.Gic&&(d.ULS.sendTraceTag(587220562,0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.ND=()=>{const Ic=this.u5a();this.VF.onFilterableSheetListChange(Ic)};this.uza=()=>{const Ic=this.u5a();this.VF.onFilterableSheetListChange(Ic)};
this.zqc=()=>{const Ic=this.u5a();this.VF.onFilterableSheetListChange(Ic)};this.onPaneClosed=()=>{this.VF.onPaneClosed();ib(this.$.pa.ya,null,Ic=>{Ic=Ia.a.Pe(Ic.data);d.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${P.a.sc(Ic)}]`)},null,null)};this.onRangeFilterInputEnabled=Ic=>{Ic?this.gridView.ha.TT(this.Pc):this.gridView.ha.$R(this.Pc)};this.Pc=()=>{var Ic=Ma.q(this.gridView.ha.ra.activeRange,this.$);Ic=Object(V.a)(new Eb,{rangeList:this.p5a(Ic.Ranges),
sheetName:Ic.SheetName});this.VF.onSelectedRangeUpdated(Ic)};this.tryParseRangeInfo=Ic=>{let kd;if(({sheetName:kd,range:Ic}=Ma.Z(Ic,this.$.xa)).returnValue){kd||(kd=this.$.xa.oa.sheetName);const xd=[];xd.push(Ic);Ic=Ma.u(kd,null,xd);return Object(V.a)(new Eb,{rangeList:this.p5a(Ic.Ranges),sheetName:Ic.SheetName})}return null};this.Sz=()=>{const Ic=this.JE!==this.$.ea.ze;this.VF&&this.lineageTaskPane.isVisible&&Ic&&(this.JE=this.$.ea.ze,this.VF.onRefreshRequired())};this.$=Fb;pa.Ga(366,this);this.blueDotManager=
Nb;this.gridView=W.h(this.$);this.lineageTaskPane=tb;this.Zvd=this.lineageTaskPane.WM();this.batchSize=50;this.S7=vc;this.INb=this.$.Kb.Qg("UserAction","LineagePaneLoadingShimmerStopWatch");this.Yza=Xa.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.Gfi();this.BHg()}dispose(){this.Vej();this.$=null;this.lineageTaskPane&&(this.lineageTaskPane.xO(this.onPaneClosed),this.lineageTaskPane.lG(this.Sz),this.lineageTaskPane=null);this.INb=this.Yza=this.J3a=this.Zvd=this.VF=null}Y8f(Fb,
pa,tb,Nb){this.activityGuid=null;if(this.lineageTaskPane.isVisible){if(9===tb){d.ULS.sendTraceTag(560989858,0,50,"LineageManager::ShowLineageTaskPane open from callout was invoked with an opened pane");return}if(!Fb&&16!==tb&&18!==tb&&30!==tb){this.lineageTaskPane.i3c();return}}ua.a.fd(this.$)||(this.INb.start(),this.S7&&(qb.b().PA(this.INb.id,this.S7.id,"actions","actions"),this.S7.stop(),this.S7=null));this.lineageTaskPane.Gic||d.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${Fb?
pa:tb}`);this.JE=this.$.ea.ze;this.J3a=null;Fb?(Fb=Ma.r(this.gridView.ha.ra.selectedRanges,this.$),this.J3a=Object(V.a)(new Eb,{rangeList:pa.toString()===hb.a.q8f?this.p5a(Fb.Ranges):null,sheetName:Fb.SheetName})):S.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&30===tb&&this.b5i(Nb);ua.a.fd(this.$)&&this.lineageTaskPane.Gic?this.lineageTaskPane.Rwj(this.uGb):this.VF.createLineageTaskPane(this.Zvd,this.J3a,this.activityGuid);this.lineageTaskPane.yg(!0);
this.$.Xc(-71295319,-1,0,null)}b5i(Fb){if(Fb){var pa=Fb.sheetName,tb=Fb.gridLocation;Fb=Fb.activityGuid;if(pa&&tb&&Fb){this.activityGuid=Fb;var Nb;({range:Nb}=Ma.Z(tb,this.$.xa)).returnValue?this.J3a=Object(V.a)(new Eb,{rangeList:this.p5a([Ma.j(Nb)]),sheetName:pa}):d.ULS.shipAssertTag(512266262,0,!1,"Blue dot sheetName/gridLocation is not valid.")}else d.ULS.shipAssertTag(509752709,0,!1,"Blue dot sheetName/gridLocation/activityGuid is not set.")}else d.ULS.shipAssertTag(509752710,0,!1,"Blue dot unexpected undefined properties for command handling.")}lineageHidePreviousHistory(){const Fb=
{["paneVisible"]:this.lineageTaskPane.isVisible};ha.a.sendTelemetryEvent(Object(V.a)(new Ha.a,{name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:ta.a.Zj(Fb)}));this.$.userOperationManager.Ic(new ob.a(1018,0,(pa,tb,Nb)=>Ib(this.$.pa.ya,pa,tb,Nb,null),64),null);this.lineageTaskPane.isVisible||this.Y8f(!1,null,4,void 0)}Gfi(){const Fb=Object(V.a)(new Bb,{tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,
onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,onDegradedCardGiveFeedbackButtonClicked:this.onDegradedCardGiveFeedbackButtonClicked,lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,lineageLoadMoreRequest:this.lineageLoadMoreRequest,lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest,areInGridHighlightsAvailable:this.areInGridHighlightsAvailable,areInGridHighlightsEnabled:this.areInGridHighlightsEnabled,
onDisplayInGridHighlightsChanged:this.onDisplayInGridHighlightsChanged});aa.a(()=>{this.VF=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Object(V.a)(new sc,{clientBatchSize:this.batchSize,filterableSheetList:this.u5a(),uiCulture:this.$.va.UICultureTag,dataCulture:this.$.va.DataCultureTag,logger:new D.a,lineageAppCallbacks:Fb}))})}whd(Fb){return pa=>{if(pa=nb.a(pa)?null:pa.Result){var tb={["CountOfActivities"]:pa.ActivityList.length};tb.WebRequestName=Fb;sa.b(this.$).ud(eb.a.XQi,
tb);pa=Object(V.a)(new Ab,{activityList:S.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?gb(pa.ActivityList,this.Yza):this.zId(pa.ActivityList),latestActivityId:pa.LastSearchedActivityId,oldestActivityId:pa.FirstSearchedActivityId,serverMessageCode:pa.LineageResponseCode,lastSearchedActivityTimestamp:new Date(pa.EcmaLastSearchedDate),serverFirstActivityId:pa.ServerFirstActivityId,serverLastActivityId:pa.ServerLastActivityId,showLoadPrevious:pa.ShowLoadPrevious,
eolCorrelationId:pa.EolCorrelationId,eolDateHideHistory:new Date(pa.EolDateHideHistory),eolPersonHideHistory:this.Dxb(pa.EolPersonHideHistory)});this.VF.onLineageActivitiesResponse(pa)}else d.ULS.shipAssertTag(537155477,0,!!pa,"LineageManager."+Fb+" returned null response.")}}CRj(Fb){return Da.e(Fb.Ranges)&&!Fb.SheetName?null:Object(V.a)(new Eb,{rangeList:this.p5a(Fb.Ranges),sheetName:Fb.SheetName})}p5a(Fb){const pa=[];for(const tb of Fb)Fb=Object(V.a)(new kb,{firstCol:tb.FirstColumn,firstRow:tb.FirstRow,
lastRow:tb.LastRow,lastCol:tb.LastColumn}),pa.push(Fb);return pa}MRj(Fb){if(!Fb)return null;const pa={};pa.Ranges=this.Bid(Fb.rangeList);pa.SheetName=Fb.sheetName;return pa}Bid(Fb){const pa=[];if(Da.e(Fb))return pa;for(const tb of Fb)Fb={},Fb.FirstColumn=tb.firstCol,Fb.FirstRow=tb.firstRow,Fb.LastRow=tb.lastRow,Fb.LastColumn=tb.lastCol,pa.push(Fb);return pa}bbi(Fb){(Fb=this.$.xa.getItemByName(Fb))&&Fb.visible&&Fb.activate(!0)}jcf(Fb,pa){const tb=[];for(var Nb of pa)pa={},pa.FirstColumn=Nb.firstCol,
pa.FirstRow=Nb.firstRow,pa.LastRow=Nb.lastRow,pa.LastColumn=Nb.lastCol,tb.push(Ma.D(pa));Nb=tb.length-1;pa=tb[Nb].topLeft;W.h(this.$).T4(tb,Nb,Fb,null,pa,null,null,3,"LineageManager.OnCardSelected",void 0,void 0,void 0,!0)}Sbj(){this.VF&&this.lineageTaskPane.isVisible&&(this.JE=this.$.ea.ze,this.VF.onRefreshRequired())}BHg(){this.lineageTaskPane.AM(this.onPaneClosed);this.lineageTaskPane.QE(this.Sz);this.$.ea.nu(this.Bf);this.$.ea.Wj(this.Tc);this.$.ea.zM(this.No);const Fb=this.$.xa;Fb.JY(this.ND);
Fb.gha(this.zqc);Fb.HGa(this.uza);Fb.JZa(this.zqc)}Vej(){this.$.ea.Nv(this.Bf);this.gridView.ha.$R(this.Pc);this.$.ea.tk(this.Tc);this.$.ea.YR(this.No);const Fb=this.$.xa;Fb.s7(this.ND);Fb.una(this.zqc);Fb.vRa(this.uza);Fb.hKb(this.zqc)}onStaleActivitiesDetected(){this.VF.onStaleActivitiesDetected()}u5a(){const Fb=this.$.xa.items,pa=[];for(const tb of Fb)tb.visible&&!Jb.e(tb)&&pa.push(tb.sheetName);return pa}pHj(){if(S.EwaSettings.ma(598)){var Fb=this.$.da.Aa(403);Fb&&Fb.disable();Fb=new Z.a(-847286761,
Pb.a.Db,this.$.Hc,0,hb.a.u0);this.$.Ja.Lb(Fb,{["InputMethod"]:Pb.a.Db,CalloutName:5})}}zId(Fb){const pa=[];for(const tb of Fb)Fb=Object(V.a)(new Gc,{activityId:Number.parseLocale(tb.UserActivity.Id),activityGuid:tb.Uid,activityType:tb.UserActivity.Type,author:this.Dxb(tb.UserActivity.Person),sheetName:tb.SheetName,displayTimestamp:new Date(tb.UserActivity.DisplayTimestamp),gridLocation:tb.DisplayLocation,valueChanges:this.d7i(tb.LineageValueChangeList),isBulkEditOverflow:tb.IsBulkEditOverFlow,rangeHighlightLocation:this.S6i(tb.UserActivity.LocationList,
tb.UserActivity.Type),nestedActivityList:this.L6i(tb.NestedActivityList),degradedCardTypeBits:tb.DegradedCardTypeBits}),pa.push(Fb);return pa}S6i(Fb,pa){if(!Fb)return d.ULS.sendTraceTag(537155468,0,15,"LineageManager:: RangeHighlightLocation.ActivityLocationList is null"),null;if(!Fb.length)return d.ULS.sendTraceTag(537155467,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is empty"),null;const tb=[];var Nb=[];let vc="";21===pa?Nb.push(Fb[0]):Nb=Fb;for(const Ic of Nb)switch(Ic.Type){case 1:break;
case 2:vc=Ic.SheetName;break;case 0:Fb=Ic;if(!Fb.RangeList){d.ULS.sendTraceTag(537155465,0,50,"LineageManager:: RangeHighlightLocation.RangeActivityLocation is null");break}vc=Fb.RangeList[0].SheetName;Nb=[];21===pa?Nb.push(Fb.RangeList[0]):Nb=Fb.RangeList;for(const kd of Nb)Fb=Object(V.a)(new kb,{firstCol:kd.FirstColumn,firstRow:kd.FirstRow,lastRow:kd.LastRow,lastCol:kd.LastColumn}),tb.push(Fb);break;default:d.ULS.sendTraceTag(537155464,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is of type: ")}return Object(V.a)(new Eb,
{sheetName:vc,rangeList:tb})}d7i(Fb){const pa=[];for(const tb of Fb)Fb=Object(V.a)(new zc,{hasNewValue:tb.HasNewValue,hasOldValue:tb.HasOldValue,newValue:tb.HasNewValue?tb.NewValue:null,oldValue:tb.HasOldValue?tb.OldValue:null,cellLocation:tb.CellLocation}),pa.push(Fb);return pa}L6i(Fb){return Fb?this.zId(Fb):null}Dxb(Fb){if(!Fb)return null;let pa=null;e.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(pa=this.Yza.Ota(Fb.Email,Fb.Provider,e.AFrameworkApplication.Hi,0));return Object(V.a)(new Qb,
{id:Fb.Id,provider:Fb.Provider,displayName:Fb.DisplayName,email:Fb.Email,imageUrl:pa})}}Object(b.a)(sd,"LineageManager",null,[721,2]);class Sb extends f.a{constructor(Fb){super();this.S7=this.lineageTaskPane=null;this.$=Fb;this.Fb()}mqf(Fb,pa){z.TaskExtensions.za(Fb,()=>{this.nb(this.$.da.Aa(366)||new sd(this.$,this.$.da,this.lineageTaskPane,pa,this.S7))},this.$.ka,3)}create(){this.S7=this.$.Kb.Bc("UserAction","LineagePaneSeenStopwatch");this.S7.start();const Fb=B.GetServiceTaskFactory.Oa(this.$.da,
365,364,this.Ya),pa=Na.a(this.$),tb=B.GetServiceTaskFactory.Oa(this.$.da,283,284,this.Ya);if(S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const Nb=B.GetServiceTaskFactory.Oa(this.$.da,501,500,0);z.TaskExtensions.za(z.TaskExtensions.Ed([Fb,pa,tb,Nb],this.$.ka),()=>{this.lineageTaskPane=Fb.result;ua.a.fd(this.$)||pa.result.zN(this.lineageTaskPane);this.mqf(ca.c(tb.result.kn.loadScript("cellLineage")),Nb.result)},this.$.ka,3)}else z.TaskExtensions.za(z.TaskExtensions.Ed([Fb,
pa,tb],this.$.ka),()=>{this.lineageTaskPane=Fb.result;ua.a.fd(this.$)||pa.result.zN(this.lineageTaskPane);this.mqf(ca.c(tb.result.kn.loadScript("cellLineage")),null)},this.$.ka,3)}static la(Fb){Fb.da.Ga(367,new Sb(Fb))}}Object(b.a)(Sb,"LineageManagerFactory",f.a,[]);var yc=a(790),Fc=a(224),Zc=a(14),Rd=a(108),Ed=a(260),ne=a(85),ze=a(238),Be=a(19),td=a(703);const Se=hb.a.JBc+"LineageActivityPaneTitle",$b=hb.a.xfb+"LineageActivityCloseButton";class Xc extends ze.a{constructor(Fb,pa,tb){super(Fb);this.uGb=
this.LDe=this.Qd=null;this.$rd=!0;this.vq=0;this.Up=!1;this.yc=(Nb,vc)=>{vc.Of||this.i3c()};this.rk=()=>{this.i3c();return!0};this.$=pa;this.taskPaneManager=tb;this.$.Xj(this.yc);va.a(this.$).di(this);ua.a.fd(this.$)&&(this.isVisible=!1)}NP(Fb){this.get_events().addHandler("LineageTaskPaneRemove",Fb)}ZR(Fb){this.get_events().removeHandler("LineageTaskPaneRemove",Fb)}QE(Fb){this.addHandler("LineageTaskPaneVisibilityChanged",Fb)}lG(Fb){this.removeHandler("LineageTaskPaneVisibilityChanged",Fb)}AM(Fb){this.get_events().addHandler("LineageTaskPaneClose",
Fb)}xO(Fb){this.get_events().removeHandler("LineageTaskPaneClose",Fb)}get isVisible(){return super.isVisible}set isVisible(Fb){super.isVisible!==Fb&&(super.isVisible=Fb,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get Gic(){return this.$rd}get Hf(){return this.isVisible}get jh(){return 15}get de(){return N.a.Nxi}get Ek(){return Be.a.Izh}get wN(){return dc.a.instance.ga(1073)}get Kp(){return 300}get isResizable(){return!1}get mc(){return this.domElement}get height(){return this.taskPaneManager.ZO.offsetHeight}get titleText(){return dc.a.instance.ga(1290)}get aC(){return this.taskPaneManager.xva(this.mc,
this.titleText,this.Kp,this.isResizable,()=>{this.isVisible=!0;this.uGb?this.uGb():d.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{this.isVisible=!1},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.Kp)}nq(){return this.Up}Fs(){return this.Up}IR(){}VQ(){return!1}sj(){}dk(){}dispose(){this.$&&(this.$.Jl(this.yc),va.a(this.$).Zz(this));this.Qd&&(Fc.a.instance.Ba(Zc.a.click,this.Qd,this.rk),Rd.KeyInputManager.instance.Tv(this.Qd,this.LDe));this.Qd=this.taskPaneManager=
this.$=null;super.dispose()}kg(Fb,pa){if(!pa){Fb=ea.DOMElementExtensions.getElementById(this.domElement,"LineagePaneFilterButton");if(!Fb)return!1;ea.DOMElementExtensions.setFocus(Fb)}return!pa}mh(Fb){return ea.DOMElementExtensions.Af(this.mc,Fb)}yg(Fb){this.Up=Fb;const pa=this.taskPaneManager;if(this.isVisible=Fb)this.$.frame.Me.ek("LineagePane"),this.$rd=!1;if(ua.a.fd(this.$))Fb?pa.Y6("LineageTaskPane",this.aC):pa.hideTaskPane("LineageTaskPane");else{this.taskPaneManager.lA();const tb=!!this.taskPaneManager.oh&&
15===this.taskPaneManager.oh.taskPane.jh;Fb&&0<pa.$B.length&&(!tb||pa.isCollapsed)&&pa.oG(this,!0)}this.$.df()}WM(){var Fb=this.$.Eb;Fb=ua.a.fd(this.$)?this.domElement:document.getElementById(Fb+hb.a.cwd);var pa=this.qH();Fb.appendChild(pa);pa=td.b("div","LineagePaneBodyId","LineageActivityBody");Fb.appendChild(pa);this.Swj();return pa}i3c(){this.$.frame.Me.ek(this.$.frame.Me.pF||Ed.AFrame.YT);this.$rd=!0;this.yg(!1);this.raiseEvent("LineageTaskPaneClose")}Rwj(Fb){this.uGb=Fb}Swj(){this.$.frame.Me.vk("LineagePane");
const Fb=this.$.frame.Me.Bi("LineagePane");Fb.parent=Ed.AFrame.YT;Fb.MN=!0}qH(){const Fb=td.b("div","LineagePaneHeaderId","LineageActivityPaneHeader"),pa=td.b("h1","LineagePaneTitleId",Se);pa.innerText=this.titleText;this.Qd=yc.a.pb("LineagePaneCloseButtonId",$b,dc.a.instance.ga(10),"ClosePaneGlyph_16x16x32",!1);this.Qd.classList.add(e.AFrameworkApplication.isRtl?hb.a.Maa:hb.a.Naa);Fc.a.instance.sa(Zc.a.click,this.Qd,this.rk);this.LDe=Rd.KeyInputManager.instance.Ns(this.Qd,this.rk,ne.a.Mh);Fb.appendChild(pa);
Fb.appendChild(this.Qd);return Fb}static la(Fb,pa){const tb=Fb.Eb;let Nb=document.getElementById(tb+hb.a.cwd);Nb||(Nb=document.createElement("div"),Nb.id=Fb.Eb+hb.a.cwd,Nb.classList.add("LineageActivityPane"),ua.a.fd(Fb)||document.getElementById(tb+hb.a.AR).appendChild(Nb));return Fb.da.Aa(365)||Fb.da.Ga(365,new Xc(Nb,Fb,pa))}}Object(b.a)(Xc,"LineageTaskPane",ze.a,[720,2,472,34]);class ed extends f.a{constructor(Fb){super();this.hh=this.xi=null;this.$=Fb;this.Fb()}get QD(){this.xi||(this.xi=z.TaskExtensions.za(Na.a(this.$),
Fb=>{this.hh=Xc.la(this.$,Fb.result)},this.ka,3));return this.xi}create(){const Fb=B.GetServiceTaskFactory.create(this.$.da,203,this.ka,this.Ya),pa=B.GetServiceTaskFactory.create(this.$.da,155,this.ka,this.Ya);z.TaskExtensions.za(z.TaskExtensions.ts(z.TaskExtensions.Ed([Fb,pa],this.ka),()=>this.QD,this.ka),()=>{this.nb(this.hh)},this.ka,3)}dispose(){this.hh=this.xi=this.$=null;super.dispose()}static la(Fb){Fb.da.Ga(364,new ed(Fb))}}Object(b.a)(ed,"LineageTaskPaneFactory",f.a,[]);class Rc{constructor(Fb,
pa){this.Esd=!1;this.Bf=()=>{this.mfg()};this.$=Fb;S.EwaSettings.ma(598)&&this.$.ea.n9a&&!Rc.Jyb&&(pa&&!pa.CTa||this.B1j(),Rc.qaf?d.ULS.sendTraceTag(537155461,0,50,"LineageTeachingCalloutTriggerManager will not trigger WYWA waterline check as it was already checked in session"):pa&&!pa.CTa||this.I1j());d.ULS.sendTraceTag(537155460,0,50,"LineageTeachingCalloutTriggerManager is initialized.")}dispose(){this.LLd();this.$=null;d.ULS.sendTraceTag(537155459,0,50,"LineageTeachingCalloutTriggerManager is disposed.")}disable(){Rc.Jyb||
(Rc.Jyb=!0,d.ULS.sendTraceTag(578557781,0,50,"LineageTeachingCalloutTriggerManager.Disable as the pane was opened."));this.LLd()}I1j(){S.EwaSettings.ma(594)&&!this.$.isAnonymousUser()&&vb.i(this.$.pa.ya,Fb=>{this.$?(Fb=Fb.Result,d.ULS.sendTraceTag(578557780,0,50,`CheckLineageWywaChanges service call succeeded, hasnewchanges = ${Fb}.`),Rc.qaf=!0,Fb&&this.UPb(0)):d.ULS.sendTraceTag(537155458,0,50,"LineageTeachingCalloutTriggerManager.VerifyWaterlineTrigger ignoring server response as class is disposed.")},
()=>{d.ULS.sendTraceTag(537155457,0,10,"CheckLineageWywaChanges service call failed.")},null,null)}B1j(){S.EwaSettings.ma(593)&&!this.mfg()&&(this.$.ea.nu(this.Bf),this.Esd=!0)}mfg(){return this.$.ea&&this.$.ea.Ho&&this.$.ea.Ho.ShouldTriggerLineageCalloutOnMerge?(d.ULS.sendTraceTag(578557778,0,50,"LineageTeachingCalloutTriggerManager.TriggerLineageCalloutOnMerge"),this.UPb(1),!0):!1}UPb(Fb){Rc.Jyb?d.ULS.sendTraceTag(537155456,0,50,"LineageTeachingCalloutTriggerManager.TriggerCallout Will not trigger dialog as it was already shown in session"):
(Rc.Jyb=!0,d.ULS.sendTraceTag(578557776,0,50,`LineageTeachingCalloutTriggerManager.TriggerCallout triggering callout due to reason ${Fb}.`),this.LLd(),S.EwaSettings.ma(474)&&(Fb=new Z.a(-847286761,Pb.a.Db,this.$.Hc,0,hb.a.u0),this.$.Ja.Lb(Fb,{["CalloutName"]:4})))}LLd(){this.Esd&&(this.Esd=!1,this.$.ea.Nv(this.Bf))}}Rc.Jyb=!1;Rc.qaf=!1;Object(b.a)(Rc,"LineageTeachingCalloutTriggerManager",null,[594,2]);class Fd extends f.a{constructor(Fb){super();this.$=Fb;this.Fb()}create(){z.TaskExtensions.za(B.GetServiceTaskFactory.Oa(this.$.da,
458,459,this.Ya),Fb=>{const pa=Fb.result;Fb=Object(Va.a)(this.$.da,403,()=>new Rc(this.$,pa));this.nb(Fb)},this.$.ka,3)}static la(Fb){Fb.da.Ga(402,new Fd(Fb))}}Object(b.a)(Fd,"LineageTeachingCalloutTriggerManagerFactory",f.a,[]);var Nd=a(875),zd=a(79);class Sd{constructor(Fb,pa){this.Ah=Fb;this.fv=pa}iX(Fb,pa,tb,Nb=null){return this.Mnh(Fb,Nb,vc=>this.Ah.oob(vc,2,tb,pa,void 0,void 0,void 0,void 0,void 0,"2"))}Mnh(Fb,pa,tb){const Nb=!!pa&&""!==pa;let vc=Fb;Nb&&(vc=w.a.OT(Fb,"perfTag",pa));const Ic=
new Date;return Nd.a.then(tb(vc),kd=>{const xd=+new Date-+Ic;if(!kd||!kd.Kg||!kd.Kg.data)return kd;Nb&&kd.Kg.data.request&&this.Fsj(kd.Kg.data.request.getResolvedUrl(),pa,xd);return kd})}Fsj(Fb,pa,tb){Fb=this.fv.n0h(Fb);if(Fb.count&&(Fb=zd.last(Fb))){const Nb={Message:"Request durations for activities calls."};Nb.PerfTag=pa;Nb.CustomDuration=tb;Nb.PerformanceDuration=Fb.duration;d.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(Nb))}}}Object(b.a)(Sd,"CatchUpNetworkingWrapper",null,[731]);var se=
a(243);class He extends se.a{constructor(Fb,pa){super(Fb,pa)}Vaa(){return 6}}Object(b.a)(He,"GetActivityFeedRequest",se.a,[]);class Gd extends se.a{constructor(Fb,pa,tb,Nb,vc,Ic){super(Fb,pa);this.ItemIds=null;this.ActivityStatesToReset=this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=tb;this.ActivityStatesToSet=Nb;this.ActivityStatesToReset=vc;this.ResetUnseenCount=Ic}Vaa(){return 7}}Object(b.a)(Gd,"UpdateActivityFeedStateRequest",se.a,[]);var fe=a(388);class $d{constructor(Fb,pa,
tb){this.Dfe=Fb;this.oDa=pa;this.GDa=tb}getActivityFeed(Fb){return Nd.a.then(this.GDa.execute(new He(this.oDa(),null),(pa,tb,Nb)=>this.Dfe.iX(pa,tb,Nb,"ActivityFeed"),Fb),pa=>{if(!pa)return d.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),null;if(!pa.Kg)return d.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;if(!pa.Kg.data)return d.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(!pa.Kg.data.ve)return d.ULS.sendTraceTag(572846940,
3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;pa=fe.a.kJa(pa.Kg.data.ve);return pa?pa:(d.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}$Vj(Fb,pa,tb,Nb){return Nd.a.then(this.GDa.execute(new Gd(this.oDa(),null,Fb,pa,tb,Nb),(vc,Ic,kd)=>this.Dfe.iX(vc,Ic,kd,"UpdateActivityFeedState"),null),vc=>{try{return vc.succeeded}catch(Ic){return d.ULS.sendTraceTag(523121054,3012,10,"UpdateActivityFeed: Exception: "+Ic.message),!1}})}}Object(b.a)($d,
"CatchUpRequestHandler",null,[730]);var qe=a(468);class pe{constructor(Fb){this.Bga=Fb;this.pee=new qe.a}vzi(){this.jAi()}jAi(){if(this.Bga){var Fb=pa=>{this.pee.contains("CatchUpChangesFeedback")||(this.pee.add("CatchUpChangesFeedback"),pa.logActivity("CatchUpChangesFeedback",null))};this.Bga.execute(pa=>{window.setTimeout(()=>{Fb(pa)},2E4)})}else d.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}Object(b.a)(pe,"FloodgateEventLogger",null,[]);
var Ne=a(187);class Le{constructor(Fb){this.qAg=Fb}get duration(){return this.qAg.duration}}Object(b.a)(Le,"PerformanceResourceTimingWrapper",null,[]);class gf{constructor(Fb){this.fv=Fb}n0h(Fb){const pa=new Ne.a;if(!this.fv)return pa;Fb=this.fv.getEntriesByName(Fb,"resource");if(!Fb)return pa;for(const tb of Fb)pa.add(new Le(tb));return pa}}Object(b.a)(gf,"PerformanceWrapper",null,[]);var Ye=a(248);class $e{constructor(){this.gb=null}get name(){return"Common.App.CatchUpActivity"}Xh(Fb){this.gb=Fb;
this.gb.register(Sd,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").xc().Fc(()=>new Sd(e.AFrameworkApplication.zd,new gf(window.performance)));this.gb.register($d,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").xc().Fc(()=>new $d(this.gb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),()=>e.AFrameworkApplication.Hi,new fe.a));this.gb.register(pe,"Common.App.CatchUpActivity.FloodgateEventLogger").xc().Fc(()=>
new pe(this.gb.Ub("Common.ISystemInitiatedFeedback")))}init(){this.gb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper");this.gb.resolve("Common.App.CatchUpActivity.ICatchUpRequestHandler")}dispose(){}static main(){Ye.a.instance.Ei(new $e)}}Object(b.a)($e,"CatchUpActivityPackage",null,[3,4]);class Ya{constructor(Fb,pa){this.$=Fb;this.catchUpActivityManager=pa}nc(Fb,pa){return this.catchUpActivityManager?-876699925===pa?!this.catchUpActivityManager.Pgf:!1:!0}executeCommand(Fb,pa){Fb=!1;
switch(pa.command){case -876699925:Fb=this.catchUpActivityManager.GYi();break;case 950288339:return this.catchUpActivityManager.showHideInGridHighlights(),I.Task.Ta(!0)}return Fb?I.Task.Ta(!0):A.a(pa.command)}wc(Fb,pa){return S.EwaSettings.ma(429)?-876699925===pa.command||950288339===pa.command:!1}Kc(){return!1}}Object(b.a)(Ya,"CatchUpActivityCommandHandler",null,[208]);class ra extends C.a{constructor(Fb){super(Fb)}ld(){this.$.da.$a(286,Fb=>{this.Zc([new Ya(this.$,Fb)])})}static la(Fb){C.a.Nd(285,
new ra(Fb))}}Object(b.a)(ra,"CatchUpActivityCommandHandlerFactory",C.a,[]);var ya=a(263),mb=a(520),Hb=a(89),Zb=a(83),mc=a(25);class Pc{constructor(Fb){this.Vh=Fb}doesContentExist(Fb){if(!Fb)return d.ULS.sendTraceTag(537168066,3012,10,"Null activity: DoesContentExist. Default to false."),!1;switch(Fb.type){case 2:case 3:case 4:case 6:case 8:case 9:case 7:case 10:if(!Fb.navigationId)return d.ULS.sendTraceTag(537168065,3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),!1;const pa=
{};pa.NavigationId=atob(Fb.navigationId);return 32===this.Vh.Zd(mc.a.zJa,2,pa);default:return!1}}}Object(b.a)(Pc,"CatchUpActivityContentManager",null,[723]);var fd=a(824),id=a(1237);class Dd{constructor(Fb){this.qGb=()=>{switch(this.Bu.model.state){case 1:this.i9f(!0);break;case 0:this.RNb(!1);break;case 2:case 3:this.RNb(!0);break;default:d.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+this.Bu.model.state)}};this.Iwg=
Fb;this.Bu.Oqe(this.qGb);this.Bz=[]}get Bu(){return this.Iwg}dispose(){this.Bu.fVf(this.qGb);this.Bz=null}owj(Fb){this.Bz.push(Fb)}X3g(){this.Bz.length=0}i9f(Fb){for(const pa of this.Bz){pa.className=fd.a.N0g;const tb=document.getElementById(`${pa.id}-${hb.a.nBe}`);ea.DOMElementExtensions.setVisible(tb,Fb)}}RNb(Fb){for(const pa of this.Bz)pa&&(Fb?pa.className=2===this.Bu.model.state?fd.a.$9i:fd.a.a$i:this.i9f(!1))}}Object(b.a)(Dd,"RangeCatchUpActivityView",null,[850,2]);var Zd=a(22);class bc extends id.a{constructor(Fb,
pa,tb){super(Fb,pa,tb);this.gridView=W.h(Fb);this.hna=pa}dispose(){this.gridView=null;super.dispose()}eKg(Fb){const pa=this.bhb[0];pa?pa.owj(Fb):d.ULS.shipAssertTag(537168004,0,!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+this.hna.activityId)}cmj(){const Fb=this.bhb[0];Fb&&Fb.X3g()}nIg(Fb){this.hna.addRange(Fb)}oQh(){if(3!==this.hna.activityType)return null;d.ULS.shipAssertTag(537168003,0,1===this.hna.pOb.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");
return Ma.D(this.hna.pOb[0])}XLb(Fb){if(Fb){if(!this.hna)return;this.sAd(this.lnj())}super.XLb(Fb)}O6c(){const Fb=this.t6c();this.bhb.push(Fb)}t6c(){return new Dd(this)}sAd(Fb){Fb?Fb.SheetName?(this.gridView.ha.Sa.vH(null),this.gridView.focus(),this.gridView.t9e(Fb,3,!1,"RangeCatchUpActivityHighlightController.NavigateToRange")):d.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):d.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}lnj(){if(Da.e(this.hna.pOb))return d.ULS.shipAssertTag(537167971,
0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),null;var Fb=this.$.xa.oa;d.ULS.shipAssertTag(537167970,0,!!Fb,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");Fb=this.OSj(Fb.sheetName,this.hna.pOb);if(!Fb&&(Fb=this.V4h(this.hna.pOb),!Fb))return null;const pa={};pa.SheetName=Fb.SheetName;pa.FirstColumn=Fb.FirstColumn;pa.FirstRow=Fb.FirstRow;pa.LastColumn=Fb.FirstColumn;
pa.LastRow=Fb.FirstRow;return pa}V4h(Fb){if(Da.e(Fb))return null;let pa=null;for(let Nb=0;Nb<Fb.length;Nb++){var tb=Fb[Nb].SheetName;if(!Zd.a.equals(tb,pa,!1)&&(pa=tb,tb=this.$.xa.getItemByName(tb),null===tb||void 0===tb?0:tb.visible))return Fb[Nb]}return null}OSj(Fb,pa){if(pa)for(const tb of pa)if(Zd.a.equals(tb.SheetName,Fb,!1))return tb;return null}}Object(b.a)(bc,"RangeCatchUpActivityHighlightController",id.a,[]);var Qc=a(78);class pd extends Qc.a{constructor(Fb,pa,tb,Nb,vc){super();this.$=Fb;
this.c5d=pa;this.$qg=tb;this.yC=Nb;this.state=vc?1:0}get type(){return this.yC}get activityId(){return this.c5d}get activityType(){return this.$qg}dispose(){this.c5d=null;super.dispose()}}Object(b.a)(pd,"CatchUpActivityHighlightModelBase",Qc.a,[]);class ce extends pd{constructor(Fb,pa,tb,Nb,vc,Ic){super(Fb,pa,tb,Nb,Ic);this.ranges=vc;this.r8a=!1}get pOb(){this.r8a||(this.ranges.sort(ce.T4b),this.r8a=!0);return this.ranges}addRange(Fb){for(const pa of Fb)this.ranges.push(pa)}dispose(){this.ranges=
null;super.dispose()}static T4b(Fb,pa){if(!Fb.SheetName||!pa.SheetName)return d.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),0;const tb=Fb.SheetName.localeCompare(pa.SheetName);return tb?tb:Fb.FirstColumn<pa.FirstColumn||Fb.FirstColumn===pa.FirstColumn&&Fb.FirstRow<pa.FirstRow?-1:Fb.FirstColumn===pa.FirstColumn&&Fb.FirstRow===pa.FirstRow?0:1}}Object(b.a)(ce,"RangeCatchUpActivityHighlightModel",pd,[]);var ke=a(346);class Oe{constructor(){this.f4c=
[];this.jNb={};this.soe={}}dispose(){this.soe=this.jNb=this.f4c=null}rWf(Fb,pa){pa?W.h(Fb).qb.Sn([24]):W.h(Fb).qb.Zg([24])}bbh(Fb,pa,tb,Nb){const vc={};for(const kd of pa){if(!kd||Da.e(kd.LocationList))continue;pa=[];const xd={},ae=[];for(const oe of kd.LocationList){if(!oe){d.ULS.shipAssertTag(537168013,0,!1,"CatchUpActivityHighlightManagerHelper.CreateControllersAndHighlights - Location is Null for activityId : "+kd.Id);break}switch(oe.Type){case 0:var Ic=oe;let ve;"0"in xd?(ve=xd["0"],ve.nIg(Ic.RangeList)):
(ve=new bc(Fb,new ce(Fb,kd.Id,kd.Type,0,Ic.RangeList,Nb),tb),pa.push(ve),xd["0"]=ve);for(const Ge of Ic.RangeList){Ic=new ke.a(Ma.D(Ge),Jb.d(Fb.xa.getItemByName(Ge.SheetName)));if(this.$yc(Ic)in this.jNb)this.jNb[this.$yc(Ic)].push(ve);else{let ye=[];ye.push(ve);this.jNb[this.$yc(Ic)]=ye}ae.push(Ic);this.f4c.push(Ic)}break;default:d.ULS.sendTraceTag(537168012,0,10,"CatchUpHighlightControllersCreator.CreateControllersAndHighlights(): Failed.Invalid ActivityLocationType")}}d.ULS.shipAssertTag(537168011,
0,!(kd.Id in vc),"CatchUpHighlightControllersCreator.CreateAndUpdateControllers - highlightControllers already has activity: "+kd.Id);this.soe[kd.Id]=ae;vc[kd.Id]=pa}this.uch(Fb,this.f4c,this.jNb,Nb);return vc}P3g(Fb){for(let pa in Fb){const tb=Fb[pa];for(const Nb of tb)Nb.cmj()}}$yc(Fb){return`${Fb.range}-${Fb.sheetId}`}uch(Fb,pa,tb,Nb){this.P3g(tb);W.h(Fb).qb.lx(pa,[24],Nb,(vc,Ic)=>{var kd=new ke.a(vc.range,vc.sheetId);kd=this.$yc(kd);const xd=tb[kd];if(xd)for(const ae of xd)ae.eKg(Ic),vc.metadata=
ae;else d.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+kd)})}}Object(b.a)(Oe,"CatchUpHighlightControllersCreator",null,[]);class Fe{constructor(){this.activityIds=this.container=this.target=null;this.isSticky=!1;this.dirHint=0;this.onHoverLeave=this.onHoverEnter=this.activityNavigationManager=null}}Object(b.a)(Fe,"CreateIndicatorTooltipParameters",null,[]);class Xe{constructor(){this.clearSticky=
!1}}Object(b.a)(Xe,"DismissIndicatorTooltipParameters",null,[]);class pf{constructor(){this.target=null;this.isSticky=!1}}Object(b.a)(pf,"UpdateIndicatorTooltipParameters",null,[]);class Ae{constructor(Fb,pa){this.$=Fb;this.Vh=pa}navigateToActivity(Fb){if(Fb.fromSummaryString)return Fb=new Z.a(1834994092,Pb.a.Db,this.$.Hc,18,null),this.$.Ja.Lb(Fb),this.aDa(1);Fb=Fb.activity;if(S.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&Fb&&1===Fb.type){var pa=
new Z.a(1834994092,Pb.a.Db,this.$.Hc,30,null);this.$.Ja.Lb(pa,{["activityGuid"]:Fb.activityId,["sheetName"]:Fb.location.region,["gridLocation"]:Fb.location.subregion[0]});return this.aDa(1)}if(!this.nji(Fb))return this.aDa(4);if(!this.Msi(Fb))return this.aDa(7);const tb={};try{pa=window.self.atob(Fb.navigationId);if(!pa)return this.aDa(5);tb.NavigationId=pa}catch(Nb){return d.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${Nb}`),this.aDa(5)}if(8===
this.Vh.Zd(mc.a.zJa,2,tb))return this.Vh.processAction(mc.a.v$a,2),this.aDa(2);Fb=32===this.Vh.Zd(mc.a.o1a,2,tb)?1:6;return this.aDa(Fb)}nji(Fb){return Fb&&Fb.navigationId?!0:!1}Msi(Fb){switch(Fb.type){case 3:case 4:case 6:case 7:case 9:case 8:return!0;case 10:return S.EwaSettings.isChangeGateEnabled("OfficeVSO:7212124_EnableTaskReplyNavigation")?!0:!1;default:return!1}}aDa(Fb){return Promise.resolve(Fb)}}Object(b.a)(Ae,"CatchUpActivityNavigationManager",null,[724]);class Ie{constructor(Fb,pa){this.D5b=
this.kfa=null;this.Kdd=!1;this.sSa=null;this.Aka={};this.eEa=null;this.tmd=!1;this.qGb=(tb,Nb)=>{switch(Nb.state){case 0:case 1:3===Nb.fId&&(this.pai(),this.sSa=null);break;case 2:break;case 3:this.q8c();this.sSa=Nb.activityId;this.cFj();break;default:d.ULS.shipAssertTag(537168030,0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+Nb.state)}};this.$l=()=>{this.Gtb()};this.Pc=()=>{this.Gtb()};this.Ln=()=>{this.Gtb()};this.uh=()=>{this.Gtb()};this.i8f=
(tb,Nb)=>{this.kfa&&Nb.SH!==this.Bka&&(Nb.isSticky&&this.o8b(!0),(tb=this.cTj(Nb.SH))?(this.kfa.createActivityIndicatorTooltip(Object(V.a)(new Fe,{target:Nb.SH,container:tb,activityIds:[Nb.activityId],isSticky:Nb.isSticky,dirHint:this.gridView.rtl?12:9,activityNavigationManager:S.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")?this.t3b:void 0})),Nb.isSticky?(this.Bka=Nb.SH,d.ULS.sendTraceTag(51172352,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Selected/Unselected Event.")):
(this.Hfc=Nb.SH,d.ULS.sendTraceTag(51172353,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event.")),this.fic||(this.gridView.view.ot(this.uDc),this.gridView.lv(this.uDc),this.fic=!0)):d.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null."))};this.zMe=(tb,Nb)=>{this.o8b(Nb.tmh)};this.uDc=()=>{this.kfa?(this.Bka&&this.kfa.updateActivityIndicatorTooltip(Object(V.a)(new pf,{target:this.Bka,
isSticky:!0})),this.Hfc&&this.kfa.updateActivityIndicatorTooltip(Object(V.a)(new pf,{target:this.Bka,isSticky:!1}))):d.ULS.shipAssertTag(537168024,0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=Fb;this.gridView=W.h(this.$);this.ha=this.gridView.ha;this.Za=this.gridView.Vb;this.ha.W_b(this.$l);this.ha.hH(this.Pc);this.gridView.FC(this.Ln);this.Za.Yk(this.uh);this.Bka=this.Hfc=null;this.fic=!1;this.rdd={};this.t3b=new Ae(this.$,e.AFrameworkApplication.ub);
this.blueDotManager=pa}get toe(){return this.kfa}set toe(Fb){this.kfa=Fb}get excelCommentManager(){this.eEa||(this.eEa=this.$.da.Aa(65));return this.eEa}get D1a(){this.D5b||(this.D5b=new Oe);return this.D5b}set D1a(Fb){this.D5b=Fb}dispose(){this.ha.Guc(this.$l);this.ha.kG(this.Pc);this.gridView.bE(this.Ln);this.Za.Gk(this.uh);this.HLe();this.rdd=this.Bka=this.Hfc=this.sSa=this.Za=this.ha=this.gridView=null}z2f(Fb){const pa=this.npb();this.HLe();if(!Da.e(Fb)){d.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:ProcessActivityPayloadHighlights().");
if(this.Aka=this.D1a.bbh(this.$,Fb,this,pa)){Fb=this.Aka;for(let tb in Fb){const Nb=Fb[tb];for(const vc of Nb)this.ySg(vc)}}this.D1a.rWf(this.$,pa)}}PNb(){const Fb=this.npb();Fb&&this.tmd?d.ULS.shipAssertTag(537168034,0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read"):(Fb||this.Gtb(),this.D1a.rWf(this.$,Fb))}abi(Fb){if(this.npb())if(this.Bka&&this.o8b(!0),this.q8c(),Fb=this.Aka[Fb.activityId])for(const pa of Fb)pa.XLb(!0);else d.ULS.sendTraceTag(537168032,
0,50,"CatchUpActivityHighlightManager.OnSelectHighlight - Controllers not found during select")}Y3f(Fb){if(this.Kdd!==Fb){var pa=this.npb();this.Kdd=Fb;pa!==this.npb()&&this.PNb()}}HLe(){if(this.Aka){const Fb=this.Aka;for(let pa in Fb){const tb=Fb[pa];for(const Nb of tb)this.Wej(Nb),Nb.dispose()}}this.Aka={};this.D1a.dispose();this.D1a=null}cFj(){if(this.excelCommentManager){var Fb=this.Aka[this.sSa];Fb&&0<Fb.length&&3===Fb[0].model.activityType&&((Fb=Fb[0])?this.excelCommentManager.HFj(Fb.oQh()):
d.ULS.shipAssertTag(537168029,0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}pai(){this.excelCommentManager&&this.excelCommentManager.Jub()}q8c(){if(this.sSa){const Fb=this.Aka[this.sSa];if(Fb){for(const pa of Fb)pa.XLb(!1);this.sSa=null}else d.ULS.sendTraceTag(537168028,0,50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}Gtb(){this.q8c();this.o8b(!0)}cTj(Fb){if(!Fb)return d.ULS.shipAssertTag(537168026,
0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),null;Fb=`${Fb.id}-${hb.a.L0g}`;let pa=this.rdd[Fb];if(!pa){if(!this.gridView.domElement)return d.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),null;pa=document.createElement("Div");pa.className=fd.a.M0g;pa.id=Fb;this.gridView.domElement.appendChild(pa);this.rdd[Fb]=pa}return pa}o8b(Fb){this.kfa&&(this.kfa.dismissActivityIndicatorTooltips(Object(V.a)(new Xe,
{clearSticky:Fb})),this.Hfc=null,Fb&&(this.Bka=null),this.fic&&!this.Bka&&(this.gridView.view.er(this.uDc),this.gridView.Ky(this.uDc),this.fic=!1))}ySg(Fb){Fb.Oqe(this.qGb);Fb.IKg(this.i8f);Fb.HKg(this.zMe)}Wej(Fb){Fb.fVf(this.qGb);Fb.egj(this.i8f);Fb.dgj(this.zMe)}npb(){return this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled()&&!this.Kdd}}Object(b.a)(Ie,"CatchUpActivityHighlightManager",null,[839,2]);var Hf=a(447);class xe{}Object(b.a)(xe,"GetRelevantActivitiesDataRequest",null,
[]);class Ze{constructor(){this.activityFeedItemId=this.activityId=null;this.type=0;this.collectionId=this.state=this.navigationId=this.relevancy=this.displayTimestamp=this.location=this.actors=null}}Object(b.a)(Ze,"Activity",null,[]);class nf{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(b.a)(nf,"ActivityFeedItem",null,[]);class hf{constructor(){this.activityFeedItems=null}}Object(b.a)(hf,"ActivityFeedPayload",
null,[]);class bb{constructor(){this.lowWaterline=this.highWaterline=this.wywaWaterline=this.actors=this.activities=null;this.hasMore=!1;this.isFirstDocumentOpen=null}}Object(b.a)(bb,"ActivityRequestPayload",null,[]);class Lb{constructor(){this.color=this.imageUrl=this.email=this.givenName=this.displayName=this.provider=this.id=null}}Object(b.a)(Lb,"Person",null,[]);class nc extends Ze{constructor(){super();this.relationship=0}}Object(b.a)(nc,"TaskActivity",Ze,[]);const Lc=(Fb,pa,tb,Nb,vc,Ic=null)=>
{Ic=Fb.Na(1,Ic);return vb.g(Fb,"GetLineageWywaAuthors",Ic,pa,tb,Nb,vc,4)},od=(Fb,pa,tb,Nb,vc,Ic,kd=null)=>{kd=Fb.Na(1,kd);kd.getRelevantActivitiesDataRequest=pa;return vb.g(Fb,"GetRelevantActivitiesData",kd,tb,Nb,vc,Ic,0)};class wd{constructor(Fb,pa,tb=!1,Nb=null){this.V1d=null;this.$=Fb;this.u3b=pa;this.UHb=Xa.a.instance.resolve("Common.App.People.IPeopleColorUtils");this.Yza=Xa.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.E7a=tb;this.blueDotManager=Nb}requestWYWAActivities(){return this.E7a?
new Promise((Fb,pa)=>{Lc(this.$.pa.ya,tb=>{var Nb;const vc=nb.a(tb)?null:tb.Result;S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?(tb=null===(Nb=null===vc||void 0===vc?void 0:vc.WywaAuthors)||void 0===Nb?void 0:Nb.length,null!=tb&&0<tb?this.Hig(Ic=>{Ic={activities:Ic,actors:vc?this.udc(vc.WywaAuthors):null,hasMore:!1,highWaterline:wd.Dia,lowWaterline:wd.Dia,wywaWaterline:wd.Dia};Fb(Ic)}):Fb(wd.ztb)):(Nb=Object(V.a)(new bb,{activities:[],actors:vc?this.udc(vc.WywaAuthors):
null,hasMore:!1,highWaterline:wd.Dia,lowWaterline:wd.Dia,wywaWaterline:wd.Dia}),Fb(Nb))},()=>{d.ULS.sendTraceTag(537168022,0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");pa(null)},null,null)}):Promise.resolve(wd.ztb)}requestActivities(){return Promise.resolve(wd.ztb)}requestRelevantActivities(){if(!this.$.ea.Zb||this.$.ea.Z5a)return d.ULS.sendTraceTag(537168021,3012,15,`CatchUpActivityRequestManager.RequestRelevantActivities: RequestRelevantActivities skipped [IsSessionActive: ${this.$.ea.Zb}, HasRaisedSessionEnded: ${this.$.ea.Z5a}]`),
Promise.resolve(wd.ztb);const Fb=Object(V.a)(new xe,{SetDaysBack:e.AFrameworkApplication.fa.rd("AppWaterlineOverrideDaysValue",0),SetTimestamp:e.AFrameworkApplication.fa.rd("AppWaterlineOverrideTimestampValue",0)});return new Promise((pa,tb)=>{od(this.$.pa.ya,Fb,Nb=>{let vc=wd.ztb;Nb?nb.a(Nb)?(Nb=P.a.sc(Nb.Errors),d.ULS.sendTraceTag(578353159,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call returned errors codes: ${Nb}`)):vc=this.S_h(Nb.Result):d.ULS.sendTraceTag(537168020,3012,
10,"CatchUpActivityRequestManager::GetRelevantActivitiesData call returned Null result.");pa(vc)},Nb=>{Nb=Ia.a.Pe(Nb.data);Nb=P.a.sc(Nb);d.ULS.sendTraceTag(537168019,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call has failed - Errors: [${Nb}]`);tb(null)},null,null)})}requestActivityFeed(){return ca.b(this.getActivityFeed()).then(Fb=>Object(V.a)(new hf,{activityFeedItems:this.ARj(Fb)}))}updateActivityState(Fb){return S.EwaSettings.ma(445)?Promise.resolve(!0):this.u3b?ca.b(this.u3b).then(pa=>
{var tb,Nb;return ca.b(pa.$Vj(Fb.itemIds,null!==(tb=Fb.activityStatesToSet)&&void 0!==tb?tb:0,null!==(Nb=Fb.activityStatesToReset)&&void 0!==Nb?Nb:0,Fb.resetUnseenCount))}):Promise.resolve(!1)}getActivityFeed(){return this.u3b?Nd.a.$Yd(this.u3b,Fb=>Fb.getActivityFeed(null)):I.Task.Ta([])}S_h(Fb){if(!Fb)return d.ULS.sendTraceTag(537168018,3012,10,"CatchUpActivityRequestManager::GetRelevantActivityRequestPayload response is null."),Object(V.a)(new bb,{activities:[]});const pa=this.Weg(Fb.NewActivities,
2);Fb=this.Weg(Fb.OutstandingActivities,3);for(const tb of Fb)pa.push(tb);return Object(V.a)(new bb,{activities:pa})}Weg(Fb,pa=1){const tb=[];if(!Fb||!Fb.length)return tb;for(const Nb of Fb)Nb?(Fb=wd.HRj(Nb.Type),6===Fb||7===Fb||9===Fb||8===Fb?tb.push(Object(V.a)(new nc,{activityId:Nb.Id,type:Fb,displayTimestamp:new Date(Nb.DisplayTimestamp),navigationId:Nb.NavigationId,actors:this.udc(Nb.People),relevancy:pa,relationship:this.GRj(Nb.Relationship)})):tb.push(Object(V.a)(new Ze,{activityId:Nb.Id,type:Fb,
displayTimestamp:new Date(Nb.DisplayTimestamp),navigationId:Nb.NavigationId,actors:this.udc(Nb.People),relevancy:pa}))):d.ULS.shipAssertTag(537168017,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivitiesToActivities: relevantActivity is null");return tb}GRj(Fb){switch(Fb){case 1:return 1;case 2:return 2;case 3:return 3}d.ULS.sendTraceTag(537168016,0,10,"Unexpected Relationship.");return 1}ARj(Fb){const pa=[];for(const tb of Fb)Fb=Object(V.a)(new nf,{id:tb.id,type:tb.type,collectionId:tb.collectionId,
activityState:tb.activityState,activityFeedItemPayload:tb.activityFeedItemPayload,timestamp:tb.timestamp}),pa.push(Fb);return pa}udc(Fb){const pa=[];if(!Fb||!Fb.length)return pa;for(const tb of Fb)tb&&pa.push(this.Dxb(tb));return pa}Dxb(Fb){return Object(V.a)(new Lb,{id:Fb.Id,provider:Fb.Provider,displayName:Fb.DisplayName,email:Fb.Email,imageUrl:this.Yza.Ota(Fb.Email,Fb.Provider,e.AFrameworkApplication.Hi,0),color:this.UHb.Rjd(new Hf.a(null,void 0,Fb.DisplayName),6)})}static HRj(Fb){switch(Fb){case 1:return 3;
case 2:return 4;case 3:return 6;case 4:return 7;case 6:return 8;case 5:return 9;case 7:return 10;default:return d.ULS.shipAssertTag(537168015,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivityTypeToActivityType: unknown RelevantActivityType"),1}}x6i(Fb,pa){const tb=Fb.map(Nb=>({activityId:Nb.activityGuid,activityFeedItemId:null,type:1,actors:[{id:Nb.author.id,provider:Nb.author.provider,displayName:Nb.author.displayName,givenName:null,email:Nb.author.email,imageUrl:Nb.author.imageUrl,
color:null}],location:{type:105,region:Nb.sheetName,subregion:[Nb.gridLocation]},displayTimestamp:Nb.displayTimestamp,relevancy:null,navigationId:null,state:0,collectionId:null}));this.V1d=Fb.map(Nb=>{var vc,Ic;const kd=null!==(Ic=null===(vc=Nb.rangeHighlightLocation)||void 0===vc?void 0:vc.rangeList.map(xd=>({Type:0,RangeList:[{SheetName:Nb.sheetName,FirstRow:xd.firstRow,LastRow:xd.lastRow,FirstColumn:xd.firstCol,LastColumn:xd.lastCol}]})))&&void 0!==Ic?Ic:[];return{Id:Nb.activityGuid,Type:null,
Person:null,DisplayTimestamp:null,LocationList:kd}});pa(tb)}Hig(Fb){this.blueDotManager?this.blueDotManager.$Fj().then(pa=>{this.x6i(pa,Fb)},()=>{}):d.ULS.shipAssertTag(509703879,3012,!1,"CatchUpActivityRequestManager.updateInGridBlueDots: Missing blue dot manager in blue dot method")}}wd.Dia="<WywaWaterline>DefaultWaterline</WywaWaterline>";wd.ztb=Object(V.a)(new bb,{activities:[],actors:[],hasMore:!1,highWaterline:wd.Dia,lowWaterline:wd.Dia,wywaWaterline:wd.Dia});Object(b.a)(wd,"CatchUpActivityRequestManager",
null,[725]);class Pd{constructor(Fb){this.$=Fb}shouldShowEmptyExperienceButton(){return this.$.ea.n9a?!0:!1}onButtonClick(){const Fb={["InputMethod"]:Pb.a.Db};this.$.Ja.Lb(new Z.a(1834994092,Pb.a.Db,this.$.Hc,16,null),Fb)}onInviteOthersButtonClick(){const Fb={["InputMethod"]:Pb.a.Db};this.$.Ja.Lb(new Z.a(869186573,Pb.a.Db,this.$.Hc,16,null),Fb)}getExplanationText(){const Fb=this.$.da.Aa(365);return dc.a.instance.Ua(Fb&&Fb.isVisible?657:656)}getCommandName(){return dc.a.instance.ga(443)}}Object(b.a)(Pd,
"CatchUpEmptyExperienceBehaviorManager",null,[726]);const je=Fb=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+Fb)};class be{constructor(Fb,pa=null){this.$=Fb;this.flyoutRibbonButton=pa;va.a(this.$).di(this);this.hasFocus=!1}dispose(){va.a(this.$).Zz(this)}get mc(){return document.getElementById("catchUpFlyoutContainer")}get Hf(){return this.flyoutRibbonButton.zif&&!this.hasFocus}get de(){return N.a.C1c}kg(Fb,pa){if(pa)return!1;Fb=document.getElementById("flyoutItem0");
if(!Fb)return d.ULS.sendTraceTag(537168009,3012,10,"Could not find firstItem in flyout when setting up focus"),!1;Fb.focus();this.ymh(Fb);return!0}mh(Fb){return this.mc?ea.DOMElementExtensions.Af(this.mc,Fb):!1}sj(){this.hasFocus=!0}dk(){this.hasFocus=!1}ymh(Fb){if(Sys.Browser.agent===Sys.Browser.Firefox){var pa=document.createEvent("KeyboardEvent");pa.initKeyEvent(Zc.a.Pb,!0,!0,window.self,!1,!1,!1,!1,ne.a.aRb,0);Fb.dispatchEvent(pa)}else pa=document.createEvent("Events"),pa.initEvent(Zc.a.Pb,!0,
!0),pa.keyCode=ne.a.aRb,pa.which=ne.a.aRb,Fb.dispatchEvent(pa)}}Object(b.a)(be,"FlyoutFocus",null,[34,2]);var Qe=a(423);class jc{constructor(Fb){this.buttonClickedCallback=null;this.kkb=this.QAb=!1;this.VHh=new Date;this.GYe=Fb}dispose(){this.kkb=this.QAb=!1}registerButtonClickedEvent(Fb){this.buttonClickedCallback&&d.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");this.buttonClickedCallback=Fb.buttonClickedCallback}onFlyoutInitialized(){this.QAb&&
d.ULS.sendTraceTag(537168007,3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");const Fb=(new Date).getTime()-this.VHh.getTime();d.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${Fb}`);n.c(mc.a.P0g,!0,n.e,0,0,Fb);this.QAb=!0;Qe.a.BC&&Qe.a.BC.updateCommandUI(!0)}logFlightTriggers(){}toggleCatchUpFlyout(){this.QAb?this.buttonClickedCallback?this.buttonClickedCallback():d.ULS.sendTraceTag(537168005,3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):
d.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get zif(){return this.kkb}onFlyoutVisibilityChanged(Fb){this.kkb!==Fb.flyoutIsVisible&&(this.kkb=Fb.flyoutIsVisible,Qe.a.BC&&Qe.a.BC.updateCommandUI(!0),this.kkb||this.GYe&&this.GYe.vzi())}}Object(b.a)(jc,"FlyoutRibbonButton",null,[837]);var Tc=a(524);class ub{constructor(){this.flyoutAnchorTarget=this.useCompactSummaryString=this.disableDismissOnClick=this.customDynamicEntryPointEnabled=
this.dynamicEntryPointEnabled=this.activityFeedDataEnabled=this.includeRelevantAuthorsInSummaryString=this.summaryStringEnabled=this.flyoutEnabled=this.featuredActivityGroupsEnabled=null}}Object(b.a)(ub,"CatchUpConfiguration",null,[]);class Vb{constructor(){this.emptyCatchUpBehaviorManager=this.ulsLogger=this.uiCulture=this.flyoutRibbonButton=this.flyoutFocus=this.dataCulture=this.changeSummariesDataProvider=this.appColorUpdateIsEnabled=this.activityRequestManager=this.activityNavigationManager=this.activityContentManager=
null}}Object(b.a)(Vb,"SharedControllerFactoryParameters",null,[]);class tc{constructor(Fb,pa,tb=null,Nb=null,vc=null){this.UHa=null;this.oaf=!1;this.Bf=()=>{this.Sha.Y3f(!0);this.drb.Hig(()=>{this.Sha.z2f(this.drb.V1d);this.Sha.Y3f(!1)})};this.UJf=Ic=>{S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&!ya.a.rh(Ic.wywaActivities)&&2!==Ic.wywaActivities[0].type&&(this.Sha.z2f(this.drb.V1d),this.showHideInGridHighlights(),this.Sha.abi(Ic.wywaActivities[0]),this.$.ea.nu(this.Bf))};
this.$=Fb;this.blueDotManager=vc;this.Sha=new Ie(this.$,this.blueDotManager);this.M6d=new Pc(e.AFrameworkApplication.ub,S.EwaSettings.ma(445));Fb=mb.a.eQj(Xa.a.instance.Ub("Common.App.CatchUpActivity.ICatchUpRequestHandler"));this.Spf=Nb;this.drb=new wd(this.$,Fb,this.E7a(),this.blueDotManager);this.t3b=new Ae(this.$,e.AFrameworkApplication.ub);this.emptyCatchUpBehaviorManager=new Pd(this.$);this.dyi(Ic=>{this.oMi(Ic)},pa);this.cAi();pa=null;tb||(pa=Xa.a.instance.resolve("Common.App.CatchUpActivity.FloodgateEventLogger"));
this.flyoutRibbonButton=tb||new jc(pa);this.flyoutFocus=new be(this.$,this.flyoutRibbonButton)}get Pgf(){const Fb=this.flyoutRibbonButton.QAb;Fb&&!this.oaf&&(d.ULS.sendTraceTag(588129368,3012,50,"Catch Up Flyout is ready and button is enabled."),this.oaf=!0);return Fb}get yki(){return this.flyoutRibbonButton.zif}dispose(){this.UHa&&this.UHa.getWywaEvent().removeListener(this.UJf);this.UHa=this.$=null;Hb.a.Ia(this.Sha);this.flyoutRibbonButton=this.flyoutFocus=this.M6d=this.t3b=this.drb=this.Sha=null;
this.$.ea.Nv(this.Bf)}GYi(){this.flyoutRibbonButton.toggleCatchUpFlyout();return!0}showHideInGridHighlights(){this.Sha.PNb()}cAi(){d.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.");this.kgf()&&d.ULS.sendTraceTag(526718752,3012,50,"ActivityFeedData is enabled")}dyi(Fb,pa){je("ScriptDownload");z.TaskExtensions.za(B.GetServiceTaskFactory.Oa(this.$.da,283,284,pa),tb=>{Fb(ca.c(tb.result.kn.loadScript("catchUpActivity")))},this.$.da.ka,3)}E7a(){return!!this.Spf&&this.Spf.E7a()&&
this.$.ea.n9a}kgf(){return S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ActivityFeedIsEnabled",!1)}oMi(Fb){z.TaskExtensions.za(Fb,()=>{aa.a(()=>{this.UHa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance(Object(V.a)(new Vb,{activityContentManager:Object(Zb.a)(723,this.M6d),activityNavigationManager:Object(Zb.a)(724,this.t3b),activityRequestManager:Object(Zb.a)(725,this.drb),dataCulture:this.$.va.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:Object(Zb.a)(jc,this.flyoutRibbonButton),
uiCulture:this.$.va.UICultureTag,ulsLogger:new D.a,emptyCatchUpBehaviorManager:Object(Zb.a)(726,this.emptyCatchUpBehaviorManager)}))});this.Sha.toe=this.UHa.getActivityIndicatorTooltipManager();Tc.a(this.$);this.UHa.getWywaEvent().addListener(this.UJf);je("InitializeCatchUpApp");this.UHa.initialize(Object(V.a)(new ub,{featuredActivityGroupsEnabled:!1,summaryStringEnabled:this.E7a(),includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0,activityFeedDataEnabled:this.kgf()}))},this.$.ka,
3)}}Object(b.a)(tc,"CatchUpActivityManager",null,[727,2]);class Sc extends f.a{constructor(Fb){super();this.$=Fb;this.Fb()}create(){let Fb=S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?B.GetServiceTaskFactory.Oa(this.$.da,501,500,1):I.Task.Ta(null),pa=B.GetServiceTaskFactory.Oa(this.$.da,458,459,this.Ya);z.TaskExtensions.za(z.TaskExtensions.Ed([Fb,pa],this.$.ka),()=>{const tb=pa.result,Nb=Fb.result,vc=Object(Va.a)(this.$.da,286,()=>new tc(this.$,this.Ya,null,tb,Nb));this.nb(vc)},
this.$.ka,3)}static la(Fb){Fb.da.Ga(287,new Sc(Fb))}}Object(b.a)(Sc,"CatchUpActivityManagerFactory",f.a,[]);var jd=a(235),pb=a(157),Rb=a(163),oc=a(283);class Jc{constructor(Fb,pa){this.blueDotSettings=0;this.areInGridHighlightsAvailable=()=>!0;this.areInGridHighlightsEnabled=()=>0===(this.blueDotSettings&1);this.xwj=tb=>{d.ULS.sendTraceTag(509732679,0,50,"User toggled in grid highlights, new value {0}.",tb);this.blueDotSettings=tb?0:1;tb=new Z.a(950288339,0,2,12,null);this.$.Ja.Lb(tb,{});this.E3j()};
this.$=Fb;this.blueDotSettings=pa;this.Yza=Xa.a.instance.resolve("Common.App.People.IUserProfilePictureUtils")}dispose(){this.$=null}$Fj(){return Object(Rb.a)(this,void 0,void 0,function*(){return new Promise(Fb=>{d.ULS.sendTraceTag(512234945,0,50,"BlueDotManager::showInGridBlueDots");sa.b(this.$).ud(eb.a.lineageLoadInGridBlueDots,{});const pa=Nb=>{Nb=Ia.a.Pe(Nb.data);d.ULS.sendTraceTag(512234944,0,50,`BlueDotManager::LineageLoadInGridBlueDots service call failed. Errors: [${P.a.sc(Nb)}]`)},tb=Nb=>
{if(Nb=nb.a(Nb)?null:Nb.Result){var vc={["CountOfActivities"]:Nb.ActivityList.length};sa.b(this.$).ud(eb.a.Mxi,vc);Nb=gb(Nb.ActivityList,this.Yza);Fb(Nb)}else d.ULS.shipAssertTag(512234914,0,!!Nb,"BlueDotManager LineageLoadInGridBlueDots returned null response.")};this.$.userOperationManager.Ic(new ob.a(1024,0,(Nb,vc,Ic)=>ec(this.$.pa.ya,Ua.b(Nb,tb),Ua.a(vc,pa),Ic,null),80),null)})})}E3j(){S.EwaSettings.isChangeGateEnabled("OfficeVSO:7146345_bluedotroamingsetting")&&!S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",
!1)&&oc.C(this.$.pa.ya,4,this.blueDotSettings.toString(),Fb=>{P.a.dg(Fb.Errors)?d.ULS.sendTraceTag(509732678,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: encountered an error. Errors: ${P.a.sc(Fb.Errors)}`):Fb.Result||d.ULS.sendTraceTag(509732677,0,10,"BlueDotManager.writeBlueDotSettingsToRoamingService failed to write to roaming service.")},(Fb,pa,tb)=>{Fb=Ia.a.Pe(Fb.data);d.ULS.sendTraceTag(509732676,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: Encountered errors for ${tb}. Errors: ${P.a.sc(Fb)}.`)},
null,null)}}Object(b.a)(Jc,"BlueDotManager",null,[863,2]);class ud extends f.a{constructor(Fb){super();this.Pbc=null;this.jQi=pa=>{pa=Ia.a.Pe(pa.data);d.ULS.sendTraceTag(509732673,0,10,`LineageBlueDotFactory: Encountered errors while reading roaming setting. Errors: ${P.a.sc(pa)}.`)};this.$=Fb;this.Fb()}create(){this.Pbc||(this.Pbc=this.mOh());this.Pbc.continueWith(()=>{this.nb(Object(Va.a)(this.$.da,501,()=>new Jc(this.$,this.Pbc.result)))})}static la(Fb){Fb.da.Ga(500,new ud(Fb))}mOh(){if(S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",
!1))return jd.a.Ta(0);let Fb=new pb.a;Object(oc.w)(this.$.pa.ya,4,pa=>{this.kQi(pa,Fb)},pa=>{this.jQi(pa);Fb.setResult(1)},null,null);return Fb.task}kQi(Fb,pa){P.a.dg(Fb.Errors)?(d.ULS.sendTraceTag(509732675,0,10,`LineageBlueDotFactory encountered an error while reading roaming setting. Errors: ${P.a.sc(Fb.Errors)}`),pa.setResult(1)):null==Fb.Result?pa.setResult(0):(Fb=parseInt(Fb.Result,10),d.ULS.sendTraceTag(509732674,0,50,`LineageBlueDotFactory read roaming setting. Value: ${Fb}`),pa.setResult(Fb))}}
Object(b.a)(ud,"BlueDotManagerFactory",f.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");Type.registerNamespace("_Ewa");c.a.Fa($a.la);c.a.Fa(fb.la);c.a.Fa(v.la);c.a.Fa(y.la);Ka.a.Ni('.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:bold;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}');
(()=>{c.a.Fa(Fb=>{ed.la(Fb);Sb.la(Fb);za.la(Fb);Fd.la(Fb);jb.la(Fb)})})();Type.registerNamespace("Common.App.CatchUpActivity");$e.main();(()=>{c.a.Fa(Fb=>{je("Begin");Sc.la(Fb);ra.la(Fb)})})();(()=>{c.a.Fa(Fb=>{ud.la(Fb)})})()},984:function(u,F,a){a.d(F,"a",function(){return e});u=a(0);var c=a(164);F=a(1240);var b=a(762);class e extends F.a{constructor(f,d){super(f,d);d!==b.a.m$&&this.vGa(d);this.Yga(e.iterateNext);this.Yga(e.Uxa);this.jWc(c.a.rVa);this.jWc(c.a.sVa)}}e.iterateNext="IterateNext";e.Uxa=
"IteratePrevious";e.FPb="ToggleShowChanges";e.setCurrentChangeCount="SetCurrentChangeCount";e.setTotalChangesCount="SetTotalChangesCount";e.YPa="OnVHDiffReady";Object(u.a)(e,"VersionHistoryMessenger",F.a,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.catchup.js.map/500701f85950382040e4fd9c3743180b/EwaDSEsNext.catchup.js.map