'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[18],{1112:function(u,F,a){a.d(F,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertFile")}},1113:function(u,F,a){a.d(F,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertPicture")}},1115:function(u,F,a){a.d(F,"a",function(){return b});var c=a(513);const b=()=>{c.a.Ni(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}},
1116:function(u,F,a){a.d(F,"a",function(){return c});u=a(0);class c{}c.OFc="b-ring_Apc_Trans";c.wng="cdn_static_resource_ewa_image";Object(u.a)(c,"ResourceHosts",null,[])},1138:function(u,F,a){var c=a(0),b=a(7),e=a(15),f=a(222),d=a(30),h=a(27),n=a(354),m=a(171),x=a(263),r=a(357),y=a(4),t=a(1),v=a(38),w=a(8),C=a(284),B=a(13);class z extends C.a{constructor(Ya){super(Ya);this.w4g=()=>{e.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};e.ULS.sendTraceTag(537167828,
0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");this.Rb=0;this.pc(1,B.a.instance.ga(2254));Ya=B.a.instance.ga(2252);const ra=this.oN();this.initializeAndShow(Ya,this.w4g,ra)}get qc(){return"ClipboardReadPermissionAskDialog"}oN(){const Ya={};Ya.id=this.qc;const ra=B.a.instance.ga(2253);Ya.DialogMessage=ra;return Ya}}Object(c.a)(z,"ClipboardReadPermissionAskDialog",C.a,[]);var A=a(51);const E=(Ya,ra,ya,mb,Hb)=>{const Zb=Ya.Stopwatch,mc={};mc.a=Hb;mc.e=Zb.id;mc.c="RearrangeRowColumn";
mc.b="mouse";mc.d=Ya.OperationId.toString();mc.f=ya.toString();mc.g=mb.toString();mc.h=ra.toString();mc.i=Ya.DragDropIsShiftKeyDown;mc.j=!0;mc.o=Zb.Ac;mc.q=!1;mc.r=Ya.CopyPasteTargetType.toString();mc.s=Ya.EncounteredDeploymentErrors;return mc};class I{constructor(Ya,ra){this.vKh=()=>{const ya={};ya.SourceItem=this.toString();return ya};this.sessionStateId=Ya;this.sessionId=ra;this.toJSON=this.vKh}Zhf(Ya){return Ya?this.sessionStateId===Ya.sessionStateId&&this.sessionId===Ya.sessionId:!1}isFromCurrentSession(Ya){return this.sessionId===
Ya.va.UserSessionId}}Object(c.a)(I,"SourceItem",null,[]);class L extends I{constructor(Ya,ra,ya,mb,Hb){super(ya,mb);this.activeFloatingObjectControlId=Ya;this.sheetName=ra;this.type=Hb}isEqual(Ya){return Ya&&Object.getType(Ya)===L?this.Zhf(Ya)&&this.activeFloatingObjectControlId===Ya.activeFloatingObjectControlId&&this.sheetName===Ya.sheetName:!1}toString(){return this.type.toString()}}Object(c.a)(L,"ArtSourceItem",I,[]);var V;(function(Ya){Ya[Ya.valid=0]="valid";Ya[Ya.notPairwiseDisjoint=1]="notPairwiseDisjoint";
Ya[Ya.cutNotSupportedInDiscontinuousSelection=2]="cutNotSupportedInDiscontinuousSelection";Ya[Ya.notValidForm=3]="notValidForm";Ya[Ya.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(V||(V={}));Object(c.b)("CopySourceValidationOptions",V);var T=a(40);class H extends I{constructor(Ya,ra,ya,mb,Hb){super(mb,Hb);e.ULS.shipAssertTag(537167645,0,!!ra&&0<ra.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=Ya;this.ranges=ra;this.sheetName=ya}isEqual(Ya){return Ya&&Object.getType(Ya)===
H?this.Zhf(Ya)&&T.Q(this.ranges,Ya.ranges)&&this.sheetName===Ya.sheetName:!1}toString(){return T.i(this.ranges,",",this.$,!1)}}Object(c.a)(H,"RangeSourceItem",I,[]);const D=Ya=>!!Ya&&Object.getType(Ya)===H;class G{}G.S_j="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(c.a)(G,"ExpectedErrorNames",null,[]);class J{}J.plainText="text/plain";J.html="text/html";J.png="image/png";J.shadowWorkbook="data/shadow-workbook";J.yoi="metadata/is-last-copy-was-external";J.Qki="metadata/is-last-copy-was-external-XLO-source";
J.T2g="metadata/chrome-extension-id";J.qsb="copyId";J.BOg="metadata/additional-signature-data-attributes";Object(c.a)(J,"ClipboardDataFormat",null,[]);const M=Ya=>Ya.clipboardItems&&(Ya=Ya.clipboardItems.getItem(J.yoi))&&"1"===Ya?!0:!1,Q=Ya=>M(Ya)&&!(void 0===Ya.clipboardItems||null===Ya.clipboardItems)&&!!Ya.clipboardItems.getItem(J.png)&&!Ya.clipboardItems.getItem(J.plainText),U=Ya=>Ya.clipboardItems&&(Ya=Ya.clipboardItems.getItem(J.Qki))&&"1"===Ya?!0:!1,Z=Ya=>Ya&&(Ya=Ya.getCachedMetadata(),null===
Ya||void 0===Ya?0:Ya.lastCopy)?Ya.lastCopy:null;var P=a(50),S=a(21),ja=a(34);class X{constructor(Ya,ra,ya,mb){this.$=Ya;this.originalDestinations=ra;this.M$b=ya;this.lrg=mb;this.gBg=this.originalDestinations;this.bvg=this.M$b;this.Byg="PasteRecoveryUI"}get AOg(){return this.lrg}get cxi(){return this.Byg}get xbj(){return this.gBg}get oWe(){return this.bvg}bLa(){return X.Q1i}jSh(){return this.M$b&&1===this.M$b.length?this.kSh(this.M$b[0]):null}kSh(Ya){var ra=S.h(this.$);const ya=ra.ib.Mi(Ya);var mb=
ra.fg(Ya,ya);ra=ra.rtl;if(!mb)return null;Ya=S.h(this.$).Df(ya);const Hb=Ya.Am;if(!Hb.Cd(mb))return null;mb=Hb.Ie(mb);const Zb=mb.topLeft.y;var mc=mb.bottomRight.y;const Pc=ra?mb.bottomRight.x:mb.topLeft.x;mb=ra?mb.topLeft.x:mb.bottomRight.x;var fd=new P.a(mb+(ra?-81:81),mc+38+6);if(Hb.mia(fd))return this.k5a(Ya,Hb,ya,mb,mc,ra?12:-3,66);fd=new P.a(mb+(ra?-81:81),mc);if(Hb.mia(fd))return this.k5a(Ya,Hb,ya,mb,mc,ra?20:3,22);fd=new P.a(mb,mc+38+6);if(Hb.mia(fd))return this.k5a(Ya,Hb,ya,mb,mc,-81+(ra?
18:0),66);mb=new P.a(Pc+(ra?81:-81),mc);if(Hb.mia(mb))return this.k5a(Ya,Hb,ya,Pc,mc,-81+(ra?12:-6),22);mc=new P.a(Pc,Zb-38-6);return Hb.mia(mc)?this.k5a(Ya,Hb,ya,Pc,Zb,ra?15:0,16):this.k5a(Ya,Hb,ya,ra?Hb.topLeft.x:Hb.bottomRight.x,Hb.bottomRight.y,-81+(ra?15:-6),22)}k5a(Ya,ra,ya,mb,Hb,Zb,mc){var Pc=S.h(this.$);const fd=Pc.rtl;Ya=Sys.UI.DomElement.getLocation(Ya.domElement);mb=new Sys.UI.Point(mb+(fd?0:Ya.x)-ra.topLeft.x,Hb+Ya.y-ra.topLeft.y);fd&&(Pc=Pc.view.visibleArea,mb.x=Pc.bottomRight.x-Pc.topLeft.x-
mb.x,2===ya||4===ya)&&(mb.x+=ra.bottomRight.x);mb=ja.a(this.$).eka(mb);return new Sys.UI.Point(mb.x+Zb,mb.y+mc)}}X.Q1i=["PasteRecoveryUI"];Object(c.a)(X,"PasteRecoveryUI",null,[437]);var Y=a(76),va=a(174);class N{}N.kGg="ActiveSelection";N.shadowWorkbook="ShadowWorkbook";N.Gog="GVML";N.plainText="PlainText";N.html="Html";N.HUg="Bitmap";Object(c.a)(N,"PayloadType",null,[]);class ea{}ea.nIj="Slice6";Object(c.a)(ea,"SliceName",null,[]);class Ca{}Ca.eJi="NotCalled";Ca.success="Success";Ca.failed="Failed";
Object(c.a)(Ca,"SucceededPopulatingSystemClipboardOptions",null,[]);var la=a(361);const Ra=(Ya,ra)=>Ya?ra&&ra.va?Ya.sessionId!==ra.va.UserSessionId:(e.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),!1):(e.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),lb=Ya=>{switch(Ya){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},Aa=Ya=>{if(!Ya)return"null";const ra=[];for(const ya of Ya.get())ra.push(`${ya.clipboardDataFormat}(${ya.data.length})`);
ra.sort();return ra.join(",")};var da;(function(Ya){Ya[Ya.valid=0]="valid";Ya[Ya.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";Ya[Ya.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";Ya[Ya.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";Ya[Ya.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";Ya[Ya.multipleDestinationsAreNotMultiplyOfSourceRange=
5]="multipleDestinationsAreNotMultiplyOfSourceRange";Ya[Ya.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";Ya[Ya.copySourceNotValid=7]="copySourceNotValid";Ya[Ya.cutNotSupportedInDiscontinuousSelection=8]="cutNotSupportedInDiscontinuousSelection";Ya[Ya.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";Ya[Ya.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";Ya[Ya.unknown=100]="unknown"})(da||(da={}));Object(c.b)("PasteValidationOptions",
da);var aa=a(49),fa=a(142),Oa=a(37),ba=a(154),ka=a(348),Pa=a(29),Fa=a(320),oa=a(11),La=a(22),Ea=a(124),ca=a(112),$a=a(564),Qa=a(99),Va=a(55),fb=a(185),Ka=a(66),hb=a(346);class fc extends Sys.EventArgs{constructor(Ya,ra,ya){super();this.command=Ya;this.destinationRange=ra;this.sourceRange=ya}}Object(c.a)(fc,"PasteCSERenderedEventArgs",Sys.EventArgs,[]);class dc extends v.a{constructor(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd=null){super();this.pasteShortcutManager=null;this.chf=t.EwaSettings.xb();this.xxa=t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",
!1);this.zdg=null;this.l8a=!1;this.Itd=t.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");this.nxa=t.EwaSettings.isChangeGateEnabled("OfficeVSO:7205979_DemoteDragDropNonEmptyRangeLogLevel");this.RDd=id=>{this.KBj(id)&&(this.cq.ufc(),e.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};this.NBi=(id,Dd)=>{e.ULS.sendTraceTag(537167768,
0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${id}]. userPressedExtensionLink=${Dd}`);this.gridView.focus()};this.ed=(id,Dd)=>{Dd.IN||Dd.Of||this.Ar("OnWorkbookOpened",!1).catch(()=>{})};this.Gh=(id,Dd)=>{id=Z(this.XK);const Zd=this.cq.Nxb(id);Zd&&(Dd.oa&&Dd.oa.sheetName===Zd.sheetName&&Zd.isFromCurrentSession(this.$)?this.cq.icf(Zd.ranges,id.commandParameters.commandType):this.cq.ufc())};this.Cpc=(id,Dd)=>{id=Z(this.XK);(id=this.cq.Nxb(id))&&
Dd.item&&Dd.item.sheetName===id.sheetName&&id.isFromCurrentSession(this.$)&&this.Ar("OnItemDeleting",!1).catch(()=>{})};this.VGb=(id,Dd)=>{this.chf?this.zdg(id,Dd):this.KIf()};this.GR=(id,Dd)=>{1===Dd.Lr&&Dd.Tf.operation.flags&2&&this.Ar("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=Ya;this.sg=ya;this.gridView=S.h(Ya);this.cq=Hb;this.Xgi=Zb;this.XK=ra;this.G5b=mb;this.getStringifiedError=fd||copyPasteInfra.getStringifiedError;this.T7f=1===Pc;this.gdd=t.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray");
this.Nj();this.copyPasteShortcutDialogFactory=this.$.da.Aa(85);e.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");mc||(e.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),mc=dc.ojh);this.userHash=d.a.mw(mc);this.RFi="CultureTag: "+B.a.instance.Btb+" HASH: ";this.XK.addMetadataChangeListener(dc.wvf,this.RDd);this.EEi=va.a.vEb;this.Gya=this.xxa?
t.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.va.CopyPasteMaxPayloadLength):w.a.Gya;(this.Fo=t.EwaSettings.getBooleanFeatureGate(va.a.FQa,!1))&&Ya.da.$a(478,id=>{this.pasteShortcutManager=id});this.chf&&(this.zdg=Fa.a(()=>{this.KIf()},1,this.$.ka,"CopyPasteInfrastructure.OnStartEditInternal",!0))}oNe(){var Ya=Z(this.XK);return Ya?(Ya=Ya.sourceItem)&&!Ya.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),
!1):!0:!1}get pasteIndicationManager(){return this.$.da.Aa(373)}PMg(Ya){this.addHandler(dc.PEd,Ya)}Qhj(Ya){this.removeHandler(dc.PEd,Ya)}copy(Ya){Ya.stopwatch=this.$.Kb.Bc("UserAction",A.b().uj(Ya.ribbonCommandInfo.command)+"ClientSide");if(this.Fo){const Zb=aa.GetServiceTaskFactory.Oa(this.$.da,478,479,0);Oa.TaskExtensions.za(Zb,()=>{this.pasteShortcutManager=Zb.result},this.ka,3)}const ra=!!Z(this.XK);t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&
!h.a.Fz&&(this.l8a=!1);this.Ar("Copy/before/"+n.a[Ya.ribbonCommandInfo.method],!1,void 0,!0,Ya.copyPasteTargetType).catch(()=>{});var ya=-1985798686===Ya.ribbonCommandInfo.command;if(1===this.gridView.Oe&&(ya=this.cq.phf(this.gridView.ha.ra.selectedRanges,ya),0!==ya)){const Zb=dc.b9g(ya);this.Pza(Zb,V[ya],!1);return Promise.reject(!1)}Ya.userHash=this.userHash;Ya.id=m.a.create().toString();let mb=this,Hb=this;return this.G5b.onCopy(Ya).then(Zb=>{Zb.isAsyncCopy||Ya.stopwatch.stop();mb.pasteIndicationManager.KNe();
const mc=la.d(Ya);e.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${mc}`);mb.Izi(Zb,ra);Zb=t.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===Ya.copyPasteTargetType:!0;!Ya.isFormatPainter&&mb.Fo&&Zb&&(mb.pasteShortcutManager?mb.pasteShortcutManager.Rqh():e.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));return Promise.resolve(!0)},Zb=>{let mc=!1,Pc="none",fd=dc.ytb,id=!0,Dd=-1,Zd=
dc.copyErrorName+dc.RJa,bc=!1,Qc=null;if(Zb){Qc=Zb.copyContext;Dd=Zb.reason;Zd+=dc.jLa(Zb);Zb.message&&(fd=Zb.message);var pd=dc.a9g(Zb);if(pd)if(3===pd.copyErrorName)mc=!0,fd=Pc="Async Copy canceled by the user.",id=!1;else if(Pa.a.Lq(pd.ewaErrors))if(fd=Hb.Ccc(pd.ewaErrors),Pa.a.eh(pd.ewaErrors,dc.operationSucceededWithAlert))bc=mc=!0;else if(Pa.a.eh(pd.ewaErrors,dc.pasteDataLimitHit)||Pa.a.eh(pd.ewaErrors,dc.copyThrottlingError))mc=!0;13===Zb.reason?(mc=!0,id=!1):11===Zb.reason&&(id=!1)}pd=Zb?
Hb.getStringifiedError(Zb):"null";mc?(pd=la.d(Ya),e.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${id}, Friendly message: ${Pc}, Error Message: ${fd}, CommandParameters: ${pd}`)):e.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${id}, Error Message: ${pd}, CommandParameters: ${la.d(Ya)}`);id&&Hb.Ar("Copy/fail/"+n.a[Ya.ribbonCommandInfo.method],
!0,void 0,void 0,Ya.copyPasteTargetType).catch(()=>{});Hb.Hzi(Ya,mc,fd,Zd,Dd,bc,Qc);return Promise.reject(Zb)})}paste(Ya){Ya.stopwatch=this.$.Kb.Bc("UserAction",A.b().uj(Ya.ribbonCommandInfo.command)+"ClientSide");t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Fz&&(e.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.l8a=!1,Ya.clipboardPicklingApiDataFormatsToRead=[J.shadowWorkbook]);
S.h(this.$).Eh&&S.h(this.$).Eh.d1(this.Uhd(Ya.ribbonCommandInfo.command),Ya.stopwatch.id);if(Ya.isPasteCommandFromRecoveryUI){var ra=this.$.da.Aa(406);var ya=this.gdd?T.d(ra.dlc):x.a.clone(ra.dlc);ra=ra.Xud;Ya.pasteRecoveryCachedClipboardItems=ra?ra[dc.JLf]:null}else ya=this.gdd?T.d(this.gridView.ha.ra.selectedRanges):x.a.clone(this.gridView.ha.ra.selectedRanges);Ya.originalDestinations=ya;Ya.expandDestinations=this.H0c(Ya.originalDestinations,Ya.commandType);if(this.T0c(Ya.commandType,Ya.expandDestinations)||
this.U_g())return Ya.userHash=this.userHash,Ya.id=m.a.create().toString(),t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!h.a.Fz&&(Ya.clipboardReadPermissionPromptShown=!1,Ya.clipboardAsyncApiDataFormatsToRead=[J.plainText+"Async"],this.G5b.shouldShowClipboardReadPermissionDialog().then(mb=>{mb&&(Ya.clipboardReadPermissionPromptShown=!0,new z(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.G5b.onPaste(Ya).then(mb=>this.aqc(mb,
Ya),mb=>this.IGb(Ya,mb));this.$.Xc(927125067,Y.a.Db,30,null);ya=T.i(Ya.expandDestinations,",",this.$,!1);e.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${ya}, CommandType: ${Ya.commandType}, copyPasteTargetType="${Ya.copyPasteTargetType}"`);return Promise.resolve(!0)}Uhd(Ya){switch(Ya){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8;default:return 3}}U_g(){return!!S.h(this.$).ha.Sa.activeFloatingObjectControlId&&
this.$.$p(null,!1,470)}ZCb(){const Ya=Z(this.XK);return Ya&&Ya.commandParameters?Ya.commandParameters.copyPasteTargetType:0}xoi(){return!!Z(this.XK)&&Ra(Z(this.XK),this.$)}Ar(Ya,ra,ya=!1,mb=!1,Hb=0){try{this.Fo&&this.pasteShortcutManager&&this.pasteShortcutManager.l8b();let Zb=Hb;const mc=this.Yvi();if(!mb&&2===mc)return e.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${ra}', isExplicit = '${ya}', isForce = '${mb}', Current CCP operation copyPasteTargetType = '${Hb}', LastCopyPasteTargetType = '${mc}'`),
Promise.reject(null);0===Zb&&(Zb=mc);const Pc=this.$.Kb.Bc("UserAction","ClearCopyState"),fd=Pc.id;e.ULS.sendTraceTag(537167820,0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${ra}', isExplicit = '${ya}', isForce = '${mb}', Current CCP operation copyPasteTargetType = '${Hb}', LastCopyPasteTargetType = '${mc}'`);this.cq.ufc();this.L9i();return this.G5b.onCancelCopy(ra).then(()=>{ra&&t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.Fz&&(this.l8a=!1);Pc.stop();this.crf(Ya,fd,!0,ya,ra,"","",Pc.Ac,Zb);return Promise.resolve(!0)},id=>{var Dd=id?this.getStringifiedError(id):"null";e.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${Dd}`);Pc.stop();Dd=dc.j0g+dc.RJa;let Zd=dc.ytb;id&&(Dd+=dc.jLa(id),id.message&&(Zd=id.message));this.crf(Ya,fd,!1,ya,ra,Zd,Dd,Pc.Ac,Zb);return Promise.reject(id)})}catch(Zb){return Promise.reject(null)}}N2c(Ya,ra,
ya=!1,mb=!1,Hb=0){return mb||!t.EwaSettings.ma(645)||this.oNe()?this.Ar(Ya,ra,ya,mb,Hb):(e.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}Pza(Ya,ra,ya){e.ULS.sendTraceTag(590705172,0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${ra}`);const mb=new Qa.a;
mb.ia("reason",ra);$a.a(Ea.a.discontinuousSelectionBlocking,[ya?ca.a.J1i:ca.a.Y9g],!0,!0,!1,!1,mb);Ya=Pa.a.$c(1,1,751,Ya,0,371863010,"DiscontinuousSelectionBlocking");t.EwaSettings.Jz()?new ka.a(this.$,Ya):(Ya=new ba.ErrorDialog(this.$,Ya),Ya.initialize(),Ya.xg())}Yvi(){const Ya=Z(this.XK);return Ya&&Ya.sourceItem?Object.getType(Ya.sourceItem)===L?2:1:0}dragDropCells(Ya,ra,ya,mb,Hb=!1){Ya.stopwatch=this.$.Kb.Bc("UserAction","DragDropClientSide");Ya.isDragDrop=!0;this.Ar("DragDrop/before/"+n.a[Ya.ribbonCommandInfo.method],
!1,void 0,void 0,Ya.copyPasteTargetType).catch(()=>{});const Zb=Hb?2:1;let mc=0;mc=Hb?4:mb?256:128;const Pc={encounteredDeploymentErrors:!1};Pc.commandParameters=Ya;Ya.userHash=this.userHash;Ya.id=m.a.create().toString();return this.Itd?this.cq.pasteRange(Ya.ribbonCommandInfo,T.q(ra,this.$),T.q(ya,this.$),Zb,mc,[Ya.stopwatch],Pc,!1,()=>{e.ULS.sendTraceTag(537167818,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${Ya.copyPasteTargetType}"`);this.s9a(Ya,Zb,ra,ya,Pc)},fd=>
{const id=fd?this.getStringifiedError(fd):"null";this.nxa||e.ULS.sendTraceTag(537167817,0,10,`CopyPasteInfrastructure.DragDropCells: ${id}, copyPasteTargetType="${Ya.copyPasteTargetType}"`);this.R$a(fd,Ya,Zb,ra,ya,Pc)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},fd=>Promise.reject(fd)):this.cq.pasteRange(Ya.ribbonCommandInfo,T.q(ra,this.$),T.q(ya,this.$),Zb,mc,[Ya.stopwatch],Pc,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${Ya.copyPasteTargetType}"`);
this.gridView.ha.selectionType=-1;this.s9a(Ya,Zb,ra,ya,Pc);return Promise.resolve(!0)},fd=>{const id=fd?this.getStringifiedError(fd):"null";this.nxa||e.ULS.sendTraceTag(521410074,0,10,`CopyPasteInfrastructure.DragDropCells: ${id}, copyPasteTargetType="${Ya.copyPasteTargetType}"`);this.R$a(fd,Ya,Zb,ra,ya,Pc);return Promise.reject(fd)})}uoh(Ya,ra,ya,mb,Hb=!1){Ya.stopwatch=this.$.Kb.Bc("UserAction","DragDropReplaceClientSide");Ya.isDragDrop=!0;this.N2c("DragDropReplace/before/"+n.a[Ya.ribbonCommandInfo.method],
!1,void 0,void 0,Ya.copyPasteTargetType).catch(()=>{});const Zb=Hb?2:1;let mc=0;mc=Hb?4:mb?256:128;const Pc={encounteredDeploymentErrors:!1};Pc.commandParameters=Ya;t.EwaSettings.getBooleanFeatureGate(va.a.U8b,!1)&&(Ya.isDragInsert=!1);Ya.userHash=this.userHash;Ya.id=m.a.create().toString();return this.Itd?this.cq.pasteRange(Ya.ribbonCommandInfo,T.q(ra,this.$),T.q(ya,this.$),Zb,mc,[Ya.stopwatch],Pc,!1,()=>{e.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${Ya.copyPasteTargetType}"`);
this.s9a(Ya,Zb,ra,ya,Pc)},fd=>{const id=fd?this.getStringifiedError(fd):"null";this.nxa||e.ULS.sendTraceTag(537167815,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${id}, copyPasteTargetType="${Ya.copyPasteTargetType}"`);return this.R$a(fd,Ya,Zb,ra,ya,Pc)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},fd=>Promise.reject(fd)):this.cq.pasteRange(Ya.ribbonCommandInfo,T.q(ra,this.$),T.q(ya,this.$),Zb,mc,[Ya.stopwatch],Pc,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410073,
0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${Ya.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.s9a(Ya,Zb,ra,ya,Pc);return Promise.resolve(!0)},fd=>{const id=fd?this.getStringifiedError(fd):"null";this.nxa||e.ULS.sendTraceTag(521410072,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${id}, copyPasteTargetType="${Ya.copyPasteTargetType}"`);this.R$a(fd,Ya,Zb,ra,ya,Pc);return Promise.reject(fd)})}toh(Ya,ra,ya,mb,Hb=!1){Ya.stopwatch=this.$.Kb.Bc("UserAction",
"DragDropInsertClientSide");this.N2c("DragDropInsert/before/"+n.a[Ya.ribbonCommandInfo.method],!1,void 0,void 0,Ya.copyPasteTargetType).catch(()=>{});const Zb=Hb?2:1,mc=T.K(this.H0c([ya],Zb));var Pc=this.$.ea.oa.sheetName;const fd=this.$.ea.oa.sheetName,id=T.v(ra,this.$);id.SheetName=Pc;Pc=T.v(mc,this.$);Pc.SheetName=fd;mb=mc.isRow||ra.isRow||mb?1:0;const Dd={encounteredDeploymentErrors:!1};Ya.isDragInsert=!0;Dd.commandParameters=Ya;Ya.userHash=this.userHash;Ya.id=m.a.create().toString();if(this.Itd)return Hb=
this.cq.QNe(Dd,id,Pc,Hb,mb,Ya.ribbonCommandInfo,()=>{e.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${Ya.copyPasteTargetType}"`);this.s9a(Ya,Zb,ra,ya,Dd)},bc=>{const Qc=bc?this.getStringifiedError(bc):"null";this.nxa||e.ULS.sendTraceTag(537167813,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${Qc}, copyPasteTargetType="${Ya.copyPasteTargetType}"`);this.R$a(bc,Ya,Zb,ra,ya,Dd)}),fb.c(Hb.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},
bc=>Promise.reject(bc))).jp(()=>!0);Hb=this.cq.QNe(Dd,id,Pc,Hb,mb,Ya.ribbonCommandInfo,null,null);let Zd=this;return fb.c(Hb.then(()=>{e.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${Ya.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.s9a(Ya,Zb,ra,ya,Dd);return Promise.resolve(!0)},bc=>{const Qc=bc?Zd.getStringifiedError(bc):"null";this.nxa||e.ULS.sendTraceTag(521410070,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${Qc}, copyPasteTargetType="${Ya.copyPasteTargetType}"`);
Zd.R$a(bc,Ya,Zb,ra,ya,Dd);return Promise.reject(bc)})).jp(()=>!0)}bff(Ya,ra){var ya=Z(this.XK);if(!ya)return e.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),Va.Task.Ta(!1);if(!D(ya.sourceItem))return e.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),Va.Task.Ta(!1);var mb=ya.sourceItem;if(!mb)return e.ULS.shipAssertTag(537167810,0,!!mb,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),Va.Task.Ta(!1);
if(!mb.isFromCurrentSession(this.$))return e.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),Va.Task.Ta(!1);if(1<mb.ranges.length)return e.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.Pza(2186,"InsertCopiedCutCells",!0),Va.Task.Ta(!1);ya=T.K(mb.ranges);var Hb=this.gridView.ha.ra.dd.clone();Ya=T.K(this.H0c([Hb],Ya));const Zb=this.Uof();mb=mb.sheetName;Hb=this.$.ea.oa.sheetName;const mc=T.v(ya,
this.$);mc.SheetName=mb;const Pc=T.v(Ya,this.$);Pc.SheetName=Hb;return(Ya.hf||ya.hf?Va.Task.Ta(0):Ya.isRow||ya.isRow?Va.Task.Ta(1):this.Xgi.X5b(this.$,S.h(this.$).rtl)).jp(fd=>this.cq.executeInsertCopiedCutCellsOperation(mc,Pc,Zb,fd.result,ra,null,null)).continueWith(()=>{Zb?this.cq.ufc():this.Ar("InsertCopiedCutCells/success/"+n.a[ra.method],!0)})}qrd(){const Ya=Z(this.XK),ra=this.gridView.ha.ra.Pg;return!!Ya&&D(Ya.sourceItem)&&ra&&1===Ya.sourceItem.ranges.length}Uof(){return this.Vof(-911352779)}clc(){return this.Vof(-1985798686)}T0c(Ya,
ra){var ya=new fa.a(this.$.xa),mb=36===Ya;const Hb=ya.Td(4);Ya=2===this.ZCb()&&ya.Td(1);mb=mb&&Hb;ya=!ya.ji||!this.clc()||!fa.a.H8b(ra,S.h(this.$));return mb||Ya||this.$.$p(ra,!0)&&ya}mic(Ya,ra){return this.cq.mic(Ya,ra)}dispose(){super.dispose();this.gk();this.XK.removeMetadataChangeListener(dc.wvf)}a9c(Ya,ra,ya,mb,Hb,Zb){if(!this.f4g(Ya.commandParameters.ribbonCommandInfo.command))return Ya.cseStatus=2,!1;if(Zb&&ra.Cd(mb))return Ya.cseStatus=4,!1;if(ya!==Hb)return Ya.cseStatus=6,!1;if(t.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&
(mb.width%ra.width||mb.height%ra.height))return Ya.cseStatus=16,!1;if(t.EwaSettings.getBooleanFeatureGate(va.a.HJe,!1)){if(ya=ra,mb=mb.Ie(this.gridView.ui),ra=null===ra.Ie(this.gridView.ui),Hb=Ya.commandParameters.ribbonCommandInfo.command,ra&&1804571062!==Hb&&-185374993!==Hb||!mb)return Ya.cseStatus=7,!1}else if(ya=ra.Ie(this.gridView.ui),mb=mb.Ie(this.gridView.ui),!ya||!mb)return Ya.cseStatus=7,!1;ra=T.v(ya,this.$);ra=this.sg.O1i(this.gridView,ra,T.v(mb,this.$),Ya.commandParameters.ribbonCommandInfo.command,
Ya.commandParameters.stopwatch);1===ra&&(Zb&&(this.sg.F2c(ya,!1),this.sg.F2c(ya,!0)),Zb=new fc(Ya.commandParameters.ribbonCommandInfo.command,mb,ya),S.h(this.$).w9i(Zb),this.pasteIndicationManager.dmd(Ya.commandParameters.id),this.ixc(Ya.commandParameters.expandDestinations,Ya.commandParameters.isPasteCommandFromRecoveryUI),this.iDe("DoPasteClientEstimation/"+n.a[Ya.commandParameters.ribbonCommandInfo.method],Ya));Ya.cseStatus=ra;return 1===ra}UMf(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,
!1,!1,this.NBi)}Lrf(Ya,ra,ya,mb){Ya=E(Ya,ra,ya,mb,this.$.va.UserSessionId);Ya.k=!0;A.b().Qe(45,Ya,!0)}FGf(Ya,ra,ya,mb,Hb){var Zb=!1,mc=!1,Pc=dc.ytb,fd=dc.MNe+dc.RJa;Ya&&(fd+=dc.jLa(Ya),Pa.a.Lq(Ya.ewaErrors)?(Pc=this.Ccc(Ya.ewaErrors),Pa.a.eh(Ya.ewaErrors,[-103190598])&&(Zb=!0)):Ya.message&&(Pc=Ya.message));mc||(mc=this.Iqd(Ya));ra=E(ra,ya,mb,Hb,this.$.va.UserSessionId);ra.k=!1;ra.l=mc;ra.n=Pc;ra.p=fd;ra.q=Zb;A.b().Qe(45,ra,!0);return Promise.reject(Ya)}f4g(Ya){switch(Ya){case 237279923:case 808159687:return t.EwaSettings.isChangeGateEnabled("OfficeVSO:7317055_PasteCse");
case -185374993:return!0;case 1804571062:return!0;default:return!1}}Vof(Ya){const ra=Z(this.XK);if(!ra)return!1;const ya=ra.sourceItem;return ya&&!ya.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1):ra.commandParameters.ribbonCommandInfo.command===Ya}KBj(Ya){return Ya&&Ya.lastCopy?Ra(Ya.lastCopy,this.$):!0}i2e(Ya,ra,ya,mb,Hb){const Zb={};Zb.a=this.$.va.UserSessionId;Zb.e=Ya.stopwatch.id;
Zb.c=A.b().uj(Ya.ribbonCommandInfo.command);Zb.b=n.a[Ya.ribbonCommandInfo.method];Zb.d=Ya.id;Zb.f=ya.toString();Zb.g=mb.toString();Zb.h=ra.toString();Zb.o=Ya.stopwatch.Ac;Zb.q=!1;Zb.r=Ya.copyPasteTargetType.toString();Zb.s=Hb.encounteredDeploymentErrors;t.EwaSettings.getBooleanFeatureGate(va.a.U8b,!1)&&(Zb.i=Hb.commandParameters.dragDropIsShiftKeyDown,Zb.j=Hb.commandParameters.isDragInsert);return Zb}s9a(Ya,ra,ya,mb,Hb){Ya=this.i2e(Ya,ra,ya,mb,Hb);Ya.k=!0;A.b().Qe(45,Ya,!0)}Qzi(Ya,ra,ya,mb,Hb,Zb,
mc,Pc,fd){Ya=this.i2e(Ya,ra,ya,mb,fd);Ya.k=!1;Ya.l=Hb;Ya.n=Zb;Ya.p=mc;Ya.q=Pc;A.b().Qe(45,Ya,!0)}crf(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd){const id={};id.a=this.$.va.UserSessionId;id.b=ra;id.c=Ya;id.f=ya;id.e=mb;id.d=Hb;id.g=Zb;id.h=mc;id.i=Pc;id.j=fd.toString();A.b().Qe(46,id,!0)}Izi(Ya,ra){Ya=this.F1e(Ya.commandParameters,Ya);Ya.l=!0;Ya.j=ra;A.b().Qe(43,Ya,!0)}Hzi(Ya,ra,ya,mb,Hb,Zb,mc){Ya=this.F1e(Ya,mc);Ya.l=!1;Ya.m=ra;Ya.o=ya;Ya.y=mb;Ya.x=Hb;Ya.z=Zb;A.b().Qe(43,Ya,!0);e.ULS.sendTraceTag(537167776,0,15,
`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${Ya.y},ErrorReason=${Ya.x},IsExpectedError=${Ya.m},IsSucceededWithAlert=${Ya.z},ErrorMessage=${Ya.o}`)}F1e(Ya,ra){const ya={};ya.a=this.$.va.UserSessionId;ya.f=Ya.stopwatch.id;ya.g=Ya.id;ya.c=A.b().uj(Ya.ribbonCommandInfo.command);ya.b=n.a[Ya.ribbonCommandInfo.method];ya.q=Ya.stopwatch.Ac;ya.bd=dc.Rbc();ya.bg=Ya.copyPasteHandlerName;ya.bj=void 0===Ya.ribbonCommandInfo.af||null===Ya.ribbonCommandInfo.af?null:r.a[Ya.ribbonCommandInfo.af];ya.bq=
Ya.uploadToClipService;ya.br=Ya.floatingObjectType;ya.s=Ya.copyPasteTargetType.toString();ya.bc=lb(Ya.copyPasteTargetType);ya.z=!1;if(ra){ya.bk=ra.id;ya.bl=ra.serverRequestTimeInMs;ra.requestTelemetryData&&(ya.bm=ra.requestTelemetryData.EcsOperationDuration,ya.bn=ra.requestTelemetryData.EcsRequestDuration,ya.bo=ra.requestTelemetryData.WfeRequestDuration);ya.d=ra.sourceItem?ra.sourceItem.toString():null;ya.e=-1;if(D(ra.sourceItem)){ya.e=0;Ya=ra.sourceItem.ranges;for(const mb of Ya)ya.e+=mb.RC}ya.h=
ra.isAsyncCopy;ya.i=ra.isFromCache;ya.k=ra.isSelectionAllowed;ya.r=ra.plainTextPayloadSize;ya.u=ra.htmlPayloadSize;ya.v=ra.htmlSizeExceedsLimit;ya.w=ra.copyTotalSizeExceedsLimit;ya.t=ra.shadowWorkbookPayloadSize;ya.p=ra.clientSideCopyTime;ya.ba=ra.encounteredDeploymentErrors;ya.bb=ra.shadowWorkbookSizeExceedsLimit;ya.be=ra.syncClipboardItemsKeys;ya.bf=ra.asyncClipboardItemsKeys;ya.bh=this.CGe(ra.succeededPopulatingSystemClipboardSync);ya.bi=this.CGe(ra.succeededPopulatingSystemClipboardAsync)}return ya}ixc(Ya,
ra=!1){if(!this.gridView.eb&&!this.gridView.ri){var ya=this.gridView.ha.ra,mb=!ra&&1===Ya.length&&T.Q(Ya,ya.selectedRanges),Hb=mb?ya.activeCell:Ya[0].topLeft;Ya[0].contains(Hb)||(e.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${ya.selectedRanges}, IndexOfActiveRange ${ya.Ds}, ActiveCell ${ya.activeCell}, calculatedDestinationRanges ${Ya}, keepThePreviousActiveCell ${mb}, newActiveCell ${Hb}, isPasteCommandFromRecoveryUI ${ra}`),Hb=Ya[0].topLeft);this.gridView.ha.mx(Ya,
0,Hb,0,void 0,"CopyPasteInfrastructure.SelectPastedRange")}}G5e(Ya,ra){const ya={};ya.a=this.$.va.UserSessionId;ya.g=Ya.stopwatch.id;ya.t=Ya.stopwatch.Ac;ya.bz=!1;ra&&(ya.bv=ra.id,ya.bw=ra.serverRequestTimeInMs,ya.n=ra.commandParameters.clipboardFormatReadTimes,ya.o=ra.commandParameters.clipboardFormatReadStatus,ya.p=ra.commandParameters.clipboardReadPermissionPromptShown,ya.q=ra.commandParameters.asyncApiReadTimedOut,ra.requestTelemetryData&&(ya.cb=ra.requestTelemetryData.EcsOperationDuration,ya.cc=
ra.requestTelemetryData.EcsRequestDuration,ya.cd=ra.requestTelemetryData.WfeRequestDuration));ya.x=Ya.copyPasteTargetType.toString();ya.bl=lb(Ya.copyPasteTargetType);ya.br=Ya.copyPasteHandlerName;ya.i=T.i(Ya.expandDestinations,",",this.$,!1);ya.h=T.i(Ya.originalDestinations,",",this.$,!1);ya.e=Ya.id;ya.d=Ya.commandType;ya.c=A.b().uj(Ya.ribbonCommandInfo.command);ya.b=n.a[Ya.ribbonCommandInfo.method];ya.bf=!1;ya.bg=!1;ya.bp=dc.Rbc();ya.bt=void 0===Ya.ribbonCommandInfo.af||null===Ya.ribbonCommandInfo.af?
null:r.a[Ya.ribbonCommandInfo.af];ya.cj=Ya.isPasteCommandFromEnterShortcut;if(ya.ca=Ya.isPasteCommandFromRecoveryUI)ya.cf=Ya.pasteRecoveryUndoStopwatch.id,ya.cg=Ya.pasteRecoveryUndoStopwatch.Ac;if(ra){if((Ya=ra.copyContextSnapshot)&&!ra.wasLastCopyExternal){ya.f=Ya.commandParameters.id;ya.j=Ya.sourceItem.toString();ya.k=-1;if(D(Ya.sourceItem)){ya.k=0;const mb=Ya.sourceItem.ranges;for(const Hb of mb)ya.k+=Hb.RC}ya.bg=1===Ya.commandParameters.commandType}else ra.clipboardItems?ya.f=ra.clipboardItems.getItem(J.qsb):
e.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");ya.bz=ra.pasteRecoveryUIDisplayed;ya.ci=ra.cseStatus}else e.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return ya}aBi(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd){Ya=this.G5e(Ya,Pc);Ya.l=!1;Ya.m=ra;Ya.s=ya;Ya.bc=mb;Ya.be=Hb;Ya.bd=Zb;Ya.bf=mc;Pc?(Ya.y=M(Pc)||!Pc.copyContextSnapshot,Ya.bi=!Ya.y&&Ra(Pc.copyContextSnapshot,this.$),Ya.bj=Pc.shadowWorkbookSizeExceedsLimit,
Ya.v=Pc.shadowWorkbookPayloadSize,Ya.w=Pc.htmlPayloadSize,Ya.bq=Aa(Pc.clipboardItems),Ya.bb=Pc.activeSelectionType,Ya.bs=Pc.isSameSession,Ya.bn=Pc.payloadOrigin,Ya.bo=Pc.payloadType,Ya.bu=Pc.externalAppSource,Ya.bx=Pc.indicationDisplayScheduled,Ya.by=Pc.pasteIndicationDisplayStatus,Ya.ck=Pc.pasteDestinationHasMergedCells):Ya.bi=Ra(fd,this.$);A.b().Qe(44,Ya,!0);e.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${Ya.be},ErrorReason=${Ya.bd},IsExpectedError=${Ya.m},IsSucceededWithAlert=${Ya.bf},ErrorMessage=${Ya.s}`)}bBi(Ya){const ra=
this.G5e(Ya.commandParameters,Ya);ra.y=Ya.wasLastCopyExternal;ra.l=!0;ra.u=Ya.plainTextPayloadSize;ra.v=Ya.shadowWorkbookPayloadSize;ra.w=Ya.htmlPayloadSize;ra.z=Ya.isClipboardDataContainShadowWorkbook;ra.ba=Ya.isShadowWorkbookParsedSuccessfully;ra.bb=Ya.activeSelectionType;ra.bc=Ya.pasteResult;ra.bh=Ya.encounteredDeploymentErrors;ra.bj=Ya.shadowWorkbookSizeExceedsLimit;ra.bk=U(Ya);ra.bq=Aa(Ya.clipboardItems);ra.bs=Ya.isSameSession;ra.bn=Ya.payloadOrigin;ra.bo=Ya.payloadType;ra.bu=Ya.externalAppSource;
ra.bx=Ya.indicationDisplayScheduled;ra.by=Ya.pasteIndicationDisplayStatus;ra.ck=Ya.pasteDestinationHasMergedCells;ra.bm=Ya.clipboardItems?Ya.clipboardItems.getItem(J.T2g):null;ra.bi=!Ya.isSameSession&&!Ya.wasLastCopyExternal;A.b().Qe(44,ra,!0)}Nj(){this.$.xa.Xf(this.Gh);this.$.xa.ZLg(this.Cpc);this.$.userOperationManager.ur(this.GR);this.$.ll(this.ed);S.h(this.$).Vb.Yk(this.VGb)}gk(){this.$&&this.$.xa&&(this.$.xa.Eg(this.Gh),this.$.xa.hhj(this.Cpc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.ko(this.GR);
this.gridView&&this.gridView.Vb&&this.gridView.Vb.Gk(this.VGb)}IGb(Ya,ra){var ya=null;let mb=!1;var Hb=null;let Zb="UnknownFailure",mc=-1,Pc=dc.ytb,fd=dc.pasteErrorName+dc.RJa,id=!1;this.pasteIndicationManager.dmd(Ya.id);this.pasteDestinationHasMergedCells(Ya.expandDestinations)&&(ra.pasteContext.pasteDestinationHasMergedCells=!0);const Dd=Z(this.XK);(Ya.clearStateOnFinish||Ya.clearSystemClipboard)&&this.Ar("Paste/fail/"+n.a[Ya.ribbonCommandInfo.method],!0,void 0,void 0,Ya.copyPasteTargetType).catch(()=>
{});if(ra){mc=ra.reason;fd+=dc.jLa(ra);ra.message&&(Pc=ra.message);if(ya=dc.p9g(ra))if(1===ya.pasteErrorName)mb=!0,Zb="CopyPasteLengthTooLongPopup",Pc=Hb="The pasted content is too long. Popup a dialog to the user.",e.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Hb}, copyPasteTargetType="${Ya.copyPasteTargetType}"`),ya=Pa.a.$c(1,0,26,690,0,1306609195,"CopyPasteOversizeError"),t.EwaSettings.Jz()?new ka.a(this.$,ya):(ya=new ba.ErrorDialog(this.$,ya),ya.initialize(),ya.xg());
else if(7===ya.pasteErrorName)mb=!0,Zb="No-Op",Pc=Hb="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",e.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Hb}, copyPasteTargetType="${Ya.copyPasteTargetType}"`);else if(8===ya.pasteErrorName)mb=!0,Zb="UseShortcutsPopup",Pc=Hb="Unable to paste content from the system clipboard. Popup dialog to the user.",e.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Hb}, copyPasteTargetType="${Ya.copyPasteTargetType}"`),
this.UMf();else if(18===ya.pasteErrorName){mb=!0;Zb="PasteExternalNotSupportMultipleSelectionPopup";Pc="Paste external not support multiple selection.";Hb="Unknown";var Zd=2186;100!==ya.validationFailureReason&&(Hb=da[ya.validationFailureReason],Zd=dc.uGe(ya.validationFailureReason));this.Pza(Zd,Hb,!0)}else 20===ya.pasteErrorName||19===ya.pasteErrorName?(mb=!0,20===ya.pasteErrorName?(Zb="PasteAcrossSessionNotSupportMultipleSelectionPopup",Pc="Paste across session does not support multiple selection."):
(Zb="PasteInSameSessionNotSupportMultipleSelectionPopup",Pc="This kind of multiple selection is not supported for same session paste."),Hb="Unknown",Zd=2186,100!==ya.validationFailureReason&&(Hb=da[ya.validationFailureReason],Zd=dc.uGe(ya.validationFailureReason)),ya=6===ya.validationFailureReason,this.T0c(Ya.commandType,Ya.expandDestinations)&&ya&&this.ixc(Ya.expandDestinations),this.Pza(Zd,Hb,!0)):6===ya.pasteErrorName?(mb=!0,Zb="No-Op",Pc=Hb="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",
e.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Hb}, copyPasteTargetType="${Ya.copyPasteTargetType}"`)):17===ya.pasteErrorName?(mb=!0,Zb="No-Op",Pc=Hb="Paste text on Art is not yet a supported operation",e.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Hb}, copyPasteTargetType="${Ya.copyPasteTargetType}"`)):16===ya.pasteErrorName?(mb=!0,Zb="No-Op",Pc=Hb="Paste has failed because the previous copy has failed",ya=this.getStringifiedError(ya),e.ULS.sendTraceTag(537167771,
0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Hb}, copyPasteTargetType="${Ya.copyPasteTargetType}", error=${ya}`)):Pa.a.Lq(ya.ewaErrors)?(Pa.a.p$(ya.ewaErrors)||Pa.a.eh(ya.ewaErrors,Pa.a.lec())?(mb=!0,Zb="CommunicationError",Hb=Pa.a.sc(ya.ewaErrors),e.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Pc} copyPasteTargetType="${Ya.copyPasteTargetType}"`)):Pa.a.eh(ya.ewaErrors,dc.Opj)?(mb=!0,Zb="SavingWorkbookError",Hb=Pa.a.sc(ya.ewaErrors),e.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Pc} copyPasteTargetType="${Ya.copyPasteTargetType}"`)):
Pa.a.eh(ya.ewaErrors,dc.operationSucceededWithAlert)&&(id=mb=!0,Zb="OperationSucceededWithAlert",Hb=Pa.a.sc(ya.ewaErrors),e.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Pc} copyPasteTargetType="${Ya.copyPasteTargetType}"`)),mb||(Pc=this.Ccc(ya.ewaErrors),mb=this.Iqd(ra))):11===ya.pasteErrorName&&(mb=!0,Zb="No-Op",Pc="Paste has failed because user try copy cross-session oart object");15===ra.reason&&(mb=!0,Zb="No-Op",Pc="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");
La.a.equals(fd,G.S_j,!1)&&(mb=!0,Zb="No-Op",Pc="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}mb||(ya=ra?this.getStringifiedError(ra):"null",e.ULS.sendTraceTag(24150916,0,10,`CopyPasteInfrastructure.OnPasteFailed: ${ya}, copyPasteTargetType="${Ya.copyPasteTargetType}"`));this.aBi(Ya,mb,Pc,Zb,fd,mc,id,ra.pasteContext,Dd);return Promise.reject(ra)}aqc(Ya,ra){var ya;e.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${ra.copyPasteTargetType}"`);
this.pasteIndicationManager.dmd(ra.id);if(this.T1i(ra.copyPasteTargetType,Ya)){t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Fz&&Ya.wasLastCopyExternal&&Ya.payloadType===N.shadowWorkbook&&(this.l8a=!0);var mb=null;(null===(ya=Ya.pastedRange)||void 0===ya?0:ya.Ranges)&&0<Ya.pastedRange.Ranges.length?mb=T.g(Ya.pastedRange.Ranges):Ya.wasLastCopyExternal||(mb=ra.expandDestinations);this.xrj(Ya,mb);if(this.KDj(Ya,mb)){let Hb;this.gdd?(ya=T.d(ra.originalDestinations),
Hb=1028===ra.commandType?T.d(ra.expandDestinations):T.d(mb)):(ya=x.a.clone(ra.originalDestinations),Hb=1028===ra.commandType?x.a.clone(ra.expandDestinations):x.a.clone(mb));let Zb=null;Ya.wasLastCopyExternal&&(ra.isKeyboardEvent||ra.isPasteCommandFromRecoveryUI)&&(Zb={[dc.JLf]:Ya.clipboardItems});this.pasteDestinationHasMergedCells(ra.expandDestinations)&&(Ya.pasteDestinationHasMergedCells=!0);Ya.pasteRecoveryUIDisplayed=!0;const mc=new X(this.$,ya,Hb,Zb),Pc=aa.GetServiceTaskFactory.Oa(this.$.da,
406,405,0);Oa.TaskExtensions.za(Pc,()=>{const fd=Pc.result;fd.GUg(mc);fd.WGj(ra.ribbonCommandInfo.method)},this.ka,8)}Ya.pasteRecoveryUIDisplayed||1!==mb.length||(mb=T.K(mb),y.AFrameworkApplication.Ip("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&mb&&(ya=Ka.d(this.$.xa.oa),mb=new hb.a(mb,ya),this.D_d(mb,"CutAndPaste")))}this.iDe("Paste/success/"+n.a[ra.ribbonCommandInfo.method],
Ya);this.bBi(Ya);this.T7f&&(!ra.isKeyboardEvent||U(Ya))&&this.$.ea.Yg.get(66)&&(e.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.T7f=!1,this.V$g());return Promise.resolve(!0)}KDj(Ya,ra){return!ra||1!==ra.length||Ya.commandParameters.clearSystemClipboard||Ya.commandParameters.clearStateOnFinish||Ya.commandParameters.skipClipboardAccess?!1:M(Ya)&&(ra=Ya.clipboardItems.getItem(J.plainText),Ya=Ya.clipboardItems.getItem(J.html),void 0===
ra||null===ra||ra.length>this.EEi||void 0===Ya||null===Ya||Ya.length>this.Gya)?(e.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0}T1i(Ya,ra){return 1===Ya||ra.payloadType===N.plainText||t.EwaSettings.ma(159)&&ra.payloadType===N.html||t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Fz&&ra.payloadType===N.shadowWorkbook}pasteDestinationHasMergedCells(Ya){const ra=
S.h(this.$).Da.rD();if(!ra||!ra.length)return!1;for(const ya of ra)if(ya.Dw(Ya[0]))return!0;return!1}iDe(Ya,ra){let ya;({$Ha:ya}=this.Oki(ra)).returnValue&&this.Ar(Ya,ya,void 0,void 0,ra.commandParameters.copyPasteTargetType).catch(()=>{})}R$a(Ya,ra,ya,mb,Hb,Zb){const mc=Ya?this.getStringifiedError(Ya):"null";this.nxa||e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${mc}`);let Pc=!1,fd=!1,id=!1,Dd=dc.ytb,Zd=dc.MNe+dc.RJa;Ya&&(Zd+=dc.jLa(Ya),Pa.a.Lq(Ya.ewaErrors)?
(Dd=this.Ccc(Ya.ewaErrors),Pa.a.eh(Ya.ewaErrors,dc.operationSucceededWithAlert)&&(Pc=!0),Pa.a.eh(Ya.ewaErrors,dc.dragDropNonEmptyRange)&&(fd=id=!0)):Ya.message&&(Dd=Ya.message));id||(id=this.Iqd(Ya));fd?this.gridView.ha.selectionType=-1:this.cq.Abj(Hb);this.nxa&&!id&&e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${mc}, copyPasteTargetType="${ra.copyPasteTargetType}`);this.Qzi(ra,ya,mb,Hb,id,Dd,Zd,Pc,Zb)}H0c(Ya,ra){let ya=Ya;const mb=this.tWh();if(null===mb||void 0===
mb?0:mb.ranges)ya=this.cq.d_g(ra,mb.ranges,Ya);return ya}tWh(){const Ya=Z(this.XK);return Ya&&D(Ya.sourceItem)?Ya.sourceItem:null}L9i(){this.raiseEvent(dc.PEd,null)}xrj(Ya,ra){const ya=Ya.commandParameters.originalDestinations;ra&&(T.Q(this.gridView.ha.ra.selectedRanges,ya)?(this.ixc(ra),Ya=oa.HelperMethods.Bpb(ra),e.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${Ya}`)):Ya.commandParameters.isPasteCommandFromRecoveryUI?(this.ixc(ra,
!0),e.ULS.sendTraceTag(537167766,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${ra}, active cell: ${ra[0].topLeft}`)):(Ya=oa.HelperMethods.Bpb(ya),e.ULS.sendTraceTag(537167765,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${Ya}`)))}Oki(Ya){if(Ya.isPlainTextPaste||Ya.isHtmlPaste||Q(Ya)||Ya.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,
$Ha:!1};var ra=Ya.copyContextSnapshot;if(Ya.commandParameters.clearStateOnFinish)return{returnValue:!0,$Ha:!0};if(ra&&D(ra.sourceItem)){var ya=ra.sourceItem;if(!ya.isFromCurrentSession(this.$))return{returnValue:!1,$Ha:!0};ra=-1985798686===ra.commandParameters.ribbonCommandInfo.command;if(!(1<ya.ranges.length||1<Ya.commandParameters.expandDestinations.length)){const mb=T.K(ya.ranges);Ya=T.K(Ya.commandParameters.expandDestinations);const Hb=this.$.ea.oa.sheetName;ya=ya.sheetName;if(ya===Hb&&Ya.equals(mb))return{returnValue:!1,
$Ha:!0};if(ya===Hb&&Ya.Ie(mb))return{returnValue:!0,$Ha:!1}}return{returnValue:ra,$Ha:!0}}return{returnValue:!1,$Ha:!0}}KIf(){var Ya=Z(this.XK);(Ya=this.cq.Nxb(Ya))&&Ya.isFromCurrentSession(this.$)&&this.Ar("OnStartEdit",!1).catch(()=>{})}Ccc(Ya){Ya=Pa.a.YSh(Ya,dc.RJa);return this.RFi+d.a.mw(Ya).toString()}Iqd(Ya){Ya=dc.jLa(Ya);return!!Ya&&La.a.W2a(Ya,dc.QFi)}V$g(){const Ya=Pa.a.$c(1,2,327,328,h.a.Bp?329:h.a.ZH?330:331,530046625,"ActivateLocalStorage"),ra=aa.GetServiceTaskFactory.Oa(this.$.da,5,4,
0);Oa.TaskExtensions.za(ra,()=>{ra.result.ng(43,Ya)},this.ka,3)}CGe(Ya){return void 0===Ya||null===Ya?Ca.eJi:Ya?Ca.success:Ca.failed}static p9g(Ya){const ra=Ya.innerError;return ra&&0!==ra.pasteErrorName?Ya.innerError:null}static a9g(Ya){const ra=Ya.innerError;return ra&&0!==ra.copyErrorName?Ya.innerError:null}static jLa(Ya){let ra="";if(!Ya)return dc.NKe;Ya.errorName&&(ra=Ya.errorName,Ya.innerError&&(ra+=dc.RJa+dc.jLa(Ya.innerError)));ra||(ra=Ya&&Ya.name?Ya.name:dc.NKe);return ra}static Rbc(){dc.vS||
(dc.vS=ea.nIj);return dc.vS}static uGe(Ya){switch(Ya){case 7:case 1:return 2193;case 5:return 2190;case 6:return 2189;case 8:case 3:case 2:case 4:case 9:case 10:return 2186;default:return e.ULS.shipAssertTag(537167764,0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${Ya}`),2193}}static b9g(Ya){switch(Ya){case 3:return 2187;case 1:return 2188;case 2:case 4:return 2186;default:return e.ULS.shipAssertTag(537167763,0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${Ya}`),
2193}}D_d(Ya,ra){Oa.TaskExtensions.za(aa.GetServiceTaskFactory.Oa(this.$.da,426,427,1),ya=>{void ya.result.Nea(Ya,ra);e.ULS.sendTraceTag(512615303,0,50,"CopyPasteInfrastructure.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.ka,3)}}dc.wvf="EwaJsMetadataChangeListenerId";dc.PEd="cpiOSC";dc.ojh="cpiDID";dc.ytb="Unknown";dc.NKe="UnknownError";dc.RJa="_";dc.MNe="DragAndDropError";dc.pasteErrorName="PasteError";dc.j0g="CancelError";dc.copyErrorName="CopyError";
dc.QFi="MergedCellOverlap";dc.JLf="PasteRecoveryCachedClipboardItems";dc.Opj=[1352631530,1679665408];dc.operationSucceededWithAlert=[-103190598];dc.pasteDataLimitHit=[1306609195];dc.copyThrottlingError=[-386183710];dc.dragDropNonEmptyRange=[563945982];dc.vS=null;Object(c.a)(dc,"CopyPasteInfrastructure",v.a,[413,414,2]);class wb{constructor(){this.Y0a=this.uDe=null}}Object(c.a)(wb,"ClipboardPlatformInitializationResult",null,[]);var Tb=a(187),xb=a(640),cb=a(554),jb=a(121),qa=a(5),za=a(60);const Na=
(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd,id=null)=>{fd=Ya.Na(9,fd);fd.sourceRanges=ra;fd.destinationRanges=ya;fd.flags=mb;return za.g(Ya,"PasteRange",fd,Hb,Zb,mc,Pc,64,id)},ua=(Ya,ra,ya,mb,Hb,Zb,mc,Pc=null)=>{mc=Ya.Na(1,mc);mc.pasteHtmlParameters=ra;return za.g(Ya,"PasteHtmlContent",mc,ya,mb,Hb,Zb,64,Pc)},Xa=(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd=null)=>{Pc=Ya.Na(9,Pc);Pc.destinationRange=ra;Pc.source=ya;return za.g(Ya,"PasteString",Pc,mb,Hb,Zb,mc,64,fd)},ha=(Ya,ra,ya,mb,Hb,Zb,mc=null,Pc=null)=>{mc=Ya.Na(1,mc);mc.copyParameters=
ra;return za.g(Ya,"Copy",mc,ya,mb,Hb,Zb,0,Pc)},ta=(Ya,ra,ya,mb,Hb,Zb,mc=null,Pc=null)=>{mc=Ya.Na(1,mc);mc.copyParameters=ra;return za.g(Ya,"Cut",mc,ya,mb,Hb,Zb,0,Pc)},wa=(Ya,ra,ya,mb,Hb,Zb,mc=null,Pc=null)=>{mc=Ya.Na(1,mc);mc.pasteParameters=ra;return za.g(Ya,"Paste",mc,ya,mb,Hb,Zb,64,Pc)};class db{constructor(Ya,ra,ya){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=Ya;this.destinationRange=ra;this.pasteFlags=ya}}Object(c.a)(db,"MacroRecorderPasteRangePayload",null,
[108]);class Jb{constructor(Ya,ra){this.content=this.destinationRange=null;this.destinationRange=Ya;this.content=ra}getContent(){return this.content}}Object(c.a)(Jb,"MacroRecorderPasteStringPayload",null,[108]);class Pb{constructor(Ya){this.pasteParameters=null;this.pasteParameters=Ya}}Object(c.a)(Pb,"MacroRecorderPastePayload",null,[108]);var eb=a(585),Ma=a(763),ob=a(188),Ia=a(33),Da=a(208),nb=a(116),Ua=a(281);const W=(Ya,ra,ya,mb,Hb,Zb,mc=null)=>{mc=Ya.Na(41,mc);mc.insertCopiedCutCellsParameters=
ra;return za.g(Ya,"InsertCopiedCutCells",mc,ya,mb,Hb,Zb,4)},sa=(Ya,ra,ya,mb,Hb,Zb,mc=null)=>{mc=Ya.Na(41,mc);mc.insertCopiedCutCellsParameters=ra;return za.g(Ya,"InsertCopiedCutCellsV2",mc,ya,mb,Hb,Zb,0)};class vb{constructor(Ya){this.parameters=null;this.parameters=Ya}getParameters(){return this.parameters}}Object(c.a)(vb,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[108]);var gc=a(374);class Bc{constructor(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd){this.destinationRange=Ya;this.qsb=ya;this.M1i=mb;this.Wd=
Hb;this.WQb=Zb;this.pasteContext=mc;this.$3b=Pc;this.Heg=fd}}Object(c.a)(Bc,"PasteHtmlRequestParams",null,[]);class Sa{constructor(Ya,ra){this.Pkc=this.kOa=null;this.oQa=va.a.oQa;this.hGd=va.a.hGd;this.vEb=va.a.vEb;this.Ghc=t.EwaSettings.getBooleanFeatureGate(va.a.E6b,!1);this.doi=t.EwaSettings.isChangeGateEnabled("OfficeVSO:7316963_InsertCopiedCutCellsV2Enabled");this.dpd=!1;this.xxa=t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.Tz=(ya,mb)=>{if(2===
mb.Lr)this.Kv.clear(),this.kOa=null;else if(1===mb.Lr&&this.Kv&&this.Kv.contains(mb.Tf)){ya=jb.a(mb.Tf.operation.operationName);const Hb=mb.Tf.dequeueUtcTime.getTime()-mb.Tf.enqueueUtcTime.getTime();e.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${ya} returned, it took ${Hb} milliseconds to complete.`);this.Kv.remove(mb.Tf);this.kOa=null}};this.$=Ya;this.gridView=ra;this.dpd&&(this.$.userOperationManager.ur(this.Tz),this.Kv=new Tb.a)}get Gya(){return this.xxa?t.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",
this.$.va.CopyPasteMaxPayloadLength):w.a.Gya}copy(Ya,ra,ya,mb=null,Hb=null){const Zb=this.$.pa.ya.Wb();this.dpd&&this.yY();this.Pkc=Zb.ClientRequestId;var mc=new ob.a(505,0,(Pc,fd,id)=>{const Dd={CopyPasteTargetType:1};Dd.SourceRanges=Ya;Dd.CopyOperationId=ra.id;e.ULS.sendTraceTag(537167756,0,50,`CopyPasteInfrastructure.Copy served from CopyPasteProxy : ${this.xxa}, CopyOperationId : ${Dd.CopyOperationId}`);return this.kOa=this.xxa?ha(this.$.pa.sw,Dd,Ua.b(Pc,ya),mb?Ua.a(fd,mb):fd,id,ra.ribbonCommandInfo,
Zb,Hb):ha(this.$.pa.ya,Dd,Ua.b(Pc,ya),mb?Ua.a(fd,mb):fd,id,ra.ribbonCommandInfo,Zb,Hb)},80);mc=this.$.userOperationManager.Ic(mc,ra.ribbonCommandInfo);this.dpd&&this.Kv.add(mc)}ILf(Ya,ra,ya,mb,Hb,Zb){return new Promise((mc,Pc)=>{var fd;const id=Zb.commandParameters.stopwatch.Ac;let Dd=2;20===Zb.commandParameters.commandType&&(Dd=16);36===Zb.commandParameters.commandType&&(Dd=32);68===Zb.commandParameters.commandType&&(Dd=64);Ia.a.nud(this.$)&&1028===Zb.commandParameters.commandType&&(Dd=1024);let Zd=
null;if(null===(fd=Zb.copyContextSnapshot)||void 0===fd?0:fd.commandParameters)Zd=Zb.copyContextSnapshot.commandParameters.id;Sa.NQd(this.$,Ya,mb,ra,ya,null,bc=>{Sa.Kec(bc,Zb,mc,Pc,id,this.$,null,!0,null,null)},bc=>{Zb.serverRequestTimeInMs=Zb.commandParameters.stopwatch.Ac-id;bc=nb.a.Pe(bc.data);Pc(new Ma.a(5,bc))},Hb,Dd,Zd,Zb.commandParameters.id)})}pasteRange(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd,id){return new Promise((Dd,Zd)=>{const bc=mc.commandParameters.stopwatch.Ac;Sa.Dsj(this.$,Ya,ra,ya,mb|-5&Hb,Qc=>
{Sa.Kec(Qc,mc,Dd,Zd,bc,this.$,null,!0,fd,id)},Qc=>{mc.serverRequestTimeInMs=mc.commandParameters.stopwatch.Ac-bc;Qc=nb.a.Pe(Qc.data);Qc=new Ma.a(5,Qc);null===id||void 0===id?void 0:id(Qc);Zd(Qc)},Zb,Pc)})}Q6i(Ya,ra,ya,mb,Hb,Zb,mc){return(new Promise((Pc,fd)=>{if(ra)if(ra.length>this.Gya){var id=mc.clipboardItems.getItem(J.plainText);let Dd=-1;void 0!==id&&null!==id&&(Dd=id.length);va.a.kif&&ra.length<this.hGd&&ra.length>this.oQa&&(this.NMf(ra),this.pW=new Bc(Ya,ra,ya,mb,Hb,Zb,mc,0,this.Frc.length),
window.requestIdleCallback&&window.requestIdleCallback(()=>this.xGd()));e.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${ra.length}, MaxHtmlImportLength: ${this.Gya}, PlainTextLength: ${Dd}`);fd(new Ma.a(1))}else id=new ob.a(204,0,(Dd,Zd,bc)=>{this.$.My();const Qc=mc.commandParameters.stopwatch.Ac;Dd=Ua.b(Dd,Oe=>{Sa.Kec(Oe,mc,Pc,fd,Qc,this.$,ra,!1,null,null)});Zd=Ua.a(Zd,Oe=>{mc.serverRequestTimeInMs=mc.commandParameters.stopwatch.Ac-
Qc;Oe=nb.a.Pe(Oe.data);fd(new Ma.a(3,Oe))});const pd=this.$.pa.ya.Wb(),ce=T.v(Ya,this.$),ke={};ke.SourceHtml=ra;ke.DestinationRanges=ce?T.s(ce):null;ke.CopyOperationId=ya;ke.PasteId=mb;e.ULS.sendTraceTag(537167755,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.xxa}. PasteId : ${ke.PasteId}`);return this.xxa?ua(this.$.pa.sw,ke,Dd,Zd,bc,null,pd,Zb):ua(this.$.pa.ya,ke,Dd,Zd,bc,null,pd,Zb)},65),this.$.userOperationManager.Ic(id,Hb);else Pc("")})).then(()=>{va.a.kif&&
ra.length>this.oQa&&(this.NMf(ra),this.pW=new Bc(Ya,ra,ya,mb,Hb,Zb,mc,0,this.Frc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.xGd()))})}NMf(Ya){const ra=this.$.Kb.Bc("Task","pasteHtmlChunkOperation"),ya=Math.floor(Ya.length/this.oQa)+1;this.Frc=Array(ya);let mb=0;for(;mb<ya;)this.Frc[mb]=Ya.substring(mb*this.oQa,(mb+1)*this.oQa),mb++;e.ULS.sendTraceTag(523257954,0,50,`CopyPasteUtils.populatePasteChunks Time taken for chunking: ${ra.Ac}`)}xGd(){this.L1i(this.pW.destinationRange,
this.Frc[this.pW.$3b],this.pW.qsb,this.pW.M1i,this.pW.Wd,this.pW.WQb,this.pW.pasteContext,this.pW.$3b,this.pW.Heg);this.pW.$3b++;this.pW.$3b<this.pW.Heg&&window.requestIdleCallback(()=>this.xGd())}L1i(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd){const id=new ob.a(204,0,(Dd,Zd,bc)=>{const Qc=mc.commandParameters.stopwatch.Ac;Dd=Ua.b(Dd,()=>{e.ULS.sendTraceTag(512313415,0,15,`CopyPasteUtils.pasteHtmlServerCall succeeded serverRequestTimeInMs:${mc.commandParameters.stopwatch.Ac-Qc},
             pasteid:${mb},
             chunkIndex:${Pc},
             totalChunks:${fd}`)});Zd=Ua.a(Zd,()=>{mc.serverRequestTimeInMs=mc.commandParameters.stopwatch.Ac-Qc;e.ULS.sendTraceTag(512313414,0,15,`CopyPasteUtils.pasteHtmlServerCall failed serverRequestTimeInMs:${mc.serverRequestTimeInMs},
               pasteid:${mb},
               chunkIndex:${Pc},
               totalChunks:${fd}`)});const pd=this.$.pa.ya.Wb();var ce=T.v(Ya,this.$);ce={SourceHtml:ra,DestinationRanges:ce?T.s(ce):null,CopyOperationId:ya,PasteId:`${mb}_chunk_${Pc}`,ChunkIndex:Pc,TotalChunks:fd};e.ULS.sendTraceTag(523257952,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.xxa}. PasteId : ${ce.PasteId}`);return ua(this.$.pa.sw,ce,Dd,Zd,bc,null,pd,Zb)},65);this.$.userOperationManager.Ic(id,Hb)}R6i(Ya,ra,ya,mb,Hb){return new Promise((Zb,mc)=>{e.ULS.sendTraceTag(537167754,
0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${Hb.id}`);ra&&(ra=La.a.trimEnd(ra,"\n","\r"));e.ULS.sendTraceTag(537167753,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${Hb.id}`);if(ra)if(ra.length>this.vEb)e.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",ra.length,this.vEb),mc(new Ma.a(1));
else{let fd,id;const Dd=T.v(Ya,this.$);e.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${Hb.id}`);var Pc=!this.$.ea.isNamedObjectViewMode&&!ra.includes("\n")&&!ra.includes("\t");e.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${Hb.id}. treatAsLink=${Pc}`);Pc=Pc&&La.a.Ijf(ra);e.ULS.sendTraceTag(537167750,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${Hb.id}. treatAsLink=${Pc}`);
const Zd=this.$.pa.ya.Wb();if(Pc){id=526;e.ULS.sendTraceTag(537167749,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${Hb.id}`);const bc=Da.a.idd(ra);e.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${Hb.id}`);const Qc=T.s(Dd);Pc=(pd,ce,ke)=>{const Oe=Hb.commandParameters.stopwatch.Ac;pd=Ua.b(pd,Fe=>{e.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${Hb.id}`);
Hb.requestTelemetryData=Fe.RequestTelemetryData;Hb.serverRequestTimeInMs=Hb.commandParameters.stopwatch.Ac-Oe;Fe.Errors&&0<Fe.Errors.length?mc(new Ma.a(2,Fe.Errors)):Zb(ra)});ce=Ua.a(ce,Fe=>{Hb.serverRequestTimeInMs=Hb.commandParameters.stopwatch.Ac-Oe;Fe=nb.a.Pe(Fe.data);mc(new Ma.a(2,Fe))});this.$.My();e.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${Hb.id}`);return za.b(this.$.pa.ya,Qc,ra,bc,!1,!1,63,pd,ce,ke,
Ya,Zd,mb)};fd=()=>new eb.a(Qc,ra,bc)}else id=180,Pc=(bc,Qc,pd)=>{this.$.My();const ce=Hb.commandParameters.stopwatch.Ac;bc=Ua.b(bc,ke=>{e.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${Hb.id}`);Sa.Kec(ke,Hb,Zb,mc,ce,this.$,ra,!1,null,null)});Qc=Ua.a(Qc,ke=>{Hb.serverRequestTimeInMs=Hb.commandParameters.stopwatch.Ac-ce;ke=nb.a.Pe(ke.data);mc(new Ma.a(4,ke))});e.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${Hb.id}`);
return Xa(this.$.pa.ya,Dd,ra,bc,Qc,pd,null,Zd,mb)},fd=()=>new Jb(Dd,ra);e.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserWebMethodOperation. pasteContext.Id=${Hb.id}`);Pc=new ob.a(id,0,Pc,65,fd);e.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${Hb.id}`);this.$.userOperationManager.Ic(Pc,ya)}else Zb("")})}icf(Ya,ra){ra=[1===ra?4:5];this.gridView.qb.lx(hb.a.Gea(Ka.d(this.$.oa),
Ya),ra,!0);this.gridView.qb.Sn(ra);this.gridView.qb.update(!0)}ufc(){const Ya=[4,5];this.gridView.qb.Zg(Ya,!1,!1);this.gridView.qb.Ti(null,Ya,!1);1===this.gridView.ha.Oe&&this.gridView.Sn(!1,!1);this.gridView.qb.update(!1,!1)}d_g(Ya,ra,ya){const mb=[];for(const Hb of ya)mb.push(this.h_g(Ya,ra,Hb));return mb}yY(){if(this.Kv)for(let Ya of this.Kv)if(this.$&&this.$.userOperationManager){if(Ya.operation){const ra=jb.a(Ya.operation.operationName);e.ULS.sendTraceTag(526758675,0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${ra}.`)}this.h0g();
this.$.userOperationManager.iua(Ya)}}h0g(){if(this.kOa){const Ya=this.kOa.qt;e.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${Ya}`);nb.a.au(Ya);!t.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.Pkc&&za.h(this.$.pa.ya,this.Pkc,null,null,null);this.Pkc=this.kOa=null}}h_g(Ya,ra,ya){e.ULS.shipAssertTag(537167713,0,!!ra,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");e.ULS.shipAssertTag(537167712,0,0<ra.length,
"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");let mb=0,Hb=0;var Zb=new Set;const mc=new Set;for(const Pc of ra){ra=`${Pc.left}_${Pc.right}`;const fd=`${Pc.top}_${Pc.bottom}`;mc.has(ra)||(mc.add(ra),Hb+=Pc.width);Zb.has(fd)||(Zb.add(fd),mb+=Pc.height)}if(36===Ya)return ya.isSingle?Sa.lWe(Hb,mb,ya):ya.clone();516===Ya&&(Ya=mb,mb=Hb,Hb=Ya);Ya=!(ya.width%Hb)&&!(ya.height%mb);Zb=ya.E_&&!(ya.height%mb);ya.R5&&!(ya.width%Hb)||Zb?ya=Sa.lWe(Hb,mb,ya):Ya?ya=ya.clone():
(ya=ya.clone(),ya.bottom=Math.min(w.a.fh,ya.top+mb-1),ya.right=Math.min(w.a.sh,ya.left+Hb-1));return ya}MRg(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd,id,Dd){if(!mb||!mb.length)return 1;if(1<mb.length){if(!this.Ghc&&Zb)return 3;if(id)return 0;if(Pc)return 9;if(fd)return 8;if(Dd)return 2;if(1<ra.length)return 4;const Zd=ra[0];if(!mc&&!x.a.all(mb,bc=>bc.isSingle||!(bc.width%Zd.width)&&!(bc.height%Zd.height)))return 5;if((!this.Ghc||!Zb)&&La.a.equals(Ya,ya,!0))for(const bc of Hb)if(bc.Cd(Zd)&&!bc.equals(Zd))return 6}else if(ra&&
0<ra.length){if(0!==this.phf(ra,fd))return 7;if(1<ra.length){if(!this.Ghc&&Zb)return 3;if((!this.Ghc||!Zb)&&La.a.equals(Ya,ya,!0))for(const Zd of ra)if(Ya=Hb[0],Zd.Cd(Ya)&&!Zd.equals(Ya))return 6}}return 0}phf(Ya,ra){if(!Ya||1>=Ya.length)return 0;if(ra)return 2;if(!T.S(Ya))return 1;ra=new xb.a(cb.a.ak());for(const ya of Ya)for(const mb of Ya){const Hb=ya.top===mb.top&&ya.bottom===mb.bottom,Zb=ya.left===mb.left&&ya.right===mb.right,mc=Math.max(ya.left,mb.left)<Math.min(ya.right,mb.right);if(Math.max(ya.top,
mb.top)<Math.min(ya.bottom,mb.bottom)&&!Hb||mc&&!Zb)return 3;ra.add(`${ya.top}-${ya.bottom}-${mb.left}-${mb.right}`);ra.add(`${mb.top}-${mb.bottom}-${ya.left}-${ya.right}`)}for(const ya of Ya)ra.remove(`${ya.top}-${ya.bottom}-${ya.left}-${ya.right}`);return 0<ra.count?3:0}Abj(Ya){const ra=this.gridView.ha;ra.updateSelection(Ya,Ya.topLeft,0);ra.selectionType=-1}Nxb(Ya){if(null===Ya||void 0===Ya?0:Ya.sourceItem){if(!D(Ya.sourceItem))return null;if((Ya=Ya.sourceItem)&&T.cb(Ya.ranges,!0))return Ya}return null}mic(Ya,
ra){e.ULS.shipAssertTag(537167711,0,!!Ya,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return ra&&qa.a.vG in ra||Ya.tabName?!1:1===Ya.method}static Dsj(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd){const id=Ya.pa.ya.Wb(fd?{wca:!0,Cba:1}:{wca:!1,Cba:0});fd=new ob.a(506,0,(Dd,Zd,bc)=>{Ya.My();return Na(Ya.pa.ya,ya,mb,Hb,Ua.b(Dd,Zb),Ua.a(Zd,mc),bc,null,id,Pc)},65,()=>new db(ya,mb,Hb));Ya.userOperationManager.Ic(fd,ra)}static Kec(Ya,ra,ya,mb,Hb,Zb,mc=null,Pc,fd,id){e.ULS.sendTraceTag(537167710,
0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${ra.id}`);ra.requestTelemetryData=Ya.RequestTelemetryData;ra.serverRequestTimeInMs=ra.commandParameters.stopwatch.Ac-Hb;Pa.a.dg(Ya.Errors)?Pa.a.pha(Ya.Errors)?(ra&&(ra.encounteredDeploymentErrors=!0),Ya=Pa.a.sc(Ya.Errors),e.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Ya}`)):
(Ya=new Ma.a(5,Ya.Errors),null===id||void 0===id?void 0:id(Ya),mb(Ya)):Ya.Result?(mb=!!Ya&&!!Ya.RequestTelemetryData,S.h(Zb).Eh.Yla(ra.commandParameters.stopwatch.id,Ya.StateId,mb?Ya.RequestTelemetryData.EcsOperationDuration:0,mb?Ya.RequestTelemetryData.EcsRequestDuration:0,mb?Ya.RequestTelemetryData.WfeRequestDuration:0),ra.pastedRange=Ya.Result.SheetMultiRange,e.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${ra.id}`),
null===fd||void 0===fd?void 0:fd(),ya(!0),t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&Pc&&(ra=ra.commandParameters.isDragDrop?9:6,(Zb=Zb.da.Aa(465))&&Zb.p1(ra,Ya))):(e.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${ra.id}`),ya(mc||!0))}static NQd(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd,id,Dd,Zd){const bc=Ya.pa.ya.Wb(),Qc=Sa.Zdh(ya,
mb,Hb,id,Dd,Zd);ya=new ob.a(503,0,(pd,ce,ke)=>{Ya.My();return wa(Ya.pa.ya,Qc,Ua.b(pd,mc),Ua.a(ce,Pc),ke,Zb,bc,fd)},65,()=>new Pb(Qc));Ya.userOperationManager.Ic(ya,ra)}static Zdh(Ya,ra,ya,mb,Hb,Zb){const mc={};mc.ShadowWorkbookBase64=Ya.shadowWorkbookBase64;mc.SourceRanges={};mc.SourceRanges.Ranges=Array(1);mc.SourceRanges.Ranges[0]={};mc.SourceRanges.Ranges[0].FirstRow=Ya.rangeRowStart;mc.SourceRanges.Ranges[0].LastRow=Ya.rangeRowEnd;mc.SourceRanges.Ranges[0].FirstColumn=Ya.rangeColumnStart;mc.SourceRanges.Ranges[0].LastColumn=
Ya.rangeColumnEnd;t.EwaSettings.getBooleanFeatureGate(va.a.E6b,!1)?ya?mc.DestinationRanges=T.u(ya.SheetName,ya.NamedObjectName,T.g(ya.Ranges)):(e.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),mc.DestinationRanges=null):mc.DestinationRanges=ra?T.s(ra):null;mc.CopyPasteTargetType=1;mc.PasteType=mb;mc.CopyOperationId=Hb;mc.PasteId=Zb;mc.SourceClientPath=Ya.sourceClientPath;mc.SourceSheetName=Ya.sourceSheetName;mc.SourceWorkbookName=Ya.sourceWorkbookName;
if(!Ya.originalSourceRangesCountExceedsLimit&&Ya.originalSourceRanges&&0<Ya.originalSourceRanges.length&&1024===mb){mc.OriginalSourceMultiRange={};ra=Array(Ya.originalSourceRanges.length);for(ya=0;ya<ra.length;++ya)ra[ya]={},ra[ya].FirstRow=Ya.originalSourceRanges[ya][0],ra[ya].FirstColumn=Ya.originalSourceRanges[ya][1],ra[ya].LastRow=Ya.originalSourceRanges[ya][2],ra[ya].LastColumn=Ya.originalSourceRanges[ya][3];mc.OriginalSourceMultiRange.Ranges=ra}return mc}static lWe(Ya,ra,ya){ya=ya.clone();ya.height<
ra&&(ya.bottom=Math.min(w.a.fh,ya.top+ra-1));ya.width<Ya&&(ya.right=Math.min(w.a.sh,ya.left+Ya-1));return ya}executeInsertCopiedCutCellsOperation(Ya,ra,ya,mb,Hb,Zb=null,mc=null){const Pc={};Pc.InsertDirection=mb;Pc.SourceRange=Ya;Pc.DestRange=ra;Pc.CopyCutOperation=ya?0:1;const fd=this.$.pa.ya,id=this.$.pa.ya.Wb(),Dd=()=>new vb(Pc);return gc.a(this.$.userOperationManager,(Zd,bc,Qc)=>this.doi?sa(fd,Pc,Zb?Ua.b(Zd,Zb):Zd,mc?Ua.a(bc,mc):bc,Qc,id):W(fd,Pc,Zb?Ua.b(Zd,Zb):Zd,mc?Ua.a(bc,mc):bc,Qc,null),Zd=>
new ob.a(104,0,Zd,void 0,Dd),Hb,t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MoveTaskCompletionToQueueItemLevelByOptingIn",!1))}QNe(Ya,ra,ya,mb,Hb,Zb,mc,Pc){return new Promise((fd,id)=>{this.executeInsertCopiedCutCellsOperation(ra,ya,mb,Hb,Zb,Dd=>{Ya.requestTelemetryData=Dd.RequestTelemetryData;if(Dd.Errors&&0<Dd.Errors.length){const Zd=new Ma.a(21,Dd.Errors);null===Pc||void 0===Pc?void 0:Pc(Zd);id(new Ma.a(21,Dd.Errors))}else null===mc||void 0===mc?void 0:mc(),fd(!0)},Dd=>{Dd=nb.a.Pe(Dd.data);
Dd=new Ma.a(21,Dd);null===Pc||void 0===Pc?void 0:Pc(Dd);id(Dd)})})}}Object(c.a)(Sa,"CopyPasteUtils",null,[412]);var na=a(496),ib;(function(Ya){Ya[Ya.range=0]="range";Ya[Ya.art=1]="art"})(ib||(ib={}));Object(c.b)("SourceItemType",ib);var Ib=a(24),ec=a(92);class qb{constructor(Ya){this.sbg={["SourceItemType.Range"]:0,["SourceItemType.Art"]:1};this.qOb={};this.obg={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,["FloatingObjectType.Image"]:1,
["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,["FloatingObjectType.Shape"]:5,["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};this.nZc={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",["3"]:"FloatingObjectType.ModernOfficeExtension",
["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};this.rbg={["RibbonCommand.Copy"]:-911352779,["RibbonCommand.Cut"]:-1985798686};this.TOd={["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.qbg={["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,["InputManager.InputMethod.CrossSlide"]:9};
this.Mka={};this.pbg={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.d4a={};this.tbg={["UILocation.Unknown"]:0,["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,
["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,["UILocation.FarPeripheralControls"]:18,["UILocation.ContextMenu"]:19,["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.Wr={};this.$=Ya;this.Mka.notDefined="InputManager.InputMethod.NotDefined";this.Mka.unknown="InputManager.InputMethod.Unknown";this.Mka.keyboard="InputManager.InputMethod.Keyboard";this.Mka.mouse="InputManager.InputMethod.Mouse";
this.Mka.touch="InputManager.InputMethod.Touch";this.Mka.crossSlide="InputManager.InputMethod.CrossSlide";this.d4a.none="FrameMode.None";this.d4a.reading="FrameMode.Reading";this.d4a.edit="FrameMode.Edit";this.Wr.unknown="UILocation.Unknown";this.Wr.upperRibbon="UILocation.UpperRibbon";this.Wr.ribbon="UILocation.Ribbon";this.Wr.QAT="UILocation.QAT";this.Wr.jewel="UILocation.Jewel";this.Wr.navigationPane="UILocation.NavigationPane";this.Wr.keyboardShortcut="UILocation.KeyboardShortcut";this.Wr.statusBar=
"UILocation.StatusBar";this.Wr.dialog="UILocation.Dialog";this.Wr.floatie="UILocation.Floatie";this.Wr.notificationBar="UILocation.NotificationBar";this.Wr.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.Wr.taskPane="UILocation.TaskPane";this.Wr.heroDock="UILocation.HeroDock";this.Wr.singleLineRibbon="UILocation.SingleLineRibbon";this.Wr.multilineRibbon="UILocation.MultilineRibbon";this.Wr.overflow="UILocation.Overflow";this.Wr.tellMe="UILocation.TellMe";this.Wr.farPeripheralControls="UILocation.FarPeripheralControls";
this.Wr.header="UILocation.Header";this.Wr.fileMenu="UILocation.FileMenu";this.Wr.contextMenu="UILocation.ContextMenu";this.Wr.dialogMenu="UILocation.DialogMenu";this.Wr.toolbar="UILocation.Toolbar";this.Wr.canvas="UILocation.Canvas";this.qOb.range="SourceItemType.Range";this.qOb.art="SourceItemType.Art"}serializeSourceItem(Ya){const ra={};if(Ya&&Object.getType(Ya)===H)ra.sheetName=Ya.sheetName,ra.topArray=x.a.map(Ya.ranges,ya=>ya.top),ra.leftArray=x.a.map(Ya.ranges,ya=>ya.left),ra.bottomArray=x.a.map(Ya.ranges,
ya=>ya.bottom),ra.rightArray=x.a.map(Ya.ranges,ya=>ya.right),ra.sessionStateId=Ya.sessionStateId,ra.sessionId=Ya.sessionId,ra.sourceItemType=this.f2f(0);else if(Ya&&Object.getType(Ya)===L)ra.activeFloatingObjectControlId=Ya.activeFloatingObjectControlId,ra.sheetName=Ya.sheetName,ra.sessionStateId=Ya.sessionStateId,ra.sessionId=Ya.sessionId,ra.floatingObjectType=this.etj(Ya.type),ra.sourceItemType=this.f2f(1);else return e.ULS.shipAssertTag(537167705,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),
null;return JSON.stringify(ra)}serializeCommandParameters(Ya){if(!Ya)return e.ULS.shipAssertTag(537167704,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;const ra={};ra.id=Ya.id;ra.commandType=Ya.commandType;ra.copyPasteTargetType=Ya.copyPasteTargetType;Ya.ribbonCommandInfo&&(ra.ribbonCommandName=this.ntj(Ya.ribbonCommandInfo.command),ra.inputMethodName=this.htj(Ya.ribbonCommandInfo.method),ra.frameModeName=this.ftj(Ya.ribbonCommandInfo.mode),ra.uiLocationName=
this.rtj(Ya.ribbonCommandInfo.af),ra.tabName=Ya.ribbonCommandInfo.tabName);return JSON.stringify(ra)}deserializeSourceItem(Ya){if(!Ya)return null;try{const ra=JSON.parse(Ya);if(!ra)return e.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let ya=null;switch(this.vkh(ra.sourceItemType)){case 0:ya=new H(this.$,this.skh(ra),ra.sheetName,ra.sessionStateId,ra.sessionId);break;case 1:ya=new L(ra.activeFloatingObjectControlId,ra.sheetName,
ra.sessionStateId,ra.sessionId,this.pkh(ra.floatingObjectType))}return ya}catch(ra){return e.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${Ya?Ya.length:0}, errror: ${ra}`),null}}deserializeCommandParameters(Ya){if(!Ya)return null;try{const ra=JSON.parse(Ya);if(!ra)return e.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),null;
const ya=la.a();ya.id=ra.id;ya.ribbonCommandInfo=this.ukh(ra);ya.commandType=ra.commandType;ya.copyPasteTargetType=ra.copyPasteTargetType;return ya}catch(ra){return e.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${Ya?Ya.length:0}, errror: ${ra}`),null}}skh(Ya){const ra=[];e.ULS.shipAssertTag(537167699,0,!!Ya.topArray&&0<Ya.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${Ya.topArray?
"empty":"null"}.`);e.ULS.shipAssertTag(537167698,0,!!Ya.leftArray&&0<Ya.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${Ya.leftArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167697,0,!!Ya.bottomArray&&0<Ya.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${Ya.bottomArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167696,0,!!Ya.rightArray&&0<Ya.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${Ya.rightArray?
"empty":"null"}.`);if(!(Ya.topArray&&Ya.leftArray&&Ya.bottomArray&&Ya.rightArray))return ra;e.ULS.shipAssertTag(537167695,0,Ya.topArray.length===Ya.bottomArray.length&&Ya.topArray.length===Ya.leftArray.length&&Ya.topArray.length===Ya.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${Ya.topArray.length}), BottomArray(${Ya.bottomArray.length}), LeftArray(${Ya.leftArray.length}), RightArray(${Ya.rightArray.length}) should be the same.`);const ya=Math.min(Ya.topArray.length,
Ya.bottomArray.length,Ya.leftArray.length,Ya.rightArray.length);for(let mb=0;mb<ya;mb++)ra.push(new Ib.Range(Ya.topArray[mb],Ya.leftArray[mb],Ya.bottomArray[mb],Ya.rightArray[mb],!1,!1));return ra}ukh(Ya){return new ec.a(this.tkh(Ya.ribbonCommandName),this.rkh(Ya.inputMethodName),this.qkh(Ya.frameModeName),this.xkh(Ya.uiLocationName),Ya.tabName)}ntj(Ya){return void 0!==Ya&&null!==Ya&&Ya.toString()in this.TOd?this.TOd[Ya.toString()]:(e.ULS.shipAssertTag(537167694,0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${Ya}`),
this.TOd["-911352779"])}tkh(Ya){return Ya&&Ya in this.rbg?this.rbg[Ya]:(e.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${Ya}`),-911352779)}htj(Ya){return void 0!==Ya&&null!==Ya&&n.a[Ya]in this.Mka?this.Mka[n.a[Ya]]:(e.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${Ya}`),this.Mka.unknown)}rkh(Ya){return Ya&&
Ya in this.qbg?this.qbg[Ya]:(e.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${Ya}`),0)}ftj(Ya){return void 0!==Ya&&null!==Ya&&na.a[Ya]in this.d4a?this.d4a[na.a[Ya]]:(e.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${Ya}`),this.d4a.edit)}qkh(Ya){return Ya&&Ya in this.pbg?this.pbg[Ya]:(e.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${Ya}`),
2)}f2f(Ya){return void 0!==Ya&&null!==Ya&&ib[Ya]in this.qOb?this.qOb[ib[Ya]]:(e.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${Ya}`),this.qOb.range)}vkh(Ya){return Ya&&Ya in this.sbg?this.sbg[Ya]:(e.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${Ya}`),0)}etj(Ya){return void 0!==Ya&&null!==Ya&&Ya.toString()in this.nZc?this.nZc[Ya.toString()]:(e.ULS.shipAssertTag(537167686,
0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${Ya}`),this.nZc["99"])}pkh(Ya){return Ya&&Ya in this.obg?this.obg[Ya]:(e.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${Ya}`),99)}rtj(Ya){return void 0!==Ya&&null!==Ya&&r.a[Ya]in this.Wr?this.Wr[r.a[Ya]]:(e.ULS.shipAssertTag(36229129,0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${Ya}`),this.Wr.ribbon)}xkh(Ya){return Ya&&
Ya in this.tbg?this.tbg[Ya]:(e.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${Ya}`),2)}}Object(c.a)(qb,"EnvironmentSerializationHelper",null,[]);class Ha{}Ha.y_f="SameSession";Ha.IJe="CrossSession";Ha.Gpf="LegacyCrossSession";Ha.external="External";Object(c.a)(Ha,"PayloadOrigin",null,[]);const Ab=Ya=>Ya?Ya.shadowWorkbookSizeExceedsLimit&&void 0!==Ya.shadowWorkbookBlockedSize&&null!==Ya.shadowWorkbookBlockedSize?Ya.shadowWorkbookBlockedSize:
Ya.shadowWorkbookBase64?Ya.shadowWorkbookBase64.length:0:0,Yb=Ya=>Ya.shadowWorkbookSizeExceedsLimit?!0:Ab(Ya)>w.a.Rmc;class Bb{constructor(Ya,ra){this._name=ra;this.$=Ya;this.hm=B.a.instance;this.cq=new Sa(Ya,S.h(Ya))}get name(){return this._name}get qZc(){return this.hm.Ua(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}ATj(Ya){let ra;ra=null;try{const ya=Ya.getItem(J.shadowWorkbook);if(!ya)return{returnValue:!1,Y0:ra};ra=JSON.parse(ya);
return{returnValue:this.aui(ra),Y0:ra}}catch(ya){return e.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+ya),{returnValue:!1,Y0:ra}}}aui(Ya){return!!Ya&&(!!Ya.shadowWorkbookBase64||Ya.shadowWorkbookSizeExceedsLimit)&&void 0!==Ya.rangeRowStart&&void 0!==Ya.rangeRowEnd&&void 0!==Ya.rangeColumnStart&&void 0!==Ya.rangeColumnEnd}Drc(Ya){Ya.wasLastCopyExternal=!0;if(t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.Fz&&516!==Ya.commandParameters.commandType&&1028!==Ya.commandParameters.commandType){var ra=null;if(({Y0:ra}=this.ATj(Ya.clipboardItems)).returnValue)return Ya.isShadowWorkbookParsedSuccessfully=!0,this.K1i(Ya,ra)}if(516!==Ya.commandParameters.commandType&&36!==Ya.commandParameters.commandType){if(t.EwaSettings.ma(159)&&20!==Ya.commandParameters.commandType&&(null===this.$.shortcutKeyManager||this.$.shortcutKeyManager.Khc)&&(ra=Ya.clipboardItems.getItem(J.html),void 0!==ra&&null!==ra&&ra&&
ra.trim()!==this.qZc&&(ra.startsWith("<")||h.a.Jf&&ra.startsWith("\n<")))){const ya=Ya.clipboardItems.getItem(J.qsb);return this.I1i(Ya,ra,void 0===ya?null:ya)}return this.ELf(Ya)}return Promise.reject(new Ma.a(6))}K1i(Ya,ra){e.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");Ya.pasteResult="SystemClipboardShadowWorkbookPaste";Ya.payloadType=N.shadowWorkbook;Ya.payloadOrigin=Ha.external;Ya.shadowWorkbookPayloadSize=
Ab(ra);Ya.shadowWorkbookSizeExceedsLimit=Yb(ra);let ya=null,mb=null;const Hb=Ya.commandParameters.originalDestinations;t.EwaSettings.getBooleanFeatureGate(va.a.E6b,!1)?ya=T.r(Hb,this.$):mb=T.v(T.K(Hb),this.$);ra.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(Ya.originalSourceRangesCountExceedsLimit=ra.originalSourceRangesCountExceedsLimit);if(Ya.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(537167833,0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${Ya.shadowWorkbookPayloadSize}) is over the limit(${w.a.Rmc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${ra.shadowWorkbookSizeExceedsLimit}`),
Promise.reject(new Ma.a(1));e.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${Ya.commandParameters.id}`);return this.cq.ILf(Ya.commandParameters.ribbonCommandInfo,mb,ya,ra,[Ya.commandParameters.stopwatch],Ya)}ELf(Ya){var ra=Ya.clipboardItems.getItem(J.plainText);if(void 0!==ra&&null!==ra&&ra.trim()===this.qZc)return Promise.reject(new Ma.a(7));void 0!==ra&&null!==ra&&(Ya.plainTextPayloadSize=ra.length);Ya.isPlainTextPaste=
!0;Ya.pasteResult="SystemClipboardPaste";Ya.payloadOrigin=U(Ya)?Ha.Gpf:Ha.external;Ya.payloadType=N.plainText;e.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${Ya.id}, PasteOperationId=${Ya.commandParameters.id}`);ra=this.cq.R6i(T.K(Ya.commandParameters.originalDestinations),ra,Ya.commandParameters.ribbonCommandInfo,[Ya.commandParameters.stopwatch],Ya);e.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${Ya.id}`);
return ra}I1i(Ya,ra,ya){Ya.htmlPayloadSize=ra.length;Ya.isHtmlPaste=!0;Ya.pasteResult="SystemClipboardHtmlPaste";Ya.payloadType=N.html;Ya.payloadOrigin=U(Ya)?Ha.Gpf:Ha.external;e.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${Ya.commandParameters.id}`);return this.cq.Q6i(T.K(Ya.commandParameters.originalDestinations),ra,ya,Ya.commandParameters.id,Ya.commandParameters.ribbonCommandInfo,[Ya.commandParameters.stopwatch],Ya)}fJe(Ya){const ra=
{};Ya&&(ra.shadowWorkbookBase64=Ya.ShadowWorkbookBase64,ra.shadowWorkbookSizeExceedsLimit=Ya.ShadowWorkbookSizeExceedsLimit,ra.originalSourceRangesCountExceedsLimit=Ya.OriginalSourceRangesCountExceedsLimit,ra.originalSourceRangesCount=Ya.OriginalSourceRangesCount,ra.shadowWorkbookBlockedSize=Ya.ShadowWorkbookBlockedSize);return ra}Vkg(Ya,ra){const ya=M(Ya),mb=32===(Ya.commandParameters.commandType&32),Hb=1024===(Ya.commandParameters.commandType&1024);let Zb=!1,mc=null,Pc=null,fd=!1;if(!ya){Zb=-1985798686===
Ya.commandParameters.ribbonCommandInfo.command;var id=Ya.copyContextSnapshot;if(ra)fd=!id.sourceItem.isFromCurrentSession(this.$);else if(id=this.cq.Nxb(id))mc=id.ranges,Pc=id.sheetName,fd=!Ya.isSameSession}return this.cq.MRg(Pc,mc,this.$.oa.sheetName,Ya.commandParameters.originalDestinations,Ya.commandParameters.expandDestinations,fd,mb,Hb,Zb,ra,ya)}}Object(c.a)(Bb,"BaseCopyPasteHandler",null,[555,556,557]);class Qb{constructor(Ya){this.clipboardItems=this.key=null;this.M$=Ya}nwa(Ya){return this.key&&
this.key.isEqual(Ya)?this.createClipboardItems(this.clipboardItems):null}setValue(Ya,ra){this.key=Ya;this.clipboardItems=this.createClipboardItems(ra)}createClipboardItems(Ya){const ra=this.M$.create();var ya=Ya.getItem(J.plainText);ya&&ra.setItem(J.plainText,ya);(ya=Ya.getItem(J.shadowWorkbook))&&ra.setItem(J.shadowWorkbook,ya);(Ya=Ya.getItem(J.html))&&ra.setItem(J.html,Ya);return ra}}Object(c.a)(Qb,"CopyCache",null,[]);var sc=a(64);class kb extends Bb{constructor(Ya,ra,ya,mb,Hb=null){super(Ya,mb);
this.b$g=ra;this.M$=ya;this.e5c=Hb||new Qb(this.M$);this.gridView=S.h(Ya);this.ha=this.gridView.ha;this.clipboardRangeFactory=Ya.da.Aa(169)}getSourceItem(){const Ya=t.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray")?T.d(this.gridView.ha.ra.selectedRanges):x.a.clone(this.gridView.ha.ra.selectedRanges);return new H(this.$,Ya,this.$.ea.oa.sheetName,this.$.ea.ze,this.$.va.UserSessionId)}beforeSerialize(Ya){Ya.isSelectionAllowed=!1;Ya.isAsyncCopy=!1;Ya.isFromCache=!1;Ya.encounteredDeploymentErrors=
!1;Ya.plainTextPayloadSize=0;Ya.shadowWorkbookPayloadSize=0;Ya.htmlPayloadSize=0;Ya.clientSideCopyTime=0;const ra=new fa.a(this.$.xa),ya=Ya.sourceItem;Ya.isSelectionAllowed=x.a.all(ya.ranges,mb=>this.isSelectionAllowed(ra,mb));Ya.isSelectionAllowed&&this.cq.icf(ya.ranges,Ya.commandParameters.commandType)}FNa(Ya){return this.gridView.Da.l5()&&S.j(this.gridView,Ya)}h2i(Ya,ra,ya,mb){let Hb=!1,Zb=1===ra.commandParameters.commandType,mc=mb[0].RC;1===ya.ranges.length&&1===mb.length?t.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&
Zb&&1!==mc&&mc!==ya.ranges[0].RC?Ya.cseStatus=17:Hb=this.b$g.a9c(Ya,T.K(ya.ranges),ya.sheetName,T.K(Ya.commandParameters.expandDestinations),this.$.ea.oa.sheetName,Zb):Ya.cseStatus=5;Hb&&S.h(this.$).Eh.xS(Ya.commandParameters.stopwatch.id,sc.BasicTelemetryCalculator.cR);return this.R1i(Ya,ya,T.u(this.$.oa.sheetName,null,mb),ra.commandParameters.commandType,Hb)}isSelectionAllowed(Ya,ra){return Ya.WBb(ra,this.gridView)}R1i(Ya,ra,ya,mb,Hb){ra=T.u(ra.sheetName,null,ra.ranges);Ya.pasteResult="SameSessionPaste";
Ya.payloadOrigin=Ha.y_f;Ya.payloadType=N.kGg;e.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${Ya.commandParameters.id}`);return this.cq.pasteRange(Ya.commandParameters.ribbonCommandInfo,ra,ya,mb,Ya.commandParameters.commandType,[Ya.commandParameters.stopwatch],Ya,Hb,null,null)}}Object(c.a)(kb,"BaseRangeCopyPasteHandler",Bb,[]);var Eb=a(35);class Gc{constructor(Ya){this.EU=new Eb.a(!0);this.$=Ya}onDeferredPasteStarted(Ya){this.EU.lb(Ya.id)||
this.EU.add(Ya.id,!0);if(0<this.EU.count){const ra=aa.GetServiceTaskFactory.Oa(this.$.da,5,4,0);Oa.TaskExtensions.za(ra,()=>{ra.result.ng(28,null)},this.$.ka,3)}}onDeferredPasteCompleted(Ya){const ra=0<this.EU.count;this.EU.lb(Ya.id)&&this.EU.remove(Ya.id);if(ra&&!this.EU.count){const ya=aa.GetServiceTaskFactory.Oa(this.$.da,5,4,0);Oa.TaskExtensions.za(ya,()=>{ya.result.removeEntry(28)},this.$.ka,3)}}}Object(c.a)(Gc,"DeferredPasteTracker",null,[]);var zc;(function(Ya){Ya[Ya.none=0]="none";Ya[Ya.loadClipboardFromServerFailed=
1]="loadClipboardFromServerFailed";Ya[Ya.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";Ya[Ya.asyncCopyCanceled=3]="asyncCopyCanceled";Ya[Ya.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(zc||(zc={}));Object(c.b)("CopyErrorType",zc);var yb=a(925),gb=a(1114);class Kb extends yb.a{constructor(Ya,ra=null){super(zc[Ya]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=Ya;this.ewaErrors=ra;if(null===ra||void 0===ra?0:ra.length)this.innerError=
new gb.a(ra,null)}}Object(c.a)(Kb,"CopyInnerError",yb.a,[]);class sd extends kb{constructor(Ya,ra,ya,mb=null){super(Ya,ra,ya,"AcrossSessionRangeCopyPasteHandler",mb);this.EU=new Gc(Ya)}serialize(Ya){const ra=Ya.sourceItem,ya={};let mb=this.e5c.nwa(ra);if(mb)ya.synchronousResult=mb,Ya.isFromCache=!0,Ya.clientSideCopyTime=Ya.commandParameters.stopwatch.Ac;else{let Zb=null;var Hb=T.F(ra.ranges);if(!Ia.a.djf()&&this.FNa(Hb)){e.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");
Hb=this.clipboardRangeFactory.create(Hb);try{Zb=Hb.toString(),mb=this.M$.create(),mb.setItem(J.plainText,Zb),this.e5c.setValue(ra,mb),ya.synchronousResult=mb,Ya.clientSideCopyTime=Ya.commandParameters.stopwatch.Ac}finally{Hb&&Hb.dispose()}}else Ya.isAsyncCopy=!0,ya.synchronousResult=this.M$.create(),ya.synchronousResult.setItem(J.plainText,this.qZc);ya.asynchronousResult=this.Tfd(Ya,ra,Zb)}Ya.syncClipboardItemsKeys=Aa(ya.synchronousResult);return ya}shouldWaitForCopyToComplete(Ya){if(!Ya||!Ya.copyContextSnapshot)return e.ULS.sendTraceTag(537167907,
0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),!1;e.ULS.shipAssertTag(537167906,0,!!this.$.va,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");if(Ya.copyContextSnapshot.sessionId===this.$.va.UserSessionId)return e.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),
!1;e.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(Ya){this.EU.onDeferredPasteStarted(Ya)}onDeferredPasteCompleted(Ya){this.EU.onDeferredPasteCompleted(Ya)}deserialize(Ya){Ya.isClipboardDataContainShadowWorkbook=!(void 0===Ya.clipboardItems.getItem(J.shadowWorkbook)||null===Ya.clipboardItems.getItem(J.shadowWorkbook));if(S.h(this.$).ha.Oe&326)return M(Ya)&&(Ya.wasLastCopyExternal=!0),Promise.reject(new Ma.a(17));
var ra=this.Vkg(Ya,!1);if(0!==ra)return Promise.reject(new Ma.a(M(Ya)?18:Ya.isSameSession?19:20,void 0,void 0,void 0,ra));var ya=Ya.copyContextSnapshot,mb=this.cq.Nxb(ya);if(M(Ya))return this.Drc(Ya);ra=Ya.commandParameters.originalDestinations;if(mb&&Ya.isSameSession)return this.h2i(Ya,ya,mb,ra);if(516!==Ya.commandParameters.commandType){if(({Y0:ya}=this.zTj(Ya.clipboardItems)).returnValue){Ya.isShadowWorkbookParsedSuccessfully=!0;let Hb=mb=null;t.EwaSettings.getBooleanFeatureGate(va.a.E6b,!1)?mb=
T.r(ra,this.$):Hb=T.v(T.K(ra),this.$);return this.G1i(Ya,Hb,mb,ya)}if(Ya.isClipboardInaccessible)return Promise.reject(new Ma.a(8));if(36!==Ya.commandParameters.commandType)return this.ELf(Ya)}return Promise.reject(new Ma.a(6))}beforePaste(Ya){this.$.da.Aa(373).iqj(Ya);Ya.indicationDisplayScheduled=!0}SSj(Ya){let ra;if(!(Ya&&Ya.SourceRanges&&Ya.SourceRanges.Ranges&&Ya.SourceRanges.Ranges.length&&(Ya.OriginalSourceRangesCountExceedsLimit||Ya.OriginalSourceMultiRange&&Ya.OriginalSourceMultiRange.Ranges&&
Ya.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,Y0:null};var ya=Ya.SourceRanges.Ranges[0];if(!Ya.ShadowWorkbookBase64&&!Ya.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,Y0:null};ra=this.fJe(Ya);ra.rangeRowStart=ya.FirstRow;ra.rangeRowEnd=ya.LastRow;ra.rangeColumnStart=ya.FirstColumn;ra.rangeColumnEnd=ya.LastColumn;ra.sourceClientPath=Ya.SourceClientPath;ra.sourceSheetName=Ya.SourceSheetName;ra.sourceWorkbookName=Ya.SourceWorkbookName;if(!Ya.OriginalSourceRangesCountExceedsLimit)for(Ya=
Ya.OriginalSourceMultiRange.Ranges,ra.originalSourceRanges=Array(Ya.length),ya=0;ya<Ya.length;++ya)ra.originalSourceRanges[ya]=[Ya[ya].FirstRow,Ya[ya].FirstColumn,Ya[ya].LastRow,Ya[ya].LastColumn];return{returnValue:!0,Y0:ra}}zTj(Ya){let ra;ra=null;Ya=Ya.getItem(J.shadowWorkbook);if(!Ya)return{returnValue:!1,Y0:ra};ra=JSON.parse(Ya);return{returnValue:this.$ti(ra),Y0:ra}}$ti(Ya){return!!Ya&&(!!Ya.shadowWorkbookBase64||Ya.shadowWorkbookSizeExceedsLimit)&&void 0!==Ya.rangeRowStart&&void 0!==Ya.rangeRowEnd&&
void 0!==Ya.rangeColumnStart&&void 0!==Ya.rangeColumnEnd}G1i(Ya,ra,ya,mb){e.ULS.shipAssertTag(537167903,0,!!mb,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");y.AFrameworkApplication.PN("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");Ya.pasteResult="CrossSessionPaste";Ya.payloadOrigin=Ha.IJe;Ya.payloadType=N.shadowWorkbook;Ya.shadowWorkbookPayloadSize=Ab(mb);Ya.shadowWorkbookSizeExceedsLimit=Yb(mb);mb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&
(Ya.originalSourceRangesCountExceedsLimit=mb.originalSourceRangesCountExceedsLimit);if(Ya.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${Ya.shadowWorkbookPayloadSize}) is over the limit(${w.a.Rmc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${mb.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new Ma.a(1));if(1028===Ya.commandParameters.commandType&&Ya.originalSourceRangesCountExceedsLimit)return e.ULS.sendTraceTag(572617859,
0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${mb.originalSourceRangesCount}) is over the limit(${w.a.FEi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${mb.originalSourceRangesCountExceedsLimit}`),Promise.reject(new Ma.a(1));e.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${Ya.commandParameters.id}`);return this.cq.ILf(Ya.commandParameters.ribbonCommandInfo,
ra,ya,mb,[Ya.commandParameters.stopwatch],Ya)}Tfd(Ya,ra,ya){e.ULS.shipAssertTag(537167901,0,!!Ya,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const mb=Ya.commandParameters.stopwatch.Ac;return new Promise((Hb,Zb)=>{e.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${Ya.id}`);const mc=T.u(ra.sheetName,null,ra.ranges);this.cq.copy(mc,Ya.commandParameters,
Pc=>{Ya.requestTelemetryData=Pc.RequestTelemetryData;Ya.serverRequestTimeInMs=Ya.commandParameters.stopwatch.Ac-mb;if(Pa.a.dg(Pc.Errors))if(Pa.a.pha(Pc.Errors))Ya.encounteredDeploymentErrors=!0,Pc=Pa.a.sc(Pc.Errors),e.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Pc}. copy Id: ${Ya.id}`);else{var fd=Pa.a.sc(Pc.Errors);e.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${fd}. copy Id: ${Ya.id}`);
Zb(new Kb(2,Pc.Errors))}else if(e.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${Ya.id}`),Ya.markForCancellation)Zb(new Kb(3,Pc.Errors));else{fd=Pc.Result;var id=fd.PlainTextResult;void 0!==ya&&null!==ya&&(id=ya);void 0!==id&&null!==id&&(Ya.plainTextPayloadSize=id.length);var Dd=this.M$.create();if(({Y0:Zd}=this.SSj(fd)).returnValue){Ya.shadowWorkbookPayloadSize=Ab(Zd);Ya.shadowWorkbookSizeExceedsLimit=Yb(Zd);
Ya.originalSourceRangesCountExceedsLimit=fd.OriginalSourceRangesCountExceedsLimit;var Zd=JSON.stringify(Zd);Dd.setItem(J.shadowWorkbook,Zd)}Dd.setItem(J.plainText,id);Ia.a.djf()&&(id=fd.HtmlResult,Ya.htmlSizeExceedsLimit=fd.HtmlSizeExceedsLimit,void 0!==id&&null!==id&&(Ya.htmlPayloadSize=id.length),Dd.setItem(J.html,id));Ya.copyTotalSizeExceedsLimit=fd.CopyTotalSizeExceedsLimit;Dd.setItem(J.qsb,Ya.commandParameters.id);this.e5c.setValue(ra,Dd);Ya.asyncClipboardItemsKeys=Aa(Dd);Hb(Dd);t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",
!1)&&(fd=1===Ya.commandParameters.commandType?8:7,(Dd=this.$.da.Aa(465))&&Dd.p1(fd,Pc))}},Pc=>{Ya.serverRequestTimeInMs=Ya.commandParameters.stopwatch.Ac-mb;Pc=nb.a.Pe(Pc.data);const fd=Pa.a.sc(Pc);e.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${fd}. copy Id: ${Ya.id}`);Zb(new Kb(2,Pc))},[Ya.commandParameters.stopwatch])})}}Object(c.a)(sd,"AcrossSessionRangeCopyPasteHandler",kb,[]);class Sb{constructor(Ya,ra,
ya,mb,Hb,Zb=null,mc=null){this.floatingObjectId=Ya;this.commandParameters=ra;this.Yt=ya;this.xhh=mb;this.Eaa=Zb;this.WQb=mc;this.S9g=Hb}}Object(c.a)(Sb,"CopyArtRequest",null,[]);class yc{constructor(Ya,ra,ya,mb,Hb,Zb,mc,Pc,fd){this.promise=null;this.ribbonCommandInfo=Ya;this.destination=ra;this.DLe=ya;this.WQb=Hb;this.Y0=Zb;this.item=mc;this.pasteContext=Pc;this.NOa=ya||ra.FirstRow+"_"+ra.FirstColumn;this.yjf=!0;this.rDe=fd}}Object(c.a)(yc,"PasteArtRequest",null,[]);class Fc{constructor(Ya,ra){this.OKb=
new Qa.a;this.z_a=Ya;this.$=ra;this.r7i=ya=>Promise.resolve(ya);this.IGb=ya=>Promise.reject(ya)}U8h(Ya){if(this.Opi(Ya.NOa)){e.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${Ya.NOa}`);const ra=this.OKb.na(Ya.NOa);this.OKb.ia(Ya.NOa,Ya);const ya=ra.promise;ra.yjf=!1;return this.nrh(Ya,ya)}this.OKb.ia(Ya.NOa,Ya);return this.Wwi(Ya)}Opi(Ya){return this.OKb.lb(Ya)}Wwi(Ya){return new Promise((ra,ya)=>{Ya.promise=
this.z_a.DLf(Ya).then(mb=>{ra(null);return this.aqc(Ya,mb)},mb=>{ya(null);return this.IGb(mb)})})}nrh(Ya,ra){return new Promise((ya,mb)=>{Ya.promise=ra.then(Hb=>{this.QYj(Ya,Hb);return this.z_a.DLf(Ya).then(Zb=>{ya(null);return this.aqc(Ya,Zb)},Zb=>{mb(null);return this.IGb(Zb)})},Hb=>this.IGb(Hb))})}aqc(Ya,ra){Ya.yjf&&(this.C3g(Ya.NOa),this.pQd(Ya,ra));return this.r7i(ra)}C3g(Ya){this.OKb.remove(Ya)}pQd(Ya,ra){const ya=this.c1h();Ya.NOa===ya&&this.z_a.pQd(Ya.destination,ra,Ya.item.type)}c1h(){var Ya=
S.h(this.$).ha.Sa.activeFloatingObjectControlId;Ya||(Ya=T.v(S.h(this.$).ha.ra.activeCell,this.$),Ya=Ya.FirstRow+"_"+Ya.FirstColumn);return Ya}QYj(Ya,ra){Ya.destination=null;Ya.DLe=ra}}Object(c.a)(Fc,"PasteArtRequestManager",null,[]);var Zc=a(200),Rd=a(122),Ed=a(104);class ne extends Bb{constructor(Ya,ra,ya,mb,Hb=null){super(Ya,"ArtCopyPasteHandler");this.x4g="XLO";this.y4g="3";this.EU=new Gc(Ya);this.M$=ra;this.z_a=ya;this.ha=S.h(Ya).ha;this.d5c=Hb||new Qb(this.M$);this.H1i=new Fc(ya,Ya);this.Dpb=
mb}getSourceItem(){e.ULS.shipAssertTag(537167896,0,!!this.ha.Sa.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");e.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Sa.activeFloatingObjectControlId}]`);return new L(this.ha.Sa.activeFloatingObjectControlId,this.$.ea.oa.sheetName,this.$.ea.ze,this.$.va.UserSessionId,this.ha.Sa.$b.floatingObject.type)}beforeSerialize(Ya){Ya&&Ya.commandParameters?
(Ya?(Ya.isAsyncCopy=!1,Ya.isSelectionAllowed=!1,Ya.isFromCache=!1,Ya.plainTextPayloadSize=0,Ya.shadowWorkbookPayloadSize=0,Ya.htmlPayloadSize=0,Ya.htmlSizeExceedsLimit=!1,Ya.clientSideCopyTime=0,Ya.encounteredDeploymentErrors=!1,Ya.shadowWorkbookSizeExceedsLimit=!1,Ya.originalSourceRangesCountExceedsLimit=!1,Ya.copyTotalSizeExceedsLimit=!1):e.ULS.sendTraceTag(537167826,0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),Ya.commandParameters.copyPasteTargetType=2):e.ULS.sendTraceTag(537167894,
0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize(Ya){const ra=Ya.sourceItem,ya={};if(!ra)return e.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),ya;if(!this.Nsi())return e.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),ya;e.ULS.sendTraceTag(537167892,0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${ra.activeFloatingObjectControlId}]`);
this.rHd();let mb=this.d5c.nwa(ra);if(mb)ya.synchronousResult=mb,Ya.isFromCache=!0,Ya.isAsyncCopy=!1,Ya.clientSideCopyTime=Ya.commandParameters.stopwatch.Ac,1===Ya.commandParameters.commandType&&this.$.Xc(2045211913,Ya.commandParameters.ribbonCommandInfo.method,Ya.commandParameters.ribbonCommandInfo.af,null);else{Ya.isFromCache=!1;Ya.isAsyncCopy=!0;mb=this.M$.create();if(Ya.commandParameters.uploadToClipService){const Hb={};Hb["data-clipservice-ccpid"]=Ya.commandParameters.id;Hb["data-pkey"]=Ya.commandParameters.pKey;
Hb["data-clipservice-type"]=Ya.commandParameters.clipServiceDataType;Hb["data-clipservice-count"]=Ya.commandParameters.objectCount.toString();Hb["data-clipservice-dc"]=Ya.commandParameters.clipServiceDataCenter;Hb["data-clipservice-client"]=this.x4g;Hb["data-TimeStamp"]=(new Date).toUTCString();Hb["data-clipservice-version"]=this.y4g;mb.setItem(J.BOg,JSON.stringify(Hb))}ya.synchronousResult=this.WHg(mb);ya.asynchronousResult=this.Tfd(Ya,ra,mb)}Ya.syncClipboardItemsKeys=Aa(ya.synchronousResult);return ya}WHg(Ya){e.ULS.shipAssertTag(537167891,
0,!!this.ha.Sa.$b,"Expecting a floating object to be currently selected for copy");Ya||(Ya=this.M$.create());const ra=this.ha.Sa.$b.qwb();ra&&Ya.setItem(J.html,`<img src='${ra}'>`);return Ya}rHd(){const Ya=this.ha.Sa.$b;this.Dpb.rHd(Rd.a.Erb(Ya.floatingObject),Rd.a.A4g(Ya.yu))}shouldWaitForCopyToComplete(){e.ULS.sendTraceTag(537167890,0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(Ya){this.EU.onDeferredPasteStarted(Ya)}onDeferredPasteCompleted(Ya){this.EU.onDeferredPasteCompleted(Ya)}deserialize(Ya){var ra=
M(Ya),ya=null;let mb=null;var Hb=!1;if(!ra){ya=Ya.copyContextSnapshot;mb=ya.sourceItem;if(!mb)return Promise.reject(new Ma.a(10));Hb=mb.isFromCurrentSession(this.$)}var Zb=this.Vkg(Ya,!0);if(0!==Zb)return Promise.reject(new Ma.a(ra?18:Hb?19:20,void 0,void 0,void 0,Zb));if(ra)return this.Drc(Ya);if(!Hb&&!ne.sli(mb))return Ya=`User attempted to paste art of type [${mb.type}] between sessions.`,e.ULS.sendTraceTag(537167889,0,50,Ya),Promise.reject(new Ma.a(11,void 0,void 0,Ya));if(ya.isAsyncSerializeFailed)return Promise.reject(new Ma.a(16,
void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let mc;try{const Pc=Ya.clipboardItems.getItem(J.shadowWorkbook);mc=JSON.parse(Pc)}catch(Pc){return Ya=copyPasteInfra.getStringifiedError(Pc),e.ULS.sendTraceTag(537167888,0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${Ya}`),Promise.reject(new Ma.a(12,void 0,Pc))}mc.floatingObjectId!==mb.activeFloatingObjectControlId?e.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${mb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${mc.floatingObjectId}]`):
e.ULS.sendTraceTag(537167886,0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${mb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${mc.floatingObjectId}]`);if(!mc||!mc.shadowWorkbookBase64)return Promise.reject(new Ma.a(13,void 0,void 0,`shadowWorkbookPayload is null = ${!mc}`));Ya.isShadowWorkbookParsedSuccessfully=!0;Ya.shadowWorkbookPayloadSize=Ab(mc);Ya.shadowWorkbookSizeExceedsLimit=Yb(mc);Ya.payloadOrigin=Hb?Ha.y_f:
Ha.IJe;Ya.payloadType=N.Gog;if(Yb(mc))return Ya=`Shadow workbook size [${Ya.shadowWorkbookPayloadSize}] is over the limit [${w.a.Rmc}]. ShadowWorkbookSizeExceedsLimit: ${mc.shadowWorkbookSizeExceedsLimit}`,e.ULS.sendTraceTag(36304156,0,15,`ArtCopyPasteHandler.Deserialize: ${Ya}`),Promise.reject(new Ma.a(1,void 0,void 0,Ya));ya=ra=null;S.h(this.$).ha.Oe&326?ya=S.h(this.$).ha.Sa.activeFloatingObjectControlId:ra=this.$.oa&&this.$.oa.activeCell?T.v(this.$.oa.activeCell,this.$):T.v(T.K(Ya.commandParameters.originalDestinations),
this.$);Hb=null;if(this.Dpb.u7f(mb))try{Hb=this.Dpb.a9c()}catch(Pc){Zb=copyPasteInfra.getStringifiedError(Pc),e.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${Zb}`)}return this.H1i.U8h(new yc(Ya.commandParameters.ribbonCommandInfo,ra,ya,Ya.commandParameters.commandType,[Ya.commandParameters.stopwatch],mc,mb,Ya,Hb))}Drc(Ya){Ya.wasLastCopyExternal=!0;if(Ya.clipboardItems.getItem("image/png")){const ra=Ya.commandParameters.stopwatch.Ac;
Ya.payloadType=N.HUg;return fb.b(this.$.Xc(1403967063,Ya.commandParameters.ribbonCommandInfo.method,Ya.commandParameters.ribbonCommandInfo.af,{["dataUrl"]:Ya.clipboardItems.getItem("image/png")})).then(ya=>{Ya.serverRequestTimeInMs=Ya.commandParameters.stopwatch.Ac-ra;return ya?Promise.resolve(null):Promise.reject(new Ma.a(15))},()=>{Ya.serverRequestTimeInMs=Ya.commandParameters.stopwatch.Ac-ra;return Promise.reject(new Ma.a(15))})}e.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");
return super.Drc(Ya)}Nsi(){const Ya=S.h(this.$).ha;return Ya.Sa.activeFloatingObjectControlId&&Ya.Sa.$b&&Ya.Sa.$b.floatingObject?Ya.Sa.$b.floatingObject.$Xd():!1}Tfd(Ya,ra,ya){return new Promise((mb,Hb)=>{const Zb=Ya.commandParameters.stopwatch.Ac;e.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");this.z_a.U9g(new Sb(ra.activeFloatingObjectControlId,Ya.commandParameters,mc=>{Ya.requestTelemetryData=mc.RequestTelemetryData;
Ya.serverRequestTimeInMs=Ya.commandParameters.stopwatch.Ac-Zb;if(Pa.a.dg(mc.Errors))if(Pa.a.pha(mc.Errors))Ya.encounteredDeploymentErrors=!0,mc=Pa.a.sc(mc.Errors),e.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${mc}`);else{var Pc=Pa.a.sc(mc.Errors);e.ULS.sendTraceTag(36229122,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Pc}`);Hb(new Kb(4,
mc.Errors))}else if(e.ULS.sendTraceTag(537167883,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${ra.activeFloatingObjectControlId}].`),Ya.markForCancellation)Hb(new Kb(3,mc.Errors));else{if(Pa.a.Lq(mc.Errors)){var fd=Pa.a.sc(mc.Errors);e.ULS.sendTraceTag(537167882,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${fd}`)}if(fd=mc.Result){fd=this.fJe(fd);fd.floatingObjectId=ra.activeFloatingObjectControlId;
Ya.shadowWorkbookPayloadSize=Ab(fd);Ya.shadowWorkbookSizeExceedsLimit=Yb(fd);try{Pc=JSON.stringify(fd)}catch(id){Hb(new Ma.a(14,void 0,id,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${Ya.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${fd.floatingObjectId}]`));return}e.ULS.shipAssertTag(537167881,0,!!ya,"Expecting syncClipboardItems to be defined");ya.setItem(J.shadowWorkbook,Pc);1===Ya.commandParameters.commandType&&(this.f5i(ra.type,ra.activeFloatingObjectControlId,
mc.StateId),this.deleteFloatingObject(ra.activeFloatingObjectControlId,ra.type));this.d5c.setValue(ra,ya);Ya.asyncClipboardItemsKeys=Aa(ya);mb(ya)}else e.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${ra.activeFloatingObjectControlId}`),mb(this.d5c.nwa(ra))}},Ya.commandParameters.commandType,ra.type,mc=>{Ya.serverRequestTimeInMs=Ya.commandParameters.stopwatch.Ac-Zb;mc=nb.a.Pe(mc.data);1===Ya.commandParameters.commandType&&
this.z_a.AUj(ra.type,ra.activeFloatingObjectControlId);const Pc=Pa.a.sc(mc);e.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Pc}`);Hb(new Kb(4,mc))},[Ya.commandParameters.stopwatch]))})}deleteFloatingObject(Ya,ra){Ya=Zc.a.xz(ra,Ya);if(Ya=Ed.a(this.$).Qq(Ya))Ed.a(this.$).deleteFloatingObject(Ya,14,!0),S.h(this.$).ha.Sa.cB=null}f5i(Ya,ra,ya){const mb=this.$.da.Aa(277);if(mb){let Zb=null;Ya=Zc.a.xz(Ya,ra);Ya=Ed.a(this.$).Qq(Ya);
if(null===Ya||void 0===Ya?0:Ya.Yi)Zb=Ya.Yi.block;if(Zb){var Hb=Ya.floatingObject.Ng();mb.B_b(()=>!Zb.Li.lb(Hb),ya,"CutArt")}}}static sli(Ya){return 1===Ya.type||5===Ya.type}}Object(c.a)(ne,"ArtCopyPasteHandler",Bb,[]);var ze=a(58);class Be extends Pb{constructor(Ya,ra,ya,mb){super(Ya);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=ra;this.top=ya;this.left=mb}}Object(c.a)(Be,"MacroRecorderPasteArtPayload",Pb,[]);class td{constructor(Ya,ra){this.$=Ya;this.Dpb=ra}rdi(Ya,
ra,ya,mb,Hb,Zb=null,mc=null){const Pc=this.$.pa.ya.Wb();let fd=null;const id={CopyPasteTargetType:2};id.FloatingObjectId=Ya;id.CopyOperationId=ya.id;ya.floatingObjectType=ra;id.UploadToClipService=ya.uploadToClipService;id.PKey=ya.pKey;id.ClipServiceDataCenter=ya.clipServiceDataCenter;let Dd=0;2===Hb?(Hb=505,Dd=16,fd=(Zd,bc,Qc)=>ha(this.$.pa.ya,id,Ua.b(Zd,mb),Zb?Ua.a(bc,Zb):bc,Qc,ya.ribbonCommandInfo,Pc,mc)):(Hb=179,fd=(Zd,bc,Qc)=>{this.wnh(ra,Ya);this.$.My();return ta(this.$.pa.ya,id,Ua.b(Zd,mb),
Zb?Ua.a(bc,Zb):bc,Qc,ya.ribbonCommandInfo,Pc,mc)});this.$.userOperationManager.Ic(new ob.a(Hb,0,fd,Dd|64),ya.ribbonCommandInfo)}wnh(Ya,ra){var ya=Zc.a.xz(Ya,ra);(ya=Ed.a(this.$).Qq(ya))?(S.h(this.$).ha.Sa.vH(ya),ya.isVisible=!1):e.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${Ya}, FloatingObjectId: ${ra}`)}AUj(Ya,ra){Ya=Zc.a.xz(Ya,ra);if(Ya=Ed.a(this.$).Qq(Ya))Ya.isVisible=!0}U9g(Ya){this.rdi(Ya.floatingObjectId,Ya.S9g,
Ya.commandParameters,Ya.Yt,Ya.xhh,Ya.Eaa,Ya.WQb)}Tdi(Ya,ra,ya,mb,Hb,Zb,mc,Pc=null,fd=!0){return new Promise((id,Dd)=>{const Zd=Zb.commandParameters.stopwatch.Ac;this.NQd(Ya,Hb,ra,ya,bc=>{Zb.requestTelemetryData=bc.RequestTelemetryData;Zb.serverRequestTimeInMs=Zb.commandParameters.stopwatch.Ac-Zd;if(Pa.a.pha(bc.Errors))Zb&&(Zb.encounteredDeploymentErrors=!0),bc=Pa.a.sc(bc.Errors),e.ULS.sendTraceTag(537167875,0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${bc}`);
else if(Pa.a.dg(bc.Errors)){var Qc=Pa.a.sc(bc.Errors);e.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${Qc}`);Dd(new Ma.a(9,bc.Errors))}else bc.Result?(Qc=bc.Result,e.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.s5i(mc,Qc.FloatingObjectId,bc.StateId),id(td.pnd(Qc.FloatingObjectId))):(e.ULS.sendTraceTag(537167873,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),Dd(new Ma.a(9,bc.Errors)))},
bc=>{Zb.serverRequestTimeInMs=Zb.commandParameters.stopwatch.Ac-Zd;bc=nb.a.Pe(bc.data);e.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${Pa.a.sc(bc)}`);Dd(new Ma.a(9,bc))},mb,Pc,fd)})}s5i(Ya,ra,ya){const mb=this.$.da.Aa(277);if(mb){const Hb=Zc.a.xz(Ya,td.pnd(ra));mb.B_b(()=>!!Ed.a(this.$).Qq(Hb),ya,"PasteArt")}}j0d(Ya,ra){ra&&this.Dpb.j0d(Ya,Zc.a.xz(Ya.type,ra))}DLf(Ya){return this.Tdi(Ya.ribbonCommandInfo,Ya.destination,Ya.DLe,Ya.WQb,Ya.Y0,Ya.pasteContext,
Ya.item.type,Ya.rDe,Ya.item.isFromCurrentSession(this.$)).then(ra=>ra,ra=>{this.j0d(Ya.item,Ya.rDe);return Promise.reject(ra)})}pQd(Ya,ra,ya){Ya||(Ya=T.v(S.h(this.$).ha.ra.activeCell,this.$));S.h(this.$).wjc(T.D(Ya),1)?Ed.a(this.$).Ona(ya,ra,!0):S.h(this.$).ha.Sa.WHa(Ya,ra,ya).continueWith(mb=>{mb.result?e.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${ra}]`):e.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${ra}]`)})}NQd(Ya,
ra,ya,mb,Hb,Zb,mc,Pc,fd=!0){const id=this.$.pa.ya.Wb(),Dd={};Dd.ShadowWorkbookBase64=ra.shadowWorkbookBase64;Dd.FloatingObjectId=mb;Dd.DestinationRanges=ya?T.s(ya):null;Dd.CopyPasteTargetType=2;Dd.ClientEstimationFloatingObjectId=Pc;ya=new ob.a(503,0,(Zd,bc,Qc)=>{Pc||this.$.My();return wa(this.$.pa.ya,Dd,Ua.b(Zd,Hb),Ua.a(bc,Zb),Qc,null,id,mc)},void 0,()=>{if(fd){let Zd;Zd=ze.a.ki(ze.a.hc(Dd));Zd.FloatingObjectId=ra.floatingObjectId;Dd.DestinationRanges||(Zd.DestinationRanges=T.p(this.$.xa.oa.sheetName,
"",0,0,0,0));return new Be(Zd,fd,0,0)}return new Be(Dd,fd,0,0)});ya.flags=65;this.$.userOperationManager.Ic(ya,Ya)}static pnd(Ya){return`${Ya.length+2}.{${Ya.toUpperCase()}}`}}Object(c.a)(td,"ArtCopyPasteUtils",null,[444]);var Se=a(194);class $b{constructor(Ya){this.b5c=this.Fta=null;this.Xab=15;this.$=Ya}rHd(Ya,ra){this.Fta=Ya;this.b5c=ra}a9c(){if(!this.Fta||!this.b5c)return e.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),
"";const Ya=Rd.a.Erb(new Zc.a(this.Fta));Ya.Id=td.pnd(m.a.create().toString());Ya.Version=-1;Ya.Name="";Ya.IsClientEstimation=!0;var ra=this.gfi(Ya);if(!ra)return null;const ya=new Zc.a(Ya);ra.block.Li.add(ya);ya.TKb();const mb=Ed.a(this.$);mb.V5b(ya,ra);ra=mb.Qq(Zc.a.WUh(Ya));!ra||ra.floatingObject.rNa||ra.floatingObject.LNa||ra.LSa(this.b5c);mb.Ona(Ya.Type,Ya.Id,!0);return Ya.Id}u7f(Ya){return t.EwaSettings.ma(219)&&Ya.isFromCurrentSession(this.$)&&!S.h(this.$).rtl&&!S.h(this.$).ib.tj}j0d(Ya,ra){this.u7f(Ya)&&
(Ya=Ed.a(this.$).Qq(ra))&&(e.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${ra}] of type [${Ya.floatingObject.type}]`),Ed.a(this.$).deleteFloatingObject(Ya,15,!0),Ya.Yi&&Ya.scb(Ya.Yi,!1))}gfi(Ya){if(!Ya)return e.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(S.h(this.$).ha.Sa.activeFloatingObjectControlId){var ra=
S.h(this.$).ha.Sa.cB.floatingObject;Ya.OriginDeltaX=ra.offsetX+this.Xab;Ya.OriginDeltaY=ra.offsetY+this.Xab;Ya.AbsoluteLeft+=this.Xab;Ya.AbsoluteTop+=this.Xab;Ya.AbsoluteRight+=this.Xab;Ya.AbsoluteBottom+=this.Xab;Ya.ZOrder=ra.hC+1;return S.h(this.$).ha.Sa.cB.Yi}if(!this.$.oa||!this.$.oa.activeCell)return e.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var ya=this.$.oa.activeCell;
ra=S.h(this.$).C1(ya);if(!ra)return e.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${ya.toString()} is null.`),null;const mb=oa.HelperMethods.zxb(ra.domElement,ra.Zi.domElement);ya=ra.gridView.fg(ya,2);if(!mb||!ya)return e.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!mb}. cellPositionRelativeToGridOrigin is null: ${!ya} .`),null;Ya.OriginDeltaX=
ya.topLeft.x-mb.x;Ya.OriginDeltaY=ya.topLeft.y-mb.y;Ya.AbsoluteLeft=ya.topLeft.x;Ya.AbsoluteTop=ya.topLeft.y;Ya.AbsoluteRight=Ya.AbsoluteLeft+Math.abs(this.Fta.AbsoluteRight-this.Fta.AbsoluteLeft);Ya.AbsoluteBottom=Ya.AbsoluteTop+Math.abs(this.Fta.AbsoluteBottom-this.Fta.AbsoluteTop);Ya.ZOrder=this.Fta.ZOrder+100;return new Se.a(ra.gridView.Da.Fl(ra.hashCode),ra.hashCode)}}Object(c.a)($b,"ArtPasteClientEstimation",null,[443]);class Xc{create(){const Ya=window.clipboardPlatform;return Ya?Ya.createClipboardItems():
null}}Object(c.a)(Xc,"ClipboardItemsFactory",null,[442]);class ed{}ed.undefined="Undefined";Object(c.a)(ed,"CCPTelemetryConsts",null,[]);class Rc{}Rc.cells="Cells";Rc.floatingObject="FloatingObject";Rc.unknown="Unknown";Object(c.a)(Rc,"ActiveSelection",null,[]);class Fd{}Fd.Imh="DisplayNotInvoked";Fd.U8c="Displayed";Fd.C5i="PrerequisitesNotReady";Object(c.a)(Fd,"PasteIndicationDisplayStatus",null,[]);var Nd=a(109);class zd{constructor(Ya){this.jHc=this.uRc=null;this.$=Ya}get xJd(){if(!this.uRc){const Ya=
this.$.da.Aa(254,!0);Ya&&(this.uRc=new sd(this.$,Ya,new Xc))}return this.uRc}get mZc(){if(!this.jHc&&this.$.da.Aa(254,!0)){const Ya=new $b(this.$);this.jHc=new ne(this.$,new Xc,new td(this.$,Ya),Ya)}return this.jHc}getCopyFlowHandler(Ya){const ra=this.SQh(S.h(this.$).Oe);Ya.commandParameters.copyPasteHandlerName=ra.name;return ra}getPasteFlowHandler(Ya){var ra=Ya.copyContextSnapshot;ra=Q(Ya)?this.mZc:M(Ya)?this.xJd:(null===ra||void 0===ra?0:ra.sourceItem)&&Object.getType(ra.sourceItem)===L?this.mZc:
this.xJd;Ya.commandParameters.copyPasteHandlerName=ra.name;return ra}initializePasteContext(Ya){if(Ya&&(Ya.isSameSession=!1,Ya.isShadowWorkbookParsedSuccessfully=!1,Ya.pasteResult=ed.undefined,Ya.payloadOrigin=ed.undefined,Ya.payloadType=ed.undefined,Ya.encounteredDeploymentErrors=!1,Ya.shadowWorkbookSizeExceedsLimit=!1,Ya.originalSourceRangesCountExceedsLimit=!1,Ya.activeSelectionType=this.HMh(),Ya.indicationDisplayScheduled=!1,Ya.pasteDestinationHasMergedCells=!1,Ya.pasteIndicationDisplayStatus=
Fd.Imh,Ya.copyContextSnapshot)){var ra=Ya.copyContextSnapshot;const mc=D(ra.sourceItem);var ya=ra.sourceItem;var mb=!!ya&&Object.getType(ya)===L;ya=0;var Hb=!1;mc?(Hb=ra.sourceItem,Ya.isSameSession=Hb.isFromCurrentSession(this.$),ya=1,Hb=this.Ppi(Hb,Ya)):mb&&(Ya.isSameSession=ra.sourceItem.isFromCurrentSession(this.$),ya=2);if(Ya.copyContextSnapshot.commandParameters){const Pc=-1985798686===ra.commandParameters.ribbonCommandInfo.command;mb=Ya.commandParameters;var Zb=this.$;ra?Zb&&Zb.va?ra=ra.sessionId===
Zb.va.UserSessionId:(e.ULS.shipAssertTag(537166211,0,!1,"ewaControl shouldn't be null"),ra=!1):(e.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),ra=!1);mb.clearSystemClipboard=ra&&Pc&&mc&&!Hb;Ya.commandParameters.copyPasteTargetType=ya}}}getSessionId(){return this.$.va.UserSessionId}Ppi(Ya,ra){const ya=Nd.b(Ya.ranges,mb=>mb.hf)&&Nd.b(ra.commandParameters.originalDestinations,mb=>1!==mb.top);return Nd.b(Ya.ranges,mb=>mb.isRow)&&Nd.b(ra.commandParameters.originalDestinations,mb=>
1!==mb.left)||ya}SQh(Ya){switch(Ya){case 1:return this.xJd;case 64:case 4:case 2:case 256:return this.mZc;default:throw Error.invalidOperation("Unsupported selection");}}HMh(){return S.h(this.$).ha.Oe&470?Rc.floatingObject:1===S.h(this.$).ha.Oe?Rc.cells:Rc.unknown}getDialogResponse(){}}Object(c.a)(zd,"ExcelCopyPasteApplicationHost",null,[411]);var Sd=a(157);class se extends C.a{constructor(Ya,ra){super(Ya);this.pp=null;this.Ygi=(ya,mb)=>{1===ya?(ya=se.Slh[mb[se.Rlh]],e.ULS.sendTraceTag(537167683,
0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===ya?"Horizontal":"Vertical"}`),this.pp.setResult(ya)):(e.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.pp.Pr())};this.hg(ra)}get qc(){return"InsertCopiedCutCellsDialog"}hg(Ya){this.pp=new Sd.a;const ra=B.a.instance.ga(16);Ya=this.oN(Ya);this.initializeAndShow(ra,this.Ygi,Ya)}oN(Ya){return{[se.vu]:this.qc,
[se.sri]:Ya}}}se.Rlh="direction";se.sri="isRtl";se.Slh={["Vertical"]:1,["Horizontal"]:0};Object(c.a)(se,"InsertCopiedCutCellsDialog",C.a,[]);class He{X5b(Ya,ra){return(new se(Ya,ra)).pp.task}}Object(c.a)(He,"InsertCopiedCutCellsDialogFactory",null,[410]);var Gd=a(89),fe=a(47),$d=a(46);class qe{constructor(Ya){this.W6b="";this.I2=this.ut=null;this.Asc=!1;this.Jbf=(ra=null,ya=null)=>{this.hide(ra,ya)};this.gridView=S.h(Ya);this.gridView.ha.hH(this.Jbf)}KNe(){this.Asc||(e.ULS.sendTraceTag(537167680,
0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.ky(Ya=>{Ya.Taa(0).then(()=>{this.Asc=!0})}))}iqj(Ya){var ra=Ya.commandParameters.id;e.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${ra}, cancelCtx is null = ${!this.ut}, PrerequisitesDownloaded = ${this.Asc}`);this.KNe();this.W6b=ra;ra=!this.axf();if(!this.ut||ra)this.GAe(),this.ut=fe.a.instance.create(()=>{this.Hmh(Ya)},void 0===Ya.timeoutToShowSpinnerInMs||
null===Ya.timeoutToShowSpinnerInMs?100:Ya.timeoutToShowSpinnerInMs,$d.a.N1i);this.I2=Ya.commandParameters.originalDestinations}Hmh(Ya){this.Asc?(this.display(Ya.commandParameters.originalDestinations),Ya.pasteIndicationDisplayStatus=Fd.U8c):(e.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),Ya.pasteIndicationDisplayStatus=Fd.C5i)}display(Ya){e.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");
this.gridView.qb.lx(hb.a.Gea(Ka.d(this.gridView.$.oa),Ya),qe.Erc,!0);this.gridView.qb.Sn(qe.Erc)}dmd(Ya){e.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${Ya}, currentPasteCommandId = ${this.W6b}`);Ya&&La.a.equals(Ya,this.W6b,!1)&&this.hide()}hide(Ya=null){this.I2&&Ya&&this.axf()&&e.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");
this.W6b="";this.GAe();this.I2=null;this.gridView.qb.Zg(qe.Erc);this.gridView.qb.Ti(null,qe.Erc)}axf(){return T.Q(this.gridView.ha.ra.selectedRanges,this.I2)}GAe(){this.ut&&(Gd.a.Ia(this.ut),this.ut=null)}dispose(){this.hide();this.gridView.ha.kG(this.Jbf)}}qe.Erc=[30];Object(c.a)(qe,"PasteIndicationManager",null,[342,2]);var pe=a(979),Ne=a(52),Le=a(697);class gf extends f.a{constructor(Ya){super();this.$=Ya;this.hm=B.a.instance;this.Fb()}create(){const Ya=Ne.a.ON([74,75],4,this.Ya,void 0,void 0,
void 0,gf.Una),ra=aa.GetServiceTaskFactory.create(this.$.da,18,this.$.ka,this.Ya);Oa.TaskExtensions.za(Oa.TaskExtensions.Ed([ra,Ya],this.ka),()=>{const ya=new pe.a;let mb=null;this.r7g(ya).then(Hb=>{mb=Hb.uDe;const Zb=copyPasteInfra.createCopyPasteInfra(mb,new zd(this.$),ya,this.$);e.ULS.shipAssertTag(537167762,0,!!this.$.va,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");e.ULS.shipAssertTag(537167761,0,!!this.$.va&&!!this.$.va.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");
const mc=mb.getMetadataManager();var Pc=Object(Le.a)(this.$.da,254,()=>new dc(this.$,mc,ra.result,Zb,new Sa(this.$,S.h(this.$)),new He,this.$.va.DocumentHostInfo.UserId,mb.getInitializationError()));this.nb(Pc);if(Hb.Y0a){Pc=dc.Rbc();const fd=JSON.stringify(Hb.Y0a.dataClipboardCapabilities),id=Hb.Y0a.clipboardStrategiesToInitialize[0].clipboardStrategyType===Hb.Y0a.dataClipboardStrategyType,Dd=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();
e.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${Pc}, StrategyType=${Hb.Y0a.dataClipboardStrategyType}, StrategyCapabilities=${fd}, IsBestStrategyTypeInitialized=${id}, InfraLoadTimeMS=${Dd}`)}else e.ULS.shipAssertTag(537167760,0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},Hb=>{const Zb=dc.Rbc();Hb=Hb?copyPasteInfra.getStringifiedError(Hb):"null";e.ULS.shipAssertTag(38847436,
0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${Zb} error: ${Hb}`)})},this.ka,3)}dispose(){super.dispose()}r7g(Ya){let ra=null;var ya=window.clipboardPlatform;ya&&(ra=ya.getClipboardPlatformEnvironment());if(!ra)return e.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),
Promise.reject(null);ya=this.$.va;const mb=[ya.OfficeOnlineChromeExtensionId,ya.ChromeClipboardAccessExtensionId],Hb=this.hm.Ua(5);var Zb=this.$.ie.get(57);let mc=!Zb&&this.$.ie.get(5);const Pc=this.$.ea.dc;Pc&&(Pc.inWebPart||Pc.inViewerFromWebPart||Pc.isDivSyndicated)&&(mc=!1);Zb=this.PPh(mc,!Zb);e.ULS.shipAssertTag(537167758,0,!!ya.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return ra.init(this.$,
Ya,mb,ya.SharedClipboardHostingApp,ya.SharedClipboardHostingApps,ya.SharedClipboardHostingEnvironments,ya.SharedClipboardOverrideOrigin,ya.SharedClipboardSchemaVersion,ya.SharedClipboardExpirationInMinutes,ya.ClipboardPromiseTimeoutInMinutes,Hb,ya.MachineCluster,new qb(this.$),Zb,ya.DocumentHostInfo.UserId,ya.ClipboardTtlInMS,t.EwaSettings.ma(305),ya.UserSessionId).then(fd=>Object(b.a)(new wb,{uDe:ra,Y0a:fd}),fd=>Promise.reject(fd))}PPh(Ya,ra){const ya=[];Ya&&ra&&ya.push(this.Xfh());ra&&(ya.push(this.K6c(7)),
ya.push(this.K6c(0)));Ya&&ya.push(this.lIe());ya.push({clipboardStrategyType:4});const mb=ya?ya.map(Hb=>JSON.stringify(Hb)).join(","):"[]";e.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${Ya}, isSystemClipboardAllowed=${ra}, result = ${mb}`);return ya}lIe(){const Ya=this.$.va,ra={clipboardStrategyType:5};ra.sessionId=Ya.UserSessionId;ra.useSharedClipboardIframe=!0;ra.sharedClipboardHostingApp=
Ya.SharedClipboardHostingApp;ra.sharedClipboardHostingApps=Ya.SharedClipboardHostingApps;ra.sharedClipboardHostingEnvironments=Ya.SharedClipboardHostingEnvironments;ra.sharedClipboardOverrideOrigin=Ya.SharedClipboardOverrideOrigin;ra.sharedClipboardSchemaVersion=Ya.SharedClipboardSchemaVersion;ra.sharedClipboardExpirationInMinutes=Ya.SharedClipboardExpirationInMinutes;ra.wacCluster=Ya.MachineCluster;return ra}Xfh(){const Ya={clipboardStrategyType:6};Ya.localStorageStrategyParameters=this.lIe();Ya.systemClipboardStrategyParameters=
this.K6c(0);return Ya}K6c(Ya){const ra={};ra.clipboardStrategyType=Ya;ra.skipFilesIfPlainTextExists=!0;return ra}static la(Ya){Ya.da.Ga(373,new qe(Ya));Ya.da.Ga(gf.Una,new gf(Ya))}}gf.Una=255;Object(c.a)(gf,"CopyPasteInfrastructureFactory",f.a,[]);var Ye=a(9);a.d(F,"a",function(){return $e});const $e=()=>{Ye.a.Fa(Ya=>{gf.la(Ya)})}},1155:function(u,F,a){u=a(0);var c=a(15),b=a(684),e=a(554),f=a(84),d=a(83),h;(function(da){da[da.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";da[da.cloudPolicySettings=
1]="cloudPolicySettings";da[da.alternateAuthToken=2]="alternateAuthToken"})(h||(h={}));Object(u.b)("ApplicationFeatureHelperRequestType",h);class n{constructor(){this.message=null;this.m6a=0}}Object(u.a)(n,"HttpRequstToPromiseRejectData",null,[]);var m=a(98),x=a(80),r=a(240),y=a(30);class t{constructor(da,aa){this.ob=da;this.Ah=aa}$5c(da,aa,fa,Oa=null,ba=null,ka=null,Pa=null,Fa=null){const oa=h[fa],La=oa+"RequestFailure";m.Health.instance.recordKpiUsage(La,0,"jpittsdirects",null);return new Promise((Ea,
ca)=>{c.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",oa);const $a=null!=Pa?Pa:this.ob.rd("ApplicationFeatureHelperRequestQueueTimeout",15E3),Qa=null!=Fa?Fa:this.ob.rd("ApplicationFeatureHelperRequestSentTimeout",3E4);this.Ah.bha(da,1,null,this.gVh(fa,Oa),ka,!1,1,Va=>{c.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",oa);try{if(void 0===Va||null===Va||void 0===
Va.data||null===Va.data||void 0===Va.data.ve||null===Va.data.ve){m.Health.instance.recordKpiFailure(La,"Invalid RequestSucceededEventArgs",!1,!0,null);let Ka=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",oa);ca(this.Pxb(Ka,Va))}else if(Va.data.httpStatus!==r.a.nP){m.Health.instance.recordKpiFailure(La,"HttpStatusCode_"+Va.data.httpStatus.toString(),!1,!0,null);let Ka=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",
Va.data.httpStatus,oa);ca(this.Pxb(Ka,Va))}else{void 0!==ba&&null!==ba&&void 0!==Va.data.responseHeaders&&null!==Va.data.responseHeaders&&ba(Va.data.responseHeaders);var fb=aa(Va.data.ve);if(fb)c.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",oa),Ea(fb);else{m.Health.instance.recordKpiFailure(La,"Parse Failure",!1,!0,null);let Ka=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",
oa);ca(this.Pxb(Ka,Va))}}}catch(Ka){m.Health.instance.recordKpiFailure(La,"Unexpected Failure",!1,!0,null),fb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",Ka,oa),ca(this.Pxb(fb,Va))}},Va=>{if(Va.data){m.Health.instance.recordKpiFailure(La,"HttpStatusCode_"+Va.data.httpStatus.toString(),!1,!0,null);var fb=y.a.Rid(Va.data.ve||"No Data");fb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",
Va.data.httpStatus,fb,oa)}else m.Health.instance.recordKpiFailure(La,"Invalid RequestFailedEventArgs",!1,!0,null),fb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",oa);ca(this.Pxb(fb,Va))},null,void 0,void 0,$a,Qa)})}Pxb(da,aa){const fa=new n;fa.message=da;fa.m6a=aa&&aa.data?aa.data.httpStatus:-1;return fa}gVh(da,aa){const fa={};fa["x-UserDataSignature"]=this.ob.Xa("UserDataSignature");fa["x-LicensingIsEnabled"]=this.ob.qa("LicensingIsEnabled").toString();
fa["x-CacheIsEnabled"]=this.ob.qa("LicensingRedisIsEnabled").toString();fa["x-OcpsIsEnabled"]=this.ob.qa("OcpsIsEnabled").toString();fa["x-LicensingAADIdIsEnabled"]=this.ob.qa("LicensingAadIdIsEnabled").toString();0===da&&(fa["x-LicenseCheckOnTenantEnabled"]="true",fa["x-SupportUserConsentDependentFeatures"]="true",fa["x-AFHUserConsentGroupValue"]="0",fa["x-UseShellServiceForUserConsentGroup"]="true",fa["x-SMBUserLicensingEnabled"]="true",fa["x-AFHPIPLComplianceEnabled"]=x.a.iy(window.location.href,
"wd_afhpipl")||"false");if(aa)for(let Oa of aa.keys)fa[Oa]=aa.na(Oa);return fa}}Object(u.a)(t,"HttpRequestToPromiseUtility",null,[]);var v=a(4),w;(function(da){da[da.loki=0]="loki";da[da.augloopACLP=1]="augloopACLP"})(w||(w={}));Object(u.b)("AlternateAuthSupportApp",w);var C=a(731),B=a(41);class z{constructor(){this.Token=null;this.ExpirationTime=0}}Object(u.a)(z,"WacAlternateAuthToken",null,[]);class A{constructor(da,aa){this.yQj=3E5;if(void 0===da||null===da||void 0===aa||null===aa)throw Error.argumentNull("appSettingsManager/clientRequestManager");
this.ob=da;this.pSb=new b.a(e.a.ak());this.Yjb=new t(da,aa);void 0!==C.a.zxd&&null!==C.a.zxd&&void 0!==C.a.kmc&&null!==C.a.kmc&&0<C.a.kmc&&(da=new z,da.Token=C.a.zxd,da.ExpirationTime=C.a.kmc,this.pSb.ia("loki",da))}oNh(){let da=null;this.pSb.lb(w[0])&&(da=this.pSb.na(w[0]));return void 0===da||null===da||this.Ntd(da)?this.pEh():Promise.resolve(da.Token)}Ntd(da){return da.ExpirationTime-Date.now()<this.yQj}pEh(){const da=new b.a(e.a.ak());da.ia("X-AlternateAuthApp",w[0]);return this.Yjb.$5c(this.Pva("/afhs/AlternateAuthHelperHandler.ashx"),
Object(f.a)(this,this.X0i,"parseAlternateAuthTokenResponse"),2,da).then(aa=>{c.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",w[0]);this.pSb.ia(w[0],aa);return aa.Token},aa=>{aa=Object(d.a)(n,aa);c.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",aa.message,aa.m6a);return null})}X0i(da){let aa=null;({Ft:aa}=B.d(da));c.ULS.sendTraceTag(545821457,3004,
aa?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",da);return aa}Pva(da){return String.format("{0}{1}?{2}",this.ob.Xa("WebServiceBase"),da,v.AFrameworkApplication.Hi)}}Object(u.a)(A,"AlternateAuthHelper",null,[195]);var E=a(460);class I{constructor(da,aa,fa){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=da;this.isEnabled=aa;this.tierName=fa}}Object(u.a)(I,"FeatureStateChangeArgs",null,[]);var L=a(136),V=a(252),T=a(27),H=a(111),D=a(171),G;
(function(da){da[da.Enabled=0]="Enabled";da[da.Disabled=1]="Disabled"})(G||(G={}));Object(u.b)("FeatureState",G);var J=a(82),M=a(25),Q=a(189);class U{constructor(da,aa,fa=null,Oa=null,ba=null){this.bva=this.GXb=this.Lie=this.Uqa=this.IYb=null;this.Yjb=new t(da,aa);this.ob=da;this.Gyg=da.rd("LicensingMaxRetryAttempts",0);this.vVb=da.qa("IsO365ConsumerHost");this.tNc=da.qa("IsO365CommercialHost");this.qVb=da.qa("PremiumUpsellIsEnabled");this.EOc=0;this.h7d=fa;this.Vme=Oa;this.La=ba;this.Tqa=da.qa("LicensingIsEnabled");
this.hFa=da.qa("OcpsIsEnabled")&&this.tNc;this.RUc=da.qa("ShowPrivacyDialog")&&!!Oa;this.IMc=da.qa("IsAnonymousUser");this.ecd=new Promise(ka=>{ka(!1)});this.nCa=new Promise(ka=>{ka(!0)});this.ava=new b.a(e.a.ak());this.tZb=!0;this.Yde=this.GWh();this.Trd()&&!this.IMc?(void 0!==v.AFrameworkApplication.ta&&null!==v.AFrameworkApplication.ta&&(this.IYb=v.AFrameworkApplication.ta.lE,void 0!==this.IYb&&null!==this.IYb&&(this.Uqa=this.IYb.Qg("WebServiceCall","ApplicationFeatureHelperService"))),this.bva=
this.R_d()):this.bva=new Promise(ka=>{ka({})});this.bva.catch(ka=>{ka=Object(d.a)(n,ka);c.ULS.sendTraceTag(42513088,3004,10,"ApplicationFeatureHelper initialization failed, HttpStatus={0}",ka?ka.m6a.toString():"Unknown")});this.tZb&&(this.qVb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(ka=>{this.qVb=this.ob.qa("PremiumUpsellIsEnabled")&&ka;return null}))}GWh(){const da=this.ob.aq("AllLicensedFeatures")?this.ob.Cw("AllLicensedFeatures"):[],aa=new E.a;for(let fa=0;fa<da.length;fa++)aa.add(da[fa]);
return aa}Trd(){return this.tNc||this.vVb}R_d(da=0,aa=!1){c.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",aa);const fa=L.a.gs();fa&&(fa.set("retryAttempt",da.toString()),fa.set("forceRefresh",aa.toString()),fa.set("isO365ConsumerHost",this.vVb.toString()),fa.set("isO365CommercialHost",this.tNc.toString()),fa.set("isFreemiumUpsellSettingEnabled",this.qVb.toString()));m.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest",
"waclicensing",fa);m.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",1,"waclicensing",fa);void 0!==this.Uqa&&null!==this.Uqa&&this.Uqa.start();let Oa=null;aa&&(Oa=new b.a(e.a.ak()),Oa.ia("x-LicensingForceRefresh","true"));this.Lie=new Date;return(this.Tqa?this.Yjb.$5c(this.Pva("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(f.a)(this,this.$0i,"parseApplicationFeatureHelperResponse"),0,Oa,Object(f.a)(this,this.t6i,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(ba=>
{const ka=Object.assign(new Q.a,{durationMs:this.Qag()});ka.extendedProperties=fa;ka.extendedProperties&&ba&&(ka.extendedProperties.set("featureCount",H.a.count(ba).toString()),ka.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in ba).toString()),ka.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in ba).toString()),"FreemiumUpsell"in ba&&ka.extendedProperties.set("isFreemiumUpsellEnabled",ba.FreemiumUpsell.toString()),this.GXb&&ka.extendedProperties.set("fromCache",
(this.GXb<this.Lie).toString()));m.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",ka);return ba},ba=>{const ka=Object.assign(new Q.a,{durationMs:this.Qag()}),Pa=Object(d.a)(n,ba);if(!Pa)return c.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),m.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,ka),new Promise((Fa,oa)=>{oa(ba)});ka.extendedProperties=
fa;ka.extendedProperties&&ka.extendedProperties.set("status",Pa.m6a.toString());m.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","RequestFailed",!1,!0,ka);return 408===Pa.m6a&&++da<=this.Gyg?this.R_d(da):new Promise((Fa,oa)=>{oa(Pa)})})}$0i(da){(da=B.b(da))?(c.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),c.ULS.sendTraceTag(50938594,3004,50,"{0}",da)):c.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");
return da.Features}Pva(da){var aa=String.format("{0}{1}",this.ob.Xa("WebServiceBase"),da);this.ob.aq("ApplicationFeatureHelperHttpCachingEnabled")&&this.ob.qa("ApplicationFeatureHelperHttpCachingEnabled")&&(da=U.Ycc(this.ob))&&0<da.length&&(this.tZb&&(da+="ucbf"),aa=new V.QueryStringBuilder(aa),aa.qj("afhskey",da),aa=aa.toString());return aa}isFeatureEnabled(da,aa){if(!this.hFa&&!this.RUc&&!this.Tqa)return this.nCa;c.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",
da);if("ConnectedServices"===da){var fa=this.hFa?this.h7d.xF("ControllerConnectedServicesEnabled"):this.nCa;const ka=this.RUc?this.Vme.getSettings().then(Pa=>2!==Pa.su,()=>aa):this.nCa;return fa.then(Pa=>Pa?ka:this.ecd)}fa=null;fa=this.hFa?this.h7d.isFeatureEnabled(da):this.nCa;let Oa=null;Oa=this.Tqa?this.Ami(da,aa):this.nCa;let ba=null;ba=this.RUc?this.Vme.isFeatureEnabled(da):this.nCa;return fa.then(ka=>ka?ba.then(Pa=>Pa?Oa:this.ecd):this.ecd).then(ka=>{this.mrf(da,ka,!0);return ka},()=>{this.mrf(da,
aa,!1);return aa})}mrf(da,aa,fa){c.ULS.sendTraceTag(526713106,3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",da,aa,fa)}getFeatureTier(da,aa){if(!this.Tqa)return new Promise(fa=>{fa(2)});c.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",da);return this.bva.then(fa=>this.Xdc(da,fa,aa),()=>aa)}isFreemiumUpsellEnabled(){const da=this.qVb&&this.vVb&&!this.IMc;if(da&&2!==this.EOc||!da&&1!==this.EOc)c.ULS.sendTraceTag(509728161,3004,
20,"ApplicationFeatureHelper_IsFreemiumUpsellEnabled: isO365ConsumerHost={0}, isAnonymousUser={1}, isFreemiumUpsellEnabled={2}",this.vVb.toString(),this.IMc.toString(),da.toString()),this.EOc=da?2:1;return da}launchUpsellExperience(da,aa=null){c.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",da));var fa=L.a.gs();fa&&(fa.set("experienceId",da),aa&&fa.set("campaignId",aa));m.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",
1,"waclicensing",fa);if(fa=J.a.instance.Lh("Common.IInProductMessagingUIManager")){const Oa=Object(f.a)(this,this.g7h,"handleDimeTaskComplete");fa.vpf(da,Oa,aa)}else c.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.La.Zd(M.a.kbc,2,{["experience"]:da})}kna(da,aa){if(!this.Tqa)return null;if(!da||!aa)return c.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),
null;const fa=D.a.create().toString();this.ava.lb(da)||this.ava.ia(da,new b.a(e.a.ak()));this.ava.na(da).add(fa,aa);c.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",fa,da));return fa}CLd(da,aa){this.Tqa&&(da&&this.ava.lb(da)?aa&&D.a.isValid(aa)?this.ava.na(da).lb(aa)?(c.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",
aa,da)),this.ava.na(da).remove(aa)):c.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",aa,da)):c.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",aa,da)):c.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",
da)))}Xdc(da,aa,fa){return this.tZb?da in aa?aa[da].LicenseTier:fa:da in aa?this.w1i(aa[da],fa):fa}w1i(da,aa){switch(da.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return aa}}g7h(){c.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.bva.then(da=>{this.NSf(da)}).catch(()=>{this.NSf({})})}NSf(da){c.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const aa=
this.R_d(0,!0);aa.then(fa=>{this.bva=aa;H.a.count(fa)>H.a.count(da)?m.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(let Oa of this.ava.keys)if(Oa in fa){const ba=this.Xdc(Oa,fa,0);Oa in da?this.Xdc(Oa,da,0)!==ba&&this.wBd(Oa,!0,ba):this.wBd(Oa,!0,ba)}else Oa in da&&this.wBd(Oa,!1,this.Xdc(Oa,da,0))}).catch(fa=>{m.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",
!1,!0,null);c.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(fa))})}wBd(da,aa,fa){c.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",da,aa,fa);aa=new I(da,aa,fa);fa=this.ava.na(da);for(let Oa of fa)try{Oa.value(aa)}catch(ba){c.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",
da,Oa.key,ba.message))}}Td(da,aa){if(this.Tqa){const fa=this.Yde.contains(da);let Oa=!0,ba="",ka=!1;return this.bva.then(Pa=>{da in Pa?(Pa=Pa[da],ba=G[Pa.FeatureState],Oa=1!==Pa.FeatureState):Oa=!fa;this.vrf(da,fa,ba,ka,aa,Oa);return Oa},()=>{ka=!0;fa&&(Oa=aa);this.vrf(da,fa,ba,ka,aa,Oa);return Oa})}return this.nCa}vrf(da,aa,fa,Oa,ba,ka){c.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",
da,aa,Oa,fa,ba,ka)}Ami(da,aa){if(this.tZb)return this.Td(da,aa);if(this.Tqa){if(this.Yde.contains(da))return this.bva.then(fa=>da in fa,()=>aa);c.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",da)}return this.nCa}t6i(da){try{da&&"Date"in da&&(this.GXb=new Date(da.Date),c.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.GXb.toString()))}catch(aa){c.ULS.sendTraceTag(578863818,
3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",aa)}}Qag(){if(void 0!==this.Uqa&&null!==this.Uqa){const da=this.Uqa.Ac;this.Uqa.stop();return da}return null}static Ycc(da){try{if(T.a.KMj){const aa=da.Xa("UserDataSignature").split(".");if(1<aa.length){const fa=window.self.atob(aa[1]),Oa=JSON.parse(fa).LocalStorageKey;if(void 0!==Oa&&null!==Oa&&0<Oa.length)return Oa}}}catch(aa){c.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",aa.toString())}return null}}
Object(u.a)(U,"ApplicationFeatureHelper",null,[196]);var Z=a(187);class P{constructor(da,aa){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=da.PolicySettings;da=new Date;da.setMinutes(da.getMinutes()+aa);this.ExpirationTime=da.getTime()}}Object(u.a)(P,"CloudPolicySettingsCacheData",null,[]);var S=a(820),ja=a(377),X=a(228);class Y{static U9f(){return v.AFrameworkApplication.fa.qa("SideCarIsEnabled")?Y.Vwc&&Y.oqd?new Promise(da=>{da(!0)}):new Promise((da,aa)=>{Y.Vwc=X.a.create(v.AFrameworkApplication.fa.Xa("SideCarUrl"));
ja.a.Uia(Y.Vwc);Y.Vwc.b$((fa,Oa)=>{(Y.oqd=Oa.succeeded)?da(Oa.succeeded):aa(Oa.succeeded)})}):new Promise(da=>{da(!1)})}}Y.oqd=!1;Y.Vwc=null;Object(u.a)(Y,"SideCarLoader",null,[]);class va{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(u.a)(va,"CloudPolicySettingsData",null,[]);class N{constructor(da,aa){this.mIc=0;this.z4b=null;this.Yjb=new t(da,aa);this.ob=da;aa=da.Xa("HostAuthType");this.hFa=da.qa("OcpsIsEnabled")&&da.qa("IsO365CommercialHost")&&!(void 0===
aa||null===aa)&&"aad"===aa.toLowerCase();this.ege=B.b(da.Xa("OcpsDefaultSettings")||"{}");this.Mkb=this.Ycc();aa=this.ob.aq("ServicesControlsMicrosoftControllerServicesList")?this.ob.Cw("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.pTb=new E.a;for(let fa=0;fa<aa.length;fa++)this.pTb.add(aa[fa]);this.hFa&&!da.qa("IsAnonymousUser")&&da.qa("SideCarIsEnabled")?this.z4b=this.qTj():this.z4b=this.Yoa(this.hFa,this.Pva("/afhs/CloudPolicySettings.ashx"),Object(f.a)(this,this.a1i,"parseCloudPolicySettingsResponse"));
this.z4b.then(()=>null).catch(fa=>{fa=Object(d.a)(n,fa);c.ULS.sendTraceTag(50622685,3004,10,"CloudPolicySettingsHelper initialization failed, HttpStatus={0}",fa?fa.m6a.toString():"Unknown")})}xF(da,aa=!0){if(!this.hFa){const ka=this;return new Promise(Pa=>{Pa(ka.yxb(da))})}let fa=this,Oa=this;const ba=this.z4b.then(ka=>{try{let Pa=null;ka.PolicySettings&&"unknown"in ka.PolicySettings&&(Pa=ka.PolicySettings.unknown);if(Pa){if(da in Pa&&void 0!==Pa[da]&&null!==Pa[da])return new Promise(oa=>{oa("0"!==
Pa[da])});const Fa=da.toLowerCase();if(Fa in Pa&&void 0!==Pa[Fa]&&null!==Pa[Fa])return new Promise(oa=>{oa("0"!==Pa[Fa])});c.ULS.sendTraceTag(51512667,3004,50,"Policy"+da+" not found, using default");return new Promise(oa=>{oa(fa.yxb(da))})}return new Promise(Fa=>{Fa(fa.yxb(da))})}catch(Pa){return c.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+da+" policy value. Error Message: {0}",Pa.message),fa.handleError(Pa.toString(),aa,fa.yxb(da))}},ka=>Oa.handleError(ka,aa,Oa.yxb(da)));ba.then(ka=>{c.ULS.sendTraceTag(50651667,
3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",da,ka);return null});return ba}isFeatureEnabled(da,aa=!0){if(this.ob.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.Cmi(da,aa);let fa=new Promise(ba=>{ba(!0)}),Oa="";this.pTb.contains(da)&&(Oa="ControllerConnectedServicesEnabled",fa=this.xF(Oa,aa));fa.then(ba=>{c.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",
da,ba,Oa);return null});return fa}Cmi(da,aa=!0){let fa=new Promise(ba=>{ba(!0)}),Oa="";"mso_sendASmile"===da?Oa="Enabled":"Survey"===da||"FloodgateSurvey"===da?Oa="SurveyEnabled":this.pTb.contains(da)&&(Oa="ControllerConnectedServicesEnabled");""!==Oa&&(fa=this.xF(Oa,aa));fa.then(ba=>{c.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",da,ba,Oa);return null});return fa}handleError(da,aa,fa){return aa?new Promise(Oa=>
{Oa(fa)}):new Promise((Oa,ba)=>{ba(da)})}Yoa(da,aa,fa){if(!da)return Promise.resolve(new va);let Oa=!1,ba=null;m.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let ka=this.x5c("GetCloudPolicySettings");return(new Promise((Pa,Fa)=>{if(void 0!==this.Mkb&&null!==this.Mkb&&0<this.Mkb.length){const oa=this.$Sj();if(void 0!==oa&&null!==oa){Oa=!0;Pa(oa);return}}this.Yjb.$5c(aa,fa,1,null,Object(f.a)(this,this.y6i,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],
this.ob.rd("CloudPolicySettingsRequestQueueTimeout",15E3),this.ob.rd("CloudPolicySettingsRequestSentTimeout",3E4)).then(oa=>{c.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.QTj(oa);Pa(oa);return oa},oa=>{Fa(oa);return null})})).then(Pa=>{({stopwatch:ka,returnValue:ba}=this.TAc(ka));var Fa=L.a.gs();Fa&&Fa.set("FromCache",Oa.toString());Fa=Object.assign(new Q.a,{durationMs:ba,extendedProperties:Fa});m.Health.instance.recordKpiSuccess("GetCloudPolicySettings",
Fa);return Pa})}qTj(){return Y.U9f().then(()=>{c.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}Pva(da){return String.format("{0}{1}",this.ob.Xa("WebServiceBase"),da)}a1i(da){let aa=null;({Ft:aa}=B.d(da));da=!!aa;c.ULS.sendTraceTag(50622687,3004,da?50:10,"ParseCloudPolicySettingsResponse: Success={0}",da);return aa}y6i(da){try{if(void 0!==da&&null!==da&&"CheckIn-Interval"in
da){const aa=parseInt(da["CheckIn-Interval"]);void 0!==aa&&null!==aa&&0<aa&&(this.mIc=aa)}}catch(aa){c.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",aa)}}yxb(da){return da in this.ege?"0"!==this.ege[da]:!0}$Sj(){try{const da=S.a.instance.getItem(this.Mkb);if(void 0===da||null===da)return c.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;c.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",
da);const aa=JSON.parse(da);if(void 0===aa||null===aa)return c.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===aa.ExpirationTime||null===aa.ExpirationTime)return c.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if((new Date(aa.ExpirationTime)).getTime()<Date.now())return c.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),
null;const fa=new va;fa.PolicySettings=aa.PolicySettings;fa.ControllerConnectedServicesFeatureNames=new Z.a;this.ob.aq("ServicesControlsMicrosoftControllerServicesList")&&this.ob.Cw("ServicesControlsMicrosoftControllerServicesList");for(let Oa of this.pTb)fa.ControllerConnectedServicesFeatureNames.add(Oa);c.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return fa}catch(da){return c.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",
da.toString()),null}}QTj(da){try{if(void 0===da||null===da||void 0===da.PolicySettings||null===da.PolicySettings)c.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.mIc)c.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{const aa=new P(da,this.mIc),fa=JSON.stringify(aa);c.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",fa);S.a.instance.setItem(this.Mkb,
fa);c.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(aa){c.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",aa.toString())}}Ycc(){const da=U.Ycc(this.ob);return da&&0<da.length?"OCPS"+da:null}x5c(da){const aa=J.a.instance.Lh("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return void 0!==aa&&null!==aa?aa.Bc("WebServiceCall",da):null}TAc(da){if(void 0!==da&&null!==da){const aa=da.Ac;da.stop();return{returnValue:aa,
stopwatch:null}}return{returnValue:null,stopwatch:da}}}Object(u.a)(N,"CloudPolicySettingsHelper",null,[193]);class ea{constructor(){this.ENe=this.nkg=this.su=0;this.FNe=this.okg=this.AIa="";this.CTc=this.Zea=2}clone(){const da=new ea;da.su=this.su;da.nkg=this.nkg;da.ENe=this.ENe;da.AIa=this.AIa;da.okg=this.okg;da.FNe=this.FNe;da.Zea=this.Zea;da.CTc=this.src;return da}get src(){return this.CTc}serialize(da=null){const aa={};if(!da||da.contains(ea.sPa))aa[ea.sPa]=this.su;if(!da||da.contains(ea.GFb))aa[ea.GFb]=
this.AIa;if(!da||da.contains(ea.HFb))aa[ea.HFb]=this.Zea;return JSON.stringify(aa)}static create(da,aa=null){const fa=new ea;fa.CTc=da;void 0!==aa&&null!==aa&&(ea.sPa in aa&&(fa.su=aa[ea.sPa]),ea.GFb in aa&&(fa.AIa=aa[ea.GFb]),ea.HFb in aa&&(fa.Zea=aa[ea.HFb]));return fa}static deserialize(da,aa){try{const fa=JSON.parse(da);if(void 0!==fa&&null!==fa)return ea.create(aa,fa);c.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",da);throw Error.argument("settingsData");
}catch(fa){throw c.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",fa.toString()),fa;}}}ea.sPa="CCS";ea.GFb="CCSTime";ea.HFb="OfficePrivacyRoamedNoticeShown";Object(u.a)(ea,"UserPrivacySettings",null,[]);var Ca=a(128);class la{constructor(da,aa){if(void 0===da||null===da||void 0===aa||null===aa)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.ob=da;this.Ah=aa;this.TSc=this.pe=null}Pva(da){var aa=String.format("{0}RoamingServiceHandler.ashx?action=",
this.ob.appSettings.RoamingServiceHandlerWebServiceBase||"");aa=new Sys.StringBuilder(aa);aa.append(da);aa.append("&");aa.append(v.AFrameworkApplication.Hi);return aa.toString()}executeRequest(da,aa,fa,Oa=null){return this.Ah.oob(da,aa,Oa,null,fa,"33",!1,null,6E4)}saveSettings(da){return new Promise((aa,fa)=>{try{if(void 0===this.pe||null===this.pe||void 0===da||null===da)c.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),fa("Can't determine setting changes to save");
else{var Oa=this.pe.su!==da.su;if(2===this.pe.src&&Oa)this.Cpj(da),aa(!0);else{var ba=this.otj(da);if(void 0===ba||null===ba||!ba.length)c.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),fa("No changes to save");else if(1===this.pe.src)aa(this.fgg(ba));else if(0===this.pe.src){c.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",ba);const ka=this.executeRequest(this.Pva("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",
ba);ka.continueWith(()=>{if(ka.qh||ka.Pf)c.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),aa(!1);else{var Pa=ka.result;void 0!==Pa.Kg&&null!==Pa.Kg&&void 0!==Pa.Kg.data&&null!==Pa.Kg.data&&Pa.Kg.data.httpStatus===r.a.nP?(c.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),aa(!0)):(c.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),aa(!1))}})}}}}catch(ka){c.ULS.sendTraceTag(50860930,
3004,10,"SaveUserPrivacySettings: Exception = {0}",ka.toString()),aa(!1)}})}otj(da){if(void 0===this.pe||null===this.pe||void 0===da||null===da)throw Error.invalidOperation("User Privacy settings have not been initialized");const aa=new Z.a;0===da.src?(this.pe.su!==da.su&&(aa.add(ea.sPa),aa.add(ea.GFb)),this.pe.Zea!==da.Zea&&aa.add(ea.HFb)):1===da.src&&this.pe.su!==da.su&&aa.add(ea.sPa);return aa.count?da.serialize(aa):(c.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),
null)}getSettings(){if(!this.TSc){const da=this;this.TSc=new Promise(aa=>{try{da.pe?aa(da.pe.clone()):da.iTj().then(fa=>{da.pe=fa;aa(da.pe.clone());return null},()=>{da.gTj().then(fa=>{da.pe=fa;aa(da.pe.clone());return null},()=>{da.hTj().then(fa=>{da.pe=fa;aa(da.pe.clone());return null},()=>{c.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");da.pe=new ea;aa(da.pe.clone());return null});return null});return null})}catch(fa){c.ULS.sendTraceTag(50860932,
3004,10,"UserPrivacySettings GetSettings: Exception = {0}",fa.toString()),da.pe=new ea,aa(da.pe.clone())}})}return this.TSc}iTj(){return new Promise((da,aa)=>{try{const Oa=-1!==window.location.href.indexOf("&wd_pn=2");if(this.ob.qa("PrivacyDialogShouldCheckRoaming")||Oa){var fa=this.executeRequest(this.Pva("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");fa.continueWith(()=>{try{if(fa.qh||fa.Pf)c.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");
else{const ba=fa.result;if(ba&&ba.Kg&&ba.Kg.data)if(ba.Kg.data.httpStatus!==r.a.nP)c.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",ba.Kg.data.httpStatus);else{if(ba.Kg.data.ve){da(la.parse(ba.Kg.data.ve,0));c.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",ba.Kg.data.ve);return}c.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else c.ULS.sendTraceTag(50860935,
3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");aa("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(ba){c.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",ba.toString()),aa("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else c.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),aa("Roaming should not be used")}catch(Oa){c.ULS.sendTraceTag(50860939,
3004,10,"TryGetSettingsFromRoaming Exception = {0}",Oa.toString()),aa("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}gTj(){return new Promise((da,aa)=>{try{const fa=Ca.a.get("WacUPToggleState");let Oa=null;void 0!==fa&&null!==fa&&0<fa.length&&(Oa=decodeURIComponent(fa));if(void 0!==Oa&&null!==Oa&&0<Oa.length){const ba=la.parse(Oa,1);c.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",ba.toString());da(ba)}else{const ba=ea.create(1),
ka=new Z.a;ka.add(ea.sPa);const Pa=ba.serialize(ka);this.fgg(Pa)?(c.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",Pa),da(ba)):(c.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",Pa),aa("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(fa){c.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",
fa.toString()),aa("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}hTj(){return new Promise(da=>{try{var aa=-1!==window.location.href.indexOf("&wdccsoff=1");let fa=ea.create(2);aa?(fa.su=2,v.AFrameworkApplication.jMe(),c.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",fa.toString())):(fa.su=1,c.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",fa.toString()));da(fa)}catch(fa){c.ULS.sendTraceTag(50967431,
3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",fa.toString()),aa=ea.create(2),aa.su=1,da(aa)}})}Cpj(da){c.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===da.su?v.AFrameworkApplication.jMe():v.AFrameworkApplication.Mqh();c.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",da)}fgg(da){try{c.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",da);const aa=
this.ob.Xa("PrivacyCookieDomain")||"";if(!aa||!aa.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");c.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",da);return Ca.a.SSd("WacUPToggleState",da,Ca.a.bW,"/",aa)}catch(aa){return c.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",aa.toString()),!1}}isFeatureEnabled(da){return this.getSettings().then(aa=>{const fa=this.ob.aq("ServicesControlsMicrosoftControllerServicesList")?
this.ob.Cw("ServicesControlsMicrosoftControllerServicesList"):[],Oa=new E.a;for(let ba=0;ba<fa.length;ba++)Oa.add(fa[ba]);return Oa.contains(da)?2!==aa.su:!0},()=>{c.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",da);return!0})}static parse(da,aa){try{return c.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",da,aa),ea.deserialize(da,aa)}catch(fa){throw c.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",fa.toString()),
fa;}}}Object(u.a)(la,"UserPrivacySettingsHelper",null,[194]);var Ra=a(248);class lb{constructor(){this.gb=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}Xh(da){this.gb=da;this.gb.register(193,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").xc().Fc(()=>new N(v.AFrameworkApplication.fa,v.AFrameworkApplication.zd));this.gb.register(194,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").xc().Fc(()=>new la(v.AFrameworkApplication.fa,
v.AFrameworkApplication.zd));this.gb.register(195,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").xc().Fc(()=>new A(v.AFrameworkApplication.fa,v.AFrameworkApplication.zd));this.gb.register(196,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").xc().Fc(()=>new U(v.AFrameworkApplication.fa,v.AFrameworkApplication.zd,this.gb.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.gb.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
v.AFrameworkApplication.ub))}init(){v.AFrameworkApplication.fa.Ev(()=>{const da=this.gb.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");v.AFrameworkApplication.fa.qa("LicensingIsEnabled")&&(da.isFeatureEnabled("LicensingTestFeature",!1).then(aa=>{c.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",aa,v.AFrameworkApplication.fa.Xa("IsAnonymousUser"));return null}),da.getFeatureTier("LicensingTestFeature",
0).then(aa=>{c.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",aa,v.AFrameworkApplication.fa.Xa("IsAnonymousUser"));return null}));this.gb.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.gOj()})}dispose(){}gOj(){try{v.AFrameworkApplication.fa.qa("SideCarIsEnabled")&&Y.U9f().then(da=>{c.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",
da);return da})}catch(da){}}static main(){Ra.a.instance.Ei(new lb)}}Object(u.a)(lb,"ApplicationFeatureHelperPackage",null,[3,4]);a.d(F,"a",function(){return Aa});const Aa=()=>{Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");lb.main()}},1158:function(u,F,a){var c=a(9);u=a(0);var b=a(222),e=a(15),f=a(1362),d=a(636),h=a(550),n=a(27),m=a(89),x=a(30),r=a(157),y=a(235),t=a(8),v=a(58),w=a(154),C=a(348),B=a(47),z=a(46),A=a(29),E=a(1),I=a(22),L=a(13),V=a(104),
T=a(83),H=a(84),D=a(146),G=a(4),J=a(14),M=a(96),Q=a(45),U=a(1076);class Z extends D.a{constructor(wb,Tb=!0){super(!1,!1,Z.Wu);this.fYa=null;this.b$d=!1;this.qn=[];this.Tj=null;this.nZb=wb;this.lCg=Tb;this.$v=this.Ile=!1;this.Mga=null;this.xKc=!1;this.qg=this.vlh;this.Fe="InsertFileDialog";this.pc(1,this.LZb);Z.Wu?(this.fYa={["id"]:this.Fe,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(H.a)(this,this.eZi,"onUploadButtonClick")}},["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,
["onFrameReady"]:Object(H.a)(this,this.XPi,"onFrameReady")},this.initializeAndShow(this.titleText,Object(H.a)(this,this.Hgc,"insertDialogHandler"),this.fYa),this.QTb=!0):(this.showDialog(this.titleText,Object(H.a)(this,this.Hgc,"insertDialogHandler")),Tb&&this.H5f(),(wb=this.rK(1))&&this.qn.push(wb),(wb=this.rK(0))&&this.qn.push(wb),this.Qig(),this.QTb=!1)}get t_j(){return this.nZb}validate(){this.Tj.rF||e.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.Tj.rF.value?
!0:(Z.gA(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}XPi(wb){this.lCg&&(this.Tj=this.G5f(wb,this.nZb))}eZi(){this.Tj&&this.Tj.rF&&(this.b$d||(this.Tj.idj(Object(H.a)(this,this.iDd,"onFileChosen")),this.b$d=!0),this.Tj.eXe())}iDd(wb){this.fYa.uploadStatusLabel=wb;this.WUa(this.titleText,Object(H.a)(this,this.Hgc,"insertDialogHandler"),this.fYa)}Hgc(wb){1===wb&&this.isEnabled()?Z.Wu&&this.Tj.rF&&!this.Tj.rF.value?(this.fYa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,this.WUa(this.titleText,
Object(H.a)(this,this.Hgc,"insertDialogHandler"),this.fYa)):(this.gzb(),this.nZb.finalizeUpload(this.Tj,Object(H.a)(this,this.dispose,"dispose"))):0===wb&&this.hide()}H5f(){this.xKc=!1;this.Tj=this.G5f(document.getElementById("uploadFrameContainer"),this.nZb);G.AFrameworkApplication.fa.qa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.Mga=Object(H.a)(this,this.ZEd,"onUploadFrameLoad"),Q.a.addHandler(this.Tj.iFrame,"load",this.Mga));this.Tj.rF||e.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");
this.POf()}ZEd(){this.POf()}POf(){if(this.Tj&&!this.xKc){var wb=this.Tj.rF;wb&&(Q.a.addHandler(wb,J.a.Pb,Object(H.a)(this,this.onKeyDown,"onKeyDown")),wb=[wb],this.qn=wb.concat.apply(wb,this.qn),this.Qig(),this.xKc=!0)}}dispose(){if(this.Tj&&!Z.Wu){const wb=this.Tj.rF;wb&&Q.a.removeHandler(wb,J.a.Pb,Object(H.a)(this,this.onKeyDown,"onKeyDown"));this.Mga&&Q.a.removeHandler(this.Tj.iFrame,"load",this.Mga)}this.Tj=null;super.dispose()}Qig(){if(0<this.qn.length){const wb=new U.a(this.qn),Tb=M.FocusManager.instance().MQ();
Tb&&(this.qn[0].focus(),Tb.jf=wb,Tb.S_=!0)}}onKeyDown(wb){4!==M.FocusManager.instance().ROf(wb)&&wb.preventDefault()}static get Wu(){return G.AFrameworkApplication.ta.Pa.Iv&&G.AFrameworkApplication.ta.Pa.alf}static gA(wb){const Tb=document.getElementById("errorText");Tb.innerText=wb;Tb.style.display="inline-block"}}Object(u.a)(Z,"InsertFileDialog",D.a,[]);class P{static get qg(){return D.a.iq(P.ol,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}P.ol="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(u.a)(P,"InsertImageDialogHtml",null,[]);class S extends Z{constructor(wb,Tb=!0){super(wb,Tb)}get LZb(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get vlh(){return P.qg}validate(){this.Tj.rF||e.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const wb=Object(T.a)(f.a,this.t_j),Tb=wb.Tkg(this.Tj.rF.value);return 0!==Tb?(Z.gA(wb.w2e(Tb)),!1):!0}}Object(u.a)(S,"InsertImageDialog",Z,[]);var ja=a(555);const X=
(wb,Tb,xb)=>{if(wb){var cb=0;do{try{wb();break}catch(jb){if(e.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",cb,xb,jb.message,jb.stack),cb>=Tb)break}cb++}while(1)}};var Y=a(107),va=a(87),N=a(41),ea=a(252),Ca=a(201),la=a(80),Ra=a(465),lb=a(171);class Aa{constructor(wb,Tb,xb,cb,jb,qa,za,Na,ua=!0,Xa=null,ha=!1){this.lXe="FileUpload.ashx";this.oo=null;this._initialized=!1;this.Jg=this.sjb=this.wKc=this.Mga=this.pUb=this.mr=this.ft=
null;this.Lm=!1;this.tE=this.qUb=this.NUc=null;this._parent=wb;this.dxg=Tb;this.CBg=xb;this.H$d=jb;this.QSc=za;this.O4d=Na;this.L6d=Xa;this.MUc=!1;this.Axg=cb.qa("CanaryRenewalForFileUploadIsEnabled");this.dkg=!1;(this.jra=ha)||this.P$g(qa);ua&&this.Pef()}get RYf(){return this.CBg}get sessionId(){return this.QSc}get iFrame(){return this.oo}get rF(){return this.mr}get g$a(){return G.AFrameworkApplication.fa?G.AFrameworkApplication.fa.qa("NativeFileOpenDialogIsEnabled"):!1}get fXe(){return G.AFrameworkApplication.fa?
G.AFrameworkApplication.fa.qa("FileInputDescriptionAccessibilityIsEnabled"):!1}get Coi(){return this.jra?!1:Ca.b(this.oo.contentWindow.location.pathname,this.lXe,0)}get FPg(){return!n.a.jla&&G.AFrameworkApplication.fa.qa("AllowMultipleImageInsertFromLocalDevice")}Pef(){this.tE=lb.a.create().toString();this.jra?this.B$c():this.IQg()}P$g(wb){this.oo=document.createElement("iframe");this.oo.className=wb;this.oo.id=wb;this.H$d&&(this.oo.style.visibility="visible",this.oo.style.height="30px",this.oo.setAttribute("frameborder",
"0"));this.Mga=Object(H.a)(this,this.ZEd,"onUploadFrameLoad");Q.a.addHandler(this.oo,"load",this.Mga)}F8b(wb=null){G.AFrameworkApplication.ta.xsc();if(!this.mr)return e.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";Q.a.addHandler(this.mr,"change",()=>{this.HEh(wb)});X(Object(H.a)(this,this.eXe,"fileInputClick"),1,"DoFileOpenDialog");return this.mr.value}HEh(wb){wb&&wb(this.mr.value)}IEh(){this.pUb&&(this.pUb.innerText=this.Q3e())}idj(wb){Q.a.addHandler(this.mr,"change",()=>{wb(this.Q3e())})}Q3e(){let wb=
null;if(this.mr.value){const Tb=this.mr.value,xb=Tb.lastIndexOf("\\");0<xb&&(wb=Tb.substring(xb+1,Tb.length))}return wb?wb:""}eXe(){try{e.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.mr.click()}catch(wb){throw e.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",wb.message),wb;}}XLj(){this.Qri()?this.Ebg():(this.F1d(),this.ft.submit())}Qri(){return(this.Axg||this.jra)&&!(void 0===window.self.FormData||null===window.self.FormData)}Y1f(wb){if(wb){const Tb=
this.YGe();this.Jg=new XMLHttpRequest;this.Jg.open("POST",Tb);this.Jg.setRequestHeader("X-CorrelationId",this.tE);this.fAi(wb);this.Jg.onreadystatechange=Object(H.a)(this,this.kpa,"uploadResponseReceived");this.Jg.send(wb)}}fAi(wb){if(!n.a.jla&&wb.get){var Tb=wb.get("ImageId");wb=window.self.navigator;Tb={["CorrelationId"]:this.tE,["Canary"]:G.AFrameworkApplication.canary,["ImageNodeId"]:Tb};wb&&(wb=wb.connection?wb.connection:wb.mozConnection?wb.mozConnection:wb.webkitConnection?wb.webkitConnection:
null)&&(Tb.effectiveType=wb.effectiveType,Tb.downlink=wb.downlink,Tb.type=wb.type,Tb.rtt=wb.rtt);e.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",Tb)}}Ebg(){try{this.F1d();e.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");const wb=new (Type.parse("FormData"))(this.ft);this.Y1f(wb)}catch(wb){e.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+wb.message),this.vab(null)}}Dbg(wb){try{if(this.F1d(),
e.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.k1j(wb)){this.qUb=wb;this.ft.contains(this.mr)&&this.ft.removeChild(this.mr);var Tb=new (Type.parse("FormData"))(this.ft);Tb.append("applicationfileInput",wb.blob,wb.filename);this.Y1f(Tb)}else this.vab(null)}catch(xb){e.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+xb.message),this.vab(null)}}k1j(wb){return wb&&void 0!==wb.blob&&null!==wb.blob&&
void 0!==wb.filename&&null!==wb.filename&&""!==wb.filename?void 0===window.self.FormData||null===window.self.FormData?(e.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(wb=wb?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===wb.blob||null===wb.blob,void 0===wb.filename||null===wb.filename||""===wb.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",e.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",
wb)),!1)}kpa(){if(4===this.Jg.readyState)if(200===this.Jg.status){e.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.tE);const wb=this.Jg.getResponseHeader("X-NewKey"),Tb=this.xki(this.Jg);let xb=!1;if(void 0!==wb&&null!==wb&&Tb&&(xb=this.$0j(wb),!this.MUc&&xb)){e.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.tE);this.MUc=!0;void 0!==this.qUb&&
null!==this.qUb?this.Dbg(this.qUb):this.Ebg();return}e.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.MUc,Tb,!(void 0===wb||null===wb),xb,this.tE);this.vab(this.Jg.responseText)}else e.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Jg.status,this.Jg.responseText?!1:!0,this.tE),this.vab(null)}xki(wb){try{const Tb=
N.a(wb.responseText).Responses;if(void 0!==Tb&&null!==Tb&&1===Tb.length){const xb=Tb[0];if(void 0!==xb&&null!==xb&&2===xb.length&&28===xb[1].StatusCode)return!0}}catch(Tb){}return!1}$0j(wb){Ra.a.Phg(wb);return G.AFrameworkApplication.canary!==wb?!1:!0}F1d(){this.NUc||(this.NUc=new Date)}dispose(){this.Lm||(this.jra?this._parent.removeChild(this.ft):(this._parent.removeChild(this.oo),Q.a.removeHandler(this.oo,"load",this.Mga),this.Mga=null),this.wKc&&(Q.a.removeHandler(this.mr,"change",this.wKc),this.wKc=
null),this.fXe&&(this.sjb&&(Q.a.removeHandler(this.mr,"change",this.sjb),this.sjb=null),this.pUb=null),this.mr=this.ft=this._parent=this.oo=null,this.Lm=!0,this.NUc=null,e.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}sch(wb){if(this.ft){var Tb;(Tb=this.ft.querySelector("input[name=__REQUESTDIGEST]"))?Tb.value=wb:(Tb=this.c6c(),Tb.type="hidden",Tb.id="__REQUESTDIGEST",Tb.name="__REQUESTDIGEST",Tb.value=wb,this.ft.appendChild(Tb))}}c6c(){return this.jra?
document.createElement("input"):this.oo.contentWindow.document.createElement("input")}ZEd(){try{if(!this.oo.contentWindow.document.body)return}catch(Tb){this.B9h();return}if(!(this._initialized||this.g$a&&n.a.SF))this.B$c();else if(!this.g$a||!n.a.SF||this.Coi){let Tb;Tb=n.a.Gv?this.oo.contentWindow.document.body.innerText:this.dkg?this.oo.contentWindow.document.body.firstChild.innerText:this.oo.contentWindow.document.body.firstChild.innerHTML;var wb=this.oo.contentWindow.document.body.innerText.toLowerCase();
const xb=0<=wb.indexOf("responses")||0<=wb.indexOf("wopisrc");wb=0<=wb.indexOf("http error");!xb&&wb&&e.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.oo.contentWindow.document.body.innerText);this.vab(Tb)}}B$c(){if(!this._initialized){var wb=this.ga("uploadForm");const Tb=this.ga("fileInput"),xb=this.YGe();this.Xbh();this.ft.id=wb;this.ft.method="post";this.ft.encoding="multipart/form-data";this.ft.action=xb;this.mr.type="file";this.O4d&&(this.mr.accept=
this.O4d,this.L6d&&(this.mr.capture=this.L6d));this.mr.id=Tb;this.mr.name=Tb;this.FPg&&(this.mr.multiple=!0);!this.fXe||n.a.Gv||n.a.ZH||(this.sjb=Object(H.a)(this,this.IEh,"fileInputChangedHandleAccessibility"),Q.a.addHandler(this.mr,"change",this.sjb),this.pUb=va.a.Cue(this.ft,this.mr,"InputFileDescription"));this.H$d&&(this.jra||(wb=this.oo.contentWindow.document.body,wb.style.margin="0",wb.style.overflow="hidden"),wb=G.AFrameworkApplication.ta,this.mr.style.fontFamily=wb.s1,this.mr.style.fontSize=
wb.$Cc,this.mr.style.margin="0");(wb=document.getElementById("__REQUESTDIGEST"))&&this.sch(wb.value);this.ft.appendChild(this.mr);this._initialized=!0;this.dxg(this)}}Xbh(){if(this.jra)this.ft=document.createElement("form"),this._parent.appendChild(this.ft),this.mr=document.createElement("input");else{this.ft=this.oo.contentWindow.document.createElement("form");const wb=this.oo.contentWindow.document;wb.body.appendChild(this.ft);this.mr=wb.createElement("input")}}IQg(){this._parent.appendChild(this.oo);
this.g$a&&n.a.SF&&this.B$c()}YGe(){var wb=new ea.QueryStringBuilder(this.lXe);G.AFrameworkApplication.tZa(wb);this.euj(wb);wb=wb.toString();if(n.a.Jf||n.a.SF||n.a.ZH)wb=la.a.J_e(wb);return wb}jpe(){const wb=new Y.a(2,1,0,Object(H.a)(this,this.delayedDispose,"delayedDispose"),4);G.AFrameworkApplication.Fi.Fg(wb)}}Object(u.a)(Aa,"UploadFrame",null,[2]);var da=a(40),aa=a(116),fa=a(21);class Oa extends Aa{constructor(wb,Tb,xb,cb,jb,qa,za=!1){super(wb,Tb,xb,cb,jb,"UploadFrame",qa.ea.sessionId,"image/*",
!1,null,za);this.$=qa;this.dkg=!0;this.Pef()}ga(wb){return wb}euj(wb){e.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");aa.a.HYc(wb,this.$.va);wb.X9(t.a.sessionId,this.sessionId);var Tb=fa.h(this.$).ha;Tb=da.o(Tb.ra.C4,this.$);wb.X9(t.a.H7i,this.$.xa.oa.name);wb.X9(t.a.G7i,Tb.FirstRow.toString());wb.X9(t.a.F7i,Tb.FirstColumn.toString())}B9h(){this.RYf("ServerUploadError")}vab(wb){this.RYf(wb)}static ymi(wb){return!wb||I.a.equals(wb,"ServerUploadError",!1)}}Object(u.a)(Oa,
"UploadFrameWrapper",Aa,[]);class ba extends S{constructor(wb,Tb,xb,cb){super(wb,!1);this.zQ=null;this.NBa=!1;this.htmlSanitizationHelper=null;this.bpc=()=>{this.S0d("");this.nDc();return!1};this.$=Tb;this.zEc=wb;this.bR=ja.a.instance;this.fa=xb;this.htmlSanitizationHelper=cb;this.H5f();this.god();this.$.rb.uy=!0}G5f(wb,Tb){return new Oa(wb,Object(H.a)(Tb,Tb.dHb,"onUploadFrameInitialized"),Object(H.a)(Tb,Tb.kpa,"uploadResponseReceived"),this.fa,!0,this.$)}dispose(){this.nDc();this.bR=this.zEc=null;
super.dispose()}hide(){super.hide();this.$.rb.uy=!1}validate(){var wb=this.zEc.m2d(this.Tj.rF.value,this.zEc.Mfg(this.Tj));return 0!==wb?(wb=this.zEc.sgd(wb).Description,this.S0d(wb),this.OXd(),!1):!0}isEnabled(){return!0}S0d(wb){E.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&E.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")&&this.htmlSanitizationHelper?this.htmlSanitizationHelper.E3f(this.zQ,wb):this.zQ.innerHTML=wb}god(){this.zQ=
document.getElementById("errorText");this.zQ.style.display="inline-block";this.NBa=!1;this.S0d("");this.oJa.style.maxWidth=this.oJa.currentStyle.minWidth}OXd(){this.bR.sa(J.a.click,this.Tj.rF,this.bpc);this.bR.sa(J.a.Pb,this.Tj.rF,this.bpc);this.NBa=!0}nDc(){this.NBa&&(this.bR.Ba(J.a.click,this.Tj.rF,this.bpc),this.bR.Ba(J.a.Pb,this.Tj.rF,this.bpc),this.NBa=!1)}}Object(u.a)(ba,"InsertImageDialogWrapper",S,[]);var ka=a(51),Pa=a(55),Fa=a(49),oa=a(37);class La extends f.a{constructor(wb,Tb,xb,cb,jb=
!0){super(null,Tb,xb);this.eja=this.Yt=null;this.w8a=!1;this.EGd=null;this.kpa=qa=>{this.c3d.stop();this.L1b.cancel();if(Oa.ymi(qa))this.nCc?this.a$e(4):(qa=new d.a(0,2,null,null,!1,null,null,null),qa.status=8,this.u_d(new h.a(qa),null,"InsertPictureWebMethod")),e.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.nCc}`);else{const za=La.o1j(qa);0!==za?(e.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${qa}`),this.a$e(za)):this.o9h(qa)}this.Mqc();this.dispose()};
this.pPi=qa=>{this.KCa(qa,this.Tj)&&this.finalizeUpload(this.Tj,null)};this.dHb=qa=>{e.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Tj=qa;if(!this.w2a){if(this.N1d){if(this.qAe()||this.g$a&&n.a.SF){qa.F8b(this.pPi);return}const za=qa.F8b(null);if(!this.KCa(za,qa))return}this.finalizeUpload(qa,null)}};this.zYi=()=>{this.nCc=!0};this.jb=wb;this.c3d=wb.Kb.Qg("WebServiceCall","InsertPictureOperation");this.L1b=B.a.instance.create(this.zYi,1E5,z.a.fUg,!1);this.nCc=!1;this.Omc=this.$.va.InsertPictureMaxFileSizeBytes;
cb&&(this.w8a="TestOnly"in cb);jb&&this.showDialog()}get $(){return this.jb}get wEi(){return this.Omc/1024/1024}dispose(){m.a.Ia(this.L1b);this.Tj&&this.Tj.jpe();this.Tj=this.L1b=this.jb=null}qaj(wb){if(!this.$)return e.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),Pa.Task.Ta(!0);if(!this.$.Pba)return Pa.Task.Ta(!0);const Tb=new r.a,xb=new FileReader;wb=wb.rF.files[0];const cb=()=>{Tb.ox(!0)};xb.onload=()=>{this.EGd=xb.result;Tb.ox(!0)};xb.onerror=cb;xb.onabort=cb;
xb.readAsDataURL(wb);return Tb.task}Mfg(wb){let Tb=-1;wb=wb.rF;(null===wb||void 0===wb?0:wb.files)&&0<wb.files.length&&(Tb=wb.files[0].size);return Tb}m2d(wb,Tb){let xb=La.K9g(f.a.KCa(wb));0===xb?-1!==Tb&&(e.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${Tb}, maxAllowedSize: ${this.Omc}, remainingWorkbookSize: ${this.$.ea.$of}`),Tb>this.Omc?xb=3:Tb>this.$.ea.$of&&(xb=7)):6===xb&&this.lCi(wb);e.ULS.sendTraceTag(526399117,0,50,`Validated file on client, validation result: ${xb}`);
return xb}KCa(wb,Tb){wb=this.m2d(wb,this.Mfg(Tb));return 0!==wb?(this.w2a||1===wb||this.qVd(wb),!1):!0}ffg(wb){wb.XLj()}sgd(wb){let Tb=0,xb=1,cb=-1100324317,jb="InsertPictureUnknownError",qa=null;switch(wb){case 1:Tb=1749;xb=0;cb=940870981;jb="InsertPictureNoFileSelected";break;case 3:xb=0;cb=1250467391;jb="InsertPicturePictureTooBig";qa=String.format(L.a.instance.mb(181),this.wEi.toLocaleString());break;case 6:Tb=1753;xb=0;cb=1380041209;jb="InsertPictureUnsupportedFormat";break;case 7:Tb=1750;xb=
0;cb=-903115058;jb="InsertPictureExceedWorkbookSize";break;case 4:Tb=1751;xb=0;cb=1218352119;jb="InsertPictureUploadTimeout";break;case 5:Tb=1752,xb=0,cb=1979899005,jb="InsertPictureServiceNonDeterministicError"}wb=La.$c(Tb,xb,cb,jb);qa&&(wb.Description=qa);return wb}showDialog(){if(this.qAe())this.w2a=!1,this.Tj=new Oa(this.$.domElement,this.dHb,this.kpa,this.fa,!1,this.$,!0);else if(e.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.w8a&&(n.a.Iw||n.a.SF&&72>n.a.yCe))this.w2a=
!1,this.Tj=new Oa(this.$.domElement,this.dHb,this.kpa,this.fa,!1,this.$);else{this.w2a=!0;const wb=E.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&E.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")?Fa.GetServiceTaskFactory.Oa(this.$.da,498,499,0):y.a.Ta(null);oa.TaskExtensions.za(wb,()=>{this.Tj=(new ba(this,this.$,this.fa,wb.result)).Tj},this.$.ka,3)}}o9h(wb){let Tb={};try{if(Tb=v.a.ki(wb),ka.b().PA(this.c3d.id,Tb.ServerCorrelationId,
"actions","ServerActions"),!A.a.dg(Tb.Errors)&&Tb.Result){this.$.ea.DX(Tb.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");const xb=Tb.Result;V.a(this.$).Ona(1,xb);const cb=this.$.da.Aa(277);cb&&cb.zWc(this.$,1,Tb.Result,Tb,"InsertPicture");e.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(xb){e.ULS.sendTraceTag(526399113,0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${wb?wb.length:-1}, errror: ${xb}`)}this.OCc(Tb,
null,"InsertPictureWebMethod")}a$e(wb){wb=this.sgd(wb);const Tb={};Tb.Errors=[wb];this.OCc(Tb,null,"InsertPictureWebMethod")}OCc(wb,Tb,xb){this.Yt(wb,Tb,xb)}u_d(wb,Tb,xb){this.eja(wb,Tb,xb)}qVd(wb){wb=this.sgd(wb);E.EwaSettings.Jz()?new C.a(this.$,wb):(new w.ErrorDialog(this.$,wb)).xg()}lCi(wb){const Tb=this.$.va.InsertPicturUnsupportedExtensionsForLogging;wb=x.a.vl(wb);for(let xb=0;xb<Tb.length;++xb)if(wb.endsWith(Tb[xb])){e.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${Tb[xb]}`);
break}}static o1j(wb){return!wb||I.a.equals(wb,t.a.insertPictureUnknownError,!0)?2:I.a.equals(wb,t.a.insertPictureNoFileSelectedError,!0)?1:I.a.equals(wb,t.a.hhi,!0)?3:I.a.equals(wb,t.a.ihi,!0)?5:0}static $c(wb,Tb,xb,cb){return A.a.$c(1,0,0,wb,Tb,xb,cb)}static K9g(wb){switch(wb){case 1:return 1;case 2:return 6}return 0}qAe(){return this.w8a||void 0===window.self.FormData||null===window.self.FormData?!1:!0}}Object(u.a)(La,"BasePictureUploaderWrapper",f.a,[2]);class Ea extends La{constructor(wb,Tb,
xb,cb,jb,qa=!0){super(wb,Tb,xb,cb,!1);this.NEh=jb;this.jac=wb.Kb.Qg("LoadResource","FileReaderUploaderLoadResource");qa&&this.showDialog()}BFj(){this.Omc=28E5;this.qVd(3)}Fcd(wb){e.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const Tb=new FileReader;wb=wb.rF.files;if(0==wb.length)e.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var xb=wb[0];Tb.onload=()=>{this.jac.stop();this.NEh.UXi(Tb.result,
this);e.ULS.sendTraceTag(526399109,0,50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${xb.type}, Size:${xb.size.toString()}`)};Tb.onerror=()=>{this.jac.stop();e.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${xb.type}, Size:${xb.size.toString()}`)};Tb.onabort=()=>{this.jac.stop();e.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${xb.type}, Size:${xb.size.toString()}`)};
this.jac.start();Tb.readAsDataURL(xb)}}finalizeUpload(wb,Tb){this.Fcd(wb,Tb)}}Object(u.a)(Ea,"FileReaderUploaderWrapper",La,[394]);var ca=a(374),$a=a(188);class Qa{constructor(wb,Tb){this.dataUri=this.sheetName=null;this.sheetName=wb;this.dataUri=Tb}getSheetName(){return this.sheetName}}Object(u.a)(Qa,"MacroRecorderPictureInsertedPayload",null,[108]);class Va extends La{constructor(wb,Tb,xb,cb,jb,qa=!0){super(wb,xb,cb,jb,!1);this.Wd=Tb;qa&&this.showDialog()}Fcd(wb,Tb){super.finalizeUpload(wb,Tb);
ca.a(this.$.userOperationManager,(xb,cb)=>{this.Yt=xb;this.eja=cb;this.c3d.start();this.L1b.tq();this.nCc=!1;this.ffg(wb);return this.qaj(wb)},xb=>{const cb={};this.$.pk(cb);const jb=cb.SheetName;xb=new $a.a(510,0,xb,72,()=>new Qa(jb,this.EGd?this.EGd:""));xb.kBa(()=>!0);xb.Wd=this.Wd;return xb},this.Wd)}finalizeUpload(wb,Tb){this.Fcd(wb,Tb)}}Object(u.a)(Va,"PictureUploaderWrapper",La,[]);class fb{constructor(wb,Tb){this.filename=wb;this.blob=Tb}}Object(u.a)(fb,"UploadBlobParameters",null,[]);class Ka extends Va{constructor(wb,
Tb,xb,cb,jb,qa,za){super(wb,Tb,xb,cb,jb,!1);this.N1d=!1;this.aJ=za;this.cgc=Ka.HKh(qa);wb=this.m2d(this.cgc.name,this.cgc.size);0!==wb?(this.qVd(wb),this.aJ.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Tj=new Oa(this.$.domElement,this.dHb,this.kpa,cb,!1,this.$)}u_d(wb,Tb,xb){super.u_d(wb,Tb,xb);this.aJ.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}OCc(wb,Tb,xb){super.OCc(wb,Tb,xb);A.a.dg(wb.Errors)?
this.aJ.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${A.a.sc(wb.Errors)}`)):this.aJ.setResult(!0)}ffg(wb){const Tb=new fb(this.cgc.name,this.cgc);wb.Dbg(Tb)}static HKh(wb){var Tb=wb.split(",");wb=Tb[0].includes("base64")?window.self.atob(Tb[1]):window.self.decodeURI(Tb[1]);Tb=Tb[0].split(":")[1].split(";")[0];const xb=new Uint8Array(wb.length);for(let cb=0;cb<wb.length;cb++)xb[cb]=wb.charCodeAt(cb);wb=new Blob([xb],{type:Tb});
wb.name="Image.png";return wb}}Object(u.a)(Ka,"DataUrlUploaderWrapper",Va,[]);class hb{constructor(){}Tfi(wb,Tb,xb,cb,jb){new Va(wb,Tb,xb,cb,jb,!0)}Tei(wb,Tb,xb,cb,jb,qa){new Ka(wb,null,Tb,xb,cb,jb,qa)}dfi(wb,Tb,xb,cb,jb){new Ea(wb,Tb,xb,cb,jb,!0)}}Object(u.a)(hb,"UploaderCreator",null,[331]);class fc extends b.a{constructor(wb){super();this.$=wb;this.Fb()}static la(wb){wb.da.Ga(485,new fc(wb))}create(){var wb;this.nb(null!==(wb=this.$.da.Aa(484))&&void 0!==wb?wb:this.$.da.Ga(484,new hb))}}Object(u.a)(fc,
"UploaderCreatorFactory",b.a,[]);a.d(F,"a",function(){return dc});const dc=()=>{c.a.Fa(wb=>{fc.la(wb)})}},1192:function(u,F,a){var c=a(9);u=a(0);var b=a(694),e=a(157),f=a(103),d=a(4),h=a(184),n=a(15),m=a(1362),x=a(30),r=a(98),y=a(82),t=a(557),v=a(171),w=a(40),C=a(374),B=a(188),z=a(283),A=a(29),E=a(282),I=a(11),L=a(13),V=a(281),T=a(104),H=a(21),D=a(146),G=a(87),J=a(96),M=a(164),Q=a(181),U=a(88),Z=a(154),P=a(348),S=a(1),ja=a(1240),X=a(80);class Y extends ja.a{constructor(ka,Pa){super(ka,X.a.dba(Pa))}Ytc(ka,
Pa){this.isEnabled()&&this.vGa(this.targetOrigin)&&(this.so(ka),this.dm(ka,Pa))}}Object(u.a)(Y,"InsertMediaCrossDocumentMessenger",ja.a,[395,119,2]);var va=a(7);class N{}Object(u.a)(N,"OnlineMediaSearchResult",null,[]);var ea=a(317);class Ca extends D.a{constructor(ka,Pa,Fa,oa,La,Ea){super();this.zic=!1;this.wDb=this.NR=this.Xwa=null;this.kMi=()=>{this.Zua(this.e0a)};this.Pud=ca=>{ca.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==ca.target.id||ca.shiftKey?"KeepFocusStartDiv"===ca.target.id&&ca.shiftKey&&
(ca.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(ca.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};this.uTi=()=>{this.dpb&&(this.dpb.launchUpsellExperience("stockimages"),n.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.Pl=Ea;this.$=ka;this.fff=Pa;this.dpb=Fa;this.UAa=[];this.cvf=oa;this.wlh=La;this.wte=this.$.va.InsertOnlinePictureMaxCountOfImagesToInsert;this.qg=this.Gch()}aGj(ka){this.zic=!1;this.showDialog(this.Pl,
null);this.Xwa=document.getElementById(this.li("InsertMediaFrame"));if(!this.Xwa)throw this.Zua(this.e0a),Error.invalidOperation("Couldn't get InsertMediaIframe.");var Pa=document.getElementById(this.li("WACDialogPanel"));Pa&&Pa.setAttribute(G.a.Ld,G.a.v_a);Pa=document.createElement("div");Pa.id="KeepFocusStartDiv";Pa.tabIndex=0;Pa.className="keep-focus-start";this.Xwa.parentNode.insertBefore(Pa,this.Xwa.parentNode.firstChild);Pa=document.createElement("div");Pa.id="KeepFocusDiv";Pa.tabIndex=0;Pa.className=
"keep-focus";this.Xwa.parentNode.appendChild(Pa);$addHandler(this.oJa,"keydown",this.Pud);this.Xwa.src=this.fff;this.Xwa.frameBorder="0";Pa=document.getElementById(this.li("WACDialogButtonPanel"));if(!Pa)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");Pa.className="display-none";Pa=document.getElementById(this.li("WACDialogTitleText"));if(!Pa)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");Pa.className="display-none";2===this.cvf&&(document.getElementById(this.li("WACDialogTitlePanel")).className=
"display-none",document.getElementById(this.li("WACDialogBodyPanel")).className="padding-zero");J.FocusManager.instance().MQ().scope.MN=!0;this.NR=new Y(this.Xwa.contentWindow,this.fff);this.NR.Ytc(M.a.bIg,Fa=>{this.bLi(Fa,ka.kpa)});this.NR.Ytc(M.a.insert,()=>{this.HSi(ka.kpa)});this.NR.Ytc(M.a.a1c,this.kMi);2===this.cvf&&0===this.wlh&&(this.NR.Ytc(M.a.Mwi,this.uTi),this.wDb=this.dpb.kna("MsoPremiumStockImages",Fa=>{n.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");
Fa.isEnabled?this.NR.Rj(M.a.n_j,{["LicenseTier"]:Fa.toString()}):n.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))}dispose(){this.UAa=null;this.dpb&&this.wDb&&this.dpb.CLd("MsoPremiumStockImages",this.wDb);this.NR&&(this.NR.dispose(),this.NR=null);super.dispose()}hide(){super.hide();U.a.kyc(this.$)}get D4(){return Q.a.a8b+"/InsertMediaDialog"}get VY(){return!1}bLi(ka,Pa){ka=ka&&ka.Values?(ka=ka.Values)?Object(va.a)(new N,{Action:ka.action||
"",Caption:ka.caption||"",ContentType:ka.contentType||"",FileExtension:ka.extension||"",PageUrl:ka.pageUrl||"",SourceUrl:ka.sourceUrl||"",ThumbnailUrl:ka.thumbnailUrl||"",LicenseUrl:ka.licenseUrl||"",LicenseDisplayName:ka.licenseDisplayName||"",Height:ka.height||0,Width:ka.width||0}):null:null;ka&&(this.UAa.push(ka),this.zic&&(n.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),Pa(this.UAa),this.zic=!1,this.Zua(this.e0a)))}HSi(ka){this.UAa&&0<this.UAa.length?
this.UAa.length<=this.wte?(ka(this.UAa),this.Zua(this.e0a)):(this.gA(),n.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.UAa.length=0):this.zic=!0}Gch(){const ka=document.createElement("div");ka.id="InsertMediaDialog";ka.className=S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const Pa=document.createElement("div");Pa.id="InsertMediaPanel";
Pa.className=S.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",!0)?"insert-media-panel":"insert-media-panel-old";const Fa=document.createElement("iframe");Fa.id="InsertMediaFrame";Fa.className="insert-media-frame";ka.appendChild(Pa);Pa.appendChild(Fa);return ea.b(ka)}gA(){const ka=A.a.$c(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");ka.Description=String.format(L.a.instance.mb(206),this.wte.toLocaleString());S.EwaSettings.Jz()?new P.a(this.$,
ka):(new Z.ErrorDialog(this.$,ka)).xg()}}Object(u.a)(Ca,"InsertMediaDialog",D.a,[]);var la=a(380),Ra=a(288);class lb extends m.a{constructor(ka,Pa,Fa,oa,La,Ea){super(null,Fa,oa);this.Dsf=0;this.kpa=ca=>{if(ca){var $a=Array(ca.length);for(var Qa=0;Qa<ca.length;Qa++){const Ka=ca[Qa];$a[Qa]={};$a[Qa].SourceUrl=Ka.SourceUrl;x.a.zxa(Ka.LicenseUrl)&&x.a.zxa(Ka.PageUrl)&&($a[Qa].LicenseUrl=Ka.LicenseUrl,$a[Qa].LicenseDisplayName=Ka.LicenseDisplayName,$a[Qa].PageUrl=Ka.PageUrl);$a[Qa].AltText=-2053056795===
this.Wd.command?Ka.Caption:""}var Va=-2009825598===this.Wd.command?"bing":"M365";Qa=H.h(this.$);var fb=w.o(Qa.ha.ra.activeCell,this.$);C.a(this.$.userOperationManager,(Ka,hb,fc)=>z.s(this.$.pa.ya,fb,$a,Va,V.b(Ka,this.cVi),V.a(hb,this.bVi),fc,null),Ka=>new B.a(595,0,Ka),this.Wd);I.HelperMethods.v_?(Qa=new Map,Qa.set("MediaProvider",Va),Qa.set("ImagesCount",ca.length.toString()),Qa.set("TimeTakenToOpenDialog",this.Dsf.toString()),r.Health.instance.recordKpiUsage(Ra.a.ehi,1,la.a.adg,Qa)):n.ULS.sendTraceTag(537155805,
0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.Mqc()}else n.ULS.sendTraceTag(537155806,0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};this.cVi=ca=>{E.a(ca)?n.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${A.a.sc(ca.Errors)}`):(n.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),ca.Result?
T.a(this.$).Ona(1,ca.Result):n.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};this.bVi=()=>{n.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};this.$=ka;this.Wd=Pa;this.aJ=Ea;this.jue=y.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let ka=null;ka=this.$.Kb.Bc("UserAction","showOnlineImagesDialogTimeStopwatch");
switch(this.Wd.command){case -2009825598:this.kFj();break;case -2053056795:this.jue.execute(Pa=>{Pa.isFeatureEnabled("MsoPremiumStockImages",!1).catch(Fa=>n.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${Fa}`)).then(Fa=>{this.lFj(Fa);return null})})}ka.stop();this.Dsf=ka.Ac}kFj(){let ka=this.$.va.BingPictureEndpoint;const Pa=t.a.uK(d.AFrameworkApplication.lcid),Fa=v.a.create();ka?(ka=0<ka.search(RegExp("insertmedia.bing.office.net",
"gi"))?String.format(ka,1,1):String.format(ka,1,d.AFrameworkApplication.lcid,Pa?Pa.name:"en-us",d.AFrameworkApplication.buildVersion,Fa.toString(),1,this.$.va.DocumentHostInfo.LoggableUserId),this.X5b(ka,1,-1,L.a.instance.ga(1755))):(n.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),this.aJ.setException(Error.create("Failed to access the Bing service endpoint")))}lFj(ka){var Pa=this.$.va.M365PictureEndpoint,Fa=v.a.create();
if(Pa){var oa=this.$.va.DocumentHostInfo.UserId;oa=oa?x.a.mw(oa).toString():"0";var La=this.jue.instance.isFreemiumUpsellEnabled();ka=ka?1:La?0:-1;Fa=Fa.toString();La=t.a.uK(d.AFrameworkApplication.lcid).name;Pa=String.format(Pa,d.AFrameworkApplication.lcid,La,d.AFrameworkApplication.buildVersion,Fa,1,oa,ka,1);this.X5b(Pa,2,ka,L.a.instance.ga(1754))}else n.ULS.sendTraceTag(537155803,0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.aJ.setException(Error.create("Failed to access the M365 service endpoint"))}X5b(ka,
Pa,Fa,oa){try{(new Ca(this.$,ka,y.a.instance.Lh("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),Pa,Fa,oa)).aGj(this),this.aJ.setResult(!0)}catch(La){n.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${La}] [MediaProvider : ${Pa}] [DialogLicenseTier : ${Fa}]`),this.aJ.setException(La)}}}Object(u.a)(lb,"OnlinePictureUploaderWrapper",m.a,[2]);var Aa=a(55);class da{constructor(ka,Pa){this.$=ka;this.uploaderCreator=Pa}executeCommand(ka,
Pa,Fa){ka=Pa.command;switch(ka){case 1403967063:if(Fa&&"dataUrl"in Fa)return Pa=new e.a,this.uploaderCreator&&this.uploaderCreator.Tei(this.$,f.a.instance,d.AFrameworkApplication.fa,Fa,Fa.dataUrl,Pa),Pa.task;this.uploaderCreator&&this.uploaderCreator.Tfi(this.$,Pa,f.a.instance,d.AFrameworkApplication.fa,Fa);return Aa.Task.Ta(!0);case -2053056795:case -2009825598:return ka=new e.a,new lb(this.$,Pa,f.a.instance,d.AFrameworkApplication.fa,Fa,ka),ka.task;default:return h.a(ka)}}wc(ka,Pa){if(ka=this.$.isEditMode)switch(Pa.command){case 1403967063:ka=
!0;break;case -2053056795:ka=!0;break;case -2009825598:ka=!0;break;default:ka=!1}return ka}Kc(){return!1}nc(){return!1}}Object(u.a)(da,"PictureCommandHandler",null,[208]);var aa=a(37),fa=a(49);class Oa extends b.a{constructor(ka){super(ka)}ld(){aa.TaskExtensions.za(fa.GetServiceTaskFactory.Oa(this.$.da,484,485,1),ka=>{this.Zc([new da(this.$,ka.result)])},this.$.ka,3)}static la(ka){b.a.Nd(90,new Oa(ka))}}Object(u.a)(Oa,"PictureCommandHandlerFactory",b.a,[]);a.d(F,"a",function(){return ba});const ba=
()=>{c.a.Fa(ka=>{Oa.la(ka)})}},1217:function(u,F,a){var c=a(9);u=a(0);var b=a(222),e=a(15),f=a(513),d=a(38),h=a(4),n=a(60);class m{}m.Lgd="GetFontPreviewData";Object(u.a)(m,"FontWebServiceMethods",null,[]);const x=(I,L,V,T,H=null)=>{const D=m.Lgd;H=I.Na(5,H);H.locale=h.AFrameworkApplication.uiCulture;return n.g(I,D,H,L,V,T,null,644)};var r=a(11),y=a(1),t=a(42),v=a(116),w=a(29);const C={xlyellow:"xlyellow"};class B extends d.a{constructor(I,L){super();this.$=I;this.xv=L;this.nva={};this.VO={};this.Ove=
!1;this.styles=null;this.RPi=(V,T,H)=>{e.ULS.sendTraceTag(520710152,1,50,`FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: ${H} has succeeded.`);this.h5i(V);this.Ove=!0;e.ULS.sendTraceTag(512340116,1,50,"FontServiceManager.onFontPreviewRequestComplete: timeFromAppInteractive to fonts download {0} ms",t.PageLoadTrackingInfo.instance.gwa(new Date));this.$8i()};this.SPi=(V,T,H)=>{V=v.a.Pe(V.data);V=w.a.sc(V);e.ULS.sendTraceTag(520710151,1,10,`FontServiceManager.onFontPreviewRequestFailed: Encountered errors: ${V} for method: ${H}`)};
this.Xkj=()=>{this.rl&&this.Lgd(this.RPi,this.SPi)};this.rl=y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);this.Xkj()}h5i(I){if(this.Tti(I)){var L=r.HelperMethods.t6(()=>{const V=I.Result;this.styles=`@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url('${V.PreviewUrl}') format('truetype')}`;const T=V.FontFacePropertiesList;let H,D,G;V.FontNameList.forEach((J,M)=>{this.nva[J]=T[M].Codepoint;let Q=`https://fs.microsoft.com/fs/${V.CatalogVersion}/rawguids/${T[M].FontGuid}`;
this.styles=this.Bue(this.styles,J,Q,T[M].FontWeight);this.VO[J]=T[M].LocalizedFontName;"Segoe UI Semibold"===J&&(H=T[M].FontFamily,D=Q,G=T[M].FontWeight)});H&&(this.styles=this.Bue(this.styles,H,D,G));f.a.Ni(this.styles)});10<L&&e.ULS.sendTraceTag(520710159,1,50,`FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration=${L}`)}}Tti(I){if(!I.Result)return e.ULS.sendTraceTag(520710158,1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),
!1;I=I.Result;return I?I.PreviewUrl?I.FontFacePropertiesList?I.FontNameList?0===I.FontFacePropertiesList.length||I.FontFacePropertiesList.length!==I.FontNameList.length?(e.ULS.sendTraceTag(520710153,1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):!0:(e.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710155,
1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),!1)}Bue(I,L,V,T){return I+`@font-face{font-family:"${L}";src:url('${V}');font-weight:${T};}`}Lgd(I,L){return x(this.xv,I,L,null,this.xv.Wb())}$8i(){this.gic&&
this.raiseEvent(B.fZe)}get oBc(){return this.VO}get nIh(){return this.nva}get gic(){return this.Ove}isFontSupported(I){return this.rl&&this.VO&&(!!this.VO[I]||!!C[I.replace(/\s/g,"").toLowerCase()])}Pre(I){this.addHandler(B.fZe,I)}}B.fZe="fsmFD";Object(u.a)(B,"FontServiceManager",d.a,[312]);var z=a(697);class A extends b.a{constructor(I){super();this.$=I;this.Fb()}static la(I){I.da.Ga(505,new A(I))}create(){this.nb(Object(z.a)(this.$.da,504,()=>new B(this.$,this.$.pa.xv)))}}Object(u.a)(A,"FontServiceManagerFactory",
b.a,[]);a.d(F,"a",function(){return E});const E=()=>{c.a.Fa(I=>{A.la(I)})}},1254:function(u,F,a){u=a(0);var c=a(108),b=a(222),e=a(15),f=a(14),d=a(38),h=a(174),n=a(92),m=a(1),x=a(21),r=a(5);class y extends d.a{constructor(B,z,A){super();this.statusBarManager=null;this.qMe=()=>{this.l8b()};this.$lh=()=>{this.l8b()};this.pMe=E=>{10===E&&this.l8b()};this.onKeyDown=E=>13===E.Ca.keyCode?(E=new n.a(237279923,1,2,6,null),this.$.Ja.Lb(E,{[r.a.skipClipboardAccess]:!0,[r.a.oQe]:!0}),!0):!1;this.$=B;this.Go=
z;this.Gm=A;this.P$c=!1;(this.U7f=m.EwaSettings.getBooleanFeatureGate(h.a.FQa,!1))&&this.$.da.$a(29,E=>{this.statusBarManager=E;E.HJ(this)})}dispose(){this.gk();this.Gm=this.Go=this.$=null;this.statusBarManager&&(this.statusBarManager.jG(this),this.statusBarManager=null)}Fn(){return this.U7f}ps(B,z){if("QueryPasteShortcutEnabledLabel"!==B&&!y.lLj.includes(B))return!1;const A=this.Fo();"QueryPasteShortcutEnabledLabel"===B?(z.Visible=A,e.ULS.sendTraceTag(537167636,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${A} for commandId ${B}`)):
(z.Visible=!A,e.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!A} for commandId ${B}`));return!0}Rqh(){this.Nj();this.raiseEvent("pasteShortcutStatusChanged")}l8b(){this.gk();this.raiseEvent("pasteShortcutStatusChanged")}Fo(){return this.P$c}Jq(B){this.addHandler("pasteShortcutStatusChanged",B)}dr(B){this.removeHandler("pasteShortcutStatusChanged",B)}Nj(){if(!this.Fo()){this.P$c=!0;x.h(this.$).zi.Yk(this.qMe);this.Gm.la("blur",this.$lh);const B=this.$.da.Aa(65);
B&&B.C3&&B.C3.registerForCommentEvents(this.pMe);this.Go.Ps(f.a.Pb,this.$.ru,this.onKeyDown,!0)}}gk(){if(this.Fo()){this.P$c=!1;x.h(this.$).zi.Gk(this.qMe);this.Gm.detach("blur");const B=this.$.da.Aa(65);B&&B.C3&&B.C3.unregisterForCommentEvents(this.pMe);this.Go.Ws(f.a.Pb,this.$.ru,this.onKeyDown,!0)}}}y.lLj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(u.a)(y,"PasteShortcutManager",d.a,[341,281,185,2]);var t=a(127);class v extends b.a{constructor(B){super();this.$=B;this.Fb()}create(){const B=
this.$;this.nb(B.da.Aa(478)||this.$.da.Ga(478,new y(B,c.KeyInputManager.instance,t.a.instance.sH())))}static la(B){B.da.Ga(479,new v(B))}}Object(u.a)(v,"PasteShortcutManagerFactory",b.a,[]);var w=a(9);a.d(F,"a",function(){return C});const C=()=>{w.a.Fa(B=>{v.la(B)})}},1255:function(u,F,a){var c=a(9);u=a(0);var b=a(108),e=a(222),f=a(127),d=a(7),h=a(15),n=a(4),m=a(1400),x=a(14),r=a(5),y=a(902),t=a(47),v=a(28),w=a(21),C=a(1),B=a(40),z=a(66),A=a(346),E=a(37),I=a(49),L=a(33);class V{constructor(D,G,J,
M){this.recoveryUI=null;this.gfg=(Q="Paste")=>{var U=z.d(this.$.xa.oa);U=new A.a(this.pasteRange,U);this.D_d(U,Q)};this.gjg=()=>{this.recoveryUI&&(this.Q2d=v.a.Qa.we.m,this.hide(),t.a.instance.create(()=>{this.YYj()},250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};this.EMe=Q=>{10===Q&&this.pua()};this.rmh=()=>{if(this.recoveryUI){const Q=document.getElementById("PasteRecoveryUI");Q&&r.a.Ak===Q.getAttribute(r.a.OY)&&Q.click();this.documentHidden=!0;this.pua()}};this.FMe=()=>{this.pua()};
this.GMe=()=>{this.pua()};this.onKeyUp=Q=>{if(this.recoveryUI){if(this.O_)return!1;if(17===Q.Ca.keyCode&&this.N$b){Q=document.getElementById("PasteRecoveryUI");if(!Q)return h.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),!1;const U=Q.getAttribute(r.a.OY)||"";if(r.a.xr===U)return Q.click(),!0}}return!1};this.onKeyDown=Q=>{if(this.recoveryUI){this.N$b=!1;this.O_=Q.ctrlKey;Q=Q.Ca.keyCode;if(27===Q)return this.pua(),C.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&
(Q=this.$.da.Aa(254))&&Q.Ar("RecoveryUIController.onKeyDown",!0,!0).catch(()=>{}),!0;if(17===Q)return this.N$b=!0}return!1};this.ZN=(Q,U)=>{this.NCb=Q=U.Wd;if(C.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)){switch(Q.command){case -1027730316:case -1059615499:if(U.properties&&U.properties.launcherId===this.k4e())return;break;case -847286761:if(U.properties&&(13===U.properties.CalloutName||18===U.properties.CalloutName))return}this.pua()}else-1027730316!==
Q.command&&-1059615499!==Q.command?this.pua():(U=U.properties)&&U.launcherId!==this.k4e()&&this.pua()};this.$=D;this.utc=G;this.Go=J;this.Gm=M;this.dlc=this.NCb=this.Xud=null;this.O_=this.N$b=this.q8b=this.vfc=!1;this.Q2d=0;this.documentHidden=!1;this.grid=w.h(this.$);this.pasteRange=null;C.EwaSettings.ml()||this.$.da.Ga(406,this)}dispose(){this.$gg();this.fhg();this.dlc=this.Xud=this.recoveryUI=this.Gm=this.Go=this.utc=this.$=null;this.Q2d=0}GUg(D){this.recoveryUI=D;this.Xud=D.AOg;this.dlc=D.xbj}pua(){this.recoveryUI&&
(this.pasteRange=B.K(this.recoveryUI.oWe),this.ZIj(),this.hide(),this.$gg(),this.recoveryUI=null)}ZIj(){const D=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761];n.AFrameworkApplication.Ip("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");C.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&
(h.ULS.sendTraceTag(523622037,0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),null!=this.NCb&&D.includes(this.NCb.command)?(h.ULS.sendTraceTag(526758984,306,50,`RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was ${y.a[this.NCb.command]}`),this.NCb=null):C.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.PasteCoOccurence",!1)?h.ULS.sendTraceTag(509723927,306,50,"RecoveryUIController:smartViewOnPaste Format as table prompt already triggered with the paste recovery UI."):
this.documentHidden?(h.ULS.sendTraceTag(523833603,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),this.documentHidden=!1):this.N$a(()=>{this.gfg("Paste")}))}KV(){return this.grid.Da.HN(4,this.$.oa)}N$a(D){if(this.KV())D();else{h.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state.");const G=()=>{this.KV()&&(D(),this.grid.Fcb(G))};this.grid.HZa(G)}}Oqi(){return!!this.recoveryUI&&
this.utc.Omi}WGj(D){n.AFrameworkApplication.Ip("XLS-SmartView-PasteCoOccurence-Treatment;XLS-SmartView-PasteCoOccurence-Control");L.a.ssi()&&(this.pasteRange=B.K(this.recoveryUI.oWe),this.N$a(()=>{this.gfg("PasteCoOccurence")}));this.recoveryUI?this.show(D):h.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")}k4e(){return this.recoveryUI?this.recoveryUI.cxi:null}show(D){const G=this.recoveryUI.jSh();G?(this.utc.showFloatie(Object(d.a)(new m.a,{x:G.x,y:G.y}),
this.recoveryUI.bLa(),D),this.Nj()):h.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")}hide(){this.Oqi()&&this.utc.kD();this.fhg()}Nj(){if(!this.q8b){var D=w.h(this.$);D.view.ot(this.gjg);D.zi.Yk(this.FMe);this.Gm.la("blur",this.rmh);this.$.Ja.osa(this.ZN);this.$.xa.Xf(this.GMe);(D=this.$.da.Aa(65))&&D.C3&&D.C3.registerForCommentEvents(this.EMe);this.q8b=!0}this.vfc||(this.Go.Ps(x.a.Pb,this.$.domElement,this.onKeyDown,!0),this.Go.Ps(x.a.Fd,this.$.domElement,this.onKeyUp,
!0),this.vfc=!0)}$gg(){if(this.q8b){var D=w.h(this.$);D.view.er(this.gjg);D.zi.Gk(this.FMe);this.Gm.detach("blur");this.$.Ja.yAa(this.ZN);this.$.xa.Eg(this.GMe);(D=this.$.da.Aa(65))&&D.C3&&D.C3.unregisterForCommentEvents(this.EMe);this.q8b=!1}}fhg(){this.vfc&&(this.Go.Ws(x.a.Pb,this.$.domElement,this.onKeyDown,!0),this.Go.Ws(x.a.Fd,this.$.domElement,this.onKeyUp,!0),this.vfc=this.O_=this.N$b=!1)}YYj(){this.recoveryUI&&250<=v.a.Qa.we.m-this.Q2d&&this.show(-1)}D_d(D,G){E.TaskExtensions.za(I.GetServiceTaskFactory.Oa(this.$.da,
426,427,1),J=>{void J.result.Nea(D,G);h.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.ka,3)}}Object(u.a)(V,"RecoveryUIController",null,[220,2]);class T extends e.a{constructor(D){super();this.$=D;this.Fb()}create(){if(C.EwaSettings.ml())this.uIi();else{const D=this.$;D.ky(G=>{G.ogc().then(J=>{this.nb(this.$.da.Aa(406)||new V(D,J,b.KeyInputManager.instance,f.a.instance.sH()))})})}}uIi(){const D=this.$;
let G=this.$.da.Aa(406);G?this.nb(G):D.ky(J=>{J.ogc().then(M=>{G=new V(D,M,b.KeyInputManager.instance,f.a.instance.sH());this.$.da.Ga(406,G);this.nb(G)})})}static la(D){D.da.Ga(405,new T(D))}}Object(u.a)(T,"RecoveryUIControllerFactory",e.a,[]);a.d(F,"a",function(){return H});const H=()=>{c.a.Fa(D=>{T.la(D)})}},1265:function(u,F,a){u=a(0);var c=a(58),b=a(15),e=a(252);class f{constructor(m,x){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=
null;this.reqTotalDurationMs=0;this.browserResourceTiming=null;this.testIteration=0;this.testName=m;this.caller=x;this.reset()}reset(){this.isSuccess=!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null}}Object(u.a)(f,"NetworkTestResult",null,[]);var d=a(581);class h{constructor(m,x,r,y,t){this.url="";this.B6a=!1;this.h8=-1;this.testIteration=0;this.baseUrl=r;this.JAf=y;this.Emd=x;this.result=new f(x,t)}runTest(){try{if(this.B6a)return b.ULS.sendTraceTag(537155206,
0,50,`NetworkTestReq.RunTest: a test for the host ${this.Emd} is already mid way, not starting a new one.`),!1;this.reset();this.B6a=!0;this.result.startTimeMs=Date.now();const m=new e.QueryStringBuilder(this.baseUrl);m.X9("tid",this.result.startTimeMs.toString());this.url=m.toString();this.Yrj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(m){return this.zvb("Exeption: "+m.message),!1}}reset(){this.url="";this.result.reset();this.B6a=!1;this.h8=-1}clearTimeout(){-1!==
this.h8&&(window.clearTimeout(this.h8),this.h8=-1)}Yrj(){try{const m=new XMLHttpRequest;m.onreadystatechange=()=>{4===m.readyState&&(200===m.status?this.DGh():this.zvb(`Error when downloading resource. status code: ${m.status}, status text: ${m.statusText}`,m.status.toString()))};m.onerror=()=>{this.zvb(`Client error when attempting to download resource. status code: ${m.status}, response: ${m.statusText}`)};this.h8=window.setTimeout(()=>{this.h8=-1;this.zvb("Request timeout")},1E4);m.open("GET",
this.url,!0);m.send(null)}catch(m){this.zvb("Exeption: "+m.message)}}DGh(){this.B6a&&(this.result.reqTotalDurationMs=Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=d.a(this.url),this.result.isSuccess=!0,this.U4b())}zvb(m,x=null){this.B6a&&(this.clearTimeout(),this.result.errorMessage=m,this.result.isSuccess=!1,this.result.errorStatusCode=x,this.U4b())}U4b(){this.B6a=!1;this.JAf&&this.JAf(this.result,this.Emd)}}Object(u.a)(h,"NetworkTestReq",null,[]);a.d(F,
"a",function(){return n});class n{static Jed(m,x,r,y=null){n.Inc||(n.Inc=Array.isArray(c.a.ki(r.va.NetworkMeasurementUrlList))?c.a.ki(r.va.NetworkMeasurementUrlList):null);const t=[];for(let v=0;v<n.Inc.length;v++){const w=n.Inc[v];let C=w.key;C||(C=w.Key);if(y&&!y.includes(C))continue;let B=w.value;B||(B=w.Value);C&&B&&t.push(new h(r,C,B,m,x))}return t}}n.Inc=null;Object(u.a)(n,"NetworkConnectionHelpers",null,[])},1362:function(u,F,a){u=a(0);var c=a(15),b=a(84);a(107);var e=a(27);class f{constructor(y,
t,v){this.Tj=this.YEd=null;this.CFa=this.G9=0;this.rUb=null;this.aT=y;this.he=t;this.ob=v;this.w2a=!1;this.N1d=!0;this.Qlj();this.g$a=this.fa.qa("NativeFileOpenDialogIsEnabled")}get context(){return this.aT}get fa(){return this.ob}get retryCount(){return this.G9}get OOd(){return this.CFa}dHb(y){this.Tj=y;if(!this.w2a){if(this.N1d){if(this.g$a&&e.a.SF){this.rUb=y.F8b(Object(b.a)(this,this.iDd,"onFileChosen"));return}this.rUb=y.F8b(null);if(!this.KCa(this.rUb,y))return}this.finalizeUpload(y,null)}}iDd(y){if(this.KCa(y,
this.Tj)){if(e.a.SF||e.a.Jf)this.rUb=y;this.finalizeUpload(this.Tj,null)}}Mqc(){this.YEd&&this.YEd()}Qlj(){this.G9=0;this.CFa=this.fa.rd("Box4UploadRetryDelayStart",200);this.Tj&&(this.Tj.dispose(),this.Tj=null)}}Object(u.a)(f,"FileUploader",null,[]);var d=a(4),h=a(322),n=a(785),m=a(134),x=a(30);a.d(F,"a",function(){return r});class r extends f{constructor(y,t,v){super(y,t,v);this.WWb=this.Tra=null}get UO(){return d.AFrameworkApplication.ta.lE}w2e(y){switch(y){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;
case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}Tkg(y){return r.KCa(y,this.G4h())}G4h(){return r.Yme}KCa(y,t=null){y=this.Tkg(y);return 0!==y?(t&&t.jpe(),2===y&&this.vj(0,this.w2e(y)),!1):!0}finalizeUpload(y,t){c.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.YEd=t;this.iGj();h.a.mark(5576);this.WWb=this.UO.Bc("LoadResource","PictureUploadTime")}vj(y,t){const v=new m.StandardDialog;v.Rb=0;v.gA(y,CommonUIStrings.l_ImageUploadFailedTitle,t,null)}Mqc(){c.ULS.sendTraceTag(36783361,
322,50,"PictureUploader.OnUploadComplete");super.Mqc();this.WWb&&(this.WWb.stop(),this.WWb=null);this.J4g()}iGj(){this.Tra=(new n.a).create();this.Tra.message=CommonUIStrings.l_ImageUploadWait;this.Tra.Rb=5;this.Tra.Lt=!1;this.Tra.BBa(null,null,null)}J4g(){this.Tra&&(this.Tra.close(),this.Tra=null)}static L$h(y,t){y=x.a.vl(y);for(let v=0;v<t.length;++v)if(y.endsWith(t[v]))return!0;return!1}static KCa(y,t=null){t||(t=r.Yme);return y?r.L$h(y,t)?0:2:1}}r.Yme=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");
Object(u.a)(r,"PictureUploader",f,[])},1434:function(u,F,a){a.r(F);var c=a(1155),b=a(0),e=a(15),f=a(4),d=a(119),h=a(400);class n extends h.a{constructor(bc){super(bc)}get M5b(){return!1}createElement(){const bc=document.createElement("link");bc.setAttribute("rel","stylesheet");bc.setAttribute("type","text/css");bc.setAttribute("href",this.Vt);return bc}Y5c(){return null}iuc(){this.element.setAttribute("href","");this.element.setAttribute("href",this.aA.Vt)}}Object(b.a)(n,"CssResource",h.a,[]);var m=
a(377),x=a(228),r=a(30),y=a(55);class t{constructor(){this.bXb=this.wUb=null}jyi(){this.wUb||(e.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.wUb=y.Task.WAA(t.oyi(),t.gyi()),this.wUb.continueWith(bc=>{e.ULS.sendTraceTag(21030599,324,10,"{0}",r.a.tgd(bc.exception))},5));return this.wUb}lyi(){if(!this.bXb)try{e.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.bXb=y.Task.WAA(t.u$c(x.a.create(f.AFrameworkApplication.fa.Xa("DimeUrl"),
null,null))),this.bXb.continueWith(bc=>{e.ULS.sendTraceTag(39978391,324,10,"{0}",r.a.tgd(bc.exception))},5)}catch(bc){e.ULS.sendTraceTag(594874951,324,10,"{0}",r.a.tgd(bc))}return this.bXb}static oyi(){var bc=t.Zdc("inproductmessaging.js");bc=x.a.create(bc,null,null);return t.u$c(bc)}static gyi(){var bc=t.Zdc("inproductmessaging.css");bc=new n(bc);return t.u$c(bc)}static Zdc(bc){return d.a.R4b(String.format("ipm/{0}",bc))}static u$c(bc){m.a.Uia(bc);return bc.q9a}}Object(b.a)(t,"DependencyDownloader",
null,[603]);class v{}v.i0i="inProductMessagingOverlayDiv";v.a3i="PlayButtonImage";v.Ojj="ReplayButtonImage";Object(b.a)(v,"Constants",null,[]);class w{constructor(){this.Oke=this.jfe=this.O5d=!0;this.Pjj=this.b3i=null;this.wHi=!1;this.locale=null;this.wgg={}}get fxe(){return this.O5d}set fxe(bc){this.O5d=bc}get Nvf(){return this.jfe}set Nvf(bc){this.jfe=bc}get W8f(){return this.Oke}set W8f(bc){(this.Oke=bc)&&this.Fxj()}Fxj(){this.Aqe(v.a3i,this.b3i);this.Aqe(v.Ojj,this.Pjj)}Aqe(bc,Qc){Qc&&(this.wgg[bc]=
Qc)}}Object(b.a)(w,"FirstRunExperienceUISettings",null,[602]);class C{constructor(){this.completed=this.qej=!1}}Object(b.a)(C,"FirstRunExperienceViewData",null,[600]);var B=a(84),z=a(176),A=a(106),E=a(25);class I{constructor(bc,Qc,pd){this.La=bc;this.ef=Qc;this.$Ub=pd}Ig(){this.La.Ne(E.a.$Gh,A.a.frame,Object(B.a)(this,this.YGh,"firstRunExperienceHandler"),64);this.La.Nb(E.a.qYe,A.a.frame,Object(B.a)(this,this.Dci,"inProductMessagingTabHandler"));this.La.Nb(E.a.pYe,A.a.frame,Object(B.a)(this,this.Cci,
"inProductMessagingShiftTabHandler"));this.La.Nb(E.a.Nlh,A.a.frame,Object(B.a)(this,this.Olh,"dimeLaunchHandler"));this.La.Nb(E.a.gXf,A.a.frame,z.ActionManager.rg);this.La.Nb(E.a.mkj,A.a.frame,z.ActionManager.rg);this.La.Nb(E.a.nkj,A.a.frame,z.ActionManager.rg);this.ef&&this.ef.updateCommandUI()}YGh(bc,Qc,pd,ce,ke){2===pd&&this.$Ub.Kwi(ke);return 32}Olh(bc,Qc,pd,ce,ke){2===pd&&this.$Ub.Hwi(ke);return 32}Dci(bc,Qc,pd){return 2===pd?this.$Ub.Szd():32}Cci(bc,Qc,pd){return 2===pd?this.$Ub.Qzd():32}}Object(b.a)(I,
"InProductMessagingActor",null,[]);var L=a(83);class V{constructor(){this.JTf=this.IYf=this.Ocg=this.tlc=this.instance=null}}Object(b.a)(V,"DimeExperienceUISettings",null,[]);var T=a(137),H=a(467);class D{constructor(bc,Qc,pd,ce,ke){this.jbc=!1;this.Otb=null;this.La=bc;this.XFa=Qc;this.DXb=pd;this.J1=ce;this.bHc=ke}sfi(bc){T.b("getHeaderApi")?bc.isFeatureEnabled("MsoPremiumBadge",!0).then(Qc=>{const pd=bc.isFreemiumUpsellEnabled();pd&&(appChrome.getHeaderApi().then(ce=>{ce.updatePremiumStatus(Qc,
pd);return null}),bc.kna("MsoPremiumBadge",ce=>{appChrome.getHeaderApi().then(ke=>{ke.updatePremiumStatus(ce.isEnabled,pd);return null})}));return null}):e.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")}Kwi(bc){this.DXb.jyi().continueWith(()=>{this.XFa.xHj(bc)})}Hwi(bc){let Qc="gopremium",pd=null,ce=()=>{};bc?(bc.experience&&""!==Object(L.a)(String,bc.experience)&&(Qc=Object(L.a)(String,bc.experience)),bc.onTaskComplete&&(ce=bc.onTaskComplete),bc.campaignId&&""!==Object(L.a)(String,
bc.campaignId)&&(pd=Object(L.a)(String,bc.campaignId))):e.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience");this.vpf(Qc,ce,pd)}vpf(bc,Qc,pd=null){if(this.jbc&&this.Otb){const ce={};ce.experience=bc||"gopremium";ce.campaignId=pd||H.b(this.J1,this.bHc,Object(L.a)(String,ce.experience),!0);this.La.processAction(E.a.gXf,2);e.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+ce.experience);try{const ke=Object.assign(new V,{instance:this.Otb,tlc:ce,Ocg:Qc||
(()=>{}),IYf:Oe=>{e.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+Oe.status)},JTf:()=>{e.ULS.sendTraceTag(51675406,324,10,"Dime launch error");this.jbc=!1;this.Otb=null}});this.XFa.MFj(ke)}catch(ke){e.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+ke.message),this.jbc=!1,this.Otb=null,this.La.Zd(E.a.kbc,2,{["experience"]:ce.experience})}}else e.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this.La.Zd(E.a.kbc,2,{["experience"]:bc})}jqf(){this.DXb.lyi().continueWith(()=>
{try{var bc=r.a.vl(f.AFrameworkApplication.uiCulture);const ce=H.c(this.J1);if(ce){var Qc={};Qc.partnerId=ce;Qc.language=bc;Qc.sessionId=f.AFrameworkApplication.userSessionId;Qc.authHint=f.AFrameworkApplication.fa.Xa("UserPrincipalName");var pd=f.AFrameworkApplication.fa.Xa("Puid")||"";""!==pd&&(bc={},bc.puid=pd,Qc.userInfo=bc);this.Otb=new Dime(Qc);this.jbc=!0;e.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else e.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(ce){e.ULS.sendTraceTag(51675410,
324,10,"FreemiumUpsellDialogDependencies failed: "+ce.message)}},3)}Szd(){return this.XFa.Szd()}Qzd(){return this.XFa.Qzd()}}Object(b.a)(D,"InProductMessagingUIManager",null,[601]);class G{constructor(){this.nme=0;this.EXa=Array(5);this.EXa[0]=10;this.EXa[1]=15;this.EXa[2]=50;this.EXa[3]=100;this.EXa[4]=200}Init(bc){this.nme=bc}SendTrace(bc,Qc){e.ULS.sendTraceTag(34182235,this.nme,this.EXa[bc],"{0}",Qc)}}Object(b.a)(G,"DefaultNetworkingManager",null,[622]);var J=a(260),M=a(318),Q=a(96);class U{constructor(bc){this.Yb=
bc}xHj(bc){bc&&(InProductMessaging.Networking.NetworkingMgr=new G,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(bc.W8f,bc.Nvf,bc.fxe,bc.wHi,bc.locale,Object(B.a)(this,this.vOi,"onDismissFirstRunExperience"),bc.wgg),this.QSa(v.i0i,!0))}MFj(bc){if(bc&&bc.instance&&bc.tlc){let Qc=document.getElementById("wacDimeContainer");Qc||(Qc=document.createElement("div"),Qc.id="wacDimeContainer",document.body.appendChild(Qc));f.AFrameworkApplication.fa.qa("DimeFocusManagerIsEnabled")&&
this.QSa("wacDimeContainer",!1);bc.tlc.parentElementId="wacDimeContainer";bc.instance.launch(bc.tlc,bc.Ocg).then(pd=>{this.OJb();document.body.removeChild(Qc);bc.IYf(pd)}).catch(pd=>{this.OJb();document.body.removeChild(Qc);bc.JTf(pd)})}else throw Error.argument("DimeExperienceUISettings");}QSa(bc,Qc){if(this.Yb&&bc&&(bc=document.getElementById(bc),this.kfi(bc),bc=this.Yb.pN("InProductMessagingFocusId"))){const pd=this.Yb.hi;pd&&"InProductMessagingFocusId"===pd.name||this.Yb.QR("InProductMessagingFocusId",
!1);Qc&&this.RRf(bc.scope)}}kfi(bc){var Qc=this.Yb.Bi("InProductMessagingFocusId");Qc.parent=J.AFrame.YT;const pd=new M.DOMFocusListing(()=>bc);pd.rcb=!1;pd.to(3);pd.to(2);pd.to(4);Qc=this.Yb.Tsa(()=>bc,Qc,pd);Qc.FJb();Qc.S_=!0;Qc.tIa=!0}RRf(bc){bc.Ik(Q.FocusManager.instance().x2);bc.Ik(Q.FocusManager.instance().y2);bc.bindAction(Q.FocusManager.instance().x2,E.a.qYe);bc.bindAction(Q.FocusManager.instance().y2,E.a.pYe)}OJb(){this.Yb&&(this.Yb.lda("InProductMessagingFocusId"),this.Yb.rRa("InProductMessagingFocusId"))}vOi(bc,
Qc){this.OJb();bc=Object.assign(new C,{completed:bc,qej:Qc});f.AFrameworkApplication.ub.Zd(E.a.XGh,2,bc)}Szd(){const bc=document.activeElement,Qc=this.Yb.MQ();return bc&&Qc&&Qc.jf&&bc===Qc.jf.Mw?(Qc.jf.Ml(bc),Qc.Lya()?32:8):4}Qzd(){const bc=document.activeElement,Qc=this.Yb.MQ();return bc&&Qc&&Qc.jf&&bc===Qc.jf.firstElement?(Qc.jf.Ml(bc),Qc.hPa()?32:8):4}}Object(b.a)(U,"InProductMessagingUIWrapper",null,[599]);var Z=a(135),P=a(248),S=a(27);class ja{constructor(){this.gb=null}get name(){return"Common.App.InProductMessaging"}Xh(bc){bc.register(t,
"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").xc().Fc(()=>new t);bc.register(U,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").xc().Fc(()=>new U(Q.FocusManager.instance()));bc.register(D,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").xc().Fc(()=>new D(f.AFrameworkApplication.ub,bc.resolve("Common.IInProductMessagingUIWrapper"),
bc.resolve("Common.App.InProductMessaging.IDependencyDownloader"),f.AFrameworkApplication.ta.Pa.Hj,f.AFrameworkApplication.ta.Pa.B6));bc.register(I,"Common.App.InProductMessaging.InProductMessagingActor").xc().Fc(()=>new I(f.AFrameworkApplication.ub,f.AFrameworkApplication.ta,bc.resolve("Common.IInProductMessagingUIManager")));bc.register(w,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").xc().Fc(()=>new w);bc.register(C,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").xc().Fc(()=>
new C);this.gb=bc}init(){this.gb.resolve("Common.App.InProductMessaging.InProductMessagingActor").Ig();f.AFrameworkApplication.fa.Ev(()=>{f.AFrameworkApplication.ta.Pa.Gs&&Z.a.get_instance().$j(15,()=>{this.gb.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(bc=>{this.gb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").sfi(bc)})});f.AFrameworkApplication.fa.qa("FreemiumUpsellShowDialogIsEnabled")&&H.a()&&!S.a.jla&&1!==f.AFrameworkApplication.ta.Pa.Hj&&
this.gb.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(bc=>{bc.isFeatureEnabled("MsoPremiumBadge",!0).then(Qc=>{!Qc&&bc.isFreemiumUpsellEnabled()&&this.gb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").jqf();return null})})})}dispose(){}static main(){P.a.instance.Ei(new ja)}}Object(b.a)(ja,"InProductMessagingPackage",null,[3,4]);var X=a(187),Y=a(41);class va{constructor(bc,Qc,pd,ce=null,ke=null){this.dw=bc;this.Mjb=Qc;this.Ijb=pd;this.Ghe=ce;this.Rlb=
ke}G$b(bc){const Qc=new Sys.StringBuilder(this.dw.lLb);Qc.append("RoamingServiceHandler.ashx?action=");Qc.append("getFirstRunExperienceSettings");Qc.append("&");Qc.append(this.vid(bc));Qc.append("&");Qc.append(f.AFrameworkApplication.Hi);f.AFrameworkApplication.zd.Pm(Qc.toString(),1,null,null,!0,2,Object(B.a)(this,this.fka,"getRequestSuccessCallback"),Object(B.a)(this,this.K4,"getRequestFailureCallback"),null)}y3a(bc){var Qc=new Sys.StringBuilder(this.dw.lLb);Qc.append("RoamingServiceHandler.ashx?action=");
Qc.append("saveFirstRunExperienceSettings");Qc.append("&");Qc.append(f.AFrameworkApplication.Hi);Qc=Qc.toString();bc=Y.c(bc);f.AFrameworkApplication.zd.Pm(Qc,2,bc,null,!0,4,Object(B.a)(this,this.A4i,"postRequestSuccessCallback"),Object(B.a)(this,this.yW,"postRequestFailureCallback"),null)}fka(bc){let Qc=!1,pd=null;try{if(0<bc.data.ve.length){const ce=Object(L.a)(Object,Y.a(bc.data.ve)),ke=ce?ce[this.dw.CYc]:null;ke&&(pd=Object(L.a)(Object,Y.a(ke.toString())))}Qc=!0}catch(ce){this.K4(null)}Qc&&this.Mjb&&
this.Mjb(bc.data,pd)}K4(bc){this.Ijb&&this.Ijb(bc?bc.data:null)}A4i(bc){this.Ghe&&this.Ghe(bc?bc.data:null)}yW(bc){this.Rlb&&this.Rlb(bc?bc.data:null)}vid(bc){const Qc=new Sys.StringBuilder("requestedsettings=");for(let pd=0;pd<bc.count;pd++)Qc.append(bc.na(pd)),pd<bc.count-1&&Qc.append(";");return Qc.toString()}}Object(b.a)(va,"FirstRunExperienceRequestHandler",null,[]);var N=a(232),ea=a(82);class Ca{constructor(){this.zjb=this.xUb=this.dw=null}kVd(bc){bc?(this.dw=bc,this.Roi()&&(e.ULS.sendTraceTag(51675532,
306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),bc=new X.a,bc.add(this.dw.CYc),this.xUb=new va(this.dw,Object(B.a)(this,this.fka,"getRequestSuccessCallback"),Object(B.a)(this,this.K4,"getRequestFailureCallback"),null,Object(B.a)(this,this.yW,"postRequestFailureCallback")),this.xUb.G$b(bc)),(this.dw.w8a||f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.lVd()):e.ULS.sendTraceTag(51675531,306,
10,"Invalid launcherSettings")}Roi(){try{if(this.dw.w8a)return!0;if(!f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",!0)||f.AFrameworkApplication.fa.qa("IsAnonymousUser"))return!1;if(this.dw.Eli||this.dw.y8a||f.AFrameworkApplication.fa.qa("IsO365ConsumerHost"))return!0;const bc=f.AFrameworkApplication.fa.Xa("FlightId");return-1!==(bc?bc.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(bc){e.ULS.sendTraceTag(576582624,306,
10,"Error checking setting {0}",bc?bc.toString():null)}return!1}Q_f(bc){const Qc={},pd={};pd.FREDisplayedDate=(new Date).toUTCString();pd.VersionDisplayed=bc;pd.RemindMeLater=!1;Qc[this.dw.CYc]=Y.c(pd);e.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.xUb&&this.xUb.y3a(Qc)}fka(bc,Qc){bc=bc?+bc.E3-+bc.MF:-1;bc>this.dw.FZf?e.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",
bc,this.dw.FZf):Qc?this.zEj(Qc)?(e.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",this.dw.Evf),this.lVd()):(this.P8c(!1),e.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(e.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.lVd())}K4(bc){this.P8c(!1);
e.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",bc?bc.httpStatus:-1)}yW(bc){e.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",bc?bc.httpStatus:-1)}lVd(){this.P8c(!0);var bc=ea.a.instance.Lh("Common.ISystemInitiatedFeedback");bc?this.J8f(bc):(e.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",
!0)&&((bc=ea.a.instance.Ub("Common.ISystemInitiatedFeedback"))?bc.execute(Qc=>{this.J8f(Qc)}):e.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))}J8f(bc){if(bc){var Qc=this.dw.mHh;Qc&&(f.AFrameworkApplication.oya(Qc),f.AFrameworkApplication.Ip(Qc));e.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Qc);bc.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.zjb=Object(B.a)(this,this.yPi,"onFirstRunExperienceCampaignEvent"),
window.addEventListener("FGWebSurfaceEvent",this.zjb,!0),window.addEventListener("FRELaunchedEvent",this.zjb,!0)):(e.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),this.Q_f(this.dw.currentVersion))}else e.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")}yPi(bc){if(bc){var Qc=bc.detail;bc=bc.type;var pd=this.dw&&this.dw.campaignId?this.dw.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===bc||pd&&Qc&&Qc.id&&-1!==Qc.id.indexOf(pd))Qc.success&&
(e.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.Q_f(this.dw.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",this.zjb,!0),window.removeEventListener("FRELaunchedEvent",this.zjb,!0))}}zEj(bc){if("RemindMeLater"in bc&&"FREDisplayedDate"in bc){if("true"===bc.RemindMeLater.toString()&&(+new Date-+new Date(bc.FREDisplayedDate.toString()))/36E5>this.dw.Evf)return!0}else if(f.AFrameworkApplication.fa.qa("WacShowVersionBasedFREToAllUsers")&&
"VersionDisplayed"in bc&&bc.VersionDisplayed<this.dw.currentVersion)return e.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),!0;return!1}P8c(bc){f.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")&&N.a.dispatch("FREDecisionEvent",{["show"]:bc})}}Object(b.a)(Ca,"FirstRunExperienceLauncher",null,[582]);class la{constructor(){this.gb=null}get name(){return"Common.App.FirstRunExperienceLauncher"}Xh(bc){this.gb=
bc;this.gb.register(582,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").xc().Fc(()=>new Ca)}init(){}dispose(){}static main(){P.a.instance.Ei(new la)}}Object(b.a)(la,"FirstRunExperienceLauncherPackage",null,[3,4]);var Ra=a(1112),lb=a(1113),Aa=a(1138),da=a(1254),aa=a(9),fa=a(222);class Oa{constructor(bc){this.$=bc}get CYc(){return"Excel"}get campaignId(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}get version(){return 1}get currentVersion(){return 0}get Eli(){return this.isEnabled()&&
this.$.ma(331)}get y8a(){return this.isEnabled()&&this.$.ma(333)}get w8a(){return this.$.ma(332)}get mHh(){return null}get Evf(){return 24}get FZf(){return 4E3}get lLb(){return this.$.va.WebServiceBase||""}isEnabled(){if(f.AFrameworkApplication.fa?f.AFrameworkApplication.fa.qa("IsAnonymousUser"):1)return!1;const bc=f.AFrameworkApplication.Qb?Object(L.a)(String,f.AFrameworkApplication.Qb.AudienceGroup):"";return"Unknown"!==bc&&"Automation"!==bc}}Object(b.a)(Oa,"FirstRunExperienceLauncherSettings",
null,[597]);class ba{constructor(bc,Qc){this.rYe=bc;this.ZGh=Qc}kVd(){this.rYe&&this.rYe.kVd(this.ZGh)}}Object(b.a)(ba,"FirstRunExperienceManager",null,[593]);var ka=a(697);class Pa extends fa.a{constructor(bc){super();this.$=bc;this.Fb()}create(){const bc=Object(ka.a)(this.$.da,311,()=>this.Rbh());this.nb(bc)}Rbh(){var bc=new Oa(this.$);bc=new ba(ea.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),bc);bc.kVd();return bc}static la(bc){bc.da.Ga(312,new Pa(bc))}}
Object(b.a)(Pa,"FirstRunExperienceManagerFactory",fa.a,[]);var Fa=a(59);class oa extends fa.a{constructor(bc){super();this.ynd=null;this.$=bc;this.Fb()}create(){const bc=Object(ka.a)(this.$.da,361,()=>this.Ech());this.nb(bc)}Ech(){this.ynd=ea.a.instance.Lh("Common.IInProductMessagingUIManager");Fa.a.Bg.Gs?Z.a.get_instance().$j(16,()=>{this.Sef()}):this.Sef();return this.ynd}Sef(){ea.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(bc=>{bc.isFeatureEnabled("MsoPremiumBadge",
!0).then(Qc=>{!Qc&&bc.isFreemiumUpsellEnabled()&&this.ynd.jqf();return null})})}static la(bc){bc.da.Ga(362,new oa(bc))}}Object(b.a)(oa,"InProductMessagingManagerFactory",fa.a,[]);var La=a(1192),Ea=a(1115),ca=a(47),$a=a(419),Qa=a(78),Va=a(1),fb=a(530),Ka=a(21),hb=a(575);class fc extends fb.a{constructor(bc){super(1);this.Vfa=!1;this.$zf=()=>{this.refresh()};this.aAf=()=>{this.refresh()};this.gridView=Ka.h(bc);this.gridView.Vb.Yk(this.aAf);this.gridView.Vb.Rm(this.$zf);this.refresh()}get sI(){return this.enc(this.Vfa)}XSd(bc){this.Vfa!==
bc&&(this.Vfa=bc,this.QIb())}get name(){return hb.a.cellEdit}dispose(){this.gridView.Vb.Gk(this.aAf);this.gridView.Vb.em(this.$zf);this.gridView=null;super.dispose()}QIb(){this.tJd(this.Vfa)}refresh(){this.XSd(!this.gridView.eb)}}Object(b.a)(fc,"CellEditSafeStatePublisher",fb.a,[]);var dc=a(38),wb=a(109);class Tb{constructor(bc,Qc){this.handler=null;this.publisher=bc;this.sI=Qc}}Object(b.a)(Tb,"SafeStatePublisherState",null,[]);var xb=a(610);const cb=bc=>bc?`${bc.Current} / ${bc.Pending} @${bc.SuspensionStartTimestamp}`:
null,jb=bc=>(null===bc||void 0===bc?void 0:bc.SuspensionStartTimestamp)&&bc.Pending>bc.Current;class qa extends dc.a{constructor(bc,Qc){super();this.bpf=null;this.Z8a=!1;this.wGb=(pd,ce)=>{3===ce.qvf&&this.Z8a&&e.ULS.sendTraceTag(520480204,0,15,"ClientStateMonitor.onMergeDidntOccur: Aborted merge occurred after another aborted merge.");this.Z8a=!0;this.Rbb()};this.fSa=new X.a;this.Hya=bc;this.Uma=Qc;this.CAb=Va.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);
this.e8a=Va.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.CAb&&(this.Uma.LZa(this.mza.bind(this)),this.e8a?this.Hya.Fre(this.wGb):this.Hya.rMg(this.UEf.bind(this)))}get DVj(){return wb.f(wb.c(this.fSa.toArray(),bc=>0!=bc.sI),bc=>bc.publisher.name)}t0b(bc){this.addHandler(qa.eSa,bc)}bvc(bc){this.removeHandler(qa.eSa,bc)}uAa(bc,Qc){const pd=new Tb(bc,Qc);this.fSa.add(pd);Qc=(ce,ke)=>{pd.sI=ke.sI;this.Rbb()};bc.t0b(Qc);pd.handler=Qc;this.Rbb()}x0d(bc){let Qc=
null;for(let pd of this.fSa)if(pd.publisher===bc){this.vhg(pd);Qc=pd;break}Qc&&(this.fSa.remove(Qc),this.Rbb())}dispose(){for(let bc of this.fSa)this.vhg(bc);this.fSa.clear();this.CAb&&(this.Uma.Icb(this.mza.bind(this)),this.e8a?this.Hya.PVf(this.wGb):this.Hya.Bhj(this.UEf.bind(this)));super.dispose()}Jbc(){let bc=gb.Jbc(this.fSa.toArray().map(Qc=>Qc.sI));return this.Z8a&&1===bc?2:bc}vhg(bc){bc.publisher.bvc(bc.handler)}Rbb(){const bc=this.Jbc();bc!==this.bpf&&(this.raiseEvent(qa.eSa,new xb.a(bc)),
this.bpf=bc)}UEf(){this.Z8a&&e.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");this.Z8a=!0;this.Rbb()}mza(bc,Qc){bc=Qc.Bca;(Qc=!jb(bc))||(Qc=this.cwi,Qc=(null===bc||void 0===bc?void 0:bc.SuspensionStartTimestamp)!==(null===Qc||void 0===Qc?void 0:Qc.SuspensionStartTimestamp));Qc&&(this.Z8a=!1);this.cwi=bc;this.Rbb()}}qa.eSa="SSC";Object(b.a)(qa,"ClientStateMonitor",dc.a,[]);var za=a(6),Na=a(70);class ua extends fb.a{constructor(bc,
Qc=null){super(1);this.Vfa=!1;this.bO=()=>{this.refresh()};this.eBf=()=>{this.refresh()};this.$=bc;this.Gae=Qc||Na.a(bc).KQ(za.a.idle);Na.a(bc).eXc(this.eBf);this.r6a.Jq(this.bO);this.refresh()}get sI(){return this.enc(this.Vfa)}XSd(bc){bc!==this.Vfa&&(this.Vfa=bc,this.QIb())}get name(){return hb.a.r6a}get r6a(){return this.Gae}dispose(){Na.a(this.$).Huc(this.eBf);this.r6a.dr(this.bO);this.Gae=null;super.dispose()}QIb(){this.tJd(this.Vfa)}refresh(){this.XSd(1===this.r6a.zu||Na.a(this.$).gi===this.r6a)}}
Object(b.a)(ua,"IdleActivitySafeStatePublisher",fb.a,[]);var Xa=a(319),ha=a(3),ta=a(22);class wa extends Qa.a{constructor(){super()}nc(){return!1}executeCommand(){return y.Task.Ta(!0)}wc(bc,Qc){return 1905775613===Qc.command}Kc(){return!1}}Object(b.a)(wa,"ToggleMergeSuspensionSafeState",Qa.a,[208]);class db extends dc.a{constructor(bc,Qc){super();this.statusBarManager=null;this.VAd=!1;this.mza=(pd,ce)=>{pd=`${ce.Bca.Current===ce.Bca.Pending?"\u26ad":"\u26ae"}${ce.Bca.Current}`;ta.a.equals(this.Lnc,
pd,!1)||(this.Lnc=pd,this.Pz())};this.RPa=(pd,ce)=>{pd=0==ce.sI;this.VAd!==pd&&(this.VAd=pd,this.Pz())};this.mergeSuspensionManager=Qc;this.mergeSuspensionManager.Uma.LZa(this.mza);this.Lnc="";Xa.a.V9(1905775613,ha.a.lc,0,1);this.Ja=bc.Ja;this.EPb=new wa;bc.da.$a(29,pd=>{this.mergeSuspensionManager&&(this.statusBarManager=pd,pd.HJ(this),this.mergeSuspensionManager.$ha.t0b(this.RPa))});this.Ja.N2(this.EPb)}Jq(bc){this.addHandler(db.uzd,bc)}dr(bc){this.removeHandler(db.uzd,bc)}Pz(){this.raiseEvent(db.uzd)}Fn(bc){return bc===
db.P7i&&!!this.mergeSuspensionManager}ps(bc,Qc){if(!this.Fn(bc))return!1;this.mergeSuspensionManager&&(Qc.LabelText=this.Lnc,Qc.On=this.VAd);return!0}dispose(){this.EPb&&(this.Ja.ucb(this.EPb),this.EPb.dispose(),this.EPb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.Uma.Icb(this.mza),this.mergeSuspensionManager.$ha.bvc(this.RPa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.jG(this),this.statusBarManager=null);this.Lnc=null;super.dispose()}}db.uzd=
"MSMSC";db.P7i="QueryMergeSuspensionStatus";Object(b.a)(db,"MergeSuspensionIndicatorManager",dc.a,[281,185,2]);var Jb=a(7),Pb=a(877);class eb extends Sys.EventArgs{constructor(bc){super();this.Exa=bc}}Object(b.a)(eb,"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);class Ma{}Object(b.a)(Ma,"SuspensionState",null,[]);class ob extends Ma{constructor(bc){super();this.ute=!1;this.ute=bc}}Object(b.a)(ob,"ReadyForPendingMergeState",Ma,[]);const Ia=new Ma,Da=new Ma,nb=new ob(!1),Ua=new ob(!0);
var W=a(878);class sa extends W.a{constructor(bc,Qc,pd){super(bc);this.GPg=Qc;this.gIj=pd}}Object(b.a)(sa,"ReadyForPendingMergesUpdatedEventArgs",W.a,[]);class vb extends dc.a{constructor(bc,Qc,pd){super();this.mza=(ce,ke)=>{ce=this.getState();const Oe=this.Y_;this.Y_=ke.Bca;ke=this.getState();this.dBi(ce,ke,Oe);this.raiseEvent(vb.pzd);this.bYe(ce,ke)};this.RPa=(ce,ke)=>{ce=this.getState();this.sI=ke.sI;ke=this.getState();this.bYe(ce,ke)};this.wGb=(ce,ke)=>{this.e8a&&4===ke.qvf&&(e.ULS.sendTraceTag(520480203,
0,50,"MergeSuspensionStateHandler.onMergeDidntOccur: Retry DoPendingMerge after bailout. Current merge counter: {0}, Response merge counter: {1}",cb(this.Y_),cb(ke.Y_)),this.oQf(this.getState(),!0))};this.CAb=Va.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.e8a=Va.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.$ha=bc;this.$ha.t0b(this.RPa);this.Uma=Qc;this.Uma.LZa(this.mza);this.e8a&&(this.Hya=pd,this.Hya.Fre(this.wGb));
this.Y_=Object(Jb.a)(new Pb.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});this.sI=this.Idi()}Idi(){return Object($a.a)(qa,this.$ha)?Object(L.a)(qa,this.$ha).Jbc():1}y0b(bc){this.addHandler(vb.GZd,bc)}fvc(bc){this.removeHandler(vb.GZd,bc)}dNg(bc){this.addHandler(vb.dKd,bc)}dij(bc){this.removeHandler(vb.dKd,bc)}qMg(bc){this.addHandler(vb.pzd,bc)}Ahj(bc){this.removeHandler(vb.pzd,bc)}M9i(){this.qJd(this.getState()===Da)}dispose(){this.$ha.bvc(this.RPa);this.$ha=null;this.Uma.Icb(this.mza);this.Uma=
null;this.e8a&&(this.Hya.PVf(this.wGb),this.Hya=null);super.dispose()}Dhd(){return Object(Jb.a)(new Pb.a,{Current:this.Y_.Current,Pending:this.Y_.Pending,SuspensionStartTimestamp:this.Y_.SuspensionStartTimestamp})}getState(){return jb(this.Y_)?0==this.sI?Ua:this.CAb&&1==this.sI?nb:Da:Ia}bYe(bc,Qc){bc!==Qc&&(Qc===Da?this.qJd(!0):bc===Da&&this.qJd(!1));this.oQf(Qc)}oQf(bc,Qc=!1){bc instanceof ob&&this.raiseEvent(vb.dKd,new sa(this.Y_,bc.ute||!this.CAb,Qc))}dBi(bc,Qc,pd){bc===Ia&&Qc!==Ia?(bc=Qc===Da,
Qc=Qc===nb,e.ULS.sendTraceTag(252760283,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: ${Qc} publisher: ${Qc||bc?this.$ha.DVj.join(","):""} counter: ${cb(this.Y_)} isBlockingAllMerges: ${bc}`)):bc!==Ia&&Qc===Ia&&e.ULS.sendTraceTag(252760284,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: ${cb(pd)}`)}qJd(bc){this.raiseEvent(vb.GZd,new eb(bc))}}vb.GZd="TPMBBC";vb.dKd="RFPMU";vb.pzd="MCC";Object(b.a)(vb,
"MergeSuspensionStateHandler",dc.a,[]);class gc extends dc.a{constructor(bc){super();this.l2=null;this.Zkc=0;this.BEb=(Qc,pd)=>{(null===pd||void 0===pd?0:pd.Bca)&&this.MPa(pd.Bca,gc.f3d)};this.Mxc=()=>{this.wYf();this.eQf(this.l2,gc.Hlj)};this.T$a=(Qc,pd)=>{pd.Vrb&&this.l2.SuspensionStartTimestamp&&e.ULS.sendTraceTag(17318084,0,50,`PendingMergeMonitor.OnEditCellEnded: committed with counter ${cb(this.l2)}`)};this.wYf();this.$=bc;this.$.ea.Wj(this.Mxc);this.$.ea.zM(this.Mxc);Ka.h(this.$).Vb.Rm(this.T$a);
this.$.da.$a(292,Qc=>{Qc.LZa(this.BEb);e.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")})}LZa(bc){this.addHandler("MCU",bc)}Icb(bc){this.removeHandler("MCU",bc)}get Y_(){return this.l2}MPa(bc,Qc=""){const pd=this.l2.Current<bc.Current||this.l2.Pending<bc.Pending;if(bc.SuspensionStartTimestamp&&this.Zkc!==bc.SuspensionStartTimestamp){if(this.Zkc>bc.SuspensionStartTimestamp){pd&&e.ULS.sendTraceTag(553736149,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via ${Qc}. S: ${gc.AEb(bc)}, C: ${gc.AEb(this.l2)}`);
return}pd||e.ULS.sendTraceTag(553736148,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: ${gc.AEb(bc)}, C: ${gc.AEb(this.l2)}`)}else if(!pd)return;this.l2=bc;this.eQf(bc,Qc)}dispose(){this.$.ea.tk(this.Mxc);this.$.ea.YR(this.Mxc);Ka.h(this.$).Vb.em(this.T$a);const bc=this.$.da.Aa(292);bc&&bc.Icb(this.BEb);super.dispose()}eQf(bc,Qc=""){jb(bc)&&bc.SuspensionStartTimestamp>this.Zkc&&(e.ULS.sendTraceTag(537155416,0,50,`PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: ${cb(bc)}, Origin: ${Qc}`),
this.Zkc=bc.SuspensionStartTimestamp);this.raiseEvent("MCU",new W.a(bc))}wYf(){e.ULS.sendTraceTag(588276808,0,50,`PendingMergeMonitor.ResetMergeCounter : Last counter was ${gc.AEb(this.l2)}`);this.l2=Object(Jb.a)(new Pb.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})}static AEb(bc){return bc?`(${bc.Current}/${bc.Pending} @${bc.SuspensionStartTimestamp})`:"null"}}gc.f3d="PMM.RTC";gc.d9b="PMM.EwaResult";gc.Hlj="PMM.resetMergeCounter";Object(b.a)(gc,"PendingMergeMonitor",dc.a,[]);class Bc{}Object(b.a)(Bc,
"ClientRevisions",null,[]);var Sa=a(46),na=a(60);const ib=(bc,Qc,pd,ce,ke,Oe,Fe,Xe=null)=>{Xe=bc.Na(1,Xe);Xe.viewportState=Qc;Xe.allowViewAdjustment=pd;return na.g(bc,"DoPendingMerge",Xe,ce,ke,Oe,Fe,0)},Ib=(bc,Qc,pd,ce,ke,Oe,Fe=null)=>{Fe=bc.Na(1,Fe);Fe.suspensionStartTimestamp=Qc;return na.g(bc,"KeepBlockingPendingMerges",Fe,pd,ce,ke,Oe,0)};class ec extends dc.a{constructor(bc,Qc,pd,ce){super();this.wJa=null;this.BCb=0;this.CCb=this.O8a=null;this.EGf=(ke,Oe)=>{this.wJa.dTg(Oe.Bca,Oe.GPg,Oe.gIj)};
this.$Gb=(ke,Oe)=>{Oe.Exa?this.vKj():this.WAc()};this.TEf=()=>{this.BCb=0};this.N1f=()=>{const ke=this.u6.Dhd();Ib(this.ya,null!=ke.SuspensionStartTimestamp?ke.SuspensionStartTimestamp:0,null,()=>{this.gTi(ke)},null,null,this.ya.Wb())};this.TCa=(ke,Oe)=>{if(Oe){Oe.Tob.MergeCount=this.u6.Dhd();let Fe;({min:ke,max:Fe}=Ka.h(this.$).gGi());Va.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?Oe.Tob.ClientRevisions=Object(Jb.a)(new Bc,{Min:ke,Max:Fe,MaxFromBlockCache:Ka.h(this.$).Da.Quf}):
Oe.Tob.ClientRevisions=Object(Jb.a)(new Bc,{Min:ke,Max:Fe})}};this.$=bc;this.C_a=pd;this.u6=Qc;this.u6.dNg(this.EGf);this.u6.y0b(this.$Gb);this.u6.qMg(this.TEf);this.$.pa.iha(this.TCa);this.ya=this.$.pa.ya;this.MNd=this.$.va.MergeSuspensionRequestThrottlingTimeInMs;this.vvi=this.$.va.KeepBlockingPendingMergesRequestIntervalMs;this.wJa=ce;e.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")}dispose(){this.$.pa.vna(this.TCa);this.WAc();this.u6.dij(this.EGf);this.u6.fvc(this.$Gb);this.u6.Ahj(this.TEf);
this.u6=null;super.dispose()}vKj(){this.WAc();if(this.cMe()){const bc=this.u6.Dhd();e.ULS.sendTraceTag(537155414,0,50,`RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter ${cb(bc)} fail count: ${this.BCb}`)}else this.CCb=this.C_a.create(this.N1f,this.MNd,Sa.a.CCb),this.O8a=this.C_a.cD(this.N1f,this.vvi,Sa.a.O8a)}WAc(){this.O8a&&(this.CCb.cancel(),this.O8a.cancel(),this.O8a=this.CCb=null)}gTi(bc){let Qc;
Qc=" fail count: "+this.BCb;this.BCb++;this.cMe()&&this.WAc();e.ULS.sendTraceTag(542229773,0,10,`RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed ${cb(bc)}${Qc}`)}cMe(){return this.BCb>ec.NEi}}ec.NEi=5;Object(b.a)(ec,"RequestController",dc.a,[]);var qb=a(157),Ha=a(197),Ab=a(28),Yb=a(281);class Bb extends Sys.EventArgs{constructor(bc,Qc){super();this.qvf=bc;this.Y_=Qc}}Object(b.a)(Bb,"MergeDidntOccurEventArgs",Sys.EventArgs,[]);class Qb extends dc.a{constructor(bc,Qc,pd=null,
ce=null,ke=null){super();this.Ykc=null;this.eFd=0;this.documentVisibilityObserver=null;this.rof=!1;this.cnc=null;this.ya=bc;this.MNd=Qc.va.MergeSuspensionRequestThrottlingTimeInMs;const Oe=Qc.va.GetRangeContentPrefetchDelayForMergeInMs;this.My=()=>{Qc.w0f(Oe)};this.Ph=pd||Ab.a.Qa;this.wkg=0;this.PL=ce;this.VAa=ke;Qc.da.$a(291,Fe=>{this.documentVisibilityObserver=Fe})}get RMa(){return 0<this.eFd}rMg(bc){this.addHandler(Qb.vzd,bc)}Bhj(bc){this.removeHandler(Qb.vzd,bc)}Fre(bc){this.addHandler(Qb.qzd,
bc)}PVf(bc){this.removeHandler(Qb.qzd,bc)}get isDocumentHidden(){return!!this.documentVisibilityObserver&&this.documentVisibilityObserver.si}dTg(bc,Qc,pd=!1){this.FNb(bc,Qc,pd)?(new qb.a).setResult(!0):(Qc=this.e2i(bc,Qc),this.Ykc=bc,this.eFd++,Qc.continueWith(()=>{this.zOi()},0,Ha.a.none,this.PL))}e2i(bc,Qc){this.wkg=this.Ph.$ea;this.rof=Qc;e.ULS.sendTraceTag(554767493,0,50,`DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge ${bc.Current} / ${bc.Pending} @${bc.SuspensionStartTimestamp}. allowSelectionAdjustment: ${Qc}`);
this.isDocumentHidden||this.My();return this.gsj(Qc,bc)}FNb(bc,Qc,pd=!1){if(this.VAa&&!Qc&&!this.VAa.Csi())return e.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0;if(!this.Ykc||bc.SuspensionStartTimestamp>this.Ykc.SuspensionStartTimestamp)return this.RMa&&e.ULS.sendTraceTag(523551556,0,50,`DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: ${bc.Current} / ${bc.Pending} @${bc.SuspensionStartTimestamp}`),
!1;if(this.RMa)return!0;if(pd)return!1;pd=this.Ykc;const ce=this.Ph.$ea-this.wkg<this.MNd;Qc=this.rof===Qc;return(bc||pd?bc&&pd?bc.Current===pd.Current&&bc.Pending===pd.Pending&&bc.SuspensionStartTimestamp===pd.SuspensionStartTimestamp:!1:!0)&&ce&&Qc}gsj(bc,Qc){const pd=this.ya.Wb(),ce=()=>{e.ULS.sendTraceTag(588276806,0,10,`DoPendingMergeSender.sendDoPendingMergeRequest: request failed ${Qc.Current} / ${Qc.Pending} @${Qc.SuspensionStartTimestamp}`)};return this.VAa?this.VAa.Poj(this.mSh(bc,ce,pd)):
this.bAe(null,!0,void 0,ce,pd)}mSh(bc,Qc,pd){return(ce,ke,Oe)=>{let Fe=void 0;e.ULS.shipAssertTag(523317955,0,null!=ce||bc,"!allowSelectionAdjustment requires a non-null initialViewportState.");Fe=this.AOi.bind(this);ke&&(Fe=Yb.b.call(null,Xe=>{const pf=Xe.Result;let Ae=null===pf||void 0===pf?void 0:pf.AdjustedViewportState;3===(null===pf||void 0===pf?void 0:pf.MergeResultState)&&(Ae=void 0);ke(Ae,Xe.StateId)},Fe));Oe&&(Qc=Yb.a.call(null,Oe,Qc));return this.bAe(ce,bc,Fe,Qc,pd)}}bAe(bc,Qc,pd,ce,ke){return ib(this.ya,
bc,Qc,pd,ce,null,null,ke)}AOi(bc){var Qc=bc.Result;void 0!=Qc&&(Qc=Qc.MergeResultState,Va.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1)&&2!==Qc?this.cnc=[Qc,bc.MergeCount]:3===Qc&&(e.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.o9i()))}o9i(){this.raiseEvent(Qb.vzd,new Sys.EventArgs)}n9i(bc,Qc){this.raiseEvent(Qb.qzd,new Bb(bc,Qc))}zOi(){this.eFd--;if(this.cnc){const bc=this.cnc;this.cnc=null;
this.n9i(...bc)}}}Qb.vzd="MWA";Qb.qzd="MDO";Object(b.a)(Qb,"DoPendingMergeSender",dc.a,[618,619]);class sc{constructor(bc=!1){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.Aci=bc}get reportName(){return this.Aci?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}Object(b.a)(sc,"SelectionAdjustSessionEndsReport",
null,[537]);var kb=a(40);class Eb{constructor(bc,Qc,pd,ce,ke,Oe){this.jb=bc;this.LG=Qc;this.I9=pd;this.kYb=ce;this.Y4d=ke;this.kM=Oe}get activeCell(){return this.LG}get selectedRanges(){return this.I9}get Ds(){let bc=!1;if(null===this.kM||void 0===this.kM)bc=!0;else if(this.kM>=this.selectedRanges.length||!this.selectedRanges[this.kM].contains(this.activeCell))e.ULS.sendTraceTag(521200010,0,50,`SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: ${this.kM}, selectedRangesLength: ${this.selectedRanges.length}`),
bc=!0;bc&&(this.kM=this.XZg());return this.kM}get activeRange(){return 0>this.Ds?this.activeCell:this.selectedRanges[this.Ds]}get sheetName(){return this.kYb}get activeItemName(){return this.Y4d}get Rog(){return 1===this.selectedRanges.length}Glg(bc){let Qc=this.selectedRanges.map(pd=>this.YSj(pd,this.Y4d));for(let pd of Qc)if(pd)for(let ce of pd)if(ce.Pk&&ce.qe.Revision<bc)return!1;return!0}bQj(){var bc;return{SheetName:this.sheetName,ActiveCell:null===(bc=this.activeCell)||void 0===bc?void 0:bc.toString(),
TopLeft:void 0,SelectedRanges:kb.r(this.selectedRanges,this.jb)}}toString(){var bc,Qc;return`active cell: ${null!==(Qc=null===(bc=this.activeCell)||void 0===bc?void 0:bc.toString())&&void 0!==Qc?Qc:"null"} selection: ${wb.f(this.selectedRanges,pd=>{var ce;return null!==(ce=null===pd||void 0===pd?void 0:pd.toString())&&void 0!==ce?ce:"null"}).join(",")}`}equals(bc){return bc?this.activeCell.equals(bc.activeCell)&&kb.Q(this.selectedRanges,bc.selectedRanges)&&this.sheetName===bc.sheetName:!1}XZg(){for(let [bc,
Qc]of this.selectedRanges.entries())if(null===Qc||void 0===Qc?0:Qc.contains(this.activeCell))return bc;return-1}YSj(bc,Qc){var pd;const ce=Ka.h(this.jb).Da.z4a(bc,Qc);ce||e.ULS.sendTraceTag(522803340,0,50,`SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: ${null!==(pd=null===bc||void 0===bc?void 0:bc.toString())&&void 0!==pd?pd:"null"} ; activeItemNameIsDefined: ${!!Qc}`);return ce}}Object(b.a)(Eb,"SelectionState",null,[]);var Gc=a(202),zc=a(739);class yb{constructor(bc){this.RAc=
0;this.iH=this.JF=null;this.n5d=new sc;this.o5d=new sc(!0);this.iI=0;this.lOj=!1;this.kGi=1E4;this.ed=()=>{this.cJe()};this.Ij=()=>{this.FZc(!0,!1)};this.K$a=()=>{this.FZc(!1,!1)};this.$=bc;this.gridView=Ka.h(this.$);this.gridView.Da.hw(this.Ij);this.gridView.Da.nt(this.K$a);this.gridView.Da.Nqe(this.K$a);this.gridView.Da.Z9(this.K$a);this.$.ll(this.ed);this.cJe()}Poj(bc){let Qc=null,pd=null,ce=()=>{this.dLi()};this.ngf()?(this.OP.parallel++,e.ULS.sendTraceTag(526390086,0,15,`SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : ${!!this.iH}`)):
(Qc=(ke,Oe)=>{this.eLi(ke,Oe)},pd=this.Lxj());return null===bc||void 0===bc?void 0:bc(pd,Qc,ce)}Csi(){return!this.ngf()&&this.Xaa().Rog}Lxj(){var bc;e.ULS.shipAssertTag(525135961,0,0===this.iI,"SelectionAdjustManager.setPreRequestState: unexpected state");this.iH&&(this.OP.errors++,e.ULS.sendTraceTag(526960090,0,10,`SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: ${this.iH.toString()}`));this.iH=null;this.JF=this.Xaa();let Qc=null;const pd=null===(bc=this.JF)||
void 0===bc?void 0:bc.bQj();pd&&(Qc={ActiveSheetName:this.JF.sheetName,SheetViewportStateChanges:[pd]});this.iI=1;return Qc}dLi(){e.ULS.shipAssertTag(525135960,0,1===this.iI,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.OP.errors++;this.iI=2;this.Ar()}eLi(bc,Qc){try{e.ULS.shipAssertTag(525135959,0,1===this.iI,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),this.RAc=Qc,Qc=2,this.JF?bc?(this.iH=this.jBj(bc))?(Qc=7,this.JF.equals(this.iH)?this.JF.equals(this.Xaa())?
(this.OP.adjustedDidntChange++,Qc=4):(this.OP.adjustedDidntChangeWithDivergence++,Qc=5):this.JF.sheetName!=this.iH.sheetName?(this.OP.differentSheetAdjust++,Qc=10):this.JF.equals(this.Xaa())||(this.OP.divergenceOnResponse++,Qc=6,this.bXf())):this.OP.errors++:(this.OP.errors++,e.ULS.sendTraceTag(537155412,0,15,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: ${this.JF.toString()}`)):(this.OP.errors++,e.ULS.sendTraceTag(537155413,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: ${null===
bc||void 0===bc?void 0:bc.ActiveCell}`)),this.iI=Qc}catch(pd){this.iI=12,e.ULS.sendTraceTag(525135958,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception ${pd}`)}finally{7!=this.iI?this.Ar():this.FZc(!1,!0)}}dispose(){this.gridView.Da.ex(this.Ij);this.gridView.Da.cr(this.K$a);this.gridView.Da.dVf(this.K$a);this.gridView.Da.tRa(this.K$a);this.$.Kl(this.ed)}ngf(){return 1===this.iI||7===this.iI}jBj(bc){let Qc;if(!({range:Qc}=kb.Z(bc.ActiveCell,this.$.xa)).returnValue)return e.ULS.sendTraceTag(537155411,
0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell ${bc.ActiveCell}`),null;let pd=[];const ce=this.$.oa,ke=!!ce&&2===ce.uG;if(bc.SelectedRanges)pd=kb.g(bc.SelectedRanges.Ranges);else if(!ke)return e.ULS.sendTraceTag(522826913,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: ${!!ce}`),null;return new Eb(this.$,Qc,pd,bc.SheetName,this.JF.activeItemName,this.JF.Ds)}Xaa(){const bc=this.$.oa;if((null===
bc||void 0===bc?0:bc.activeCell)&&bc.selectedRanges&&bc.sheetName)return new Eb(this.$,bc.activeCell,bc.selectedRanges,bc.sheetName,this.$.activeItemName,bc.Ds);e.ULS.sendTraceTag(525135957,0,15,`SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: ${!bc}, activeCell null: ${!(null===bc||void 0===bc?0:bc.activeCell)}, selectedRanges null: ${!(null===bc||void 0===bc?0:bc.selectedRanges)}, sheetName null: ${!(null===bc||void 0===bc?0:bc.sheetName)}`);return null}cJe(){this.$.da.$a(276,
()=>{const bc=Gc.a(this.$);bc.HY(this.n5d);bc.HY(this.o5d)})}FZc(bc,Qc){var pd;if(this.Jqi(bc))if(8===this.iI)e.ULS.sendTraceTag(523106438,0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");else{Qc&&e.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{e.ULS.shipAssertTag(525135956,0,7===this.iI,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),this.JF.equals(this.Xaa())?(null===(pd=
this.gridView)||void 0===pd?0:pd.eb)?(this.OP.editBoxDivergence++,this.iI=11):(bc=0,bc=this.iH.Ds,-1==bc?(this.OP.errors++,e.ULS.sendTraceTag(522826912,0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange")):(this.OP.adjusted++,this.iI=8,this.gridView.ha.mx(this.iH.selectedRanges,bc,this.iH.activeCell,0,void 0,"SelectionAdjust"))):(this.OP.divergenceOnViewportReady++,this.bXf(),this.iI=9)}catch(ce){this.iI=12,e.ULS.sendTraceTag(525135955,0,10,`SelectionAdjustManager.attemptAdjustSelection: caught Exception ${ce}`)}finally{this.Ar()}}}Jqi(bc){if(!this.iH)return!1;
if(!this.JF)return e.ULS.sendTraceTag(537155409,0,10,`SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: ${this.iH.toString()}`),!1;if(Ka.h(this.$).Da.Quf<this.RAc)return!1;if(bc||this.lOj)e.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust");else if(!this.JF.Glg(this.RAc)||!this.iH.Glg(this.RAc))return!1;return!0}Ar(){this.JF=this.iH=
null;this.iI=0}bXf(){const bc=this.Xaa();e.ULS.sendTraceTag(537155408,0,50,`SelectionAdjustManager.ReportDivergence: initial: ${this.JF.toString()} current: ${bc?bc.toString():""} adjusted: ${this.iH.toString()} sheetSameBetweenInitialAndAdjusted: ${this.JF.sheetName===this.iH.sheetName} sheetSameBetweenInitialAndCurrent: ${this.JF.sheetName===(bc?bc.sheetName:null)}`)}get OP(){return zc.a.BD(this.kGi)?this.o5d:this.n5d}}Object(b.a)(yb,"SelectionAdjustManager",null,[620,2]);class gb extends Qa.a{constructor(bc,
Qc,pd=null){super();this.CDa=this.lgc=this.s6a=this.H0a=null;e.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");this.$=bc;this.YXa=new gc(bc);this.VAa=new yb(this.$);this.wJa=new Qb(this.$.pa.ya,this.$,void 0,void 0,this.VAa);this.cei(bc,pd);this.cga=new vb(this.CDa,this.YXa,this.wJa);this.HNd=new ec(bc,this.cga,Qc,this.wJa);Va.EwaSettings.ma(251)&&(this.lgc=new db(bc,this));e.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created")}y0b(bc){this.cga.y0b(bc)}fvc(bc){this.cga&&
this.cga.fvc(bc)}get $ha(){return this.CDa}get Uma(){return this.YXa}get u6(){return this.cga}uAa(bc,Qc){this.CDa.uAa(bc,Qc)}x0d(bc){this.CDa.x0d(bc)}MPa(bc,Qc=""){this.YXa.MPa(bc,Qc)}dispose(){this.lgc&&(this.lgc.dispose(),this.lgc=null);this.VAa&&this.VAa.dispose();this.wJa.dispose();this.HNd&&(this.HNd.dispose(),this.HNd=null);this.cga&&(this.cga.dispose(),this.cga=null);this.YXa.dispose();this.YXa=null;this.CDa.dispose();this.CDa=null;this.H0a&&(this.H0a.dispose(),this.H0a=null);this.s6a&&(this.s6a.dispose(),
this.s6a=null);this.$=null;super.dispose()}QIb(){this.cga.M9i()}static Jbc(bc){let Qc=0;for(let pd of bc){if(2==pd)return 2;1==pd&&(Qc=1)}return Qc}cei(bc,Qc){this.CDa=new qa(this.wJa,this.YXa);Qc?Object($a.a)(ua,Qc)?this.uAa(Qc,Object(L.a)(ua,Qc).sI):Object($a.a)(fc,Qc)?this.uAa(Qc,Object(L.a)(fc,Qc).sI):this.uAa(Qc,0):(this.H0a=new fc(bc),this.s6a=new ua(bc),this.uAa(this.H0a,this.H0a.sI),this.uAa(this.s6a,this.s6a.sI))}}Object(b.a)(gb,"MergeSuspensionManager",Qa.a,[589,2]);class Kb extends fa.a{constructor(bc){super();
this.Lc=bc;this.Fb()}create(){e.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.nb(this.Lc.da.Aa(343)||this.Lc.da.Ga(343,new gb(this.Lc,ca.a.instance)))}static la(bc){e.ULS.sendTraceTag(537155418,0,50,"MergeSuspensionFactory.Attach");bc.da.Ga(344,new Kb(bc))}}Object(b.a)(Kb,"MergeSuspensionFactory",fa.a,[]);var sd=a(49),Sb=a(37),yc=a(89),Fc=a(98),Zc=a(58),Rd=a(13);class Ed{}Ed.Yxi=3;Ed.connected=0;Object(b.a)(Ed,"ConnectionStateConstants",null,[]);var ne=a(110),ze=a(118),Be=
a(44);class td{constructor(bc,Qc,pd){var ce;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.Kzf=(ke,Oe)=>{this.blockedOperationsCount++;ke=`${Oe.componentName}_${Oe.actionName}_${Oe.details})`;
this.blockedActions[ke]=this.blockedActions[ke]?this.blockedActions[ke]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};this.aFd=ke=>{this.durationUntilUserInactive=ne.getElapsedSeconds(this.startTime,Ab.a.Qa.zb);ke.PMd(this.aFd)};this.gW=()=>{this.hasTabbedOut=!0};this.Zca=(ke,Oe)=>{Oe.xLf!==this.type||this.isToastShown||(this.durationUntilToastShownMs=ze.a(Ab.a.Qa,this.startTime),this.toastRaiser=Oe.toastRaiser,this.isToastShown=!0)};this.startTime=bc;this.durationUntilToastShownMs=
0;this.blockedActions={};this.isToastShown=pd;if(null===(ce=Qc.ea)||void 0===ce?0:ce.Re)this.wasUserActiveOnPIStart=Qc.ea.Re.Ir;this.Nj(Qc);this.isDialogShown=0<Qc.rb.JR;bc=Qc.da.Aa(183);this.isTaskPaneShown=!!bc&&bc.isVisible&&!bc.isCollapsed;this.isTaskPaneCollapsed=!!bc&&bc.isVisible&&bc.isCollapsed}D3f(){this.durationMs=ze.a(Ab.a.Qa,this.startTime)}hEd(bc){var Qc;this.D3f();Be.a(bc).$uc(this.Kzf);Be.a(bc).Zf.avc(this.Zca);bc.da.$a(291,pd=>{pd.Bcb(this.gW)});if(null===(Qc=bc.ea)||void 0===Qc?0:
Qc.Re)bc.ea.Re.PMd(this.aFd),this.wasUserActiveOnPIEnd=bc.ea.Re.Ir}Nj(bc){Be.a(bc).o0b(this.Kzf);this.isToastShown?this.toastRaiser="Immediate":Be.a(bc).Zf.wXc(this.Zca);bc.da.$a(291,Qc=>{this.hasTabbedOut=Qc.si;Qc.EGa(this.gW)});this.wasUserActiveOnPIStart&&bc.ea.Re.vse(this.aFd)}}Object(b.a)(td,"PartialInteractivityData",null,[]);var Se=a(1117);class $b extends td{constructor(bc,Qc,pd,ce,ke,Oe){super(bc,Qc,ce);this.swappedOffline=this.swappedByOffline=!1;this.lastFailedRequestToOnlineTimeGapSec=
this.longestDurationBetweenFailedRequestsSec=this.averageDurationBetweenFailedRequestsSec=0;this.errorDataDuringConnectivityIssuesMode=this.disconnectionSource=null;this.failedRequests=[];this.triggeringRequest=null;this.type=4;this.swappedOffline=pd;this.disconnectionSource=Enum.toString(Se.a,ke);this.triggeringRequest=Oe}xNi(bc,Qc){this.swappedByOffline=Qc;this.hEd(bc)}Avj(bc){this.errorDataDuringConnectivityIssuesMode=bc}Yaj(bc){10>this.failedRequests.length&&(bc=bc+"_"+ne.getElapsedSeconds(this.startTime,
Ab.a.Qa.zb).toString(),this.failedRequests.push(bc))}}Object(b.a)($b,"ConnectivityIssuesData",td,[]);var Xc=a(159),ed=a(124),Rc=a(112);class Fd{}Fd.Soh="DuringWork";Fd.connectivityIssues="ConnectivityIssues";Fd.offline="Offline";Object(b.a)(Fd,"UnavailabilityTypes",null,[]);var Nd=a(51);class zd{constructor(bc){this.Skc=this.data=null;this.bcd=0;this.OFe=null;this.TAf=(Qc,pd)=>{pd.uM?(this.data=new $b(Ab.a.Qa.zb,this.$,5===pd.Hoa,0!==pd.Hoa,this.$.Te.disconnectionSource,this.OFe),this.Skc=this.$.Te.jpf,
this.bcd=1,this.$.pa.Te.gOg(this.zm),Xc.a(this.$).fXc(this.O_f)):(this.data.xNi(this.$,5===pd.Hoa),this.$.pa.Te.kWf(this.zm),this.data.lastFailedRequestToOnlineTimeGapSec=ne.getElapsedSeconds(this.Skc,Ab.a.Qa.zb),Va.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?Nd.b().mMb(557682689,0,50,Fd.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",Zc.a.hc(this.data)):
e.ULS.sendTraceTag(557682689,0,50,`ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: ${Zc.a.hc(this.data)}`),this.data&&this.data.isToastShown&&Fc.Health.instance.recordQosError(ed.a.d4g,[Rc.a.Dlc],!0,!1,!1,!1,null),Xc.a(this.$).kMd(this.O_f),this.data=null)};this.O_f=(Qc,pd)=>{this.data.Avj(pd.VU)};this.zm=(Qc,pd)=>{this.data.Yaj(pd.context.methodName);Qc=Ab.a.Qa.zb;pd=ne.getElapsedSeconds(this.Skc,Qc);this.Skc=Qc;pd>this.data.longestDurationBetweenFailedRequestsSec&&
(this.data.longestDurationBetweenFailedRequestsSec=pd);this.bcd++;this.data.averageDurationBetweenFailedRequestsSec=this.LZg(pd)};this.QAf=(Qc,pd)=>{this.OFe=pd.wSj};this.$=bc;Be.a(this.$).Zf.Xqe(this.TAf);this.$.Te.Wqe(this.QAf)}dispose(){this.$&&(Be.a(this.$).Zf.oVf(this.TAf),this.$.Te&&this.$.Te.nVf(this.QAf));this.data&&this.$.pa.Te.kWf(this.zm);this.$=null}LZg(bc){const Qc=this.bcd-1;return(this.data.averageDurationBetweenFailedRequestsSec*(Qc-1)+bc)/Qc}}Object(b.a)(zd,"ConnectivityIssuesTelemetryManager",
null,[2]);var Sd=a(852),se=a(8),He=a(1265),Gd=a(1116);class fe{constructor(bc){this.QZf=null;this.dvd=this.Dzd=this.AFb=this.BFb=0;this.rUd=!1;this.g4c=this.LTa=this.uAc=this.m$a=null;this.u4c=0;this.bsj=()=>{if(12E4>this.$.ea.Re.Lfb)for(let Qc of this.uAc)Qc.runTest();else this.qXd("UserInactive")};this.Jkj=Qc=>{Qc=Sys.Serialization.JavaScriptSerializer.serialize(Qc);e.ULS.sendTraceTag(388821830,0,50,Qc)};this.akj=Qc=>{if(Qc){var pd=this.g4c[Qc.testIteration.toString()];pd?pd.push(Qc):(pd=[Qc],this.g4c[Qc.testIteration.toString()]=
pd);if(pd.length===this.QZf.length){pd=Sys.Serialization.JavaScriptSerializer.serialize(pd);if(this.$&&this.$.Te){if(Qc.EstimatedLatency=this.$.Te.kxe,this.$.Te.kxe>this.$.ov.ExcelRountripThresholdMs){e.ULS.sendTraceTag(570712144,0,50,`Periodic ping tests results when network is slow: ${pd}, consequtive slow ping iteration #: ${this.u4c++}`);return}}else e.ULS.sendTraceTag(537155209,0,50,"EwaControl/ConnectivityObserver is null when conducting slow connection speed tests");e.ULS.sendTraceTag(570712142,
0,50,`Periodic ping tests results: ${pd}`);this.u4c=1}}};this.gh=(Qc,pd)=>{Qc=pd.context.methodName;if(Qc===se.a.Kxb||Qc===se.a.fwa)this.AFb++,Qc=Date.now(),this.NCj(Qc)&&(this.AFb=0,this.dvd=Qc,this.OKj())};this.Yca=()=>{this.UWd("OnThrottledUserActivity")};this.gW=()=>{this.qXd("OnDocumentHidden")};this.CR=()=>{this.UWd("OnDocumentUnhidden")};this.$=bc;if(this.sUd=this.q2g())this.QZf=[Gd.a.OFc],this.u4c=1,this.g4c={},this.$.ea.Re.hha(this.Yca),this.$.da.$a(291,Qc=>{Qc.EGa(this.gW);Qc.FGa(this.CR)})}dispose(){this.$&&
(this.rUd&&this.$.pa&&0<this.m$a.count&&this.$.pa.Mr(this.gh),this.sUd&&(this.qXd("Dispose"),this.$.ea.Re.BAa(this.Yca)))}Hdi(){Va.EwaSettings.ma(209)&&this.W4i();this.sUd&&this.X4i()}dei(){this.AFb=this.BFb;this.dvd=0;var bc={};if(!this.m$a){this.m$a=new X.a;const Qc=He.a.Jed(this.Jkj,"InitSampleMeasurement",this.$);for(const pd of Qc)bc[pd.Emd]=pd.baseUrl,this.m$a.add(pd)}bc=Sys.Serialization.JavaScriptSerializer.serialize(bc);e.ULS.sendTraceTag(537155210,0,50,`Init Network measurement: numberOfRequestToWaitPerNetworkMeasurement: ${this.BFb}, numberOfRequestFromTheLastNetworkMeasurement: ${this.AFb}, testParams: ${bc} `);
0<this.m$a.count&&this.$.pa.Kq(this.gh)}OKj(){for(let bc of this.m$a)bc.runTest()}UWd(bc){this.LTa&&this.LTa.Ep||(e.ULS.sendTraceTag(537155208,0,50,`NetworkMeasurement.StartConnectionSpeedTest: starting ping tests. caller: ${bc}`),this.LTa=ca.a.instance.cD(this.bsj,5E3,Sa.a.IIj),this.LTa.GV())}qXd(bc){this.LTa&&this.LTa.Ep&&(e.ULS.sendTraceTag(537155207,0,50,`NetworkMeasurement.StopConnectionSpeedTest: stopping ping tests. caller: ${bc}`),this.LTa.cancel())}NCj(bc){return this.AFb>=this.BFb&&bc-this.dvd>
this.Dzd}q2g(){return fe.GZf(this.$.va.SlowNetworkMeasurementsSamplePercentage)}W4i(){this.BFb=this.$.va.NumberOfRequestToWaitPerNetworkMeasurement;this.Dzd=1E3*this.$.va.MinTimeBetweenNetworkMeasurementInSec;const bc=this.$.va.NetworkMeasurementsSamplePercentage;0<this.BFb&&0<this.Dzd&&(this.rUd=fe.GZf(bc))&&this.dei()}X4i(){if(!this.uAc){this.uAc=new X.a;const bc=He.a.Jed(this.akj,"PrepareAndInitSlowNetworkTests.ConnectionSpeedTest",this.$,[Gd.a.OFc]);for(const Qc of bc)this.uAc.add(Qc);this.$.ea.Re.Ir&&
this.UWd("PrepareAndInitSlowNetworkTests")}}static GZf(bc){return 100*Math.random()<bc}}Object(b.a)(fe,"NetworkMeasurement",null,[2]);var $d=a(127),qe=a(752);class pe{constructor(bc){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=[];this.sessionID=bc}get count(){return this._count}get xU(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-1]}ZWj(){this.xU&&
this.xU.D3f()}FIg(bc){this.allOfflinePartialInteractivitiesDataInSession.push(bc);this._count++}}Object(b.a)(pe,"OfflinePartialInteractivitiesDataForLog",null,[]);class Ne extends td{constructor(bc,Qc,pd){super(bc,Qc,pd);this.timeFromLastOffline=0;this._errorDataDuringOfflineMode=null;this.timeFromLastOffline=-1;this.type=5}ezj(bc){this.timeFromLastOffline=bc}Bvj(bc){this._errorDataDuringOfflineMode=bc}}Object(b.a)(Ne,"OfflinePartialInteractivityData",td,[]);class Le{constructor(bc,Qc){this.tPa=this.xU=
null;this.$Hd=-1;this.Rvb=null;this.dpf=y.Task.delay(0);this.jab=(pd,ce)=>{ce.uM?this.IUi(ce.Hoa):this.JUi()};this.Zca=(pd,ce)=>{5===ce.xLf&&this.S3a()};this.P_f=(pd,ce)=>{this.xU.Bvj(ce.VU)};this.S3a=()=>{this.tPa.ZWj();this.Hpj(Le.eGd,Sys.Serialization.JavaScriptSerializer.serialize(this.tPa))};this.zkj=pd=>{if(pd=pd.result)this.Zlg=!0,e.ULS.sendTraceTag(576811915,0,50,`OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: ${pd}`)};
this.Nej=()=>{this.Zlg&&(this.$?Sb.TaskExtensions.za(this.indexedDB.N7b(Le.eGd),()=>{e.ULS.sendTraceTag(537155204,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.ka):e.ULS.sendTraceTag(537155203,0,10,"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.yPa=()=>{if(this.tPa&&0<this.tPa.count){const pd=Sys.Serialization.JavaScriptSerializer.serialize(this.tPa);
e.ULS.sendTraceTag(560791644,0,50,`OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: ${pd}`)}};this.$=bc;this.indexedDB=Qc;this.Zlg=!1;this.indexedDB.te()&&(this.indexedDB.initialize(Le.Hzb,Le.Izb),this.Wjj(),this.tPa=new pe(this.$.va.UserSessionId),Be.a(this.$).Zf.oXc(this.jab));this.Gm=$d.a.instance.sH();this.Gm.la("beforeunload",this.yPa)}dispose(){this.$&&Be.a(this.$)&&Be.a(this.$).Zf.vMd(this.jab);yc.a.Ia(this.Rvb);this.$=this.Rvb=null}IUi(bc){this.xU=
new Ne(Ab.a.Qa.zb,this.$,0!==bc);this.xU.ezj(-1!==this.$Hd?window.performance.now()-this.$Hd:-1);this.tPa.FIg(this.xU);Be.a(this.$).Zf.wXc(this.Zca);this.S3a();this.Rvb=ca.a.instance.cD(this.S3a,Le.HHh,Sa.a.S3a);Xc.a(this.$).fXc(this.P_f)}JUi(){this.xU.hEd(this.$);this.S3a();yc.a.Ia(this.Rvb);this.Rvb=null;this.$Hd=window.performance.now();Be.a(this.$).Zf.avc(this.Zca);Xc.a(this.$).kMd(this.P_f);this.bkj()}Hpj(bc,Qc){this.$?this.dpf=Sb.TaskExtensions.za(this.dpf,()=>{this.indexedDB.Jna(new qe.a(bc,
Qc))},this.$.ka):e.ULS.sendTraceTag(537155205,0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")}Wjj(){const bc=this.$.ka;Sb.TaskExtensions.za(Sb.TaskExtensions.za(this.indexedDB.Uja(Le.eGd),this.zkj,bc),this.Nej,bc)}bkj(){if(this.xU){const bc=Sys.Serialization.JavaScriptSerializer.serialize(this.xU);Va.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?Nd.b().mMb(560791645,0,50,Fd.offline,this.xU.durationMs,
"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",bc):e.ULS.sendTraceTag(560791645,0,50,`OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: ${bc}`)}this.xU&&this.xU.isToastShown&&Fc.Health.instance.recordQosError(ed.a.U_j,[Rc.a.Dlc],!0,!1,!1,!1,null)}}Le.Hzb="NetworkAvailability";Le.Izb="NetworkAvailabilityData";Le.eGd="partialInteractivityData";Le.HHh=3E3;Object(b.a)(Le,
"OfflineModeTelemetryManager",null,[2]);class gf{constructor(bc,Qc){this.dma=this.HAd=this.Dyf=null;this.$=bc;Va.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&S.a.Jf||(this.Dyf=new Le(bc,Qc));Va.EwaSettings.ma(209)&&(this.HAd=new fe(this.$),this.HAd.Hdi());!Va.EwaSettings.ma(548)||Va.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&S.a.Jf||(this.dma=new Sd.NetworkConnectionHealthChecker(this.$));this.P7g=new zd(this.$)}dispose(){yc.a.Ia(this.Dyf);
yc.a.Ia(this.HAd);yc.a.Ia(this.dma);yc.a.Ia(this.P7g);this.$=null}}Object(b.a)(gf,"NetworkConnectionTelemetryManager",null,[2]);class Ye extends td{constructor(bc,Qc,pd,ce){super(bc,Qc,pd);this.wasInteruptedByOfflineMode=!1;this.type=ce;this.wasInteruptedByOfflineMode=!1}jab(){this.wasInteruptedByOfflineMode=!0}}Object(b.a)(Ye,"SilentReopenData",td,[]);class $e{constructor(bc){this.W7=null;this.zIf=(Qc,pd)=>{this.wIf(pd,3)};this.NEf=(Qc,pd)=>{this.wIf(pd,2)};this.$=bc;this.Zf=Be.a(this.$).Zf;this.Zf.Cre(this.NEf);
this.Zf.INg(this.zIf)}dispose(){this.Zf.NVf(this.NEf);this.Zf.Eij(this.zIf);this.W7=this.Zf=this.$=null}wIf(bc,Qc){bc.uM?this.W7=new Ye(Ab.a.Qa.zb,this.$,0!==bc.Hoa,Qc):(5===bc.Hoa&&(this.W7.wasInteruptedByOfflineMode=!0),3!==bc.Hoa&&2!==bc.Hoa||e.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),this.W7.hEd(this.$),2===Qc?Va.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?
Nd.b().nMb(571289604,0,50,Fd.offline,this.W7.durationMs,this.W7):e.ULS.sendTraceTag(571289604,0,50,Zc.a.hc(this.W7)):Va.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?Nd.b().nMb(542782150,0,50,Fd.Soh,this.W7.durationMs,this.W7):e.ULS.sendTraceTag(542782150,0,50,Zc.a.hc(this.W7)),this.W7=null)}}Object(b.a)($e,"SilentReopenPartialInteractivityTelemetryManager",null,[2]);class Ya extends dc.a{constructor(bc,Qc,pd=!0){super();this.b1=this.g5b=this.uPa=
this.soa=this.GTa=null;this.Pwf=0;this.euc=this.ocb=this.pcb=!1;this.Qwf=this.documentVisibilityObserver=null;this.Iqa=!1;this.Bnd=this.f8=0;this.GBb=!1;this.d$f=0;this.jUd=!1;this.n1=null;this.yFf=()=>{e.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");this.nnc(1,!1)};this.CR=()=>{this.dla||this.XDb?window.setTimeout(()=>{this.FZd()},this.Pwf):this.FZd();this.documentVisibilityObserver.uRa(this.CR);this.GBb=!1};this.jg=()=>{e.ULS.sendTraceTag(537155218,
0,50,`NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:${this.XDb}, IsInDuringWorkSilentReopenMode:${this.lmc&&!this.Iqa}`);this.XDb&&this.Vne();this.lmc&&!this.Iqa&&this.Sne();Ka.h(this.$).fc.em(this.jg);this.pcb=this.ocb=!1};this.zFf=()=>{e.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.nnc(1,!0);this.ocb&&!this.pcb&&Ka.h(this.$).fc.em(this.jg);this.ocb=!1};this.Yca=(ce,ke)=>{this.Bnd=this.f8;this.f8=ke.iCc};
this.yIf=()=>{this.$&&(this.euc||(Na.a(this.$).KQ(za.a.cQa).rLg(this.IFf),this.$.ll(this.ed),this.euc=!0),this.Iqa=this.Vji(),this.nnc(2,!1))};this.IFf=()=>{var ce=Na.a(this.$).gi;const ke=ce.zRg();ce=wb.f(ce.$s.hd.errors,Oe=>Oe.MessageIdName);e.ULS.sendTraceTag(545842889,0,50,`NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:${ke}, IsB2W:${this.Iqa}, Errors: ${Zc.a.hc(ce)}`);ke&&(this.GTa?(this.Iqa=!1,this.yKe(),this.kDc()):this.soa&&(this.zKe(),this.kDc()))};
this.ed=()=>{this.$?(e.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.Iqa=!1,this.b1&&this.b1.Ep&&(yc.a.Ia(this.b1),this.b1=null),this.n1&&this.n1.Ep&&(yc.a.Ia(this.n1),this.n1=null),this.nnc(2,!0),this.kDc()):e.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};this.RAf=()=>{this.Ovf(!0)};this.SAf=()=>{this.Ovf(!1)};this.cYb=Ed.Yxi;this.q4c=Ed.connected;this.$=bc;this.Te=
bc.pa.Te;pd&&(this.Qwf=new gf(bc,Qc));this.$.da.$a(291,ce=>{this.documentVisibilityObserver=ce});this.Pwf=this.$.va.ExcelNetworkCheckAfterTabActivationDelayMs;this.Te.Ire(this.yFf);this.Te.zob(this.zFf);this.Te.Wqe(this.RAf);this.Te.XKg(this.SAf);new $e(this.$,this);this.vsf=this.$.va.LongInactivityTimePeriodSeconds;this.$.ea.IXc(this.yIf);this.$.ea.Re.hha(this.Yca);this.d$f=this.$.va.SilentReopenDuringWorkDelayMs}get Vli(){return this.Iqa}get XDb(){return!(this.cYb&1)}get lmc(){return!(this.cYb&
2)}get dla(){return!!(this.q4c&2)}dispose(){this.Te&&(this.Te.SVf(this.yFf),this.Te.kKb(this.zFf),this.Te.nVf(this.RAf),this.Te.sgj(this.SAf));this.GBb&&this.documentVisibilityObserver&&(this.documentVisibilityObserver.uRa(this.CR),this.GBb=!1);this.$&&(this.euc&&this.kDc(),this.$.ea&&(this.$.ea.dWf(this.yIf),this.$.ea.Re&&this.$.ea.Re.BAa(this.Yca)));this.n1&&(this.n1.dispose(),this.n1=null);yc.a.Ia(this.Qwf);this.$=null;super.dispose()}jEi(){this.jUd=!0}Sne(){this.soa||(this.soa=Be.a(this.$).Zf.kZa(3,
"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))}Vji(){if(this.jUd)return this.jUd=!1,!0;const bc=this.f8>this.vsf||this.Bnd>this.vsf&&10>this.f8;e.ULS.sendTraceTag(537155223,0,50,`NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:${this.f8}, Time gap between last two activities: ${this.Bnd}. return value:${bc}`);return bc}Lkj(){this.n1=ca.a.instance.create(()=>{Fc.Health.instance.recordQosError(ed.a.NIj,[Rc.a.Dlc],
!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0)}eGg(){this.soa||this.b1?e.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):this.b1=ca.a.instance.create(()=>{this.$?this.soa?e.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):
Ka.h(this.$).eb?(this.ocb||(Ka.h(this.$).fc.Rm(this.jg),e.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),this.pcb=!0,e.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):this.Sne():e.ULS.sendTraceTag(537155222,
0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.d$f,Sa.a.LHj,void 0,!0)}Ovf(bc){this.q4c=this.Ize(2,bc,!0);this.Sse()}nnc(bc,Qc){this.cYb=this.Ize(bc,Qc,!1);this.Sse()}Ize(bc,Qc,pd){pd=pd?this.q4c:this.cYb;return Qc?pd|bc:pd&~bc}FZd(){const bc=!!this.uPa,Qc=!!this.GTa,pd=!!this.soa,ce=!!this.g5b;this.XDb&&!bc?this.dGg():!this.XDb&&bc&&this.rih();!this.lmc||Qc||pd?this.lmc||(Qc?this.yKe():(pd||this.b1&&this.b1.Ep)&&this.zKe()):this.Iqa?this.bGg():
this.b1||this.eGg();this.dla&&!ce?this.keg(!0):!this.dla&&ce&&this.keg(!1)}dGg(){this.$?this.uPa?e.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):Ka.h(this.$).eb?(this.pcb||(Ka.h(this.$).fc.Rm(this.jg),e.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),
this.ocb=!0,e.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.Vne():e.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")}Vne(){this.uPa||(this.uPa=Be.a(this.$).Zf.kZa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))}rih(){this.uPa&&(yc.a.Ia(this.uPa),this.uPa=
null)}yKe(){this.GTa&&(yc.a.Ia(this.GTa),this.GTa=null);this.n1&&this.n1.Ep&&this.n1.cancel();this.n1=null}zKe(){this.soa&&(yc.a.Ia(this.soa),this.soa=null);this.b1&&(yc.a.Ia(this.b1),this.b1=null);this.pcb&&!this.ocb&&Ka.h(this.$).fc.em(this.jg);this.pcb=!1}bGg(){this.GTa||(this.GTa=Be.a(this.$).Zf.kZa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",void 0,Rd.a.instance.ga(2184)));this.Lkj()}keg(bc){bc?(this.g5b=Be.a(this.$).Zf.kZa(4,"NetworkConnectionStateManager.ConnectivityIssues"),
this.Q7i()):(yc.a.Ia(this.g5b),this.g5b=null)}Q7i(){if(this.$&&this.$.pa){const bc=this.$.pa.ya.Wb();na.I(this.$.pa.ya,null,null,null,bc)}}kDc(){Na.a(this.$).KQ(za.a.cQa).dr(this.IFf);this.$.Kl(this.ed);this.euc=!1}Sse(){this.documentVisibilityObserver||e.ULS.sendTraceTag(537155211,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");this.documentVisibilityObserver&&this.documentVisibilityObserver.si?this.GBb||
(this.documentVisibilityObserver.FGa(this.CR),this.GBb=!0,e.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.FZd()}}Object(b.a)(Ya,"NetworkConnectionStateManager",dc.a,[592,2]);class ra extends fa.a{constructor(bc){super();this.$=bc;this.Fb()}create(){Sb.TaskExtensions.za(sd.GetServiceTaskFactory.Oa(this.$.da,395,396,this.Ya),bc=>{let Qc=Object(ka.a)(this.$.da,
400,()=>new Ya(this.$,bc.result));this.nb(Qc)},this.$.ka,3)}static la(bc){bc.da.Ga(401,new ra(bc))}}Object(b.a)(ra,"NetworkConnectionStateManagerFactory",fa.a,[]);var ya=a(1255),mb=a(1158),Hb=a(1217),Zb=a(120),mc=a(107),Pc=a(147),fd=a(325);class id{constructor(bc){this.POa=this.iyd=this.TOa=this.xmc=0;this.byd=this.Gtf=null;bc?(this.Gmc=bc,this.wtb=Date.now,this.beh(),this.pdj()):e.ULS.sendTraceTag(520955213,209,10,"Can not initialize PenMinutesManager because TaskManager is null")}yxj(){this.Gtf=
"Office.Excel.Online.Data.Activity.PenMinutes"}pdj(){window.document.body.addEventListener("pointerenter",Object(B.a)(this,this.fqc,"onPointerEnter"));window.document.body.addEventListener("pointerleave",Object(B.a)(this,this.k0,"onPointerLeave"));ea.a.instance.Ub("Common.App.VisibilityManagement.IVisibilityManager").execute(bc=>{bc.Wre(Object(B.a)(this,this.uyb,"handleVisibilityChange"))})}fqc(bc){"pen"!==bc.pointerType||this.TOa||(this.TOa=Math.floor(this.wtb()/1E3),this.TOa<=this.xmc&&(this.TOa=
this.xmc),this.iyd=0)}k0(){this.K$e()}K$e(){const bc=Math.ceil(this.wtb()/1E3);this.TOa&&bc>this.xmc&&(this.iyd=bc,this.POa+=this.iyd-this.TOa);this.xmc=bc;this.TOa=0}uyb(bc,Qc){0!==Qc.newState&&this.K$e()}beh(){this.byd=new mc.a(4,2,6E4,Object(B.a)(this,this.cBi,"logPenUsage"));this.Gmc.Fg(this.byd)}cBi(){0<this.POa&&this.V1f(this.POa);this.POa=0}V1f(bc){const Qc=new fd.a;Qc.name=this.Gtf;const pd=[];(bc=Zb.a.ph("PenInputSec",bc.toString(),3))&&Array.add(pd,bc);Qc.dataFields=pd;Pc.a.sendActivityEvent(Qc)}dispose(){0<
this.POa&&this.V1f(this.POa);this.Gmc.np(this.byd)}}Object(b.a)(id,"PenMinutesManager",null,[510]);class Dd{constructor(){this.LQc=this.gb=null}get name(){return"Common.App.PenMinutesManager"}Xh(bc){this.gb=bc;const Qc=f.AFrameworkApplication.Fi;this.gb.register(510,"Common.App.PenMinutesManager.IPenMinutesManager").xc().Fc(()=>new id(Qc))}init(){this.LQc=this.gb.resolve("Common.App.PenMinutesManager.IPenMinutesManager")}dispose(){this.LQc&&this.LQc.dispose()}static main(){P.a.instance.Ei(new Dd)}}
Object(b.a)(Dd,"PenMinutesManagerPackage",null,[3,4]);class Zd extends fa.a{constructor(bc){super();this.$=bc;this.Fb()}static la(bc){bc.da.Ga(514,new Zd(bc))}create(){this.nb(Object(ka.a)(this.$.da,513,()=>{Type.registerNamespace("Common.App.PenMinutesManager");Dd.main();const bc=ea.a.instance.resolve("Common.App.PenMinutesManager.IPenMinutesManager");bc.yxj();return bc}))}}Object(b.a)(Zd,"PenMinutesFactory",fa.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");
Object(c.a)();Object(Ra.a)();Object(lb.a)();Object(Aa.a)();Object(da.a)();Object(La.a)();Object(Ea.a)();Object(Hb.a)();Type.registerNamespace("Common.App.InProductMessaging");ja.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");la.main();(()=>{aa.a.Fa(()=>{aa.a.Fa(Pa.la)})})();(()=>{aa.a.Fa(()=>{aa.a.Fa(oa.la)})})();aa.a.Fa(Kb.la);aa.a.Fa(ra.la);(()=>{aa.a.Fa(bc=>{Zd.la(bc)})})();Object(ya.a)();Object(mb.a)()},852:function(u,F,a){a.r(F);u=a(0);var c=a(7),b=a(15),e=a(323),f=a(29),
d=a(11),h=a(316);class n{constructor(){this.scenario=null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}}Object(u.a)(n,"ConnectionErrorLogInfo",null,[]);var m=a(1116),x=a(1265);class r{constructor(t){this.Mmd=[m.a.wng,m.a.OFc];this.Wn=(v,w)=>{this.zO[w]=v;this.z$h()&&this.Ekj("OnNetworkDownImmediatePing"===v.caller)};this.dma=t;this.$=t.$;this.zO={}}vwi(){const t=x.a.Jed(this.Wn,"OnNetworkDownImmediatePing",this.$,this.Mmd);for(const v of t)v.runTest()}z$h(){for(const t of this.Mmd)if(void 0===
this.zO[t]||null===this.zO[t])return!1;return!0}Ekj(t){const v=this.$.Te.E5;t&&this.LLj(v);for(var w of this.Mmd)this.zO[w]=Sys.Serialization.JavaScriptSerializer.serialize(this.zO[w]);t=Date.now();w=this.dma.Fjd(a(852).NetworkConnectionHealthChecker.eFb).returnValue;const C=this.dma.Fjd(a(852).NetworkConnectionHealthChecker.pMb).returnValue;this.zO.isOfflineMode=v;this.zO.networkDownBBAge=-1===w?w:t-w;this.zO.transientServerCommunicationFailuresBBAge=-1===C?C:t-C;this.dma.businessBar?(this.zO.isNetworkDownBBShown=
this.dma.businessBar.cF(56).toString(),this.zO.isServerErrorBBShown=this.dma.businessBar.cF(21).toString()):(this.zO.isNetworkDownBBShown="unknown",this.zO.isServerErrorBBShown="unknown");b.ULS.sendTraceTag(537155224,0,50,`ConnectionHealthTestsRunner.ReportPingResults: ${Sys.Serialization.JavaScriptSerializer.serialize(this.zO)}`)}LLj(t){const {NetworkConnectionHealthChecker:v}=a(852),w={};for(const C of Object.keys(this.zO)){const B=this.zO[C];w[B.testName]=B.isSuccess}w.isOfflineMode=t;this.dma.FXd(v.p4c,
Sys.Serialization.JavaScriptSerializer.serialize(w))}}Object(u.a)(r,"ConnectionHealthTestsRunner",null,[]);a.d(F,"NetworkConnectionHealthChecker",function(){return y});class y{constructor(t){this.businessBar=this.X8a=null;this.WLi=(v,w)=>{w.U8c?this.YLi(w):this.XLi(w)};this.gh=(v,w)=>{v=w.context.methodName;this.X8a&&v===this.X8a&&(b.ULS.sendTraceTag(537155230,0,50,`NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "${this.X8a}" has now succeeded. Querying local storage for BB showings.`),
this.v9a(y.pMb,!0),this.X8a=null);this.Irf(!1);this.f5b=!1};this.zm=(v,w)=>{f.a.eh(w.errors,[-1387426400])&&!this.f5b&&(this.f5b=!0,this.r7f()&&window.performance.mark(y.Cyf),(new r(this)).vwi())};this.ug=()=>{this.Irf(!0);this.v9a(y.eFb,!1);this.v9a(y.pMb,!1)};this.nza=()=>{b.ULS.sendTraceTag(537155225,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");this.v9a(y.eFb,!0)};this.$=t;this.pa=this.$.pa;this.localStorage=new h.a;
this.f5b=!1;this.$.ea.Xk(this.ug);this.pa.Te.zob(this.nza);this.pa.Kq(this.gh);this.$.da.$a(5,v=>{this.businessBar=v;v.DKg(this.WLi)});this.pa.iw(this.zm)}dispose(){this.$&&(this.$.ea&&this.$.ea.jo(this.ug),this.pa&&(this.pa.Te.kKb(this.nza),this.pa.gx(this.zm),this.pa.Mr(this.gh)))}YLi(t){const v={};v.Timestamp=Date.now().toString();switch(t.n0a){case 21:this.X8a=t.data.FailedMethod;v.FailedMethod=this.X8a;this.FXd(y.pMb,JSON.stringify(v));break;case 56:this.FXd(y.eFb,JSON.stringify(v))}}XLi(t){switch(t.n0a){case 21:this.v9a(y.pMb,
!0);break;case 56:this.v9a(y.eFb,!0)}}FXd(t,v){try{this.localStorage.te()&&this.localStorage.setItem(t,v)}catch(w){b.ULS.sendTraceTag(537155231,0,15,`NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: ${w.message||"Unknown"}`)}}Fjd(t){if(this.localStorage.te()&&(t=this.localStorage.$4a(t))&&"null"!==t){var v=JSON.parse(t);t=parseInt(v.Timestamp,10);v=Sys.Serialization.JavaScriptSerializer.serialize(v);return{returnValue:t,rawData:v}}return{returnValue:-1,
rawData:null}}Irf(t){if(this.localStorage.te()){const v=this.localStorage.$4a(y.p4c);if(v&&"null"!==v){let w=-1;this.f5b&&(w=this.ySh(y.Cyf,y.JKi));b.ULS.sendTraceTag(537155229,0,50,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: ${Sys.Serialization.JavaScriptSerializer.serialize(v)}, Period offline: ${w}, New session: ${t}`);this.localStorage.removeItem(y.p4c)}}}ySh(t,v){if(!this.r7f())return-1;window.performance.measure(v,t);t=window.performance.getEntriesByName(v);
return t.length&&t[t.length-1]?t[t.length-1].duration:(b.ULS.sendTraceTag(537155228,0,10,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name ${v} returned no measures.`),-1)}v9a(t,v){try{let w;const C=({rawData:w}=this.Fjd(t)).returnValue;if(-1!==C){const B=Object(c.a)(new n,{timeElapsed:Date.now()-C,scenario:t,isNewSession:!v,rawData:w});b.ULS.sendTraceTag(537155227,0,50,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: ${JSON.stringify(B)}`)}this.localStorage.removeItem(t)}catch(w){b.ULS.sendTraceTag(537155226,
0,15,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: ${w.message||"Unknown"}`)}}r7f(){return d.HelperMethods.R_c&&e.a.rqb}}y.eFb="NetworkDownBBShown";y.pMb="ServerCommunicationFailureBBShown";y.p4c="ConnectionHealthPingRsults";y.Cyf="offMoStMa";y.JKi="offMoDuMea";Object(u.a)(y,"NetworkConnectionHealthChecker",null,[2])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.pi.js.map/f017b06b56986f7c811a588de0da1766/EwaDSEsNext.pi.js.map