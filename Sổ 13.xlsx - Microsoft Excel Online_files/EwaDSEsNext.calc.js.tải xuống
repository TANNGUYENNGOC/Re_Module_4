'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[14],{1162:function(u,F,a){u=a(0);var c=a(15),b=a(222),e=a(8),f=a(111);a(201);var d=a(187),h=a(83),n=a(177),m=a(185),x=a(66);class r{}r.local="Local";r.JOj="Thread";Object(u.a)(r,"RecalcServiceCreateMode",null,[]);var y=a(162);class t{constructor(ba){this.m7d=null;this.init(ba)}get O$(){return this.m7d}init(ba){this.m7d=new n.a;if(void 0!==ba&&null!==ba&&void 0!==ba.HeadersList&&null!==ba.HeadersList&&0<ba.HeadersList.length)for(const ka of ba.HeadersList)this.O$.ia(ka.Index,
ka.Name)}}Object(u.a)(t,"ColHeadersListData",null,[]);var v=a(1),w=a(33),C=a(100),B=a(22),z=a(21),A=a(175);class E{constructor(ba,ka){this.Hze=ba;this.sheetName=ka;this.Axc=!1}}Object(u.a)(E,"CalcBlockInformation",null,[]);class I{constructor(ba,ka,Pa,Fa,oa){this.type=ba;this.fullName=ka;this.range=Pa;this.sheetId=Fa;this.attributes=oa;this.eF=null}}Object(u.a)(I,"CalcNamedObject",null,[]);class L{constructor(ba){this.hkg=ba;this.Ake=[];this.Ahg=[];this.w0a={};this.FTd=new Map}get Sj(){return this.Ake}n5f(ba,
ka){this.Ake[ba]=ka;this.hkg&&ka.Q7&&this.FTd.set(ka.Q7.sheetName,ba)}getSheetIndex(ba){if(this.hkg){if(this.FTd.has(ba))return this.FTd.get(ba)}else for(let ka=1;ka<this.Sj.length;ka++)if(B.a.equals(this.Sj[ka].Q7.sheetName,ba,!1))return ka;return-1}}Object(u.a)(L,"GridCache",null,[]);var V=a(684),T=a(554);class H{constructor(ba){this.Q7=ba;this.v6=new V.a(T.a.ak());this.Fnc=!1}}Object(u.a)(H,"SheetInformation",null,[]);var D=a(938),G;(function(ba){ba[ba.initialization=0]="initialization";ba[ba.contentReady=
1]="contentReady";ba[ba.cellEdit=2]="cellEdit"})(G||(G={}));Object(u.b)("UpdateDataTrigger",G);class J{constructor(ba){this.iKd=null;this.xwd=this.hKd=this.rEd=!1;this.ZHd=0;this.RHd=this.THd=this.UHd=this.SHd=-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.fr=this.errorTypeNames=null;this.Rt=this.currentStateId=-1;this.Qta="";this.gaa=null;this.getNameLoc=(ka,Pa)=>this.Ric()?this.Ze.na(this.currentStateId).Sj[0].v6.lb(Pa)?(ka=excelOnlineCalc.location.nameLoc(ka,
Pa),excelOnlineCalc.util.success(ka)):excelOnlineCalc.util.success(null):(ka=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ka));this.getContainingTable=ka=>{if(!this.Ric())return ka=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ka);const Pa=ka.range.col,Fa=ka.range.row;var oa=this.Ze.na(this.currentStateId).Sj[0].v6,La=null;for(let Ea of oa)if(oa=Ea.value,2===oa.type&&B.a.equals(ka.sheet.index.toString(),oa.sheetId,!0)){const ca=oa.range;Pa>=ca.left-1&&Pa<=
ca.right-1&&Fa<=ca.bottom-1&&Fa>=ca.top-1&&(La=excelOnlineCalc.location.nameScope(this.documentLoc,oa.sheetId),La=excelOnlineCalc.location.nameLoc(La,oa.fullName))}return La?excelOnlineCalc.util.success(La):excelOnlineCalc.util.success(null)};this.getStructRefColumn=(ka,Pa)=>{if(!this.Ric()){var Fa=excelOnlineCalc.util.unavailable([2]);return excelOnlineCalc.util.failure(Fa)}Fa=ka.name;var oa=this.Ze.na(this.currentStateId).Sj[0].v6;if(oa.lb(Fa)){oa=oa.na(Fa);const Ea=oa.range;if(2!==oa.type)return excelOnlineCalc.util.failure(this.d6c(5));
const ca=oa.eF?oa.eF.O$:null;if(!ca)return excelOnlineCalc.util.success(null);for(var La of ca)if(B.a.equals(La.value,Pa,!0))return ka=excelOnlineCalc.location.documentLoc(ka.scope.document.path,ka.scope.document.name),ka=excelOnlineCalc.location.sheetIndex(ka,oa.sheetId),La=excelOnlineCalc.location.gridRange(Ea.top-1,La.key,Ea.bottom-Ea.top+1,1),La=excelOnlineCalc.location.sheetGridRange(ka,La),Fa=excelOnlineCalc.location.structRefColumnLoc(Fa,La,!!(oa.attributes&16),!!(oa.attributes&8)),excelOnlineCalc.util.success(Fa);
return Ea.right-Ea.left+1!==ca.count?(Fa=excelOnlineCalc.util.unavailable([17,ka,Pa]),excelOnlineCalc.util.failure(Fa)):excelOnlineCalc.util.failure(this.d6c(0))}return excelOnlineCalc.util.success(null)};this.getStructRefSpecialRef=(ka,Pa)=>{if(!this.Ric())return Pa=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Pa);var Fa=this.Ze.na(this.currentStateId).Sj[0].v6;if(Fa.lb(ka.name)){var oa=Fa.na(ka.name);if(2!==oa.type)return excelOnlineCalc.util.failure(this.d6c(5));Fa=!!(oa.attributes&
16);const La=!!(oa.attributes&8),Ea=Fa?1:0,ca=La?1:0;ka=excelOnlineCalc.location.documentLoc(ka.scope.document.path,ka.scope.document.name);ka=excelOnlineCalc.location.sheetIndex(ka,oa.sheetId);oa=oa.range;let $a={};if(1===Pa)$a=excelOnlineCalc.location.gridRange(oa.top-Ea-1,oa.left-1,oa.bottom+ca-oa.top+Ea+1,oa.right-oa.left+1);else if(2===Pa)$a=excelOnlineCalc.location.gridRange(oa.top-1,oa.left-1,oa.bottom-oa.top+1,oa.right-oa.left+1);else if(3===Pa)if(Fa)$a=excelOnlineCalc.location.gridRange(oa.top-
2,oa.left-1,1,oa.right-oa.left+1);else return excelOnlineCalc.util.success(null);else if(4===Pa)if(La)$a=excelOnlineCalc.location.gridRange(oa.bottom,oa.left-1,1,oa.right-oa.left+1);else return excelOnlineCalc.util.success(null);Pa=excelOnlineCalc.location.sheetGridRange(ka,$a);return excelOnlineCalc.util.success(Pa)}return excelOnlineCalc.util.success(null)};this.getDocumentLoc=(ka,Pa)=>{if((B.a.equals(ka,this.documentLoc.path,!0)||!ka)&&B.a.equals(Pa,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);
ka=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(ka,Pa)]);return excelOnlineCalc.util.failure(ka)};this.getSheetIndex=(ka,Pa)=>{if(!this.Ze.lb(this.currentStateId)||!this.Ze.na(this.currentStateId).Sj)return Pa=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Pa);ka=this.Ze.na(this.currentStateId).Sj;for(let Fa=1;Fa<ka.length;Fa++)if(B.a.equals(ka[Fa].Q7.sheetName,Pa,!0))return excelOnlineCalc.util.success(ka[Fa].Q7.sheetId);return excelOnlineCalc.util.success(null)};
this.getSheetName=(ka,Pa)=>{if(!this.Ze.lb(this.currentStateId)||!this.Ze.na(this.currentStateId).Sj)return Pa=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Pa);ka=this.Ze.na(this.currentStateId).Sj;for(let Fa=1;Fa<ka.length;Fa++)if(B.a.equals(ka[Fa].Q7.sheetId,Pa,!0))return excelOnlineCalc.util.success(ka[Fa].Q7.sheetName);return excelOnlineCalc.util.success(null)};this.getUserDefinedFuncLoc=()=>excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"]);
this.getSheetRangeIndexes=()=>excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"]);this.FFf=()=>{this.setNumberFormats()};this.ed=()=>{c.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");this.Ze=new n.a;this.currentStateId=this.Rt=-1;this.Qta="";this.htb=null;this.hKd=!1;this.fr&&this.clearCache()};this.D$f=(this.Lc=ba)?ba.va.CalcWebWorkerSmokeTestPingIntervalMS:this.D$f;this.Ze=new n.a;this.htb=null;this.documentLoc=
excelOnlineCalc.location.documentLoc("",this.Lc.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Yoa();this.$qd=w.a.$qd();this.gHh=v.EwaSettings.isChangeGateEnabled("OfficeVSO:7403363_fixTextWithWhitespaces")}dispose(){this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.uMd(this.FFf);this.Lc&&this.Lc.Kl(this.ed);this.close()}tQb(ba){if(!this.fr)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Lc.da.Aa(268),
!this.instantaneousSupportInformationManager))return c.ULS.sendTraceTag(537170198,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),!1;2!==ba&&(this.currentStateId=this.Lc.ea.jDb,this.currentStateId===e.a.re&&(this.currentStateId=this.Lc.ea.ze));if(1===ba&&this.currentStateId<this.Rt)return c.ULS.sendTraceTag(537170197,0,50,`CalcAsyncEngine::UpdateData() currentStateId:${this.currentStateId} < lastUpdatedStateId:${this.Rt} - ignoring update`),!1;this.dvj();0!==
ba&&this.hKd||(this.xzj(),this.Dwj(),this.oxj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.Kre(this.FFf),this.Lc.ll(this.ed),this.hKd=!0);this.Laj();let ka=!1;0===ba&&(ka=this.nfi());if(0!==ba||ka)this.Jyj()?(this.lzj(ba),this.kzj(),this.Rt=this.currentStateId,this.f3g()):c.ULS.sendTraceTag(537170196,0,15,`CalcAsyncEngine::UpdateData() for StateId:${this.currentStateId} failed - no Sheets information`);2!==ba&&this.resumeRecalc();return!0}evalFormula(ba,ka,Pa,Fa){if(!this.fr)return c.ULS.sendTraceTag(537170195,
0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});ka=excelOnlineCalc.calc.sheetCellLocation(null!==Pa&&void 0!==Pa?Pa:x.d(this.Lc.xa.oa),ka.top-1,ka.left-1);ba=this.fr.evalFormula(this.Lc.ea.ze,ba,ka,Fa);this.resumeRecalc();return ba}SZg(ba,ka,Pa,Fa=null){const oa=x.d(this.Lc.xa.oa);let La=ba.cell.$Q-1,Ea=ba.cell.ZQ-1;var ca=La,$a=Ea;let Qa=null;Fa&&(Qa=excelOnlineCalc.calc.cellLocation(La,Ea),La=Fa.top-1,Ea=Fa.left-1,ca=Fa.bottom-1,$a=Fa.right-1);Pa=this.k2d(ba,Pa,"SetCell");
if(0>Pa)return!1;$a=J.daa("CalculateFormula.cell",oa,La,Ea,ca,$a);ca=[];Fa=this.Zjd(oa);ka=excelOnlineCalc.calc.inferredRangeFormulaEdit($a,ka,Qa,Fa);ca.push(ka);ba=(ka=this.L8e())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",oa,La,Ea,B.a.Nte(ba.cell.text),Pa,ka.top-1,ka.left-1,ka.bottom-1,ka.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",
oa,La,Ea,B.a.Nte(ba.cell.text),Pa,"","","","");c.ULS.sendTraceTag(537170180,0,50,ba);this.fr.editRangeFormulas(Pa,ca);this.resumeRecalc();return!0}Tub(ba,ka,Pa,Fa){if(!this.fr)return c.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),Promise.reject("RecalcService is null");if(!Pa||!ka)return c.ULS.sendTraceTag(524120779,0,15,`CalcAsyncEngine::EvalFormulaRangeOnClone inputs are null. originCell null: ${!Pa}, outputColumnRange null: ${!ka}`),Promise.reject("CalcAsyncEngine::EvalFormulaRangeOnClone: null inputs");
c.ULS.shipAssertTag(537170178,0,Pa.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");const oa=x.d(this.Lc.xa.oa),La=this.Zjd(oa);var Ea=null;if(ba){Ea=[];for(const $a of ba)if($a.column!==Pa.left){ba=$a.row-1;var ca=$a.column-1;ba=J.daa("EvalFormulaRangeOnClone.cell",oa,ba,ca,ba,ca);ca=$a.text;Ea.push(excelOnlineCalc.calc.rangeWrite(ba,excelOnlineCalc.calc.valueCellData(ca,ca,$a.Gj,null)))}}Pa=excelOnlineCalc.calc.cellLocation(Pa.top-1,Pa.left-1);ka=J.daa("EvalFormulaRangeOnClone.outputColumnRange",
oa,ka.top-1,ka.left-1,ka.bottom-1,ka.right-1);Fa=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(ka,Fa,Pa,La)];Ea=this.fr.evalOnClonedModel(Ea,Fa);this.resumeRecalc();return Ea}yJe(ba){let ka=null;try{if(ba)if(this.Qta=z.h(this.Lc).Da.Dva(ba),this.currentStateId=ba.gUa,this.currentStateId<this.Rt||this.currentStateId===e.a.re)c.ULS.sendTraceTag(537170176,0,50,`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:${this.Qta} blockRevision:${this.currentStateId} < lastUpdatedStateId:${this.Rt}`);
else{if(this.tfi(),!this.ZUg())if(ka=this.Lc.Kb.Bc("ModelUpdate",`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:${this.Qta} StateId:${this.currentStateId}`),this.htb=this.Vxb(ba.oa.sheetName),!this.htb){const La=!!(this.Lc.qd&32),Ea=this.Ze.lb(this.currentStateId)&&this.Ze.na(this.currentStateId).Sj?this.Ze.na(this.currentStateId).Sj.length:0;c.ULS.sendTraceTag(537170147,0,15,`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets ${Ea}, scratchPad:${La}, sheetNameLength:${ba.oa.sheetName?
ba.oa.sheetName.length:-1} Hash:${ba.oa.hash}`)}else if(z.h(this.Lc).Da.Dm.E2a(ba.Ad)){var Pa=ba.sf;if(Pa){var Fa=Pa.getCalcBlockModel();if(!Fa)c.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.RUg(Fa)){this.Ze.na(this.currentStateId).w0a[this.Qta]=new E(Fa,ba.oa.sheetName);var oa=ba.ke;oa?this.qIg(oa.NamedObjects):c.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else c.ULS.sendTraceTag(537170146,
0,15,`CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:${this.Qta}`)}}else c.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{ka&&ka.stop()}}x5a(ba){if(!this.Ze.na(this.currentStateId).Sj||!this.Ze.na(this.currentStateId).Sj[0])return null;var ka=this.Ze.na(this.currentStateId).Sj[0].v6;if(!ka||!ka.lb(ba.name))return null;ba=ka.na(ba.name);if(!ba||!ba.eF)return null;ka=new d.a;for(let Pa of ba.eF.O$)ka.add(Pa.value);
return ka}TZg(ba,ka,Pa){var Fa=z.h(this.Lc),oa=Fa.Sb(ka);oa=this.k2d(oa,null,"CopyPaste");Pa=this.k2d(Fa.Sb(ba),Pa,"CopyPaste");if(0>oa||0>Pa||oa!==Pa)c.ULS.sendTraceTag(537170143,0,15,`CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:${Pa}, targetRevision:${oa}.`);else{Pa=[];Fa=x.d(this.Lc.xa.oa);var La=this.Zjd(Fa);ba=J.daa("CalculateFormulaForCopyPaste.srcRange",Fa,ba.top-1,ba.left-1,ba.bottom-1,ba.right-1);ka=J.daa("CalculateFormulaForCopyPaste.targetRange",
Fa,ka.top-1,ka.left-1,ka.bottom-1,ka.right-1);ka=excelOnlineCalc.calc.copyPasteRangePasteEdit(ka,ba,La);Pa.push(ka);ka=La?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Fa,oa,La.row,La.column,La.lastRow,La.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Fa,oa,"","","","");c.ULS.sendTraceTag(537170142,0,50,ka);this.fr.editRangePaste(oa,Pa);
this.resumeRecalc()}}Zjd(ba){const ka=this.L8e();let Pa=null;ka?Pa=J.daa("GetViewport.viewport",ba,ka.top-1,ka.left-1,ka.bottom-1,ka.right-1):c.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return Pa}L8e(){const ba=z.h(this.Lc);let ka=ba.ui;if(z.h(this.Lc).ib.tj){ka=ba.Df(1).ui;if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!ka)return c.ULS.sendTraceTag(537170140,0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),
null;ka.fea(1,1);ka.fea(3,1)}return ka}k2d(ba,ka,Pa){let Fa;if(!this.fr||!ba)return c.ULS.sendTraceTag(537170139,0,15,`CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:${!this.fr}, modifiedCell is null:${!ba}, operation:${Pa}`),-1;const oa=ba.cell.$Q-1,La=ba.cell.ZQ-1;if(ba.cell.my){if(Fa=ba.cell.my.Sxe,Fa===e.a.re)return c.ULS.sendTraceTag(537170138,0,15,`CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:${ba.cell.my.Ad}, operation:${Pa}`),-1}else return c.ULS.sendTraceTag(537170137,
0,15,`CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:(${ba.cell.$Q},${ba.cell.ZQ}), operation:${Pa}`),-1;if(Fa<this.Rt)return c.ULS.sendTraceTag(537170136,0,50,`CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:(${oa},${La}) - blockRevision:${Fa} < lastUpdatedStateId:${this.Rt}, operation:${Pa}`),-1;if(Fa<this.currentStateId)return c.ULS.sendTraceTag(537170135,0,50,`CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:(${oa},${La}) - blockRevision:${Fa} < currentStateId:${this.currentStateId}, operation:${Pa}`),
-1;ka&&!this.rEd&&(this.fr.setOnRecalcResults(ka),this.rEd=!0);return this.FVj()&&!this.tQb(2)?(c.ULS.sendTraceTag(537170134,0,15,`CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:${Pa}`),-1):Fa}getFormulaBarText(ba,ka,Pa){return ka&&ka.startsWith("'")?ka:ba.cell.formulaBarText||Pa.toString()}Feh(ba,ka,Pa){let Fa=null;if(this.sAe()&&this.Ze.na(this.Rt).w0a){const oa=this.Ze.na(this.Rt).w0a[ba];if(null===oa||void 0===oa?0:oa.Axc)Fa=oa.Hze}Pa=this.cki(Fa,ka,Pa);ka=this.A6g(Fa,
ka,Pa);c.ULS.sendTraceTag(50671754,0,50,`CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:${ba} StateId:${this.currentStateId} number of formulas ${ka}`)}cki(ba,ka,Pa){let Fa=!1;const oa=J.I0e(ka);if(ba){const La=J.I0e(ba);B.a.equals(La,oa,!1)&&(Fa=!0)}Fa?this.VIg(ba,this.Rt,Pa):this.XIg(ka,Pa);return Fa}sAe(){let ba=!1;this.fr&&-1!==this.Rt&&(ba=this.fr.stateIdAvailable(this.Rt));return ba&&this.Ze.lb(this.Rt)&&this.Rt<this.currentStateId}A6g(ba,ka,Pa){let Fa;Fa=0;let oa,La;
for(ka.reset();oa=ka.getNextCell();)A.f(oa.formula)&&Fa++,(La=Pa?ba.getCell(oa.row,oa.col):null)?this.w6g(ka,oa,La):this.WIg(ka,oa);if(Pa)for(ba.reset();La=ba.getNextCell();)(oa=ka.getCell(La.row,La.col))||this.Zpe(ba,La);return Fa}oxj(){this.fr.setOnUpdateRequest(()=>{})}nxj(){this.fr.setOnUnresponsive((ba,ka,Pa,Fa)=>{this.SYi(ba,ka,Pa,Fa)})}SYi(ba,ka,Pa,Fa){c.ULS.sendTraceTag(537170126,0,15,`CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:${ba}, waitTime:${ka}, timeoutCount:${Pa}, hasBeenClosed:${Fa}.`);
Fa&&(this.dmj(),this.Yoa())}dmj(){this.ed(null,null);this.xwd=this.rEd=!1;this.ZHd=0;this.RHd=this.THd=this.UHd=this.SHd=-1}close(){this.fr.close()}clearCache(){this.fr.clearCache()}resumeRecalc(){this.fr.resumeRecalc()}Dwj(){this.fr.setA1ReferenceStyle(!0)}Laj(){if(this.instantaneousSupportInformationManager){var ba=this.instantaneousSupportInformationManager.thi;const Pa=this.instantaneousSupportInformationManager.whi,Fa=this.instantaneousSupportInformationManager.vhi,oa=this.instantaneousSupportInformationManager.uhi;
var ka=!1;ba!==this.SHd&&(ka=!0,this.SHd=ba);Pa!==this.UHd&&(ka=!0,this.UHd=Pa);Fa!==this.THd&&(ka=!0,this.THd=Fa);oa!==this.RHd&&(ka=!0,this.RHd=oa);const La=[];v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",!1)&&(ka=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),La.push(ka),ka=!0);v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(ka=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),La.push(ka),
ka=!0);v.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(ka=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",null),La.push(ka),ka=!0);ka&&(ba=excelOnlineCalc.calc.recalcServiceConfig(null,ba,null,Pa,null,null,null,Fa,La,oa),this.fr.reconfigure(ba))}}lzj(ba){let ka=null;if(this.Ze.lb(this.currentStateId))try{this.gaa=[],ka=this.Lc.Kb.Bc("ModelUpdate",`CalcAsyncEngine::SetUpdatedRanges() StateId:${this.currentStateId} UpdateTriggerData:${G[ba]}`),
f.a.forEach(this.Ze.na(this.currentStateId).w0a,(Pa,Fa)=>{Fa.Axc||(this.Feh(Pa,Fa.Hze,Fa.sheetName),Fa.Axc=!0)},null),this.fr.updateRanges(this.currentStateId,this.gaa)}finally{ka&&ka.stop()}else c.ULS.sendTraceTag(537170122,0,15,`CalcAsyncEngine::SetUpdatedRanges StateId:${this.currentStateId} does not exist in GridCache`)}kzj(){const ba=[],ka=this.sAe();var Pa=ka&&this.Ze.na(this.Rt).Sj&&this.Ze.na(this.Rt).Sj[0]&&this.Ze.na(this.Rt).Sj[0].Fnc?this.Ze.na(this.Rt).Sj[0].v6:null;this.jFe(Pa,this.Ze.na(this.currentStateId).Sj[0].v6,
null,this.Rt,ba);this.Ze.na(this.currentStateId).Sj[0].Fnc=!0;for(let Fa=1;Fa<this.Ze.na(this.currentStateId).Sj.length;Fa++)Pa=-1,ka&&this.Ze.na(this.Rt).Sj&&(Pa=this.djd(this.Ze.na(this.currentStateId).Sj[Fa].Q7.sheetName,this.Rt)),Pa=-1!==Pa&&this.Ze.na(this.Rt).Sj[Pa].Fnc?this.Ze.na(this.Rt).Sj[Pa].v6:null,this.jFe(Pa,this.Ze.na(this.currentStateId).Sj[Fa].v6,this.Ze.na(this.currentStateId).Sj[Fa].Q7.sheetId,this.Rt,ba),this.Ze.na(this.currentStateId).Sj[Fa].Fnc=!0;this.fr.updateNamedObjects(this.currentStateId,
ba)}jFe(ba,ka,Pa,Fa,oa){if(void 0!==Pa&&null!==Pa){var La=excelOnlineCalc.calc.undefinedNamesWrite(Pa);oa.push(La)}if(ba){var Ea=!1;La=[];var ca=[];if(ka)for(let Qa of ka){const Va=Qa.value;if(ba.lb(Qa.key)){var $a=ba.na(Qa.key);J.OIi($a,Va)?Ea=!0:($a=excelOnlineCalc.calc.namedObject(Qa.key,null),La.push($a),J.CWc(Qa.key,Va,ca))}else J.CWc(Qa.key,Va,ca)}for(let Qa of ba)ka&&ka.lb(Qa.key)||(ba=excelOnlineCalc.calc.namedObject(Qa.key,null),La.push(ba));Ea&&(ka=excelOnlineCalc.calc.namedObjectsPromote(Pa,
Fa),oa.push(ka));0<La.length&&(ka=excelOnlineCalc.calc.namedObjectsWrite(Pa,La),oa.push(ka));0<ca.length&&(Pa=excelOnlineCalc.calc.namedObjectsWrite(Pa,ca),oa.push(Pa))}else if(ka){Fa=[];for(ca of ka)J.CWc(ca.key,ca.value,Fa);0<Fa.length&&(Pa=excelOnlineCalc.calc.namedObjectsWrite(Pa,Fa),oa.push(Pa))}}ZUg(){return this.Ze.na(this.currentStateId).w0a[this.Qta]?(c.ULS.sendTraceTag(537170121,0,50,`CalcAsyncEngine::BlockPreviouslyHandled Block Hash:${this.Qta} StateId:${this.currentStateId} previously handled`),
!0):!1}RUg(ba){return 1===ba.getColumnNumbers().length&&ba.getColumnNumbers()[0]===J.Yyd+1?!1:!0}nfi(){let ba=!1;z.h(this.Lc).Da.Zvb(ka=>{ka.state&1&&this.Lc.ea.ze===ka.qe.Revision&&(this.yJe(ka),ba=!0)});return ba}rHe(ba,ka){var Pa=ba.getRowNumbers(),Fa=ba.getColumnNumbers();ba=Pa[0]-1;Pa=Pa[Pa.length-1]-1;const oa=Fa[0]-1;Fa=Fa[Fa.length-1]-1;ka=this.Vxb(ka);if(!ka){const La=this.Ze.lb(this.currentStateId)&&this.Ze.na(this.currentStateId).Sj?this.Ze.na(this.currentStateId).Sj.length:0;c.ULS.sendTraceTag(537170120,
0,15,`CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets ${La}`)}return J.daa("CreateBlockRangeLocation",ka,ba,oa,Pa,Fa)}VIg(ba,ka,Pa){if(Pa=this.rHe(ba,Pa)){var Fa=J.h6b(ba.getRowNumbers());ba=J.h6b(ba.getColumnNumbers());ka=excelOnlineCalc.calc.rangePromote(Pa,ka,Fa,ba);this.gaa[this.gaa.length]=ka}}XIg(ba,ka){if(ka=this.rHe(ba,ka)){var Pa=J.h6b(ba.getRowNumbers());ba=J.h6b(ba.getColumnNumbers());ba=excelOnlineCalc.calc.rangeWrite(ka,null,Pa,ba);this.gaa[this.gaa.length]=
ba}}w6g(ba,ka,Pa){let Fa=null,oa=0,La=0;switch(ka.valueType){case 2:Fa=this.Wjd(ka);var Ea=this.Wjd(Pa);Ea=B.a.equals(Ea,Fa,!1);break;case 1:null===ka.value&&null===Pa.value?Ea=!0:(oa=parseFloat(ka.value),Ea=parseFloat(Pa.value)===oa);break;default:null===ka.value&&null===Pa.value?Ea=!0:(La=parseFloat(ka.value),Ea=La===parseFloat(Pa.value))}Ea&&ka.valueType===Pa.valueType&&ka.ifmt===Pa.ifmt&&ka.formulaType===Pa.formulaType&&B.a.equals(Pa.formula,ka.formula,!1)||(void 0!==ka.formula&&null!==ka.formula||
void 0!==ka.value&&null!==ka.value||void 0!==ka.text&&null!==ka.text||this.gHh&&0!==ka.valueType?this.K_b(ba,ka,Fa,oa,La):this.Zpe(ba,ka))}qIg(ba){if(this.Lc.Cb&&this.Lc.Cb.items)for(let La=0;La<this.Lc.Cb.count;La++){var ka=this.Lc.Cb.items[La];if(2!==ka.type&&3!==ka.type)continue;var Pa=0,Fa=ka.name,oa=Fa.lastIndexOf("!");if(0<oa){Pa=Fa.substr(0,oa);"'"===Pa.charAt(0)&&(Pa=Pa.substr(1,Pa.length-2));Pa=this.djd(Pa,this.currentStateId);if(-1===Pa){ka=this.Ze.lb(this.currentStateId)&&this.Ze.na(this.currentStateId).Sj?
this.Ze.na(this.currentStateId).Sj.length:0;c.ULS.sendTraceTag(595096334,0,50,`CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets ${ka}`);continue}Fa=Fa.substr(oa+1)}Pa=this.Ze.na(this.currentStateId).Sj[Pa].v6;let Ea=ka.usedRange;2===ka.type&&(Ea=y.a(ka));if(Pa.lb(Fa)){if(oa=Pa.na(Fa),oa.range=Ea,oa.attributes=ka.attributes,2===oa.type&&(Fa=J.PXe(ka.name,ba),ka=(Pa=v.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc"))?ka.XO:null===
Fa||void 0===Fa?void 0:Fa.ColHeadersList,Fa||Pa))if(!oa.eF)oa.eF=new t(ka);else if(ka)for(const ca of ka.HeadersList)oa.eF.O$.ia(ca.Index,ca.Name)}else if(oa=this.Vxb(ka.sheetName)){oa=new I(ka.type,ka.name,Ea,oa,ka.attributes);if(2===oa.type)if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc")&&ka.XO)oa.eF=new t(ka.XO);else if(ka=J.PXe(ka.name,ba))oa.eF=new t(ka.ColHeadersList);Pa.ia(Fa,oa)}else ka=this.Ze.lb(this.currentStateId)&&this.Ze.na(this.currentStateId).Sj?
this.Ze.na(this.currentStateId).Sj.length:0,c.ULS.sendTraceTag(537170117,0,50,`CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets ${ka}`)}}K_b(ba,ka,Pa,Fa,oa){var La=ba.getRowNumbers()[ka.row]-1;ba=ba.getColumnNumbers()[ka.col]-1;La=J.daa("AddRangeUpdateCommand",this.htb,La,ba,La,ba);ba=null;let Ea=ka.formula||ka.text;const ca=excelOnlineCalc.calc.blankValue;let $a=null;void 0!==ka.text&&null!==ka.text||void 0!==ka.value&&null!==ka.value||(Pa="",$a="This cell contains blanks only",
0===ka.formulaType&&(Ea=""));switch(ka.valueType){case 2:null!==Pa&&(0===ka.formulaType&&(ba=excelOnlineCalc.calc.valueCellData(Ea,Pa,ka.ifmt,$a)),1===ka.formulaType&&(ba=excelOnlineCalc.calc.cellFormulaCellData(Ea,Pa,ka.ifmt,$a)),2===ka.formulaType&&(ba=excelOnlineCalc.calc.valueCellData("",ca,0,"This cell is a part of an array")));break;case 1:isNaN(Fa)?c.ULS.sendTraceTag(537170116,0,50,`CalcAsyncEngine::AddRangeUpdateCommand Cell(${ka.row},${ka.col}) invalid numeric value`):(0===ka.formulaType&&
(ba=excelOnlineCalc.calc.valueCellData(Ea,Fa,ka.ifmt,null)),1===ka.formulaType&&(ba=excelOnlineCalc.calc.cellFormulaCellData(Ea,Fa,ka.ifmt,null)),2===ka.formulaType&&(ba=excelOnlineCalc.calc.valueCellData("",ca,0,"This cell is a part of an array")));break;case 3:isNaN(oa)?c.ULS.sendTraceTag(537170115,0,15,`CalcAsyncEngine::AddRangeUpdateCommand Cell(${ka.row},${ka.col}) invalid boolean value`):(Pa=1===oa?!0:!1,0===ka.formulaType&&(ba=excelOnlineCalc.calc.valueCellData(Ea,Pa,ka.ifmt,null)),1===ka.formulaType&&
(ba=excelOnlineCalc.calc.cellFormulaCellData(Ea,Pa,ka.ifmt,null)),2===ka.formulaType&&(ba=excelOnlineCalc.calc.valueCellData("",ca,0,"This cell is a part of an array")));break;case 4:isNaN(oa)?c.ULS.sendTraceTag(537170114,0,15,`CalcAsyncEngine::AddRangeUpdateCommand Cell(${ka.row},${ka.col}) invalid error value`):(Pa=excelOnlineCalc.calc.errorValue(oa),0===ka.formulaType&&(ba=excelOnlineCalc.calc.valueCellData(Ea,Pa,ka.ifmt,null)),1===ka.formulaType&&(ba=excelOnlineCalc.calc.cellFormulaCellData(Ea,
Pa,ka.ifmt,null)),2===ka.formulaType&&(ba=excelOnlineCalc.calc.valueCellData("",ca,0,"This cell is a part of an array")));break;default:ba=excelOnlineCalc.calc.valueCellData("",ca,ka.ifmt,null)}ba&&(ka=excelOnlineCalc.calc.rangeWrite(La,ba,null,null),this.gaa[this.gaa.length]=ka)}WIg(ba,ka){switch(ka.valueType){case 2:this.K_b(ba,ka,this.Wjd(ka),null,0);break;case 1:this.K_b(ba,ka,null,parseFloat(ka.value),0);break;default:this.K_b(ba,ka,null,null,parseFloat(ka.value))}}Zpe(ba,ka){var Pa=ba.getRowNumbers()[ka.row]-
1;ba=ba.getColumnNumbers()[ka.col]-1;Pa=J.daa("AddRangeUpdateCommandEmptyCell",this.htb,Pa,ba,Pa,ba);ka=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,ka.ifmt,null);ka=excelOnlineCalc.calc.rangeWrite(Pa,ka,null,null);this.gaa[this.gaa.length]=ka}Vxb(ba){ba=this.djd(ba,this.currentStateId);return 0<ba?this.Ze.na(this.currentStateId).Sj[ba].Q7.sheetId:null}djd(ba,ka){if(!this.Ze.lb(ka))return c.ULS.sendTraceTag(537170113,0,15,`CalcAsyncEngine.GetSheetInternalIndex StateId:${ka} does not exist in GridCache`),
-1;const Pa=this.Ze.na(ka);return Pa.Sj?Pa.getSheetIndex(ba):(c.ULS.sendTraceTag(537170112,0,15,`CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:${ka}`),-1)}Jyj(){if(!this.Ze.lb(this.currentStateId)||!this.Ze.na(this.currentStateId).Sj.length)return c.ULS.sendTraceTag(537170083,0,15,`CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:${this.currentStateId} or StateId does not exist in GridCache`),!1;const ba=[];for(let ka=1;ka<this.Ze.na(this.currentStateId).Sj.length;ka++){const Pa=
this.Ze.na(this.currentStateId).Sj[ka];Pa&&ba.push(Pa.Q7)}this.fr.updateSheetNames(this.currentStateId,ba);this.fr.updateUnusedCells(this.currentStateId,this.Ze.na(this.currentStateId).Ahg);return!0}setNumberFormats(){if(this.instantaneousSupportInformationManager){var ba=[];for(const ka of this.instantaneousSupportInformationManager.Vya){const Pa=excelOnlineCalc.calc.numberFormat(ka.IfmtIndex,ka.FormatString,ka.Builtin);ba.push(Pa)}this.fr.setNumberFormats(ba,!0)}}dvj(){if(this.instantaneousSupportInformationManager&&
this.instantaneousSupportInformationManager.Ke){var ba=this.rfi();if(!this.xwd||ba)this.g6b(),this.instantaneousSupportInformationManager.Ke.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.Ke.TrueValueString),this.instantaneousSupportInformationManager.Ke.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.Ke.FalseValueString),ba=D.CalcHelper.mIe(this.instantaneousSupportInformationManager,ba),this.fr.setLocale(ba),this.xwd=!0}}xzj(){var ba=null;
if(void 0!==this.Lc.workbookContext.TimeZoneInformation&&null!==this.Lc.workbookContext.TimeZoneInformation){ba=null;this.Lc.workbookContext.TimeZoneInformation.StandardDate.Month&&(ba=excelOnlineCalc.date.dateTime(this.Lc.workbookContext.TimeZoneInformation.StandardDate.Year,this.Lc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Lc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Lc.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Lc.workbookContext.TimeZoneInformation.StandardDate.Minute,
this.Lc.workbookContext.TimeZoneInformation.StandardDate.Second,this.Lc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Lc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));let ka=null;this.Lc.workbookContext.TimeZoneInformation.DaylightDate.Month&&(ka=excelOnlineCalc.date.dateTime(this.Lc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Lc.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Lc.workbookContext.TimeZoneInformation.DaylightDate.Day,
this.Lc.workbookContext.TimeZoneInformation.DaylightDate.Hour,this.Lc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Lc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Lc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Lc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,3));ba=excelOnlineCalc.date.tzData(this.Lc.workbookContext.TimeZoneInformation.Bias,ba,this.Lc.workbookContext.TimeZoneInformation.StandardBias,ka,this.Lc.workbookContext.TimeZoneInformation.DaylightBias)}else c.ULS.sendTraceTag(537170082,
0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");ba=excelOnlineCalc.calc.workbookProps(this.Lc.workbookContext.F1904,this.Lc.workbookContext.FDateCompatibility,ba);this.fr.setWorkbookProps(ba)}Yoa(){v.EwaSettings.ma(300)&&m.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.D$f,!0)).continueWith(Fa=>{Fa.exception?c.ULS.sendTraceTag(537170079,0,15,`CalcAsyncEngine.TryInitialize: calc smoke test failed: ${Fa.exception.toString()}`):c.ULS.sendTraceTag(537170080,0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});
const ba=v.EwaSettings.ma(644)?r.local:r.JOj,[ka,Pa]=w.a.IV(this.Lc)?[excelOnlineCalc.x10.PluginSchedulerSingleton.instance(),excelOnlineCalc.x10.GridImportManagerSingleton.instance()]:[void 0,void 0];this.iKd=m.c(excelOnlineCalc.calc.createRecalcService(ba,ka,Pa));this.iKd.continueWith(Fa=>{Fa.exception?c.ULS.sendTraceTag(537170075,0,50,`CalcAsyncEngine.TryInitialize: Calc web worker failed: ${Fa.exception.toString()}`):(c.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),
(this.fr=this.iKd.result)?this.tQb(0)?this.nxj():c.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):c.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})}rfi(){const ba=this.instantaneousSupportInformationManager.Hja;if(!ba||this.ZHd===ba.length)return null;this.ZHd=ba.length;return D.CalcHelper.$He(ba)}g6b(){this.errorTypeNames=D.CalcHelper.g6b()}tfi(){if(!(this.Ze.lb(this.currentStateId)&&0<this.Ze.na(this.currentStateId).Sj.length)){this.Ze.ia(this.currentStateId,
new L(this.$qd));this.Ze.na(this.currentStateId).n5f(0,new H(null));var ba=this.Lc.xa;for(let Fa=0;Fa<ba.count;Fa++){var ka=Object(h.a)(C.a,ba.getItem(Fa));if(ka){void 0!==ka.sheetId&&null!==ka.sheetId&&void 0!==ka.name&&null!==ka.name&&ka.sheetId.length&&ka.sheetName.length||c.ULS.sendTraceTag(537170074,0,15,`CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:${Fa} Id:${ka.sheetId} Hash:${ka.hash} NameLength:${ka.name?ka.name.length:-1}`);var Pa=void 0;Pa=excelOnlineCalc.calc.sheetName(ka.sheetId,
ka.name);this.Ze.na(this.currentStateId).n5f(Fa+1,new H(Pa));Pa=ka.usedRange.DS();Pa=excelOnlineCalc.calc.rangeLocation(0,0,Pa.LastRow,Pa.LastColumn);ka=excelOnlineCalc.calc.unusedCellsUpdate(ka.sheetId,Pa);this.Ze.na(this.currentStateId).Ahg.push(ka)}else c.ULS.sendTraceTag(537170073,0,15,`CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:${this.currentStateId} sheet-index:${Fa}`)}}}f3g(){for(let ba of this.Ze)ba.key<this.Rt&&this.Ze.remove(ba.key)}Wjd(ba){ba=ba.value||ba.text;
if(void 0===ba||null===ba)ba="";return ba}FVj(){if(!this.Ze.lb(this.currentStateId))return!1;let ba=!1;f.a.forEach(this.Ze.na(this.currentStateId).w0a,(ka,Pa)=>{Pa.Axc||(ba=!0)},null);return ba}d6c(ba){const ka={};ka.reason=ba;ka.kind=1;return ka}Ric(){return this.Ze.lb(this.currentStateId)&&this.Ze.na(this.currentStateId).Sj&&this.Ze.na(this.currentStateId).Sj[0]&&this.Ze.na(this.currentStateId).Sj[0].v6?!0:!1}static Gah(ba){const ka=[];if(null===ba||void 0===ba?0:ba.O$)for(let Pa of ba.O$)ba=excelOnlineCalc.calc.columnData(Pa.key,
Pa.value),ka.push(ba);return ka}static OIi(ba,ka){if(ba.type!==ka.type||ba.attributes!==ka.attributes||!B.a.equals(ba.fullName,ka.fullName,!1)||!ba.range.equals(ka.range))return!1;if(!ba.eF&&!ka.eF)return!0;if(!ba.eF||!ka.eF||ba.eF.O$.count!==ka.eF.O$.count)return!1;for(let Pa of ba.eF.O$){let Fa;if(!(Pa.value&&({value:Fa}=ka.eF.O$.Dc(Pa.key)).returnValue&&Fa&&B.a.equals(Pa.value,Fa,!1)))return!1}return!0}static CWc(ba,ka,Pa){var Fa=J.daa("NamedObject",ka.sheetId,ka.range.top-1,ka.range.left-1,ka.range.bottom-
1,ka.range.right-1);if(2===ka.type){const oa=!!(ka.attributes&16),La=!!(ka.attributes&8);ka=J.Gah(ka.eF);Fa=excelOnlineCalc.calc.namedTableData(Fa,oa,La,ka);ba=excelOnlineCalc.calc.namedObject(ba,Fa)}else Fa=excelOnlineCalc.calc.namedRangeData(Fa),ba=excelOnlineCalc.calc.namedObject(ba,Fa);Pa.push(ba)}static I0e(ba){const ka=Sys.Serialization.JavaScriptSerializer.serialize(ba.getRowNumbers());ba=Sys.Serialization.JavaScriptSerializer.serialize(ba.getColumnNumbers());return ka+ba}static h6b(ba){let ka=
null;if(1<ba.length)for(let Pa=1;Pa<ba.length;Pa++){let Fa=0;for(;ba[Pa-1]+1+Fa<ba[Pa];)ka=ka||[],ka.push(ba[Pa-1]+Fa),Fa++}return ka}static PXe(ba,ka){if(!ka)return null;for(let Pa=0,Fa=ka.length;Pa<Fa;++Pa)if(B.a.equals(ba,ka[Pa].Name,!1))return ka[Pa];return null}static daa(ba,ka,Pa,Fa,oa,La){const Ea=(ca,$a,Qa,Va)=>{(0>Qa||Qa>=Va)&&c.ULS.sendTraceTag(537170072,0,15,`CalcAsyncEngine::CreateSheetRangeLocation() callerId:${ca} invalid ${$a}:${Qa}`)};void 0!==ka&&null!==ka||c.ULS.sendTraceTag(537170071,
0,15,`CalcAsyncEngine::CreateSheetRangeLocation() callerId:${ba} sheetId is null`);Ea(ba,"top",Pa,J.Tuf);Ea(ba,"left",Fa,J.Yyd);Ea(ba,"bottom",oa,J.Tuf);Ea(ba,"right",La,J.Yyd);return excelOnlineCalc.calc.sheetRangeLocation(ka,Pa,Fa,oa,La)}}J.Tuf=1048576;J.Yyd=16384;Object(u.a)(J,"CalcAsyncEngine",null,[2]);class M{constructor(){this.FK=this.GK=this.NF=this.OF=this.z_=!1}}Object(u.a)(M,"AbsoluteRelativeReferenceInfo",null,[]);var Q=a(980),U=a(24);class Z{}Z.gNf="#";Object(u.a)(Z,"Operators",null,
[]);var P=a(981);class S{}S.sheet="Sheet";S.sheetRange="SheetRange";S.document="Document";S.aci="Ident";Object(u.a)(S,"TraverseFormulaQualifierTypes",null,[]);var ja=a(982),X=a(873),Y=a(791),va=a(40),N=a(55),ea=a(68),Ca=a(290),la=a(38);class Ra extends Sys.EventArgs{constructor(ba){super();this.lk=ba}}Object(u.a)(Ra,"EditedCellRecalcCompleteEventArgs",Sys.EventArgs,[]);class lb extends la.a{constructor(ba){super();this.pu=null;this.amg=!1;this.xOd=this.instantaneousSupportInformationManager=this.JHb=
null;this.LBd=new Map;this.Ufe=null;this.Jpc=ka=>{c.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");ka.uMd(this.Jpc);ka.Hja.length?this.ppc(ka,Sys.EventArgs.Empty):(c.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),ka.mre(this.ppc))};this.ppc=ka=>{c.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");ka.mMd(this.ppc);this.nTj(ka)};this.onContentReady=()=>{this.pu&&(this.instantaneousSupportInformationManager&&
this.instantaneousSupportInformationManager.Iod||N.Task.delay(0).continueWith(()=>{this.pu.tQb(1)},0,null,ea.a.current))};this.Jzf=(ka,Pa)=>{this.pu&&(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Iod||this.pu.yJe(Pa.Yc.block))};c.ULS.sendTraceTag(537170067,0,50,"Creating CalcManager");this.qhc=!1;this.jb=ba;this.yq=z.h(ba);this.$Hc=null;this.gridView.lv(this.onContentReady);this.gridView.Da.$Wc(this.Jzf);this.$.da.$a(268,ka=>{ka.Ke?(c.ULS.sendTraceTag(537170066,
0,50,"CalcManager.ctor: LocaleInformation already available..."),this.Jpc(ka,Sys.EventArgs.Empty)):(c.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),ka.Kre(this.Jpc))})}lLg(ba){this.addHandler(lb.sOe,ba)}Axf(ba){this.raiseEvent(lb.sOe,new Ra(ba))}get fs(){return this.$Hc}get gridView(){return this.yq}get $(){return this.jb}get IB(){return this.Ufe}get localeInfo(){return this.fs?this.fs.config.localeInfo:null}get config(){return this.fs.config}dispose(){c.ULS.sendTraceTag(537170064,
0,50,"CalcManager.Dispose called");this.$.da.$a(268,ba=>{ba.uMd(this.Jpc);ba.mMd(this.ppc)});this.gridView&&(this.gridView.Ky(this.onContentReady),this.gridView.Da&&this.gridView.Da.cVf(this.Jzf),this.yq=null);this.$Hc=null;v.EwaSettings.isChangeGateEnabled("OfficeVSO:7108565_CalcNotInitializedAfterDisposed")&&(this.qhc=!1)}UZg(ba,ka,Pa,Fa=null){return this.pu?this.pu.SZg(ba,ka,Pa,Fa):!1}evalFormula(ba,ka,Pa,Fa){return this.pu?this.pu.evalFormula(ba,ka,Pa,Fa):Promise.reject("calc engine not initialized")}Tub(ba,
ka,Pa,Fa){return this.pu?this.pu.Tub(ba,ka,Pa,Fa):Promise.reject("CalcEngine is null")}x5a(ba){return this.pu?(c.ULS.shipAssertTag(537170059,0,2===ba.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.pu.x5a(ba)):null}kte(ba,ka){if(!ka||2!==ba.type)return!1;ba=y.a(ba);return ba.right-ba.left+1===ka.count}zWe(ba,ka){if(!this.JHb)return this.amg||c.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var Pa=this.Eta(U.Range.Qc(1,1));
Pa=this.JHb.parseFormula(excelOnlineCalc.parse.parseLocals(1,Pa.range),ba);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(Pa))return c.ULS.sendTraceTag(537170056,0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{let Fa;if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:6518739_FlightRemovalStructuredReferencesHighlighting")){const oa=null!==ka&&void 0!==ka?ka:this.gridView.ha.ra.activeCell,La=excelOnlineCalc.location.gridCell(oa.top-1,oa.left-1),Ea=excelOnlineCalc.location.documentLoc("",
this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),ca=excelOnlineCalc.location.sheetIndex(Ea,this.$.xa.oa.sheetId),$a=this.afh(La,ca);this.xOd||(this.xOd=excelOnlineCalc.util.createResolver(this.$eh()));Fa=excelOnlineCalc.parse.parseResultHelper.extractReferences(Pa,this.fs.config.localeInfo,v.EwaSettings.ma(581),$a,this.xOd)}else Fa=excelOnlineCalc.parse.parseResultHelper.extractReferences(Pa,this.fs.config.localeInfo,v.EwaSettings.ma(581));v.EwaSettings.ma(101)&&this.ZYj(Fa,ba);return Fa}catch(Fa){return c.ULS.sendTraceTag(537170055,
0,10,`CalcManager.ExtractReferenceWrappers - exception: ${Fa.message}`),null}}extractLetVariables(ba,ka){if(!this.JHb)return this.amg||c.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;const Pa=this.Eta(U.Range.Qc(1,1));ba=this.JHb.parseFormula(excelOnlineCalc.parse.parseLocals(1,Pa.range),ba);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(ba))return c.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;
try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(ba,ka,this.fs.config.localeInfo)}catch(Fa){return c.ULS.sendTraceTag(537170052,0,10,`CalcManager.ExtractLetVariables - exception: ${Fa.message}`),null}}extractReferences(ba,ka,Pa,Fa,oa){if(!ka)return c.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!Pa)return c.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;oa=this.zWe(ba,oa);if(!oa)return c.ULS.sendTraceTag(537170049,
0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.Ydh(oa,ka,Pa,ba,Fa)}catch(La){return c.ULS.sendTraceTag(537170048,0,10,`CalcManager.ExtractReferences - exception: ${La.message}`),null}}z2h(ba,ka,Pa,Fa){if(!ba)return c.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!ka||0>=ka.length)return c.ULS.sendTraceTag(537170018,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),
null;ba=this.Eta(ba);if(!this.fs||!ba)return null;const oa=this.Gwb(ba).returnValue;if(!oa||oa.k7a)return null;Pa=excelOnline.utils.getCharIndexInTextFromPoint(Pa,Fa,v.EwaSettings.ma(581));return 0>Pa?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.fs.config,Pa,ka,ba)}JZg(ba,ka,Pa,Fa){if(!ba)return c.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;let oa=null;return this.evalFormula(ka,ba,void 0,excelOnlineCalc.calc.evalFormulaFormatOrigin()).then(La=>
{let Ea;const ca=({kind:Ea}=this.fs.Ish(La,Pa)).returnValue;8!==Ea||ca.length&&ca!==D.CalcHelper.unknownError?La=0:(c.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),La=excelOnlineCalc.calc.getEvalFailureReason(La),void 0!==La&&null!==La||c.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),La=1);return oa=Fa?new Q.a(ca,Fa.start,Fa.end,La):new Q.a(ca,-1,-1,La)},La=>
{c.ULS.sendTraceTag(537170014,0,10,`EvalSession.GetPartialResultValueForFormula - exception: ${La}`);return Promise.resolve(oa)})}getSubExpressionSpan(ba){return this.fs&&ba?excelOnlineCalc.runtime.getSubExpressionSpan(ba):null}getFormulaSubExpressionObject(ba,ka,Pa){return this.fs&&ba&&ka&&Pa?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.fs.config,ka,Pa,this.Eta(ba)):null}C2h(ba,ka,Pa){return this.fs&&ba&&ka?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.fs.config,ka,
Pa,this.Eta(ba)):null}A2h(ba,ka,Pa){return this.fs&&ba&&ka?excelOnlineCalc.runtime.getSubExpressionSubspans(this.fs.config.localeInfo,ka,Pa):null}LWh(){return this.fs?this.fs.config.localeInfo.listSeparator:null}isFormulaSubExpressionVolatile(ba){return this.fs?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.fs.config.localeInfo,ba):!1}Eta(ba,ka=!0){return ba&&this.fs?this.fs.xfh(this.fs.mhh(),ba.top-1,ba.left-1,ka):null}Iif(ba,ka){if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:7173486_IsFormulaCellRefactor")){ba=
this.f5a(ba);if(!Object(Ca.c)(ba))return null;ka=this.IB.parseEdit(ka,ba.value);return excelOnlineCalc.util.isSuccess(ka)?ka.value.kind===X.a.formula:null}ba=this.mdc(ba);if(void 0===ba||null===ba)return null;ba=this.IB.createFormat(ba.FormatString,ba.Builtin);if(!excelOnlineCalc.util.isSuccess(ba))return null;ka=this.IB.parseEdit(ka,ba.value);return excelOnlineCalc.util.isSuccess(ka)?ka.value.kind===X.a.formula:null}kti(ba){ba=this.f5a(ba);return Object(Ca.c)(ba)?"Text"===ba.value.valueType:null}f5a(ba){if(null==
this.IB)return Object(Ca.a)("Number formatter is null");if(null==this.instantaneousSupportInformationManager)return Object(Ca.a)("Instantaneous manager is null");if(this.LBd.has(ba))return Object(Ca.d)(this.LBd.get(ba));if("number"===typeof ba){var ka=this.mdc(ba);if(null==ka)return Object(Ca.a)(`Invalid ifmt=${ba}`);var Pa=ka.FormatString;ka=ka.Builtin}else Pa=ba,ka=!1;Pa=this.IB.createFormat(Pa,ka);return excelOnlineCalc.util.isSuccess(Pa)?(this.LBd.set(ba,Pa.value),Object(Ca.d)(Pa.value)):Object(Ca.a)("Could not create number format")}getWorksheetFuncId(ba){return this.localeInfo.getWorksheetFuncId(ba)}Ydh(ba,
ka,Pa,Fa,oa){const La={Items:[]};for(let Qa=0;Qa<ba.length;Qa++){var Ea=ba[Qa];const Va={};Va.Start=Ea.span.start;Va.End=Ea.span.end;if(oa||Ea.kind!==P.a.func)if(oa||Ea.kind!==P.a.Xxi){if(!this.$nh(Ea,ka,Pa))continue;var ca=new M;const fb=this.w_h(Ea,ka,ca,Fa);if(v.EwaSettings.ma(581)){var $a=this.CWh(Ea);const Ka=this.BWh(Ea);if(fb||Ka&&0<=$a){let hb={};hb.Span=Va;hb.LetNumber=$a;hb.LetName=Ka;hb.Range=fb;hb.IsRangeRef=ca.z_;hb.IsAbsoluteFirstRow=ca.OF;hb.IsAbsoluteFirstColumn=ca.NF;hb.IsAbsoluteSecondRow=
ca.GK;hb.IsAbsoluteSecondColumn=ca.FK;hb.IsStructRef=Ea.kind===P.a.KXd;La.Items.push(hb)}}else fb&&($a={},$a.Span=Va,$a.Range=fb,$a.IsRangeRef=ca.z_,$a.IsAbsoluteFirstRow=ca.OF,$a.IsAbsoluteFirstColumn=ca.NF,$a.IsAbsoluteSecondRow=ca.GK,$a.IsAbsoluteSecondColumn=ca.FK,$a.IsStructRef=Ea.kind===P.a.KXd,La.Items.push($a))}else Ea=Ea.ref.value.oper.kind,ca={},ca.Span=Va,ca.IsString=2===Ea,ca.IsBoolean=4===Ea,ca.IsNumber=1===Ea,La.Items.push(ca);else Va.End=Ea.span.start+Ea.ref.name.length,Ea={},Ea.Span=
Va,Ea.IsFunction=!0,Ea.FunctionId=this.getWorksheetFuncId(Fa.substring(Va.Start,Va.End)),La.Items.push(Ea)}La.Items.sort((Qa,Va)=>Qa.Span.Start-Va.Span.Start);return La}CWh(ba){return ba.kind===P.a.Kpf?ba.ref.number:-1}BWh(ba){return ba.kind===P.a.Kpf?ba.ref.name:null}w_h(ba,ka,Pa,Fa){if(ba.kind===P.a.range)return Pa.z_=!0,this.rGe(ba,ka,Pa,Fa);if(ba.kind===P.a.namedRange){Pa=ba.ref;(ba=this.$.Cb.getItemByName(Pa.name))||(ba=this.$.Cb.getItemByName(ka+"!"+Pa.name));if(!(ba&&ba.sheetName&&ba.usedRange&&
B.a.equals(ba.sheetName,ka,!0)))return null;ka=2===ba.type?y.a(ba):ba.usedRange;return va.m(ka,ba)}if(ba.kind===P.a.KXd){let oa=ba.ref,La;oa.name?(La=this.$.Cb.getItemByName(oa.name))||(La=this.$.Cb.getItemByName(ka+"!"+oa.name)):La=this.gridView.Bb.Bj(this.gridView.ha.ra.activeCell);if(!(La&&La.sheetName&&La.usedRange&&B.a.equals(La.sheetName,ka,!0)))return null;Pa.z_=!1;return this.rGe(ba,ka,Pa,Fa)}return null}rGe(ba,ka,Pa,Fa){ba=ba.ref;if(ba.type){if(ba.type===ja.a.column){var oa=ba.startIndex;
ba=ba.endIndex;Pa.NF=oa.kind===Y.a.abs;Pa.FK=ba.kind===Y.a.abs;return this.createRange(0,oa.index,e.a.fh,ba.index,ka)}if(ba.type===ja.a.row)return oa=ba.endIndex,Pa.OF=ba.startIndex.kind===Y.a.abs,Pa.GK=oa.kind===Y.a.abs,this.createRange(ba.startIndex.index,0,ba.endIndex.index,e.a.sh,ka);if(ba.type===ja.a.cell){oa=ba.row;var La=ba.col;Pa.OF=Pa.GK=oa.kind===Y.a.abs;Pa.NF=Pa.FK=La.kind===Y.a.abs;return this.E3b(ba.span.end,Fa)&&(Pa=U.Range.Qc(oa.index+1,La.index+1),Pa=this.gridView.Bb.A7e(Pa))?va.n(Pa,
ka):this.createRange(oa.index,La.index,oa.index,La.index,ka)}if(ba.type===ja.a.range){oa=ba.top;La=ba.left;Fa=ba.bottom;ba=ba.right;const Ea=Math.min(oa.index,Fa.index),ca=Math.min(La.index,ba.index),$a=Math.max(oa.index,Fa.index),Qa=Math.max(La.index,ba.index);Pa.OF=oa.kind===Y.a.abs;Pa.GK=Fa.kind===Y.a.abs;Pa.NF=La.kind===Y.a.abs;Pa.FK=ba.kind===Y.a.abs;return this.createRange(Ea,ca,$a,Qa,ka)}c.ULS.sendTraceTag(537170010,0,10,`CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '${ba.type}'`);
return null}c.ULS.sendTraceTag(537170011,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null}E3b(ba,ka){return ka.length>=ba&&0<ba&&ka.charAt(ba-1)===Z.gNf}PZg(ba,ka,Pa){this.pu&&this.pu.TZg(ba,ka,Pa)}mdc(ba){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Vya&&this.instantaneousSupportInformationManager.Vya[ba]&&this.IB?this.instantaneousSupportInformationManager.Vya[ba]:null}toXLNumber(ba){if(!this.IB)return null;
ba=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.IB,ba);return excelOnlineCalc.util.isSuccess(ba)?ba.value:null}ZYj(ba,ka){if(ba)for(const Pa of ba)Pa.ref.type&&Pa.ref.type===ja.a.cell&&(ba=Pa.ref,lb.B4i(ba,ka)&&(ba.span.end+=1,Pa.span.end+=1))}createRange(ba,ka,Pa,Fa,oa){const La={};La.FirstRow=ba;La.FirstColumn=ka;La.LastRow=Pa;La.LastColumn=Fa;La.SheetName=oa;return La}$nh(ba,ka,Pa){var Fa=ba.ref.qualifier;if(!Fa)return!0;switch(ba.ref.qualifier.type){case S.sheet:return ba=Fa.document,
B.a.equals(Fa.sheet,ka,!0)&&(!ba||B.a.equals(ba.document,Pa,!0));case S.sheetRange:return ka=this.$.xa.getItemByName(ka),Pa=this.$.xa.getItemByName(Fa.sheet1),Fa=this.$.xa.getItemByName(Fa.sheet2),!!ka&&!!Pa&&!!Fa&&(Pa.index<=ka.index&&ka.index<=Fa.index||Fa.index<=ka.index&&ka.index<=Pa.index);case S.document:return B.a.equals(Fa.document,Pa,!0);case S.aci:return Fa=Fa.name,B.a.equals(Fa,ka,!0)||B.a.equals(Fa,Pa,!0);default:return c.ULS.sendTraceTag(537170009,0,10,`CalcManager.GetQualifierData: Unsupported formula qualifier type '${Fa.type}'`),
!1}}nTj(ba){this.instantaneousSupportInformationManager=ba;ba.Vya.length&&ba.Hja.length?(this.$Hc=new D.CalcHelper(this.gridView.$),this.JHb=this.fs.createParser(),this.Ufe=this.fs.createNumberFormatter(),this.qhc=!0,c.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),this.pu||(c.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.pu=new J(this.$))):c.ULS.sendTraceTag(537170008,0,15,`CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = ${ba.Vya.length}, functions info count = ${ba.Hja.length}`)}Gwb(ba){if(!ba)return{returnValue:null,
emptyCell:!1};var ka=this.getSheetName(ba.sheet.index);if(!ka)return c.ULS.sendTraceTag(537169998,0,50,`CalcManager.GetCellFromBlockCache: No sheet index ${ba.sheet.index}`),{returnValue:null,emptyCell:!1};const Pa=lb.convertToRange(ba);ka=this.gridView.Gwb(ka,Pa.top,Pa.left);return ka?ka.Wnh?{returnValue:ka,emptyCell:!1}:(c.ULS.sendTraceTag(537169996,0,50,`CalcManager.GetCellFromBlockCache: cell ${ba.range.row} ${ba.range.col} is empty`),{returnValue:null,emptyCell:!0}):(c.ULS.sendTraceTag(537169997,
0,50,`CalcManager.GetCellFromBlockCache: cellProxy is null for cell ${ba.range.row} ${ba.range.col}`),{returnValue:null,emptyCell:!1})}getSheetName(ba){const ka=this.gridView.$.xa.getItem(ba);return ka?ka.sheetName:(c.ULS.sendTraceTag(537169995,0,50,`CalcManager.GetSheetName - no sheet in index ${ba}`),null)}afh(ba,ka){const Pa={allowUnqualifiedCell:!0,wrapCellReferences:!0};Pa.config=this.fs.config;Pa.originGridCell=excelOnlineCalc.util.success(ba);Pa.originSheet=excelOnlineCalc.util.success(ka);
return Pa}$eh(){const ba={};ba.config=this.fs.config;ba.getNameLoc=this.pu.getNameLoc;ba.getContainingTable=this.pu.getContainingTable;ba.getStructRefColumn=this.pu.getStructRefColumn;ba.getStructRefSpecialRef=this.pu.getStructRefSpecialRef;ba.getDocumentLoc=this.pu.getDocumentLoc;ba.getSheetIndex=this.pu.getSheetIndex;ba.getSheetName=this.pu.getSheetName;ba.getUserDefinedFuncLoc=this.pu.getUserDefinedFuncLoc;ba.getSheetRangeIndexes=this.pu.getSheetRangeIndexes;return ba}static B4i(ba,ka){return ka.length>
ba.span.end&&ka.charAt(ba.span.end)===Z.gNf}static convertToRange(ba){return U.Range.Qc(ba.range.row+1,ba.range.col+1)}}lb.sOe="ECRC";Object(u.a)(lb,"CalcManager",la.a,[580,2]);var Aa=a(37),da=a(52);class aa extends b.a{constructor(ba){super();this.$=ba;this.Fb()}create(){if(this.$){c.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var ba=76;var ka="Current"}else ba=79,ka="Stable";
c.ULS.sendTraceTag(537169992,0,50,`CalcManagerFactory.Create: Calc ${ka} JS was loaded`);Aa.TaskExtensions.za(da.a.loadScript(ba,4,this.Ya,void 0,void 0,265),()=>{c.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");let Pa=this.$.da.Aa(266,!1);Pa||(c.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),Pa=new lb(this.$),this.$.da.Ga(266,Pa));this.nb(Pa)},this.ka,3)}else c.ULS.sendTraceTag(537169994,
0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")}static la(ba){ba&&ba.da&&ba.da.Ga(265,new aa(ba))}}Object(u.a)(aa,"CalcManagerFactory",b.a,[]);var fa=a(9);a.d(F,"a",function(){return Oa});const Oa=()=>{fa.a.Fa(aa.la)}},1208:function(u,F,a){var c=a(9);u=a(0);var b=a(15),e=a(222),f=a(89),d=a(4),h=a(187),n=a(8),m=a(38),x=a(872),r=a(226),y=a(60),t=a(871);class v extends Sys.EventArgs{constructor(){super()}}Object(u.a)(v,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);
var w=a(47),C=a(46);a(35);var B=a(29),z=a(1),A=a(613);a(22);var E=a(281),I=a(21);a(175);class L{constructor(J){this.data=J}}Object(u.a)(L,"NumberFormatDataHolder",null,[]);var V=a(177);class T extends m.a{constructor(J,M){super();this.jlc=n.a.re;this.F0c=null;this.fhb=this.Vkc=!1;this.Nyf=(Q,U)=>{var Z;(Q=I.h(this.$))&&(U=null!==(Z=null===U||void 0===U?void 0:U.cell)&&void 0!==Z?Z:Q.Sb(null))&&this.pCa(U.cell.Gj,!0)};this.mQi=Q=>{this.isActive()&&(B.a.Lq(Q.Errors)||!Q.Result?(Q=Q.Errors?Q.Errors.map(U=>
JSON.stringify(U)).join(","):"None",b.ULS.sendTraceTag(537155726,0,50,`GetCategoryFromServer failed, ignoring - server errors: ${Q}`)):(Q=Q.Result,b.ULS.sendTraceTag(537155725,0,50,`Updating number format category cache, format index = ${Q.Index}, category = ${Q.Category}`),this.jxj(Q.Index,Q.Category),this.raiseEvent(T.D1c,new x.a(Q.Index,Q.Category),this)))};this.refresh=()=>{b.ULS.sendTraceTag(537155722,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");this.p3b();this.isActive()&&
this.ea.dc.allowEdits&&(this.fhb||this.Hn&&!(this.ea.jDb>this.jlc)?this.nFc():(b.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information."),this.phd=t.a(this.$.pa.ya,this.Hn?this.Hn.Digest:"",this.UQi,this.TQi,null,null)),b.ULS.sendTraceTag(537155720,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info."),this.g3e())};this.bDf=Q=>{b.ULS.sendTraceTag(537155716,0,50,`InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = ${Q.data.status}, HTTP status = ${Q.data.httpStatus}.`);
this.kLa=null};this.j0=()=>{this.fhb=!1;this.ea.cE(this.j0);this.lSa(this.Vkc?T.PTd:T.gBd)};this.Tc=(Q,U)=>{b.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");r.a(U)&&this.lSa(T.PTd)};this.Bf=()=>{b.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==this.$.workbookContext.CalcMode&&this.tBd(0===this.$.workbookContext.CalcMode)};this.ed=()=>{b.ULS.sendTraceTag(537155713,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");
this.lSa(T.PTd);z.EwaSettings.ma(296)&&3!==this.$.workbookContext.CalcMode&&this.tBd(0===this.$.workbookContext.CalcMode)};this.MQi=(Q,U,Z)=>{b.ULS.sendTraceTag(537155712,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");this.kLa=null;this.isActive()?Q.StateId===n.a.re?(b.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),this.nFc()):!Q.Result||this.eY&&this.eY.length?this.lSa(T.gBd):this.LGf(Q,
U,Z):b.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};this.LGf=Q=>{this.eY=Q.Result;b.ULS.sendTraceTag(537155681,0,50,`InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned ${this.eY?this.eY.length:-1} functions.`);Q=!1;if(this.eY){for(const U of this.eY)U&&(this.OZe[U.NameUI.toLocaleUpperCase()]=U.FunctionIndex.toString(),U.NameUI!==U.NameDataStrings&&(this.OZe[U.NameDataStrings.toLocaleUpperCase()]=
U.FunctionIndex.toString(),Q=!0),this.RJh.ia(U.FunctionIndex,U.NameUI));this.raiseEvent(T.ted,Sys.EventArgs.Empty,this)}Q&&b.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};this.UQi=Q=>{if(this.isActive())if(b.ULS.shipAssertTag(537155679,0,!!this.$,"null ewaControl"),this.Vkc=!1,this.jlc=Q.StateId,this.jlc===n.a.re)this.Vkc=!0,this.nFc();else{if(Q.Result){var U=this.Hn;this.Hn=Q.Result;b.ULS.sendTraceTag(537155678,
0,50,`InstantaneousSupportInformation updated, new result digest: ${this.Hn.Digest}.`);Q=[];if(U)Q=T.rXh(U.NumberFormats,this.Hn.NumberFormats);else for(U=0;U<this.Hn.NumberFormats.length;U++)this.eoc.ia(U,this.Hn.NumberFormats[U].NumberFormatCategory);for(const Z of Q)this.eoc.ia(Z,this.Hn.NumberFormats[Z].NumberFormatCategory);this.raiseEvent(T.QBd,new v(Q),this);z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",!1)&&this.raiseEvent(T.Iqf)}this.lSa(T.gBd)}};
this.TQi=Q=>{this.isActive()&&(10===Q.data.status?b.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):(b.ULS.sendTraceTag(21311555,0,10,`Failed to update instantaneous support information, status = ${Q.data.status}, HTTP status = ${Q.data.httpStatus}.`),this.Vkc=!0,this.nFc()))};b.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");this.ea=J;this.$=M;this.Hn=this.kLa=this.phd=this.tJb=null;this.eoc=new V.a;this.Fwb=new V.a;this.eY=
[];this.RJh=new V.a;this.OZe={};this.ea.Wj(this.Tc);this.$.ll(this.ed);I.h(this.$).ha.eha(this.Nyf);z.EwaSettings.ma(296)&&this.ea.nu(this.Bf);this.lSa(T.Adf);b.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end")}Kre(J){this.addHandler(T.QBd,J)}uMd(J){this.removeHandler(T.QBd,J)}JKg(J){this.addHandler(T.D1c,J)}fgj(J){this.removeHandler(T.D1c,J)}mre(J){this.addHandler(T.ted,J)}mMd(J){this.removeHandler(T.ted,J)}lMg(J){this.addHandler(T.Iqf,J)}get Ke(){return this.Hn?
this.Hn.LocaleInformation:null}get Vya(){return this.Hn?this.Hn.NumberFormats:[]}get Hja(){this.eY&&this.eY.length||this.g3e();return this.eY}get thi(){return this.Hn&&void 0!==this.Hn.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.Hn.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.Hn.InstantaneousCalcWebWorkerPrecisionSamplingRate:T.Tih}get whi(){return this.Hn&&void 0!==this.Hn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.Hn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?
this.Hn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:T.Xih}get vhi(){return this.Hn&&void 0!==this.Hn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.Hn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.Hn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:T.Wih}get uhi(){return this.Hn&&void 0!==this.Hn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.Hn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.Hn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:
T.Vih}get uff(){return this.Hn?this.Hn.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:T.Uih}get Iod(){return null!==this.F0c?this.F0c:this.Hn?this.Hn.InstantaneousCalcManualMode:!1}eTj(J){let M;if(!J)return{returnValue:!0,category:"General"};M="";if(!({category:J}=this.pCa(J,!1)).returnValue)return{returnValue:!1,category:M};M=this.n9g(J);return{returnValue:!0,category:M}}n9g(J){let M="";switch(J){case 0:M="General";break;case 1:M="Number";break;case 2:M="Currency";break;case 3:M="Accounting";break;
case 4:M="Date";break;case 5:M="Time";break;case 6:M="Percentage";break;case 7:M="Fraction";break;case 8:M="Scientific";break;case 9:M="Text";break;case 10:M="Special";break;case 11:M="Custom"}return M}pCa(J,M){let Q,U=({value:Q}=this.eoc.Dc(J,0)).returnValue;!U&&0<J&&this.$&&(b.ULS.sendTraceTag(537155735,0,50,`InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache ${J}`),this.lPh(J),M&&(Q=this.kPh(J),U=!0),A.a(J,this.$.GG)&&
(Q=6));return{returnValue:U,category:Q}}bni(J){let M=0;if(({category:M}=this.pCa(J,!0)).returnValue)return 6===M;b.ULS.sendTraceTag(537155733,0,50,`InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index ${J}`);return!1}sIh(J){b.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.kLa=y.o(this.$.pa.ya,{FilterType:0},E.b(this.LGf,J),this.bDf,null,null,null)}jZe(){this.lSa(T.Adf)}tBd(J){this.F0c=
J}lPh(J){if(this.Fwb&&this.$){var M;if(!({value:M}=this.Fwb.Dc(J)).returnValue||M.isCompleted)b.ULS.sendTraceTag(537155728,0,50,`Getting number format category for format index: ${J}`),(M=t.c(this.$.pa.ya,J,this.mQi,null,null,null))&&this.Fwb.ia(J,M)}else b.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")}kPh(J){return 1<=J&&8>=J?1:9<=J&&12>=J?2:13===J||14===J?6:15===J?8:17===J|18===J?7:19===J?4:16===J||20<=
J&&29>=J||31===J?11:30===J?9:32<=J&&35>=J?3:0}isActive(){const J=void 0===this.ea||null===this.ea,M=!J&&this.ea.Zb;b.ULS.sendTraceTag(537155727,0,50,`InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:${M} - sessionStateManager IsNullOrUndefined: ${J}`);return M}jxj(J,M){this.eoc.ia(J,M)}dispose(){f.a.Ia(this.tJb);this.tJb=null;this.p3b();for(let J of this.Fwb){const M=J.value;M&&!M.isCompleted&&d.AFrameworkApplication.zd.au(M.qt)}this.Fwb=null;this.ea&&
(this.ea.tk(this.Tc),this.fhb&&this.ea.cE(this.j0),this.fhb=!1,this.ea.Nv(this.Bf));this.ea=null;this.$&&I.h(this.$)&&I.h(this.$).ha&&(I.h(this.$).ha.qna(this.Nyf),this.$.Kl(this.ed));this.$=null;super.dispose()}isFeatureEnabled(J){try{switch(J){case "LocaleLongDateFormat":return z.EwaSettings.ma(193);case "GetLocaleDayNames":return z.EwaSettings.ma(194);case "CalculateTextWidthIgnoreLetterSpacing":return z.EwaSettings.ma(280);case "OfficeVSO:3657744_CalcFixForDateFormat":return z.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");
case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return z.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");case "CalcAutocompleteExperiment":return z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1);case "CalcNewFunctions":return z.EwaSettings.ma(243);case "CalcContractChecks":return z.EwaSettings.ma(244);case "CalcSupportDynamicArrays":return z.EwaSettings.ma(245);case "CalcFormatCalculations":return z.EwaSettings.ma(246);
case "CalcFormulaCacheAPIChanges":return z.EwaSettings.ma(247);case "CalcStrictFormulaChecking":return z.EwaSettings.ma(248);case "CalcSupportRowReference":return z.EwaSettings.ma(259);case "CalcParserUsesPledges":return z.EwaSettings.ma(301);case "CalcWebWorker":return!0;case "CalcWebWorkerTest":return z.EwaSettings.ma(300);case "CalcLookupFunctions":return z.EwaSettings.ma(302);case "CalcLogStopWatch":return z.EwaSettings.ma(365);case "CalcPreventSpillingHack":return z.EwaSettings.ma(249);case "CalcDynamicArrayOperators":return z.EwaSettings.ma(101);
case "CalcDotOperator":return z.EwaSettings.ma(570);case "CalcLetFunction":return z.EwaSettings.ma(686);default:return J.startsWith("OfficeVSO:")?z.EwaSettings.isChangeGateEnabled(J):!1}}catch(M){return b.ULS.sendTraceTag(537155724,0,15,`InstantaneousSupportInformation.IsFeatureEnabled(${J}): feature parsing failed, returning false. Exception: ${M.toString()}.`),!1}}lSa(J){this.isActive()&&this.ea.dc.allowEdits?(f.a.Ia(this.tJb),this.tJb=null,this.tJb=w.a.instance.create(this.refresh,J,C.a.xhi)):
b.ULS.sendTraceTag(537155723,0,50,`InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits ${void 0!==this.ea&&null!==this.ea&&void 0!==this.ea.dc&&null!==this.ea.dc?this.ea.dc.allowEdits:!1}, IsEditMode ${void 0===this.ea||null===this.ea?!1:this.$.ea.isEditMode}`)}g3e(){b.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.kLa?b.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):
this.isActive()?this.eY&&this.eY.length||(this.kLa=y.o(this.$.pa.ya,{FilterType:0},this.MQi,this.bDf,null,null,null)):b.ULS.sendTraceTag(537155717,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")}nFc(){this.fhb||(this.fhb=!0,this.ea.OE(this.j0))}p3b(){this.au(this.phd);this.au(this.kLa);this.kLa=this.phd=null}au(J){J&&!J.isCompleted&&this.$.pa.ya.igb(J.qt)}static rXh(J,M){if(!J||!J.length)return[];if(!M||!M.length){M=Array(J.length);for(var Q=
0;Q<J.length;++Q)M[Q]=J[Q].IfmtIndex;return M}Q=new V.a;for(const U of J)Q.ia(U.IfmtIndex,new L(U));J=new h.a;for(const U of M){let Z;({value:Z}=Q.Dc(U.IfmtIndex)).returnValue&&Z.data.FormatString===U.FormatString||J.add(U.IfmtIndex)}return J.toArray()}}T.QBd="isim0";T.D1c="isim1";T.ted="isim2";T.Iqf="isim3";T.Adf=100;T.PTd=1E3;T.gBd=3E5;T.Tih=.001;T.Xih=.1;T.Wih=.2;T.Vih=.001;T.Uih=50;Object(u.a)(T,"InstantaneousSupportInformationManager",m.a,[579,2]);var H=a(697);class D extends e.a{constructor(J){super();
this.$=J;this.Fb()}create(){if(this.$){b.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script");var J=Object(H.a)(this.$.da,268,()=>new T(this.$.ea,this.$));this.nb(J)}}static la(J){if(!J)throw Error.argumentNull("ewaControl");J.da.Ga(246,new D(J))}}Object(u.a)(D,"InstantaneousSupportInformationManagerFactory",e.a,[]);a.d(F,"a",function(){return G});const G=()=>{c.a.Fa(D.la)}},1224:function(u,F,a){function c(M){if(M){var Q=new x(M.IsRangeRef);
Q.OF=M.IsAbsoluteFirstRow;Q.NF=M.IsAbsoluteFirstColumn;Q.GK=M.IsAbsoluteSecondRow;Q.FK=M.IsAbsoluteSecondColumn;return Q}}function b(M){var Q;if(M){var U=new x(0===M.kind);M=null===(Q=null===M||void 0===M?void 0:M.rangeInfo)||void 0===Q?void 0:Q.positionKindInfo;if(!M)return U;U.OF=0===M.firstRow;U.NF=0===M.firstColumn;U.GK=0===M.secondRow;U.FK=0===M.secondColumn;return U}}u=a(0);var e=a(222),f=a(7),d=a(15),h=a(83),n=a(5),m=a(324);class x{constructor(M){this.FK=this.GK=this.NF=this.OF=!1;this.z_=
M}}Object(u.a)(x,"MarqueeRangeData",null,[]);class r{constructor(M,Q,U,Z=!1){this.XYd=M;this.oPb=Q;this.Z7a=Z;U?(this.z_=U.z_,this.OF=U.OF,this.NF=U.NF,this.GK=U.GK,this.FK=U.FK):d.ULS.shipAssertTag(524039642,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}}Object(u.a)(r,"MarqueeMetadata",null,[]);var y=a(40),t=a(139),v=a(35),w=a(1),C=a(22),B=a(580),z=a(21),A=a(175),E=a(346),I=a(33),L=a(727),V=a(874);const T="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");
class H{constructor(M,Q){this.EK=this.ufb=this.qsf=!1;this.d9=null;this.aza=()=>{this.EK=!1};this.Lc=M;this.gridView=z.h(M);this.calcManager=Q;this.mgf=w.EwaSettings.ma(675);this.hR=I.a.hR(M);this.Xka=w.EwaSettings.isChangeGateEnabled("OfficeVSO:6592066_FixAutoCompleteCardFocusBug");this.cti=w.EwaSettings.isChangeGateEnabled("OfficeVSO:7144291_logRefactorInPreviewRanges");this.gridView.Vb.Rm(this.aza)}get formulaAssistanceManager(){this.d9||(this.d9=this.Lc.da.Aa(464));return this.d9}get formulaAssistanceTelemetryManager(){this.nEa||
(this.nEa=this.Lc.da.Aa(491));return this.nEa}bC(M,Q){M.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.ufb||M.PF)return!1;const U=void 0===Q||null===Q?M.text:Q;if(this.calcManager&&1<U.length&&A.f(U)){var Z=this.bka(),P=this.x5e(),S=this.Lc.workbookContext.WorkbookFileName;let ja=!1;const X=.01>Math.random()?Object(h.a)(t.a,this.Lc.Kb.Bc("LoadingUIShown","ColoredReferencesManager")):null;try{const Y=this.calcManager.extractReferences(U,P,S,!this.mgf);if(!Y)return d.ULS.sendTraceTag(524039689,
0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;P=[];S=[];const va=[],N=[];let ea=0,Ca=0;const la=new v.a(!1);let Ra="";for(const Aa of Y.Items)if(ja=Aa.IsStructRef||ja,Aa.IsBoolean||Aa.IsNumber||Aa.IsString){const da=Aa.IsBoolean?"rgba(0, 0, 255, 1)":Aa.IsNumber?"rgba(9, 134, 88, 1)":"rgba(163, 21, 21, 1)";this.KE(S,U,ea,Aa.Span.Start,null);this.KE(S,U,Aa.Span.Start,Aa.Span.End,da);ea=Aa.Span.End}else if(w.EwaSettings.ma(581)){if(Aa.Range||
Aa.LetName&&0<=Aa.LetNumber){let da=null;if(Aa.Range){let fa=y.D(Aa.Range);da=this.SZ(fa,la,1);P.push(new E.a(fa,Z))}else Aa.LetName&&0<=Aa.LetNumber&&(da=Ra=this.YPh(Aa.LetName,Aa.LetNumber,la,Ra),Ca!==la.count&&M.colors.add(Aa.Span.Start+"-"+Aa.Span.End,T[(la.count-1)%T.length]));this.KE(S,U,ea,Aa.Span.Start,null);this.KE(S,U,Aa.Span.Start,Aa.Span.End,da);ea=Aa.Span.End;va.push(Aa.Span);let aa=S.length-1;N.push(new r(aa,S[aa].text,c(Aa)));Ca=la.count}}else if(Aa.Range){let da=y.D(Aa.Range),aa=this.SZ(da,
la,1);this.KE(S,U,ea,Aa.Span.Start,null);this.KE(S,U,Aa.Span.Start,Aa.Span.End,aa);P.push(new E.a(da,Z));ea=Aa.Span.End;va.push(Aa.Span);let fa=S.length-1;N.push(new r(fa,S[fa].text,c(Aa)))}this.formulaAssistanceTelemetryManager?0<Y.Items.length&&this.formulaAssistanceTelemetryManager.ibc.formulaHighlightsCounter++:this.gmc("ColoredReferencesManager.tryUpdateColoredReferences: FormulaAssistanceTelemetryManager unavailable");this.KE(S,U,ea,U.length,null);this.Hyc(M,S,!!Q);const lb=M.textBox.text;if(!C.a.equals(lb,
U,!1)){d.ULS.shipAssertTag(38114182,0,!1,`ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [${lb.length}], originalTextLength [${U.length}]`);let Aa=M.textBox.caretPosition;M.textBox.text=U;M.textBox.caretPosition=Aa;return!0}this.Cz(P,la,N);w.EwaSettings.ma(581)&&0<P.length&&d.ULS.sendTraceTag(524039688,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");w.EwaSettings.ma(581)&&
0<M.colors.count&&d.ULS.sendTraceTag(524039687,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.EK=!0}finally{X&&X.JBa(()=>{ja&&d.ULS.sendTraceTag(524039686,0,50,`ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in ${X.Ac} ms`)})}}else return this.Cz(null,null),this.EK&&(this.EK=!1,Z=M.textBox.caretPosition,M.textBox.setPlainText(U),M.textBox.caretPosition=Math.min(Z,U.length),Q)?!0:!1}lgb(M,Q,U){if(this.ufb||
M.PF)return!1;const Z=isNullOrUndefined(Q)?M.text:Q;var P=[];const S=new v.a(!1);if(1<Z.length&&Object(L.b)(U)){const X=[],Y=[],va=[];var ja=0;const N=this.bka();for(const ea of U.formulaHighlights){this.KE(X,Z,ja,ea.span.start,null);switch(ea.kind){case 0:case 1:case 2:U=y.B(ea.rangeInfo.sharedRange);if(isNullOrUndefined(U)){d.ULS.sendTraceTag(521211937,0,10,`ColoredReferencesManager.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:${ea.kind.toString()},`);
this.KE(X,Z,ea.span.start,ea.span.end,null);break}ja=this.SZ(U,S,1);this.KE(X,Z,ea.span.start,ea.span.end,ja);P.push(new E.a(U,N));Y.push({Start:ea.span.start,End:ea.span.end});U=X.length-1;va.push(new r(U,X[U].text,b(ea)));break;case 3:this.KE(X,Z,ea.span.start,ea.span.end,null,"rgba(229, 229, 229, 1)")}ja=ea.span.end}this.KE(X,Z,ja,Z.length);this.Hyc(M,X,!!Q);Q=M.textBox.text;if(!C.a.equals(Q,Z,!1))return d.ULS.shipAssertTag(521211936,0,!1,`ColoredReferencesManager.UpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [${Q.length}], originalTextLength [${Z.length}]`),
Q=M.textBox.caretPosition,M.textBox.text=Z,M.textBox.caretPosition=Q,!0;this.Cz(P,S,va);return this.EK=!0}this.Cz(null,null);return this.EK&&(this.EK=!1,P=M.textBox.caretPosition,M.textBox.setPlainText(Z),M.textBox.caretPosition=Math.min(P,Z.length),Q)?!0:!1}PEb(M,Q,U){if(!M||!Q||!U)return d.ULS.shipAssertTag(524039685,0,!!M,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),d.ULS.shipAssertTag(524039684,0,!!Q,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),
d.ULS.shipAssertTag(524039683,0,!!U,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;const Z=Object(h.a)(r,Q.metadata);if(!Z)return d.ULS.shipAssertTag(524039682,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var P=Z.XYd,S=Z.oPb,ja=this.gridView.Bb.vqd(U)?U.Xwb(Z.NF,Z.OF):U.xLa(Z.NF,Z.OF,Z.FK,Z.GK);if(!ja)return d.ULS.shipAssertTag(524039681,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;const X=S.indexOf("!");-1!==X&&(ja=S.substring(0,
X+1)+ja);if(!M.textBox.changeTextInExistingTextPart(P,S,ja))return d.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;Z.oPb=ja;P=!0;for(S=1;4>=S;S++)(ja=z.h(this.Lc).qb.Cv(3,S,Q.oU))?(ja.range=U,ja.metadata=Z):(d.ULS.shipAssertTag(524039680,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),P=!1);this.gridView.qb.update(!1,!1);this.gridView.Ul&&(this.gridView.fc.textBox.text=M.text);this.gridView.fc.NQa(new m.a({GAb:!0}));
return P}Ioi(M){if(3!==M.Rq)return d.ULS.shipAssertTag(524039651,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;M=Object(h.a)(r,M.metadata);return M?M.z_&&!M.Z7a:(d.ULS.shipAssertTag(524039650,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)}OBa(M,Q){d.ULS.sendTraceTag(524039649,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(Q?"suspending":"resuming")+" colored references");Q&&this.EK&&(this.EK=
!1,this.Cz(null,null),M.textBox.WCe());this.ufb=Q}dispose(){this.gridView&&this.gridView.Vb&&this.gridView.Vb.em(this.aza)}jzb(M){const Q=this.formulaAssistanceTelemetryManager;Q||this.gmc("ColoredReferencesManager.highlightPreviewRanges: Failed to log highlightPreviewRanges measurement, FormulaAssistanceTelemetryManager unavailable");null===Q||void 0===Q?void 0:Q.YB(["highlightPreviewRanges"]);this.hR?this.$ai(M):this.Zai(M);null===Q||void 0===Q?void 0:Q.yw(["highlightPreviewRanges"],!0)}$ai(M){var Q=
this.formulaAssistanceManager.X4a(M,V.a);if(isNullOrUndefined(Q))this.Xka&&this.Cz(null,null);else{var U=this.bka(),Z=[],P=new v.a(!1),S=[];Q=Q.formulaHighlights;for(const ja of Q)if(Q=ja.kind,0===Q||2===Q||1===Q)Q=y.B(ja.rangeInfo.sharedRange),Object(L.b)(Q)&&(Z.push(new E.a(Q,U)),this.SZ(Q,P,1),S.push(new r(ja.span.start,M.substring(ja.span.start,ja.span.end),b(ja),!0)));this.Cz(Z,P,S)}}Zai(M){const Q=this.bka();var U=this.x5e();const Z=this.Lc.workbookContext.WorkbookFileName,P=[],S=new v.a(!1),
ja=[];if(U=this.calcManager.extractReferences(M,U,Z,!this.mgf)){for(const X of U.Items)X.Range&&(U=y.D(X.Range),P.push(new E.a(U,Q)),this.SZ(U,S,1),ja.push(new r(X.Span.Start,M.substring(X.Span.Start,X.Span.End),c(X),!0)));this.Cz(P,S,ja)}else this.Xka&&this.Cz(null,null)}SZ(M,Q,U){let Z=Q.getItem(M.toString());Z||(Z=T[Q.count%T.length],Q.add(M.toString(),Z));return String.format(Z,U)}YPh(M,Q,U,Z){M="["+M+", "+Q+"]";Q=U.getItem(M);Q||(Q=U.count%T.length,Q=T[Q],Z===String.format(Q,1)&&(U.add("skip-"+
M,Q),Q=U.count%T.length,Q=T[Q]),U.add(M,Q));return String.format(Q,1)}KE(M,Q,U,Z,P=null,S=null){d.ULS.shipAssertTag(524039648,0,U<=Z,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");U<Z&&(Q=Q.substring(U,Z),M.push(Object(f.a)(new B.a,{text:Q,color:P,backgroundColor:S})))}Cz(M,Q,U=null){M&&M.length?(d.ULS.sendTraceTag(524039647,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+M.length),M.reverse(),U.reverse(),this.gridView.qb.lx(M,[3],
!0,(Z,P)=>{if(Z&&Z.range&&P){d.ULS.shipAssertTag(524039643,0,Q.lb(Z.range.toString()),`ColoredReferencesManager.HighlightRanges: The range '${Z.range.toString()}' doesn't exist in the range to color dictionary`);var S=this.SZ(Z.range,Q,.1),ja=this.SZ(Z.range,Q,1);this.Lc.frame&&this.Lc.frame.xD&&this.Lc.frame.xD.CN||(P.style.background=S);P.style.borderColor=ja;U&&(P.setAttribute(n.a.C6a,Z.oU.toString()),Z.metadata=U[Z.oU])}else d.ULS.shipAssertTag(524039646,0,!!Z,"ColoredReferencesManager.HighlightRanges: state is null"),
d.ULS.shipAssertTag(524039645,0,!!Z.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),d.ULS.shipAssertTag(524039644,0,!!P,"ColoredReferencesManager.HighlightRanges: div is null")})):(M=this.Lc.Kb.Bc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.qb.Zg([3]),this.gridView.qb.RSa(new E.a(null,this.bka()),[3]),M.stop())}Hyc(M,Q,U){const Z=M.textBox;Z.HF=!0;var P=Z.selection;const S=P.index;P=S+P.length;Z.setTextFromTextParts(Q);Q=Z.text.length;Z.selectRange(Math.min(S,
Q),Math.min(P,Q));U&&M.NQa(new m.a);Z.HF=!1}gmc(M){this.cti&&!this.qsf&&(d.ULS.sendTraceTag(521211935,0,50,M),this.qsf=!0)}bka(){return this.rdc().sheetId}x5e(){return this.rdc().sheetName}rdc(){return this.gridView.ar&&this.gridView.ar.eG?this.gridView.ar.eG:this.Lc.oa}}Object(u.a)(H,"ColoredReferencesManager",null,[298,2]);class D extends e.a{constructor(M){super();this.$=M;this.Fb()}create(){this.$.da.$a(266,M=>{M=w.EwaSettings.ml()||w.EwaSettings.isChangeGateEnabled("OfficeVSO:6143820_MoveServiceRegistrationFromFAM_V2")?
this.$.da.Aa(281)||this.$.da.Ga(281,new H(this.$,M)):new H(this.$,M);this.nb(M)})}static la(M){M.da.Ga(282,new D(M))}}Object(u.a)(D,"ColoredReferencesManagerFactory",e.a,[]);var G=a(9);a.d(F,"a",function(){return J});const J=()=>{G.a.Fa(D.la)}},1272:function(u,F,a){u=a(0);var c=a(222),b=a(811);class e extends c.a{constructor(h){super();this.$=h;this.Fb()}create(){this.$.da.$a(266,h=>{h=this.$.da.Aa(294)||this.$.da.Ga(294,new b.RelativeAndAbsoluteReferencesManager(h));this.nb(h)})}static la(h){h.da.Ga(295,
new e(h))}}Object(u.a)(e,"RelativeAndAbsoluteReferencesManagerFactory",c.a,[]);var f=a(9);a.d(F,"a",function(){return d});const d=()=>{f.a.Fa(e.la)}},1396:function(u,F,a){a.r(F);u=a(1208);F=a(1162);var c=a(1224);a=a(1272);Type.registerNamespace("_Ewa");Object(u.a)();Object(F.a)();Object(c.a)();Object(a.a)()},791:function(u,F,a){a.d(F,"a",function(){return c});u=a(0);class c{}c.abs="Abs";c.rel="Rel";Object(u.a)(c,"PositionBaseType",null,[])},811:function(u,F,a){a.r(F);u=a(0);var c=a(7),b=a(15);class e{}
Object(u.a)(e,"Reference",null,[]);class f extends e{constructor(){super();this.column=this.row=null}}Object(u.a)(f,"CellReference",e,[]);class d{constructor(){this.end=this.start=0;this.Mv=null}bRg(E,I){for(let L=0;L<this.Mv.length;L++){const V=this.p1b(E,this.Mv[L]);I+=V;L<this.Mv.length-1&&(I+=":")}return I}}Object(u.a)(d,"IReferenceSequence",null,[]);var h=a(24),n=a(791);class m extends d{constructor(){super();this.pjc=!1}jdc(){const {RelativeAndAbsoluteReferencesManager:E}=a(811),I=this.Mv[0];
return E.fxf(I.row.kind===n.a.abs,I.column.kind===n.a.abs)}p1b(E,I){I=h.Range.Qc(I.row.index+1,I.column.index+1);return this.pjc?I.Xwb(1===E||3===E,1===E||2===E):I.xLa(1===E||3===E,1===E||2===E,!0,!0)}}Object(u.a)(m,"CellReferenceSequence",d,[]);class x extends e{constructor(){super();this.secondColumn=this.firstColumn=null}}Object(u.a)(x,"ColumnReference",e,[]);class r extends d{constructor(){super()}jdc(){const E=this.Mv[0];return a(811).RelativeAndAbsoluteReferencesManager.Cvf(E.firstColumn,E.secondColumn).kind===
n.a.abs?2:3}p1b(E,I){return h.Range.iwb(I.firstColumn.index+1,I.secondColumn.index+1).xLa(1===E||3===E,!0,1===E||3===E,!0)}}Object(u.a)(r,"ColumnReferenceSequence",d,[]);class y extends e{constructor(){super();this.right=this.left=this.bottom=this.top=null}}Object(u.a)(y,"RangeReference",e,[]);class t extends d{constructor(){super()}jdc(){const {RelativeAndAbsoluteReferencesManager:E}=a(811),I=this.Mv[0];return E.fxf(I.top.kind===n.a.abs,I.left.kind===n.a.abs)}p1b(E,I){I=new h.Range(I.top.index+1,
I.left.index+1,I.bottom.index+1,I.right.index+1,!1,!1);const L=1===E||3===E;E=1===E||2===E;return I.xLa(L,E,L,E)}}Object(u.a)(t,"RangeReferenceSequence",d,[]);class v extends e{constructor(){super();this.secondRow=this.firstRow=null}}Object(u.a)(v,"RowReference",e,[]);class w extends d{constructor(){super()}jdc(){const E=this.Mv[0];return a(811).RelativeAndAbsoluteReferencesManager.Cvf(E.firstRow,E.secondRow).kind===n.a.abs?0:1}p1b(E,I){return h.Range.mbc(I.firstRow.index+1,I.secondRow.index+1).xLa(!0,
1===E||2===E,!0,1===E||2===E)}}Object(u.a)(w,"RowReferenceSequence",d,[]);var C=a(981),B=a(982),z=a(175);a.d(F,"RelativeAndAbsoluteReferencesManager",function(){return A});class A{constructor(E){this.calcManager=E}g2a(E,I,L){let V,T;V=I;T=L;if(!E||!z.f(E))return{returnValue:E,SAd:V,RAd:T};var H=this.calcManager.zWe(E);if(!H)return b.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),
{returnValue:null,SAd:V,RAd:T};H=this.m1h(H,E,I,L);let D=0,G="",J=0,M=0;for(;M<H.length;M++)if(this.uNe(H[M],I,L)){D=H[M].jdc();V=H[M].start;break}for(;M<H.length&&this.uNe(H[M],I,L);M++)G+=E.substring(J,H[M].start),G=H[M].bRg(D,G),J=H[M].end;J&&(T=G.length);G+=E.substring(J,E.length);return{returnValue:G,SAd:V,RAd:T}}m1h(E,I,L,V){const T=[];for(let J=0;J<E.length;J++){var H=E[J];if(H.kind===C.a.range)if(H=H.ref,H.type===B.a.cell){var D=H;H=Object(c.a)(new m,{start:H.span.start,end:H.span.end,Mv:[Object(c.a)(new f,
{column:D.col,row:D.row})],pjc:this.calcManager.E3b(H.span.end,I)});T.push(H)}else if(H.type===B.a.range)this.vNe(H.topLeftSpan,L,V)&&this.vNe(H.bottomRightSpan,L,V)?(D=new y,H.top.index<=H.bottom.index?(D.top=H.top,D.bottom=H.bottom):(D.bottom=H.top,D.top=H.bottom),H.left.index<=H.right.index?(D.left=H.left,D.right=H.right):(D.right=H.left,D.left=H.right),H=Object(c.a)(new t,{start:H.topLeftSpan.start,end:H.bottomRightSpan.end,Mv:[D]}),T.push(H)):(D=Object(c.a)(new m,{start:H.topLeftSpan.start,end:H.topLeftSpan.end,
Mv:[Object(c.a)(new f,{column:H.left,row:H.top})],pjc:this.calcManager.E3b(H.topLeftSpan.end,I)}),H=Object(c.a)(new m,{start:H.bottomRightSpan.start,end:H.bottomRightSpan.end,Mv:[Object(c.a)(new f,{column:H.right,row:H.bottom})],pjc:this.calcManager.E3b(H.topLeftSpan.end,I)}),T.push(D),T.push(H));else if(H.type===B.a.column){D=H;for(H=Object(c.a)(new r,{start:H.span.start,end:H.span.end,Mv:[Object(c.a)(new x,{firstColumn:D.startIndex,secondColumn:D.endIndex})]});H.end<I.length-1&&":"===I.charAt(H.end)&&
J<E.length-1;)if(D=E[J+1].ref,D.type===B.a.column&&D.span.start===H.end+1){var G=D;H.Mv.push(Object(c.a)(new x,{firstColumn:G.startIndex,secondColumn:G.endIndex}));H.end=D.span.end;J++}else break;T.push(H)}else if(H.type===B.a.row){D=H;for(H=Object(c.a)(new w,{start:H.span.start,end:H.span.end,Mv:[Object(c.a)(new v,{firstRow:D.startIndex,secondRow:D.endIndex})]});H.end<I.length-1&&":"===I.charAt(H.end)&&J<E.length-1;)if(D=E[J+1].ref,D.type===B.a.row&&D.span.start===H.end+1)G=D,H.Mv.push(Object(c.a)(new v,
{firstRow:G.startIndex,secondRow:G.endIndex})),H.end=D.span.end,J++;else break;T.push(H)}}return T}uNe(E,I,L){return!(E.start>L||I>E.end)}vNe(E,I,L){return!(E.start>L||I>E.end)}static Cvf(E,I){return E.index<=I.index?E:I}static fxf(E,I){return I||E?I&&E?2:!I&&E?3:0:1}}Object(u.a)(A,"RelativeAndAbsoluteReferencesManager",null,[296])},938:function(u,F,a){a.r(F);u=a(0);var c=a(15),b=a(263),e;(function(w){w[w.paren=0]="paren";w[w.lead=1]="lead";w[w.intern=2]="intern";w[w.trail=3]="trail";w[w.undefined=
4]="undefined"})(e||(e={}));Object(u.b)("CurrencyFormatOption",e);var f;(function(w){w[w.none=-1]="none";w[w.mdy=0]="mdy";w[w.dmy=1]="dmy";w[w.ymd=2]="ymd";w[w.myd=3]="myd";w[w.dym=4]="dym";w[w.ydm=5]="ydm"})(f||(f={}));Object(u.b)("DateOrderOption",f);var d=a(8);class h{constructor(w,C){({CalcHelper:w}=a(938));C&&(C.Ke||c.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));this.Myg=w.mIe(C,w.$He(C.Hja));this.Nyg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}get localeInfo(){return this.Nyg}get localeData(){return this.Myg}formatNumber(w){return this.localeInfo.formatNumber(w)}}
Object(u.a)(h,"LocaleHolder",null,[]);var n=a(979),m=a(52),x=a(1),r=a(22),y=a(13),t=a(201);a.d(F,"CalcHelper",function(){return v});class v{constructor(w){this.$=w;(this.py=this.$.da.Aa(268))||c.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");let C;C=x.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?m.a.current.fo(76):m.a.current.fo(79);this.logger=new n.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",
this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.pca=new h(w,this.py);excelOnlineCalc.config.initCalc(this.logger,this.py?B=>this.py.isFeatureEnabled(B):()=>!1,C);this.xtg=excelOnlineCalc.config.calcConfig(this.pca.localeInfo)}get config(){return this.xtg}mhh(){if(x.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.xa)return c.ULS.shipAssertTag(537170069,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;const w=this.$.xa.oa;
return w?w.index:(c.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.xa.oa.index}createParser(){const w={};w.config=this.config;return excelOnlineCalc.parse.createParser(w)}createNumberFormatter(){const w=excelOnlineCalc.numfmt.createFormatGlobals(this.config,(C,B)=>excelOnlineCalc.calc.getTime(this.config,C,B,"Estimation"));return excelOnlineCalc.numfmt.createNumberFormatter(w)}xfh(w,C,B,z){if(!z)return{range:{row:C,col:B},sheet:{document:this.documentLoc,
index:w}};C=excelOnlineCalc.location.gridCell(C,B);w=excelOnlineCalc.location.sheetIndex(this.documentLoc,w);return excelOnlineCalc.location.sheetGridCell(w,C)}Ish(w,C){let B;B=excelOnlineCalc.calc.getEvalResultKind(w);switch(B){case 4:return{returnValue:w?this.pca.localeInfo.trueName:this.pca.localeInfo.falseName,kind:B};case 1:return{returnValue:x.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.HCc(this.pca.formatNumber(w),C):this.pca.formatNumber(w),
kind:B};case 2:return{returnValue:x.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.HCc(w.toString(),C):w.toString(),kind:B};case 128:return{returnValue:"",kind:B};case 8:switch(w.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.pca.localeInfo.errorNames[w.type],kind:B};default:return{returnValue:v.unknownError,kind:B}}case 32:return{returnValue:x.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.HCc(this.Ofh(w,C),C):"##UNSUPPORTED: ARRAY",kind:B};default:return{returnValue:y.a.instance.ga(2214),kind:B}}}HCc(w,C){return w.length<=C?w:w.substring(0,C-3)+"..."}Ofh(w,C){let B=this.pca.localeInfo.leftBrace;for(let z=0;z<w.rows;++z){for(let A=0;A<w.cols;++A)B+=w.opers[z][A],A<w.cols-1&&(B+=this.pca.localeInfo.columnSeparator);z<w.rows-1&&(B+=this.pca.localeInfo.rowSeparator)}return this.HCc(B,C-1)+this.pca.localeInfo.rightBrace}static mIe(w,C=null){const B=v.g6b(),z=w.Ke.TrueValueString,A=
w.Ke.FalseValueString,E=w.Ke.DecimalSeparator.toString(),I=w.Ke.ListSeparator.toString(),L=w.Ke.ColumnSeparator.toString(),V=w.Ke.RowSeparator.toString(),T=w.Ke.ThousandsDataArray,H=w.Ke.ThousandSeparator.toString(),D=w.Ke.Lcid,G=w.Ke.Country,J=w.Ke.DigitsNumber,M=w.Ke.ExpSeparatedBySpace,Q=w.Ke.FractionSeparator.toString(),U=w.Ke.PercentSeparatedBySpace,Z=r.a.z0g(Enum.toString(e,w.Ke.CurrencyFormat)),P=w.Ke.CurrencySymbolLead,S=w.Ke.CurrencySeparatedBySpace,ja=w.Ke.CurrencySymbolString,X=w.Ke.DigitsCurrency,
Y=-1===w.Ke.DateOrder?"MDY":t.e(Enum.toString(f,w.Ke.DateOrder)),va=w.Ke.DateSeparator.toString(),N=w.Ke.DateAlternativeSeparator.toString(),ea=w.Ke.Year4Digits,Ca=w.Ke.Month2Digits,la=w.Ke.Day2Digits,Ra=w.Ke.LongDateFormat,lb=w.Ke.TimeSeparator.toString(),Aa=w.Ke.TimeAltSeparator,da=w.Ke.Hour2Digits,aa=w.Ke.Use24HourClock,fa=w.Ke.AmPmSeparatedBySpace,Oa=[w.Ke.AmString,w.Ke.PmString],ba=w.Ke.DayNameShortArray,ka=w.Ke.DayNameLongArray,Pa=w.Ke.MonthNameShortArray,Fa=w.Ke.MonthNameLongArray,oa=w.Ke.PictureSpecialArray,
La=b.a.map(("\x00"+w.Ke.PictureSingleString).split(""),dc=>"\x00"===dc?null:dc),Ea=w.Ke.PictureColorArray,ca=w.Ke.PictureDbnumArray,$a=w.Ke.RowLetter.toString(),Qa=w.Ke.ColumnLetter.toString(),Va=w.Ke.LeftBrace.toString(),fb=w.Ke.RightBrace.toString(),Ka=w.Ke.LeftBracket.toString(),hb=w.Ke.RightBracket.toString(),fc=v.e2h(w.Ke);return excelOnlineCalc.calc.localeData(C,B,z,A,$a,Qa,Va,fb,Ka,hb,E,I,L,V,T,H,D,G,J,M,Q,U,Z,P,S,ja,X,Y,va,N,ea,Ca,la,Ra,lb,Aa,da,aa,fa,Oa,ba,ka,Pa,Fa,oa,La,Ea,ca,fc,w.Ke.SysDateFormatString,
w.Ke.SysTimeFormatString)}static $He(w){const C=[];if(!w)return C;for(const B of w)w=null,B.IsDynamicUdf||(w=excelOnlineCalc.calc.worksheetFunctionName(B.FunctionIndexInServer,B.NameUI)),w&&C.push(w);return C}static g6b(){const w=[],C=Object.keys(d.a.errorNames);for(let B=0;B<C.length;B++){const z=excelOnlineCalc.calc.errorTypeName(B+1,C[B]);z&&w.push(z)}return w}static e2h(w){const C=Array(6);C[1]="#"+w.AllStructRefString;C[3]="#"+w.HeadersStructRefString;C[2]="#"+w.DataStructRefString;C[4]="#"+
w.TotalsStructRefString;C[5]="#"+w.ThisRowStructRefString;return C}}v.unknownError="##ERR##";Object(u.a)(v,"CalcHelper",null,[])},981:function(u,F,a){a.d(F,"a",function(){return c});u=a(0);class c{}c.Xxi="literal";c.operator="operator";c.func="function";c.namedRange="namedRange";c.range="range";c.Kpf="letName";c.all="*";c.KXd="structRefRange";Object(u.a)(c,"TraverseFormulaInterestTypes",null,[])},982:function(u,F,a){a.d(F,"a",function(){return c});u=a(0);class c{}c.cell="cell";c.range="range";c.row=
"row";c.column="col";Object(u.a)(c,"TraverseFormulaRefTypes",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.calc.js.map/3d7bcd0fbed1f54a4a02c8040712f0f8/EwaDSEsNext.calc.js.map