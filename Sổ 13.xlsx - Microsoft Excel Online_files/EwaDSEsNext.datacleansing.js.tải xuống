'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[27],{1132:function(u,F,a){a.d(F,"a",function(){return c});u=a(0);class c{constructor(b,e,f,d,h,n){this.Ioa=b;this.confidence=e;this.headerRowCount=f;this.headerColumnCount=d;this.orientation=h;this.fields=n}}Object(u.a)(c,"TableInterpretation",null,[])},1160:function(u,F,a){var c=a(9);u=a(0);var b=a(15),e=a(222),f=a(49),d=a(37),h=a(7),n=a(171),m=a(724),x=a(699);class r extends m.a{constructor(){super();this.hasMergedcells=
this.tableName=this.interpretations=this.range=null;this.H_=Object.assign(new x.a,{T_:r.getTypeName(),B_:r.Pd()})}static getTypeName(){return"AugLoop_ExcelTableAi_ExcelRecognizedTableNew"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(u.a)(r,"ExcelRecognizedTableNew",m.a,[]);class y extends r{constructor(){super();this.requestId=null;this.H_=Object.assign(new x.a,{T_:y.getTypeName(),B_:y.Pd()})}static getTypeName(){return"AugLoop_ExcelTableai_ExcelRangeMetadata"}static Pd(){return["AugLoop_ExcelTableAi_ExcelRecognizedTableNew",
"AugLoop_Core_Annotation"]}}Object(u.a)(y,"ExcelRangeMetadata",r,[]);m=a(1292);class t extends m.a{constructor(){super();this.value=null;this.type=0;this.H_=Object.assign(new x.a,{T_:t.getTypeName(),B_:t.Pd()})}static getTypeName(){return"AugLoop_ExcelTableai_ExtendedExcelCell"}static Pd(){return["AugLoop_Excel_ExcelCell","AugLoop_Core_GridCell"]}}Object(u.a)(t,"ExtendedExcelCell",m.a,[]);m=a(869);class v extends m.a{constructor(){super();this.mergeCellAddresses=this.requestId=this.cells=this.range=
null;this.H_=Object.assign(new x.a,{T_:v.getTypeName(),B_:v.Pd()})}static getTypeName(){return"AugLoop_ExcelTableai_RangeDataSignal"}static Pd(){return["AugLoop_Signals_Signal"]}}Object(u.a)(v,"RangeDataSignal",m.a,[]);m=a(715);class w extends m.a{constructor(){super();this.worksheetId=null;this.bottom=this.right=this.top=this.left=0;this.H_=Object.assign(new x.a,{T_:w.getTypeName(),B_:w.Pd()})}static getTypeName(){return"AugLoop_ExcelTableAi_ExcelRangeAddressNew"}static Pd(){return[]}}Object(u.a)(w,
"ExcelRangeAddressNew",m.a,[]);var C=a(99);m=a(38);var B=a(1),z=a(22),A=a(21);class E extends Sys.EventArgs{constructor(N){super();this.gJb=N}}Object(u.a)(E,"RecognizedTableUpdateEventArgs",Sys.EventArgs,[]);var I=a(187),L=a(24),V=a(346);class T{constructor(N,ea,Ca,la){this.SA=N;this.interpretations=ea;this.tableName=Ca;this.id=la}}Object(u.a)(T,"RecognizedTable",null,[]);class H{constructor(N,ea,Ca){this.classification=N;this.aggregations=ea;this.headerReferences=Ca}}Object(u.a)(H,"TableField",null,
[]);var D=a(1132);const G=N=>{var ea=new V.a(J(N.range),N.range.worksheetId);var Ca=N.interpretations;var la=new I.a;if(Ca&&Ca.length)for(const oa of Ca){b:switch(oa.orientation.toLowerCase()){case "columnmajor":Ca=2;break b;case "rowmajor":Ca=1;break b;default:b.ULS.sendTraceTag(537151256,0,50,"Invalid value for table orientaion."),Ca=0}const La=Ca;if(0===La)b.ULS.sendTraceTag(537151257,0,50,"Invalid value for table orientaion. Skipping current interpretation.");else{Ca=D.a;var Ra=J(oa.location),
lb=oa.confidence,Aa=oa.headerRowCount,da=oa.headerColumnCount;var aa=oa.fields;var fa=new I.a;if(aa)for(const Ea of aa){aa=fa;var Oa=aa.add;c:switch(Ea.classification.toLowerCase()){case "dimension":var ba=1;break c;case "measure":ba=2;break c;default:b.ULS.sendTraceTag(537151255,0,50,"Invalid value %s for field classification."),ba=0}var ka=Ea.aggregations;var Pa=new I.a;if(ka)for(const ca of ka)switch(ca.toLowerCase()){case "sum":Pa.add(0);break;case "count":Pa.add(1);break;case "average":Pa.add(2);
break;case "min":Pa.add(3);break;case "max":Pa.add(4);break;case "distinctcount":Pa.add(5);break;case "stddev":Pa.add(6);break;case "variance":Pa.add(7);break;default:b.ULS.sendTraceTag(537151254,0,50,"Invalid value for aggregation type.")}ka=Pa;var Fa=Ea.headerReferences;Pa=new I.a;if(Fa)for(const ca of Fa)Fa=new L.Range(ca.top,ca.left,ca.top,ca.left,!1,!1),Pa.add(Fa);Oa.call(aa,new H(ba,ka,Pa))}Ca=new Ca(Ra,lb,Aa,da,La,fa);la.add(Ca)}}return new T(ea,la,N.tableName,N.id)},J=N=>new L.Range(N.top,
N.left,N.bottom,N.right,!1,!1);class M{constructor(N){this.Jy=new Map;this.Tod=!1;this.tableIntelligenceManager=N;this.tableIntelligenceManager.xZa("Valid",this.kZi.bind(this));this.tableIntelligenceManager.xZa("Invalid",this.WSi.bind(this))}zdc(N,ea){return this.Jy?this.Jy.has(N.sheetId)?this.Jy.get(N.sheetId).filter(Ca=>Ca.table.SA.range.Cd(N.range)&&(Ca.FEb&ea)==Ca.FEb):[]:(b.ULS.sendTraceTag(521025344,306,10,"Recognized table is null"),[])}kZi(N,ea){if(this.Jy){if(!this.Tod){for(const [Ca,la]of this.Jy)la.every(Ra=>
4===Ra.FEb)?this.Jy.delete(Ca):this.Jy.set(Ca,la.filter(Ra=>4!==Ra.FEb));this.Tod=!0}N=ea.gJb;this.Jy.has(N.SA.sheetId)||this.Jy.set(N.SA.sheetId,[]);this.Jy.get(N.SA.sheetId).push({table:N,FEb:2})}else b.ULS.sendTraceTag(521025315,306,10,"Recognized table is null")}WSi(N,ea){this.Tod=!1;N=ea.gJb;if(this.Jy)if(this.Jy.has(N.SA.sheetId))for(const Ca of this.Jy.get(N.SA.sheetId))Ca.table.id===ea.gJb.id&&(Ca.FEb=4);else b.ULS.debugAssertTag(522981602,306,!1,"No recognized tables for sheet");else b.ULS.sendTraceTag(521025314,
306,10,"Recognized table is null")}}Object(u.a)(M,"TableIntelligenceQueryManager",null,[390]);class Q{}Object(u.a)(Q,"RecognizedTableLog",null,[]);class U{}Object(u.a)(U,"Interpretation",null,[]);class Z{constructor(N){this.Jy=new Map;this.d1b=void 0;this.bpb=new Set;this.OFb=void 0;this.tableIntelligenceManager=N}Wog(){this.OFb?b.ULS.shipAssertTag(522303246,306,!1,"LogXlimRecognizedTables should not be called twice."):(this.OFb=this.kCd.bind(this),this.tableIntelligenceManager.xZa("Valid",this.OFb))}uBi(N){N=
this.G0(N);b.ULS.sendTraceTag(521233111,306,15,`${JSON.stringify(N)}`)}kCd(N,ea){N=ea.gJb;B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",!1)&&(this.bpb&&this.Jy?(this.bpb.has(N.id)||(this.VJg(N),this.bpb.add(N.id)),this.d1b||(this.d1b=window.setTimeout(this.U6.bind(this),2E3))):b.ULS.sendTraceTag(522303245,306,15,`AnnotationId set or recognized table store is null. annotationIdSet = ${!!this.bpb}, recognizedTableStore = ${!!this.Jy}`))}U6(){for(const [,N]of this.Jy)b.ULS.sendTraceTag(521233110,
306,15,JSON.stringify(N));window.clearTimeout(this.d1b);this.bpb=this.d1b=void 0;this.Jy.clear();this.Jy=void 0;this.tableIntelligenceManager.Afj(this.OFb);this.OFb=void 0}VJg(N){const ea=N.SA.sheetId;this.Jy.has(ea)||this.Jy.set(ea,[]);this.Jy.get(ea).push(this.G0(N))}G0(N){const ea=[];for(const Ca of N.interpretations){let la=0,Ra=0;for(const lb of Ca.fields)1===lb.classification?la++:2===lb.classification&&Ra++;ea.push({confidence:Ca.confidence,headerRowCount:Ca.headerRowCount,headerColumnCount:Ca.headerColumnCount,
orientation:Ca.orientation,measureCount:Ra,dimensionCount:la})}return{interpretations:ea,range:{top:N.SA.range.top,bottom:N.SA.range.bottom,left:N.SA.range.left,right:N.SA.range.right},isTable:!!N.tableName,annotationId:N.id}}}Object(u.a)(Z,"RecognizedTableLogger",null,[]);class P extends m.a{constructor(N,ea){super();this.aic=this.gif=!1;this.Ote={};this.instantaneousSupportInformationManager=null;this.kKd=void 0;this.ssf=!1;this.xCh=(Ca,la)=>{var Ra;1===la.operationType&&((la=la.FM)?(b.ULS.sendTraceTag(537151251,
306,50,`TableIntelligenceManager::ExcelRangeMetadataHandler called for requestID = ${la.requestId}`),Ca=G(la),B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",!1)&&(null===(Ra=this.kKd)||void 0===Ra?void 0:Ra.uBi(Ca)),({value:Ra}=this.XVd.Dc(la.requestId)).returnValue?(this.XVd.remove(la.requestId),Ra(Ca)):b.ULS.sendTraceTag(537151250,306,10,`TableIntelligenceManager::ExcelRangeMetadataHandler Callback not found for requestId = ${la.requestId}`)):b.ULS.sendTraceTag(537151252,
306,10,"TableIntelligenceManager::ExcelRangeMetadataHandler excelRangeMetadata is null."))};this.FGg=(Ca,la)=>{this.JOf("RecognizedTableUpdate",la)};this.augmentationLoopManager=N;this.$=ea;this.XVd=new C.a;this.$.da.Ga(20,this);B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",!1)&&(this.kKd=new Z(this))}y5a(){this.Ccg||(this.Ccg=new M(this));return this.Ccg}lXh(N,ea){if(B.EwaSettings.isChangeGateEnabled("OfficeVSO:6648526_LimitCellsInSignal")&&1E4<N.range.RC)return b.ULS.sendTraceTag(520501002,
306,15,`Signal with range size of ${N.range.RC} exceeds limit of ${1E4}`),4;this.YFg();if(this.vqi(N.range))return this.t_h(N,ea);b.ULS.sendTraceTag(537151253,306,15,"Range is not completely contained within the viewport");return 2}eNg(N){this.ZFg();this.addHandler("RecognizedTableUpdate",N);this.Kef()}eij(N){this.removeHandler("RecognizedTableUpdate",N)}xZa(N,ea){var Ca,la;B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceSheetCountThreshold",!1)&&(null===(la=null===(Ca=
this.$)||void 0===Ca?void 0:Ca.xa)||void 0===la?0:la.count)&&this.$.xa.count>B.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.TableIntelligenceSheetCountThresholdValue",100)?b.ULS.sendTraceTag(520720838,306,15,`TableIntelligenceManager::addRecognizedTableAnnotationCallback Exceeded max sheet count threshold. SheetCount ${this.$.xa.count}`):(this.Ote[N]||(this.aic||(this.augmentationLoopManager.activateAnnotation(r.getTypeName()),this.aic=!0),this.augmentationLoopManager.cpb.Zga(N,r.getTypeName(),
(Ra,lb)=>this.JOf(this.zyd(N),lb)),this.Ote[N]=!0),this.YIg(N,ea),this.Kef())}Afj(N){this.removeHandler(this.zyd("Valid"),N)}YIg(N,ea){this.addHandler(this.zyd(N),ea)}Bcj(){B.EwaSettings.ma(286)&&B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligence",!1)&&(this.augmentationLoopManager.activateAnnotation(r.getTypeName()),this.augmentationLoopManager.Zga(r.getTypeName(),this.FGg))}Acj(){this.augmentationLoopManager.activateAnnotation(y.getTypeName());this.augmentationLoopManager.Zga(y.getTypeName(),
this.xCh)}ZFg(){var N,ea;B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceSheetCountThreshold",!1)&&(null===(ea=null===(N=this.$)||void 0===N?void 0:N.xa)||void 0===ea?0:ea.count)&&this.$.xa.count>B.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.TableIntelligenceSheetCountThresholdValue",100)?b.ULS.sendTraceTag(520720837,306,15,`TableIntelligenceManager::addRecognizedTableAnnotationCallback Exceeded max sheet count threshold. SheetCount ${this.$.xa.count}`):this.aic||
(this.Bcj(),this.aic=!0)}YFg(){this.gif||(this.gif=!0,this.Acj())}JOf(N,ea){1===ea.operationType&&((ea=ea.FM)?(ea=G(ea),this.raiseEvent(N,new E(ea))):b.ULS.sendTraceTag(523772681,306,10,"TableIntelligenceManager::processAndRaiseExcelRecognizedTableAnnotationReceivedEvent ExcelRecognizedTable is null."))}zyd(N){return`${"RecognizedTableUpdate"}_${N}`}t_h(N,ea){b.ULS.sendTraceTag(537151248,306,15,"On-Demand Metadata Triggered");const Ca=N.range,la=A.h(this.$).jk("TableIntelligence",Ca,1),Ra=[],lb=[];
let Aa=0;const da=B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",!1),aa=B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceNumberFormatEnabled",!1);for(aa&&!this.instantaneousSupportInformationManager&&this.$.da.$a(268,fa=>{this.instantaneousSupportInformationManager=fa});la.$$mn();){const fa=la.$$cu();if(!fa)continue;if(0===fa.qx.type&&z.a.Tq(fa.qx.value))continue;fa.$H&&fa.range&&lb.push(Object(h.a)(new w,{worksheetId:N.sheetId,left:fa.range.left-
1,top:fa.range.top-1,right:fa.range.right-1,bottom:fa.range.bottom-1}));const Oa=fa.range.top-1,ba=fa.range.left-1;let ka=null,Pa=null;aa&&({category:Pa}=this.instantaneousSupportInformationManager.pCa(fa.cell.Gj,!0),fa.text!=fa.qx.value&&(ka=fa.text,da&&Aa++));Ra.push(Object.assign(new t,{row:Oa,column:ba,value:fa.qx.value,type:fa.qx.type,displayText:ka,I5j:Pa}))}da&&b.ULS.sendTraceTag(526260166,306,50,`TableIntelligenceManager::getRangeDataFromGrid requests non-null displayText: ${Aa}, number of values: ${Ra.length}, range size: ${Ca.height} rows by ${Ca.width} columns`);
if(0<Ra.length)return this.Deh(Ra,N,lb,ea),lb.length?5:0;b.ULS.sendTraceTag(537151247,306,15,"All cells in range were empty");return 3}Deh(N,ea,Ca,la){var Ra=ea.range;Ra=Object(h.a)(new w,{top:Ra.top,left:Ra.left,bottom:Ra.bottom,right:Ra.right,worksheetId:ea.sheetId});ea=n.a.create().toString();N=Object(h.a)(new v,{cells:N,range:Ra,mergeCellAddresses:Ca,requestId:ea});this.augmentationLoopManager.MXd(N);this.XVd.add(ea,la)}vqi(N){const ea=A.h(this.$);if(B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",
!1)){const Ca=ea.$Ka();b.ULS.sendTraceTag(520501001,306,50,`viewportWidth: ${Ca.width}, viewportHeight: ${Ca.height}`)}return ea.Da.HN(4,this.$.oa)&&!!ea.Sb(N.topLeft)&&!!ea.Sb(N.bottomLeft)&&!!ea.Sb(N.topRight)&&!!ea.Sb(N.bottomRight)}Kef(){var N;!this.ssf&&B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligenceLogging",!1)&&(this.ssf=!0,null===(N=this.kKd)||void 0===N?void 0:N.Wog())}}Object(u.a)(P,"TableIntelligenceManager",m.a,[2,343]);class S extends e.a{constructor(N){super();
this.$=N;this.Fb()}create(){d.TaskExtensions.za(f.GetServiceTaskFactory.Oa(this.$.da,328,327,1),N=>{if(N=N.result){let ea=this.$.da.Aa(20);ea||(ea=new P(N,this.$),this.$.da.Ga(20,ea));this.nb(ea)}else b.ULS.sendTraceTag(537151246,306,10,"AugmentationLoopManager instance null. Can not create TableIntelligenceManager instance. Creating null service event."),this.nb(null)},this.$.ka,3)}static la(N){N.da.Ga(404,new S(N))}}Object(u.a)(S,"TableIntelligenceManagerFactory",e.a,[]);class ja{constructor(N,
ea){this.Pte=!1;this.tableIntelligenceManager=N;B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EnableGridHighlights",!1)&&void f.GetServiceTaskFactory.aka(ea.da,510,511,1);this.tableIntelligenceManager.xZa("Valid",()=>{this.Pte||(b.ULS.sendTraceTag(526979921,0,15,"Received annotation with interpretations"),this.Pte=!0)})}}Object(u.a)(ja,"TableIntelligenceDarkActivationManager",null,[339]);var X=a(697);class Y extends e.a{constructor(N){super();this.$=N;this.Fb()}static la(N){N.da.Ga(481,
new Y(N))}create(){const N=f.GetServiceTaskFactory.Oa(this.$.da,20,404,1);d.TaskExtensions.za(N,()=>{const ea=N.result,Ca=Object(X.a)(this.$.da,480,()=>new ja(ea,this.$));this.nb(Ca)},this.$.ka,3)}}Object(u.a)(Y,"TableIntelligenceDarkActivationManagerFactory",e.a,[]);a.d(F,"a",function(){return va});const va=()=>{c.a.Fa(N=>{S.la(N);Y.la(N)})}},1259:function(u,F,a){var c=a(9);u=a(0);var b=a(222),e=a(15),f=a(38),d=a(1);class h extends f.a{constructor(){super()}A_d(r,y){e.ULS.sendTraceTag(537154185,
0,50,`ProactiveSuggestionManager.TriggerProactiveSuggestion: proactive suggestion was triggered. Range: ${r}, TriggerType: ${y}`);if(d.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.DataCleansingProactiveSuggestion",!1))switch(y){case 0:this.raiseEvent("pssort",void 0,r);break;case 1:this.raiseEvent("psfilter",void 0,r);break;case 2:this.raiseEvent("pscrttbl",void 0,r)}}}Object(u.a)(h,"ProactiveSuggestionManager",f.a,[590]);var n=a(697);class m extends b.a{constructor(r){super();
this.$=r;this.Fb()}create(){let r=Object(n.a)(this.$.da,476,()=>new h);this.nb(r)}static la(r){r.da.Ga(475,new m(r))}}Object(u.a)(m,"ProactiveSuggestionManagerFactory",b.a,[]);a.d(F,"a",function(){return x});const x=()=>{c.a.Fa(r=>{m.la(r)})}},1431:function(u,F,a){function c(ub,Vb=aa.a.Db){return da.b(ub.Xc(-1502853784,Vb,12,null))}function b(ub,Vb){ub.Xc(2105621672,aa.a.Db,12,{onClose:Vb})}function e(ub,Vb="DataCleansingTaskPane"){ub.Xc(802602464,aa.a.Db,12,{[fa.a.DQ]:Vb})}function f(ub){return ub.reduce((Vb,
tc)=>{var Sc=tc.tableRange;tc=tc.suggestions;Sc&&tc&&(Sc=Pa(Sc,!1).Ew(!1),Vb[Sc]=d(Vb[Sc],tc));return Vb},{})}function d(ub,Vb){return Vb.reduce((tc,{type:Sc})=>{Sc in tc?tc[Sc]++:Sc&&(tc[Sc]=1);return tc},null!==ub&&void 0!==ub?ub:{})}function h(ub,Vb,tc){var Sc;if(!Vb)return"";var jd=JSON.stringify(n(Vb));tc=(Vb=null===(Sc=Vb[0])||void 0===Sc?void 0:Sc.tableRange)?`${tc} ${Pa(Vb,!1).Ew(!1)}`:"";jd=`suggestionsCountPerType: [${jd}], tableIdentifier: [${tc}]`;return`tableType: [${m(ub)}], ${jd}`}
function n(ub){return ub.reduce((Vb,tc)=>{tc=oa[tc.type];tc in Vb||(Vb[tc]=0);Vb[tc]++;return Vb},{})}function m(ub){return ub?ub.includes(":")?"Range":"Ctrl-T":""}function x(ub){ub={otelEvent:Object.assign(Object.assign({},ub),{telemetryProperties:{ariaTenantToken:"19eb5e37de684ce38ce5cf3d5842d3f7-e8722941-bde5-4b98-9cd5-2775ec51482c-6873",nexusTenantToken:1777}}),additionalDataFields:void 0};ca.a.sendOtelEvent(ub)}function r(ub){$a.add(ub)}function y(ub){if(J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CleanDataSurvey",
!1)){const Vb=$a.has(0),tc=$a.has(1);Vb&&!tc&&ub.Xc(2063144036,-1,0,null)}}function t(ub,Vb){return Object(Qa.a)(this,void 0,void 0,function*(){if(Va.m(ub.oa)){const tc=ub.oa;return Vb.map(Sc=>Pa(Sc,!0)).filter(Sc=>tc.$0.cjc(Sc))}return[]})}function v(ub,Vb,tc){return Object(Qa.a)(this,void 0,void 0,function*(){try{switch(null===Vb||void 0===Vb?void 0:Vb.type){case 0:return w(ub,Vb,tc);case 2:return B(ub,Vb,tc);case 1:return C(ub,Vb,tc);default:Y.ULS.sendTraceTag(520987281,0,10,`applySuggestion: Unknown suggestion type ${null===
Vb||void 0===Vb?void 0:Vb.type}`)}}catch(Sc){Y.ULS.sendTraceTag(520987280,0,10,`applySuggestion: ${Sc}`)}return null})}function w(ub,Vb,tc){return Object(Qa.a)(this,void 0,void 0,function*(){const Sc=Vb.variations.filter(Fb=>Fb.isSelected&&Fb.value!==Vb.replacementValue).map(Fb=>Fb.value),jd={["SheetName"]:ub.oa.sheetName,["MatchCase"]:!1,["MatchEntireCell"]:!1,["SearchAllSheets"]:!1,["ExcludeFormulaResult"]:!1,["SearchUp"]:!1,["SearchStrings"]:Sc},pb=Vb.variations.every(Fb=>Fb.value!==Vb.replacementValue),
Rb=new xb(!pb&&!0),{aEd:oc,ZDd:Jc,rFd:ud}=z(Vb);Object(ha.a)(ub.userOperationManager,(Fb,pa,tb)=>W.x(ub.pa.ya,jd,Object(cb.u)(ub.oa.sheetName,null,tc),Vb.replacementValue,Object(Jb.b)(Fb,oc),Object(Jb.a)(pa,Jc),tb,Rb),Fb=>new ta.a(258,0,Fb),null);yield ud;return{result:Sc.length,successful:!0}})}function C(ub,Vb,tc){return Object(Qa.a)(this,void 0,void 0,function*(){if(null===tc||void 0===tc||!tc.length)return Y.ULS.sendTraceTag(520987279,0,10,"applyNumberFormatInconsistencySuggestion: empty changeRanges."),
Promise.resolve({result:0,successful:!1});const Sc=Object(cb.u)(ub.oa.sheetName,null,tc),jd=new xb(!0),pb={},Rb=Vb.formats.find(({key:tb})=>tb===Vb.replacementFormat).format;pb.NumberFormatOptions=Object(Z.a)(new Da.a,{NumberFormatCategory:-1,CustomFormatString:Rb});pb.ValidMembers=32;pb.NumberFormat=15;const oc=Object(cb.o)(Pb.h(ub).ha.ra.activeCell,ub),Jc=ub.pa.ya.Wb({wca:!0,Cba:1}),{aEd:ud,ZDd:Fb,rFd:pa}=z(Vb);Object(ha.a)(ub.userOperationManager,(tb,Nb,vc)=>wa.l(ub.pa.ya,Sc,oc,pb,!1,null,null,
!0,Object(Jb.b)(tb,ud),Object(Jb.a)(Nb,Fb),vc,jd,Jc,null),tb=>new ta.a(11,0,tb),null);yield pa;return{result:-1,successful:!0}})}function B(ub,Vb,tc){return Object(Qa.a)(this,void 0,void 0,function*(){const {aEd:Sc,ZDd:jd,rFd:pb}=z(Vb),Rb=new xb(!0);Object(ha.a)(ub.userOperationManager,(oc,Jc,ud)=>{var Fb=ub.pa.ya,pa=Object(cb.u)(ub.activeItemName,null,tc);a:{var tb=Vb.extraSpacesType;switch(tb){case 0:tb=1;break a;case 2:tb=2;break a;case 1:tb=4;break a;default:throw Y.ULS.sendTraceTag(520987278,
0,10,`ConvertExtraSpacesTypeToTrimWhitespaceType: Unknown ExtraSpacesPaddingType ${tb}`),Error.argument("illegal ExtraSpacesPaddingType");}}return db(Fb,pa,tb,Object(Jb.b)(oc,Sc),Object(Jb.a)(Jc,jd),ud,Rb)},oc=>new ta.a(253,0,oc),null);return{result:(yield pb).Result,successful:!0}})}function z(ub){const Vb=new Na.a;return{aEd(tc){tc&&ua.a.dg(tc.Errors)?(Y.ULS.sendTraceTag(520987277,0,10,`DataCleansing onOperationSuccess: Ewa result contains error messages after applying type [${ub.type}]`),Vb.setResult(null)):
(Y.ULS.sendTraceTag(537163359,0,20,`DataCleansing onOperationSuccess: Suggestion of type [${ub.type}] applied successfully in tableType [${m(ub.tableName)}]`),Vb.setResult(tc))},ZDd(tc){Y.ULS.sendTraceTag(520987275,0,10,`DataCleansing onOperationFailed: Ewa result contains error messages for type [${ub.type}], HttpStatus [${tc.data.httpStatus}]`);Vb.setResult(null)},rFd:da.d(Vb.task)}}function A(ub,Vb,tc,Sc=$b){const {fy:jd,success:pb}=ub.rZe(tc,Vb,Sc.width,Sc.font);return pb?jd:(Y.ULS.sendTraceTag(512508562,
0,50,"formatValue: Failed to acquire friendly format string"),"")}function E(ub){return ub.find(Vb=>Sd.a.Nyd(Vb,[qb.getTypeName()]))}function I(ub){return ub.filter(Vb=>Sd.a.Nyd(Vb,[ec.getTypeName()]))}function L({level:ub,methodName:Vb,message:tc,X5j:Sc=Hb.Table,h5j:jd=0,dataFields:pb={},eue:Rb=mb.OnDemand,fields:oc={}}){if(J.EwaSettings.isChangeGateEnabled("OfficeVSO:7288724_SmartViewEnableRecordLog"))switch(pb=Object.assign({},pb),pb.Method=Vb,pb.Message=tc,pb.SuggestionType=Sc,pb.ApiType=Rb,pb.Fields=
oc,Vb=gf.a.hc(pb),ub){case 50:Y.ULS.sendTraceTag(509752733,jd,50,Vb);break;case 15:Y.ULS.sendTraceTag(509752732,jd,15,Vb);break;case 10:Y.ULS.sendTraceTag(509752731,jd,10,Vb)}}a.r(F);var V=a(513),T=a(9),H=a(33),D=a(0),G=a(694),J=a(1),M=a(184),Q=a(55);class U{constructor(ub,Vb){this.$=ub;this.D0i=Vb}nc(){return!1}executeCommand(ub,Vb){ub=!0;switch(Vb.command){case -1190551534:this.D0i.HIe();break;default:ub=!1}return ub?Q.Task.Ta(!0):M.a(Vb.command)}wc(ub,Vb){return-1190551534===Vb.command&&J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingTaskPane",
!1)}Kc(){return!1}}Object(D.a)(U,"DataCleansingCommandHandler",null,[208]);var Z=a(7),P=a(89),S=a(49),ja=a(420),X=a(37),Y=a(15),va=a(38);class N{constructor(ub,Vb){this.MDg=ub;this.yPc=Vb}get JYd(){return this.MDg}get messageType(){return this.yPc}toString(){return"TaskPaneViewState: "+this.JYd+", MessageType: "+this.messageType}}Object(D.a)(N,"DataCleansingTaskPaneState",null,[]);class ea extends va.a{constructor(ub){super();this.UTd=this.ERa=this.y7a=this.isInViewMode=this.vNa=this.Naf=!1;this.nzc=
J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingDisableTaskPaneWhenALSessionClose",!1);this.BR=()=>{if(this.isInViewMode=!this.$.ea.isEditMode)this.ERa=!1;Y.ULS.sendTraceTag(509874460,0,50,`DataCleansingPaneStateManager.OnApplicationModeChanged: view mode has changed to ${this.isInViewMode}.`);this.uCa()};this.LB=(Vb,tc)=>{Vb=tc.a2d;Y.ULS.sendTraceTag(509874459,0,50,`DataCleansingPaneStateManager.OnUserListChanged: the number of coauth users has changed to ${Vb}.`);if(this.vNa&&
1>=Vb||!this.vNa&&1<Vb)this.vNa=1<tc.a2d,Y.ULS.sendTraceTag(509874458,0,50,`DataCleansingPaneStateManager.OnUserListChanged: coauthoring mode has changed to ${this.vNa}.`),this.vNa&&(this.ERa=!1),this.uCa()};this.FR=()=>{if(this.y7a=this.$.oa.Gd.Hv)this.ERa=!1;Y.ULS.sendTraceTag(509874457,0,50,`DataCleansingPaneStateManager.OnNamedSheetViewModeChanged: named sheet view mode has changed to ${this.y7a}.`);this.uCa()};this.Gh=(Vb,tc)=>{Y.ULS.sendTraceTag(509874456,0,50,"DataCleansingPaneStateManager.OnActiveSheetChanged: active sheet was changed.");
tc.UD.Gd.wRa(this.FR);tc.oa.Gd.psa(this.FR);this.y7a=tc.oa.Gd.Hv;this.ERa=!1;this.uCa()};this.cHb=()=>{Y.ULS.sendTraceTag(509874454,0,50,"DataCleansingPaneStateManager.onUnrecoverableErrorOccurred: Received augmentation loop permanent session close.");this.uCa()};this.$=ub;this.UTd&&this.$.ea.d$(this.LB);this.$.ea.IY(this.BR);this.$.oa.Gd.psa(this.FR);this.$.Vn.Xf(this.Gh);this.Eqc=this.Eqc.bind(this);this.$.da.$a(411,Vb=>{Vb.LNg(this.Eqc);this.nzc&&Vb.SNg(this.cHb);2===Vb.status&&(this.Naf=!0);this.uCa()});
this.Nve()&&(this.isInViewMode=!this.$.ea.isEditMode,this.vNa=1<this.$.ea.Xm.length,this.y7a=this.$.oa.Gd.Hv);this.Fib=this.zFe()}get currentState(){return this.Fib}get dataCleansingManager(){return this.$.da.Aa(411,void 0)}Iob(ub){this.addHandler("scev",ub)}evc(ub){this.removeHandler("scev",ub)}dispose(){this.$.da.$a(411,ub=>{ub.Hij(this.Eqc);ub.Nij(this.cHb)});this.$.ea.u7(this.LB);this.UTd&&this.$.ea.u7(this.LB);this.$.ea.B0(this.BR);this.$.oa.Gd.wRa(this.FR);this.$.Vn.Eg(this.Gh)}sEd(){this.ERa=
!1;Y.ULS.sendTraceTag(509874461,0,50,"DataCleansingPaneStateManager.OnRefreshRequested: refresh pane was triggerd.");this.uCa()}Eqc(ub,{sheetId:Vb,yea:tc}){Y.ULS.sendTraceTag(509874455,0,50,`DataCleansingPaneStateManager.OnSuggestionsStatusChanged: suggestion status of sheet id ${Vb} has changed to ${tc}.`);ub=this.$.xa.oa.sheetId;ub===Vb&&2===tc&&(this.ERa=!0);ub!==Vb||4!==tc&&2!==tc&&5!==tc||this.uCa()}Nve(){return this.$&&this.$.ea&&this.$.ea.Xm&&this.$.oa&&this.$.oa.Gd?!0:(Y.ULS.sendTraceTag(509874453,
0,50,"DataCleansingPaneStateManager.AreDependenciesValid: at least one of the dependencies is null."),!1)}uCa(){this.Fib=this.zFe();this.raiseEvent("scev")}zFe(){let ub;ub=this.H$h()?new N(4,5):this.isInViewMode?new N(5,2):this.UTd&&this.vNa?new N(5,1):this.y7a?new N(5,3):this.ERa?new N(2,0):this.jji()?new N(1,0):new N(0,0);Y.ULS.sendTraceTag(509874452,0,50,`DataCleansingPaneStateManager.ConcludeState: the new state of the data cleansing task pane is: ${ub}`);return ub}jji(){const ub=this.JMh();return 4===
ub||6===ub}JMh(){return this.dataCleansingManager?this.dataCleansingManager.Ebc():0}H$h(){return this.Naf||!this.cpd()||!this.Nve()}cpd(){const ub=this.dataCleansingManager;return this.nzc&&J.EwaSettings.isChangeGateEnabled("OfficeVSO:6245313_disableTaskPaneWhenALSessionClose")&&ub?ub.cpd:!0}}Object(D.a)(ea,"DataCleansingPaneStateManager",va.a,[]);var Ca=a(173),la=a(1321),Ra=a(741),lb=a(13);class Aa{constructor(){this.availableTables=this.selectedTable=this.suggestions=this.callbacks=this.isLoading=
this.type=null;this.viewState=0;this.sheetName=this.sheetId=this.applyConfirmationMessage=this.messageType=null}}Object(D.a)(Aa,"DataCleansingTaskPaneProps",null,[]);var da=a(185),aa=a(76),fa=a(5),Oa=a(24);class ba{constructor(){this.bottom=this.top=this.right=this.left=0}}Object(D.a)(ba,"RangeAddress",null,[]);const ka=ub=>Pa(ub,!1).Ew(!1),Pa=(ub,Vb)=>{ub=new Oa.Range(ub.top,ub.left,ub.bottom,ub.right,!1,Vb);if(Vb&&(1>ub.top||ub.top>ub.maxRows||1>ub.bottom||ub.bottom>ub.maxRows||ub.top>ub.bottom||
1>ub.left||ub.left>ub.maxColumns||1>ub.right||ub.right>ub.maxColumns||ub.left>ub.right))throw Y.ULS.sendTraceTag(510247817,0,10,"Range.ValidateRange: range is invalid"),Error.argument("Range.ValidateRange: range is invalid");return ub},Fa=ub=>Object(Z.a)(new ba,{left:ub.left,right:ub.right,top:ub.top,bottom:ub.bottom});var oa;(function(ub){ub[ub.textInconsistency=0]="textInconsistency";ub[ub.numberFormatInconsistency=1]="numberFormatInconsistency";ub[ub.extraSpaces=2]="extraSpaces"})(oa||(oa={}));
Object(D.b)("SuggestionType",oa);class La{constructor(ub,Vb){this.onKeyDown=tc=>{switch(this.$.shortcutKeyManager.vs(new Sys.UI.DomEvent(tc))){case -1502853784:switch(tc.stopPropagation(),tc=this.$.ea.hQb,tc){case 1:Y.ULS.sendTraceTag(510247753,0,50,"DataCleansingReactTaskPane.onKeyDown: Undo command triggered");void c(this.$,1);break;default:Y.ULS.sendTraceTag(510247752,0,50,`DataCleansingReactTaskPane.onKeyDown: Undo command skipped, state is ${tc}`)}}};this.m7b=ub;this.$=Vb}hE(ub,Vb,tc,Sc,jd,pb,
Rb,oc){void Ca.UISurfaces.aj().then(Jc=>{var ud,Fb;Jc.showTaskPane("DataCleansingTaskPane",this.tu(ub,Vb,tc.JYd,Sc,jd,pb,tc.messageType,Rb,oc));Jc=null!==(ud=null===Vb||void 0===Vb?void 0:Vb.length)&&void 0!==ud?ud:0;ud=null!==(Fb=null===Sc||void 0===Sc?void 0:Sc.length)&&void 0!==Fb?Fb:0;Fb=h(jd,Vb,Rb);Y.ULS.sendTraceTag(537163409,0,50,`DataCleansingReactTaskPane.ShowReactTaskPane: Suggestions count: [${Jc}], tableNames count: [${ud}], taskPaneState: [${tc}], ${Fb}`);return null})}Vu(ub,Vb,tc,Sc,
jd,pb,Rb,oc){void Ca.UISurfaces.aj().then(Jc=>{Jc.updateTaskPane("DataCleansingTaskPane",this.tu(ub,Vb,tc.JYd,Sc,jd,pb,tc.messageType,Rb,oc));Jc=h(jd,Vb,Rb);Y.ULS.sendTraceTag(537163408,0,50,`DataCleansingReactTaskPane.UpdateReactTaskPane: Suggestions count: [${Vb.length}], tableNames count: [${Sc.length}], taskPaneState: [${tc}], ${Jc}`);return null})}DF(){void Ca.UISurfaces.aj().then(ub=>{ub.hideTaskPane("DataCleansingTaskPane",2);return null})}D7(){void Ca.UISurfaces.aj().then(ub=>{ub.setSelectedTaskPane("DataCleansingTaskPane");
return null})}tu(ub,Vb,tc,Sc,jd,pb,Rb,oc,Jc){Vb=Object(Z.a)(new Aa,{type:"DataCleansingTaskPaneProps",suggestions:Vb,callbacks:pb,availableTables:Sc,selectedTable:jd,isLoading:0===tc,viewState:tc,messageType:Rb,["sheetId"]:oc,["sheetName"]:Jc});return H.a.fd(this.$)?Object(Z.a)(new la.a,{width:320,contentProps:Vb,title:lb.a.instance.ga(1299),onOpen:ud=>{ud.addEventListener("keydown",this.onKeyDown);this.m7b.zy()},onClose:ud=>{ud.removeEventListener("keydown",this.onKeyDown);this.m7b.KB()},onHide:()=>
{this.m7b.KB()},onShow:()=>{this.m7b.zy()}}):Object(Z.a)(new la.a,{contentProps:Object(Z.a)(new Ra.a,{container:ub,paneProps:Vb})})}}Object(D.a)(La,"DataCleansingReactTaskPane",null,[]);class Ea{constructor(){this.containsHiddenCells=this.onPaneLifecycleEvent=this.sendOtelEvent=this.onFeedback=this.onCustomNumberFormatOptionChosen=this.canApplySuggestion=this.onUndo=this.onForceRefresh=this.onTableSelected=this.onSuggestionRejected=this.onSuggestionApplied=this.onSuggestionValuesChanged=this.onCancelSuggestionPreview=
this.onSuggestionPreview=this.onSuggestionDeselected=this.onSuggestionSelected=null}}Object(D.a)(Ea,"DataCleansingTaskPaneCallbacks",null,[]);var ca=a(147);const $a=new Set;var Qa=a(163),Va=a(66);class fb{constructor(ub){this.BU=this.m9a=null;this.xEf=()=>{this.hideTaskPane()};this.yEf=()=>{this.KB()};this.zEf=()=>{this.zy()};this.PIf=()=>{this.updateTaskPane()};this.onSuggestionApplied=Vb=>{Vb&&this.KEj();r(1)};this.Xca=()=>{this.updateTaskPane()};this.Gh=()=>{this.Kf&&this.$.da.$a(411,Vb=>{Vb.p1f()})};
this.sEd=()=>{this.$.da.$a(411,Vb=>{Vb.SPj()});this.Eza.sEd()};this.$=ub;this.$ta=new La(this,this.$);this.Kf=this.R7a=!1;this.Eza=new ea(ub);this.Eza.Iob(this.Xca);this.$.da.$a(411,Vb=>{Vb.RMg(this.PIf);Vb.QMg(this.onSuggestionApplied);this.$.Vn.Xf(this.Gh)})}HIe(){const ub=this.$.da.Aa(411),Vb=null===ub||void 0===ub?void 0:ub.Q_e();this.Y$g(Vb,this.sHe(ub))}Y$g(ub=null,Vb=null){let tc=null,Sc=null,jd=null,pb=null,Rb=null;ub&&(tc=ub.Dcg,Sc=ub.oS,jd=ub.suggestions,pb=ub.sheetId,Rb=ub.sheetName);if(H.a.fd(this.$))this.Kf?
this.$ta.D7():this.$ta.hE(this.m9a,jd,this.Eza.currentState,tc,Sc,Vb,pb,Rb);else if(this.BU)this.X8f(jd,tc,Sc,Vb);else if(!this.R7a){this.R7a=!0;const oc=S.GetServiceTaskFactory.Oa(this.$.da,415,416,0),Jc=ja.a(this.$);ub=S.GetServiceTaskFactory.create(this.$.da,203,this.$.ka,0);X.TaskExtensions.za(X.TaskExtensions.Ed([oc,Jc,ub],this.$.ka),()=>{this.BU=oc.result;Jc.result.zN(this.BU);this.dYi();this.X8f(jd,tc,Sc,Vb)},this.$.ka,3);return}Q.Task.Ta(!0)}zy(){this.Kf=!0;$a.clear();this.$.da.$a(411,ub=>
{ub.p1f()})}KB(){this.Kf=!1;y(this.$);this.$.da.$a(411,ub=>{ub.onSuggestionDeselected(null);ub.nkh();ub.k4b()})}dispose(){this.Eza.evc(this.Xca);P.a.Ia(this.Eza);this.$.da.$a(411,ub=>{ub.Shj(this.PIf);ub.Rhj(this.onSuggestionApplied)});this.hideTaskPane();this.BU&&(this.BU.xO(this.xEf),this.BU.yMd(this.yEf),this.BU.zMd(this.zEf),this.$.Vn.Eg(this.Gh),this.BU=null);this.m9a=this.$ta=this.$=null;this.R7a=!1}sHe(ub){return ub?Object(Z.a)(new Ea,{onSuggestionSelected:ub.onSuggestionSelected,onSuggestionDeselected:ub.onSuggestionDeselected,
onSuggestionPreview:ub.onSuggestionPreview,onCancelSuggestionPreview:ub.onCancelSuggestionPreview,onSuggestionValuesChanged:ub.onSuggestionValuesChanged,onSuggestionApplied:ub.BLi,onSuggestionRejected:ub.onSuggestionRejected,onTableSelected:ub.onTableSelected,onForceRefresh:this.sEd,onUndo:ub.RYi,canApplySuggestion:ub.canApplySuggestion,onCustomNumberFormatOptionChosen:ub.onCustomNumberFormatOptionChosen,onFeedback:()=>{e(this.$)},sendOtelEvent:x,onPaneLifecycleEvent:r,containsHiddenCells:Vb=>t(this.$,
Vb)}):null}dYi(){this.m9a=this.BU.WM();this.BU.AM(this.xEf);this.BU.uXc(this.yEf);this.BU.vXc(this.zEf)}X8f(ub,Vb,tc,Sc){this.BU.yg(!0);const jd=Va.d(this.$.oa);this.Kf?(this.$ta.Vu(this.m9a,ub,this.Eza.currentState,Vb,tc,Sc,jd,this.$.oa.sheetName),this.$ta.D7()):(this.$ta.hE(this.m9a,ub,this.Eza.currentState,Vb,tc,Sc,jd,this.$.oa.sheetName),this.zy())}hideTaskPane(){this.$ta.DF();this.KB()}updateTaskPane(){this.$.da.$a(411,ub=>{if(this.Kf){const Vb=ub.Q_e();this.$ta.Vu(this.m9a,Vb.suggestions,this.Eza.currentState,
Vb.Dcg,Vb.oS,this.sHe(ub),Vb.sheetId,Vb.sheetName)}})}KEj(){this.Kf&&this.updateTaskPane()}}Object(D.a)(fb,"DataCleansingPaneManager",null,[]);class Ka{constructor(ub,Vb){this.type="DataCleansingStatefulTaskPaneProps";this.annotations=[];this.callbacks=ub;this.hostAppCallbacks=Vb}}Object(D.a)(Ka,"TaskpaneProps",null,[641]);class hb{constructor(ub,Vb,tc){this.Lc=ub;this.uBb=!1;this.aC=Object(Z.a)(new la.a,{width:330,title:lb.a.instance.ga(1299),onOpen:()=>{this.uBb=!0;$a.clear();Y.ULS.sendTraceTag(510247821,
0,50,"DataCleansingTaskpane.onOpen")},onClose:()=>{this.uBb=!1;y(this.Lc);Y.ULS.sendTraceTag(510247820,0,50,"DataCleansingTaskpane.onClose")},onHide:()=>{this.uBb=!1;y(this.Lc);Y.ULS.sendTraceTag(510247819,0,50,"DataCleansingTaskpane.onHide")},onShow:()=>{this.uBb=!0;$a.clear();Y.ULS.sendTraceTag(510247818,0,50,"DataCleansingTaskpane.onShow")}});this.aC.contentProps=new Ka(Vb,tc)}zyc(ub){Object.assign(this.aC.contentProps,ub);void this.render()}render(){return Object(Qa.a)(this,void 0,void 0,function*(){if(this.uBb){const ub=
yield Ca.UISurfaces.aj();ub.updateTaskPane("DataCleansingStatefulTaskPane",this.aC);ub.setSelectedTaskPane("DataCleansingStatefulTaskPane")}})}show(){return Object(Qa.a)(this,void 0,void 0,function*(){(yield Ca.UISurfaces.aj()).showTaskPane("DataCleansingStatefulTaskPane",this.aC)})}hide(){return Object(Qa.a)(this,void 0,void 0,function*(){(yield Ca.UISurfaces.aj()).hideTaskPane("DataCleansingStatefulTaskPane",this.aC.location)})}}Object(D.a)(hb,"DataCleansingTaskpane",null,[]);class fc{constructor(ub){this.$=
ub;this.HDf=(Vb,tc)=>{var Sc;null===(Sc=this.n7b)||void 0===Sc?void 0:Sc.zyc(tc)}}HIe(){H.a.fd?this.$xb().then(ub=>ub.show()):Y.ULS.sendTraceTag(522782367,0,10,"DataCleansingPaneManager.createOrShowDataCleansingTaskPane: Stateful taskpane is only supported in the new WacTaskPaneInfra")}dispose(){var ub;null===(ub=this.dataCleansingHostManager)||void 0===ub?void 0:ub.evc(this.HDf)}$xb(){return Object(Qa.a)(this,void 0,void 0,function*(){this.n7b||(this.dataCleansingHostManager=yield S.GetServiceTaskFactory.aka(this.$.da,
494,495,4),this.n7b=new hb(this.$,this.dataCleansingHostManager.callbacks,this.dataCleansingHostManager.iQg),this.n7b.zyc(this.dataCleansingHostManager.state),this.dataCleansingHostManager.Iob(this.HDf));return this.n7b})}}Object(D.a)(fc,"DataCleansingPaneManager",null,[]);class dc extends G.a{constructor(ub){super(ub)}ld(){J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingStatefulTaskPane",!1)?this.Zc([new U(this.$,new fc(this.$))]):this.Zc([new U(this.$,new fb(this.$))])}static la(ub){G.a.Nd(417,
new dc(ub))}}Object(D.a)(dc,"DataCleansingCommandHandlerFactory",G.a,[]);var wb=a(222),Tb=a(82);class xb{constructor(ub){this.$7f=ub}}Object(D.a)(xb,"DataCleansingApplyContext",null,[]);var cb=a(40);class jb{constructor(ub,Vb,tc,Sc,jd){this.suggestions=ub;this.Dcg=Vb;this.oS=tc;this.sheetId=Sc;this.sheetName=jd}}Object(D.a)(jb,"DataCleansingSuggestionsResponse",null,[]);var qa=a(263),za=a(571),Na=a(157),ua=a(29);class Xa{constructor(ub,Vb=null){this.r_a=new Na.a;this.RTc=this.DQc=null;this.bEd=tc=>
{var Sc;tc&&ua.a.dg(tc.Errors)?(Y.ULS.sendTraceTag(509874267,0,10,`DataCleansingEwaSuggestion.OnOperationSuccessCallback: Ewa result contains error messages after applying type [${this.type}]`),this.r_a.setResult(null)):(Y.ULS.sendTraceTag(537163359,0,20,`DataCleansingEwaSuggestion.OnOperationSuccessCallback: Suggestion of type [${this.type}] applied successfully in tableType [${m(null===(Sc=this.AI)||void 0===Sc?void 0:Sc.tableName)}]`),this.r_a.setResult(tc))};this.$Dd=tc=>{Y.ULS.sendTraceTag(509748801,
0,10,`DataCleansingEwaSuggestion.OnOperationFailedCallback: Ewa result contains error messages for type [${this.type}], HttpStatus [${tc.data.httpStatus}]`);this.r_a.setResult(null)};this.jb=ub;Vb&&(this.DQc=Vb,this.RTc=Pa(Vb.suggestionRange,!0))}get id(){return this.AI.id}get type(){return this.AI.type}get AI(){return this.DQc}get suggestionRange(){return this.RTc}get $(){return this.jb}E3i(ub,Vb){this.DQc=ub=this.X4c(ub,Vb);this.RTc=Pa(ub.suggestionRange,!0)}}Object(D.a)(Xa,"DataCleansingEwaSuggestion",
null,[666]);var ha=a(374),ta=a(188),wa=a(60);const db=(ub,Vb,tc,Sc,jd,pb,Rb,oc=null)=>{oc=ub.Na(9,oc);oc.ranges=Vb;oc.trimWhitespaceType=tc;return wa.g(ub,"TrimWhitespace",oc,Sc,jd,pb,Rb,0)};var Jb=a(281),Pb=a(21),eb=a(346);class Ma{constructor(){this.id=null;this.type=0;this.columnName=this.columnIdentifier=this.suggestionRange=this.suggestionRangeStringRef=this.tableIdentifier=this.tableRange=this.tableName=null}}Object(D.a)(Ma,"DataCleansingSuggestion",null,[]);class ob extends Ma{constructor(){super();
this.extraSpacesType=0;this.ranges=null}}Object(D.a)(ob,"ExtraSpacesSuggestion",Ma,[]);class Ia extends Xa{constructor(ub,Vb=null){super(ub,Vb)}qmd(ub){const Vb=this.Jva();Vb&&Pb.h(this.$).qb.lx(eb.a.Gea(Va.d(this.$.oa),Object(cb.W)(Vb)),ub,!0,void 0,!0)}Jva(){const ub=this.AI;ub||Y.ULS.sendTraceTag(510247744,0,10,"ExtraSpacesEwaSuggestion.HighlightOnGrid: suggestion cast failure, should not happen");const Vb=[];for(const tc of ub.ranges)Vb.push(Pa(tc,!1));if(0<Vb.length)return Vb}Q0c(){return!0}apply(){const ub=
this.AI,Vb=new xb(!0);ha.a(this.$.userOperationManager,(tc,Sc,jd)=>db(this.$.pa.ya,Object(cb.u)(this.$.activeItemName,null,qa.a.map(ub.ranges,pb=>Pa(pb,!1))),Ia.e9g(ub.extraSpacesType),Jb.b(tc,this.bEd),Jb.a(Sc,this.$Dd),jd,Vb),tc=>new ta.a(253,0,tc),null);return da.d(this.r_a.task).then(tc=>({result:tc.Result,successful:!0}))}X4c(ub,Vb){if(!ub)return Y.ULS.sendTraceTag(510247715,0,10,"ExtraSpacesEwaSuggestion.ConvertToPaneSuggestion: suggestion cast failure, should not happen"),null;Vb=Object(Z.a)(new ob,
{id:za.a.create().toString(),type:2,tableRange:Vb.tableRange,tableName:Vb.tableName,columnName:Vb.D3c,extraSpacesType:this.t1i(ub.extraSpacesType),ranges:[]});var tc=Fa(ub.suggestionRange);Vb.suggestionRange=tc;tc=Pa(tc,!0);Vb.suggestionRangeStringRef=tc.Ew(!1);for(const Sc of ub.ranges)Vb.ranges.push(Fa(Sc));return Vb}t1i(ub){switch(ub){case "Leading":return 0;case "Trailing":return 1;case "InBetween":return 2;default:throw Y.ULS.sendTraceTag(510247714,0,10,"ExtraSpacesEwaSuggestion.ParseStringToExtraSpacesType: received illegal extra spaces type."),
Error.argument("illegal extra spaces type");}}static e9g(ub){switch(ub){case 0:return 1;case 2:return 2;case 1:return 4;default:throw Y.ULS.sendTraceTag(510247713,0,10,"ExtraSpacesEwaSuggestion.ConvertExtraSpacesTypeToTrimWhitespaceType: received illegal ExtraSpacesPaddingType."),Error.argument("illegal ExtraSpacesPaddingType");}}}Object(D.a)(Ia,"ExtraSpacesEwaSuggestion",Xa,[]);var Da=a(776);class nb extends Ma{constructor(){super();this.isMixedNumberText=this.variationsType=this.formats=this.replacementFormat=
this.suggestedFormat=null}}Object(D.a)(nb,"NumberFormatInconsistencySuggestion",Ma,[]);class Ua extends Xa{constructor(ub,Vb,tc=null){super(ub,tc);this.tve=!1;this.sg=Vb}qmd(ub){const Vb=this.Jva();Vb&&Pb.h(this.$).qb.lx(eb.a.Gea(Va.d(this.$.oa),Object(cb.W)(Vb)),ub,!0,void 0,!1);Pb.h(this.$).qb.update(!1)}Jva(){const ub=this.AI;ub||Y.ULS.sendTraceTag(510247712,0,10,"NumberFormattingEwaSuggestion.HighlightOnGrid: suggestion cast failure, should not happen");const Vb=[];for(const tc of ub.formats)if(tc.ranges&&
0<tc.ranges.length)for(const Sc of tc.ranges)(tc.format!==ub.replacementFormat||J.EwaSettings.isChangeGateEnabled("OfficeVSO:6401137_DataClensingStringTypeAsNonTextFix")&&!tc.isApplicable)&&Vb.push(Pa(Sc,!1));if(0<Vb.length)return Vb}Q0c(){return!this.tve}apply(){const ub=this.AI;var Vb=this.Jva();if(!Vb)return Y.ULS.sendTraceTag(510247711,0,10,"NumberFormattingEwaSuggestion.apply: empty bad ranges."),Promise.resolve({result:0,successful:!1});const tc=new xb(!0),Sc={},jd=ub.formats.find(({key:Jc})=>
Jc===ub.replacementFormat).format;Sc.NumberFormatOptions=Ua.G9g(jd);Sc.ValidMembers=32;Sc.NumberFormat=15;const pb=Object(cb.u)(this.$.oa.sheetName,null,Vb);Vb=Pb.h(this.$);const Rb=Object(cb.o)(Vb.ha.ra.activeCell,this.$),oc=this.$.pa.ya.Wb({wca:!0,Cba:1});ha.a(this.$.userOperationManager,(Jc,ud,Fb)=>wa.l(this.$.pa.ya,pb,Rb,Sc,!1,null,null,!0,Jb.b(Jc,this.bEd),Jb.a(ud,this.$Dd),Fb,tc,oc,null),Jc=>new ta.a(11,0,Jc),null);return da.d(this.r_a.task).then(()=>({result:-1,successful:!0}))}X4c(ub,Vb){if(!ub)return Y.ULS.sendTraceTag(510247710,
0,10,"NumberFormattingEwaSuggestion.ConvertToPaneSuggestion: suggestion cast failure, should not happen"),null;var tc=ub.suggestedFormat.value;const Sc=this.p_e(tc);Vb=Object(Z.a)(new nb,{id:za.a.create().toString(),type:1,tableRange:Vb.tableRange,tableName:Vb.tableName,columnName:Vb.D3c,replacementFormat:tc,suggestedFormat:tc,formats:[],variationsType:this.u1i(ub.variationsType)});tc=Fa(ub.suggestionRange);Vb.suggestionRange=tc;tc=Pa(tc,!0);Vb.suggestionRangeStringRef=tc.Ew(!1);this.Iue(Sc,ub.suggestedFormat,
Vb);for(var jd of ub.otherFormats)ub=this.p_e(jd.value),this.Iue(ub,jd,Vb);jd=this.$Fh(Vb);Vb.suggestedFormat=jd;Vb.replacementFormat=jd;jd||(this.tve=!0);return Vb}$Fh(ub){if(ub=ub.formats.find(Vb=>Vb.isApplicable))return ub.format}Iue(ub,Vb,tc){ub={value:ub,ranges:[],isApplicable:ub?Vb.isApplicable:!1,format:Vb.value,key:Vb.value};this.Kyc(ub,Vb.ranges);tc.formats.push(ub)}p_e(ub){if(!Ua.hwb.has(ub)){const Vb=this.sg.rZe("1234.56",ub,244,"12px sans-serif");Vb.success?(Array.from(Ua.hwb.values()).find(tc=>
tc==Vb.fy)&&Y.ULS.sendTraceTag(510247708,0,50,"Duplicated friendly format string for different formats."),Ua.hwb.set(ub,Vb.fy)):(Y.ULS.sendTraceTag(510247709,0,50,"NumberFormattingEwaSuggestion.GenerateFriendlyFormatString: Failed to acquire friendly format string"),Ua.hwb.set(ub,""))}return Ua.hwb.get(ub)}Kyc(ub,Vb){for(const tc of Vb)Vb=Fa(tc),ub.ranges.push(Vb)}static G9g(ub){return Object(Z.a)(new Da.a,{NumberFormatCategory:-1,CustomFormatString:ub})}u1i(ub){switch(ub){case "AllNumber":return 0;
case "AllText":return 1;case "MixedNumberAndText":return 2;default:throw Y.ULS.sendTraceTag(510247707,0,10,"NumberFormattingEwaSuggestion.ParseStringToNumberFormatVariationsType: received illegal variations type."),Error.argument("illegal variations type");}}}Ua.hwb=new Map;Object(D.a)(Ua,"NumberFormattingEwaSuggestion",Xa,[]);var W=a(283),sa=a(79);class vb extends Xa{constructor(ub,Vb=null){super(ub,Vb)}qmd(ub){const Vb=this.Jva();Vb&&Pb.h(this.$).qb.lx(eb.a.Gea(Va.d(this.$.oa),Object(cb.W)(Vb)),
ub,!0,void 0,!1);Pb.h(this.$).qb.update(!1)}Jva(){const ub=this.AI;ub||Y.ULS.sendTraceTag(510247706,0,10,"TextInconsistencyEwaSuggestion.HighlightOnGrid: suggestion cast failure, should not happen");const Vb=this.G8e(tc=>tc.isSelected&&tc.value!==ub.replacementValue,!1);if(0<Vb.length)return Vb}Q0c(){const ub=this.AI;return qa.a.any(ub.variations,Vb=>Vb.isSelected&&Vb.value!==ub.replacementValue)&&!!ub.replacementValue}apply(){const ub=this.AI,Vb=this.xK(),tc=this.G8e(Rb=>Rb.isSelected&&Rb.value!==
ub.replacementValue),Sc=ub.variations.every(Rb=>Rb.value!==ub.replacementValue),jd=new xb(!Sc&&!0);ha.a(this.$.userOperationManager,(Rb,oc,Jc)=>W.x(this.$.pa.ya,Vb,Object(cb.u)(this.$.oa.sheetName,null,tc),ub.replacementValue,Jb.b(Rb,this.bEd),Jb.a(oc,this.$Dd),Jc,jd),Rb=>new ta.a(258,0,Rb),null);const pb=ub.variations.filter(Rb=>Rb.isSelected&&Rb.value!==ub.replacementValue).length;return da.d(this.r_a.task).then(()=>({result:pb,successful:!0}))}X4c(ub,Vb){if(!ub)return Y.ULS.sendTraceTag(510247703,
0,10,"TextInconsistencyEwaSuggestion.ConvertToPaneSuggestion: suggestion cast failure, should not happen"),null;Vb={id:za.a.create().toString(),type:0,tableRange:Vb.tableRange,tableName:Vb.tableName,columnName:Vb.D3c,normalizedValue:ub.normalizedValue,suggestedValue:ub.suggestedValue.value,replacementValue:ub.suggestedValue.value,variations:[],tableIdentifier:null,suggestionRange:null,suggestionRangeStringRef:null,columnIdentifier:null};var tc=Fa(ub.suggestionRange);Vb.suggestionRange=tc;tc=Pa(tc,
!0);Vb.suggestionRangeStringRef=tc.Ew(!1);tc={value:ub.suggestedValue.value,ranges:[],isSelected:!1};this.Kyc(tc,ub.suggestedValue.ranges);Vb.variations.push(tc);for(const Sc of ub.variations)ub={value:Sc.value,ranges:[],isSelected:!0},this.Kyc(ub,Sc.ranges),Vb.variations.push(ub);return Vb}Kyc(ub,Vb){for(const tc of Vb)Vb=Fa(tc),ub.ranges.push(Vb)}xK(){const ub=this.AI,Vb=sa.select(sa.where(sa.asEnumerable(ub.variations),Sc=>Sc.isSelected&&Sc.value!==ub.replacementValue),Sc=>Sc.value),tc={ExcludeFormulaResult:!0,
MatchCase:!0,MatchEntireCell:!0,SearchAllSheets:!1};tc.SearchStrings=sa.toArray(Vb);tc.SearchUp=!1;tc.SheetName=this.$.oa.sheetName;return tc}G8e(ub,Vb=!0){const tc=[],Sc=this.AI;for(const jd of Sc.variations)jd.ranges&&ub(jd)&&tc.push(...qa.a.map(jd.ranges,pb=>Pa(pb,Vb)));return tc}}Object(D.a)(vb,"TextInconsistencyEwaSuggestion",Xa,[]);const gc=(ub,Vb,tc,Sc)=>{try{switch(tc.type){case "TextInconsistency":return Bc(tc,Sc,()=>new vb(ub));case "ExtraSpaces":return Bc(tc,Sc,()=>new Ia(ub));case "NumberFormattingInconsistency":return Bc(tc,
Sc,()=>new Ua(ub,Vb));default:return Y.ULS.sendTraceTag(510247747,0,10,"DataCleansingEwaSuggestionFactory.CreateFromTableLintSuggestion: suggestion type is not supported - "+tc.type),null}}catch(jd){return Y.ULS.sendTraceTag(510247746,0,10,"DataCleansingEwaSuggestionFactory.CreateFromTableLintSuggestion: exception thrown"),null}},Bc=(ub,Vb,tc)=>{tc=tc();tc.E3i(ub,Vb);return tc};class Sa extends va.a{constructor(ub){super();this.Cy=new Map;this.Eca=new Map;this.jpb=new Map;this.kOc=null;this.yea=new Map;
this.$=ub}get sof(){return this.kOc}get loe(){var ub=this.$.xa.oa.sheetId;const Vb=[];if(!this.Cy.has(ub))return Vb;ub=this.Cy.get(ub);for(let tc of ub.keys())this.P_e(tc).length&&Vb.push(tc);return Vb}get mGg(){const ub=this.$.xa.oa.sheetId;return this.yea.has(ub)?this.yea.get(ub):0}get uMj(){return this.yea.keys()}k4b(){this.Eca=new Map}j3g(){this.jpb=new Map;this.kOc=null}applySuggestion(ub){ub&&this.jpb.set(ub.id,ub)}MCe(ub){const Vb=this.yea.get(ub);if(2===Vb||5===Vb)J.EwaSettings.isChangeGateEnabled("OfficeVSO:6443391_InfiniteLoadingOnSwitchingSheets")?
Y.ULS.sendTraceTag(510247751,0,50,`DataCleansingSuggestionsCollection.clearAllSuggestions: Clearing all suggestions for sheet ${ub}. Suggestions status=${Vb}.`):Y.ULS.sendTraceTag(510247750,0,50,"DataCleansingSuggestionsCollection.clearAllSuggestions: Clearing all suggestions."),this.k4b(),this.K3g(),this.j3g()}HGi(ub,Vb){this.Eca.set(ub,Vb)}onSuggestionApplied(ub){this.kOc=ub}QYi(ub){this.jpb.delete(ub)}Bn(ub,Vb){if(this.Cy.has(ub)&&(ub=this.Cy.get(ub),ub.has(Vb))){Vb=ub.get(Vb);for(let tc of Vb.values())return Pa(tc.AI.tableRange,
!0)}return null}Vsi(ub,Vb){return this.Cy.has(ub)?this.Cy.get(ub).has(Vb):!1}P_e(ub){const Vb=[];if(!ub)return Vb;var tc=this.$.xa.oa.sheetId;if(!this.Cy.has(tc))return Vb;tc=this.Cy.get(tc);if(tc.has(ub)){ub=tc.get(ub);for(let Sc of ub.keys())this.jpb.has(Sc)||(this.Eca.has(Sc)?Vb.push(this.Eca.get(Sc).AI):Vb.push(ub.get(Sc).AI))}return Vb}KMh(){var ub=Va.d(this.$.oa);const Vb=[];if(ub=this.Cy.get(ub))for(let tc of ub.values())for(let Sc of tc.keys())this.jpb.has(Sc)||(ub=this.Eca.get(Sc)||tc.get(Sc),
Vb.push(ub.AI));return Vb}w5a(ub){return this.Eca.has(void 0)?this.Eca.get(void 0):this.Cy.has(ub)&&(ub=this.Cy.get(ub),ub.has(void 0)&&(ub=ub.get(void 0),ub.has(void 0)))?ub.get(void 0):null}I2h(ub){if(this.Eca.has(ub))return this.Eca.get(ub);for(const Vb of this.Cy.values())for(const tc of Vb.values())if(tc.has(ub))return tc.get(ub);return null}GSd(ub,Vb,tc){if(tc){this.MCe(ub);this.yea.set(ub,1);for(const Sc of tc)this.CJg(ub,Vb,Sc)}}$Ld(ub,Vb,tc){this.Efj(ub,Vb,tc);this.Eca.delete(tc.id)}o5f(ub,
Vb){this.yea.set(Vb,ub);Y.ULS.sendTraceTag(510247749,0,50,`DataCleansingSuggestionsCollection.setAllSheetsSuggestionsStatus: Setting the suggestions status of sheet id ${Vb} to ${ub}.`)}ejd(ub){return this.yea.get(ub)}L1h(ub){let Vb=0;if(this.Cy.has(ub)){ub=this.Cy.get(ub);for(const [,tc]of ub)Vb+=tc.size}return Vb}K3g(){this.Cy=new Map;this.yea=new Map}Efj(ub,Vb,tc){if(this.Cy.has(ub)){const Sc=this.Cy.get(ub);if(Sc.has(Vb)){const jd=Sc.get(Vb);jd.has(tc.id)&&(jd.delete(tc.id),jd.size||Sc.delete(Vb),
Sc.size||this.Cy.delete(ub))}}}CJg(ub,Vb,tc){this.Cy.has(ub)||this.Cy.set(ub,new Map);const Sc=this.Cy.get(ub);Sc.has(Vb)||this.Cy.get(ub).set(Vb,new Map);Sc.get(Vb).set(tc.id,tc)}}Object(D.a)(Sa,"DataCleansingSuggestionsCollection",va.a,[]);var na=a(724),ib=a(699);class Ib extends na.a{constructor(){super();this.columnIdentifier=this.tableIdentifier=this.tableRange=this.tableName=this.worksheetName=this.worksheetId=null;this.H_=Object.assign(new ib.a,{T_:Ib.getTypeName(),B_:Ib.Pd()})}static getTypeName(){return"AugLoop_Tablelint_TableLintAnnotationBase"}static Pd(){return["AugLoop_Core_Annotation"]}}
Object(D.a)(Ib,"TableLintAnnotationBase",na.a,[]);class ec extends Ib{constructor(){super();this.investigationTelemetry=this.suggestions=this.columnName=this.columnTitle=null;this.H_=Object.assign(new ib.a,{T_:ec.getTypeName(),B_:ec.Pd()})}static getTypeName(){return"AugLoop_Tablelint_TableLintColumnAnnotation"}static Pd(){return["AugLoop_Tablelint_TableLintAnnotationBase","AugLoop_Core_Annotation"]}}Object(D.a)(ec,"TableLintColumnAnnotation",Ib,[]);class qb extends na.a{constructor(){super();this.worksheetId=
null;this.errorCount=this.suggestionsCount=0;this.aggregatedAnnotations=this.unsupportedFeaturesSet=null;this.H_=Object.assign(new ib.a,{T_:qb.getTypeName(),B_:qb.Pd()})}static getTypeName(){return"AugLoop_Tablelint_TableLintWorksheetAggregateAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(D.a)(qb,"TableLintWorksheetAggregateAnnotation",na.a,[]);class Ha extends Ib{constructor(){super();this.errorCategory=this.errorType=this.investigationTelemetry=this.columnName=this.columnTitle=
null;this.H_=Object.assign(new ib.a,{T_:Ha.getTypeName(),B_:Ha.Pd()})}static getTypeName(){return"AugLoop_Tablelint_TableLintErrorAnnotation"}static Pd(){return["AugLoop_Tablelint_TableLintAnnotationBase","AugLoop_Core_Annotation"]}}Object(D.a)(Ha,"TableLintErrorAnnotation",Ib,[]);class Ab extends Ib{constructor(){super();this.unsupportedFeatures=this.investigationTelemetry=this.columnName=this.columnTitle=null;this.H_=Object.assign(new ib.a,{T_:Ab.getTypeName(),B_:Ab.Pd()})}static getTypeName(){return"AugLoop_Tablelint_TableLintUnsupportedFeatureAnnotation"}static Pd(){return["AugLoop_Tablelint_TableLintAnnotationBase",
"AugLoop_Core_Annotation"]}}Object(D.a)(Ab,"TableLintUnsupportedFeatureAnnotation",Ib,[]);class Yb extends va.a{constructor(ub,Vb){super();this.qha=!1;this.uNj=(tc,Sc)=>{if(tc=Sc.FM)switch(Sc.operationType){case 1:case 2:this.raiseEvent("carek",tc);break;case 3:this.raiseEvent("caiek",tc);break;default:Y.ULS.sendTraceTag(537163396,306,15,`TableLintManager.TableLintColumnAnnotationHandler Received unexpected OperationType:${Sc.operationType}`)}else Y.ULS.sendTraceTag(537163397,306,50,"TableLintManager.TableLintColumnAnnotationHandler TableLintColumnAnnotation is null.")};
this.wNj=(tc,Sc)=>{if(Sc.FM)switch(Sc.operationType){case 1:case 2:this.raiseEvent("aarek",Sc.FM);break;case 3:break;default:Y.ULS.sendTraceTag(537163394,306,15,`TableLintManager.TableLintAnnotationHandler Received unexpected OperationType:${Sc.operationType}`)}else Y.ULS.sendTraceTag(537163395,306,50,"TableLintManager.TableLintWorksheetAggregateAnnotationHandler TableLintWorksheetAggregateAnnotation is null.")};this.vNj=(tc,Sc)=>{Y.ULS.sendTraceTag(537163393,306,50,`TableLintManager.TableLintColumnAnnotationStateUpdateHandler Received state update: ${tc}->${Sc}`)};
this.augmentationLoopManager=ub;this.FLi=Vb}UZb(){this.qha?Y.ULS.sendTraceTag(537163398,0,50,"TableLintManager.ActivateEvents: Events are already registered"):(this.Kdj(),this.qha=!0)}dispose(){this.qha&&(this.uVj(),this.qha=!1)}Qqe(ub){this.addHandler("carek",ub)}iVf(ub){this.removeHandler("carek",ub)}Kqe(ub){this.addHandler("aarek",ub)}XUf(ub){this.removeHandler("aarek",ub)}wKg(ub){this.addHandler("caiek",ub)}Yfj(ub){this.removeHandler("caiek",ub)}Kdj(){Y.ULS.sendTraceTag(574482312,0,50,"TableLintManager.RegisterTableLintEvents: activate annotations");
this.augmentationLoopManager.register(this.augmentationLoopManager.Lbc().iyc("DataCleansing").Wxc(this.FLi).activateAnnotation({annotationType:ec.getTypeName(),w_:!0,Ste:this.vNj,bRb:this.uNj}).activateAnnotation({annotationType:qb.getTypeName(),w_:!0,bRb:this.wNj}).activateAnnotation({annotationType:Ha.getTypeName(),w_:!0}).activateAnnotation({annotationType:Ab.getTypeName(),w_:!0}).build())}uVj(){this.augmentationLoopManager.unregister("DataCleansing")}}Object(D.a)(Yb,"TableLintManager",va.a,[2]);
class Bb{constructor(ub,Vb,tc,Sc){this.tableName=ub;this.columnName=Vb;this.columnTitle=tc;this.tableRange=Sc}get D3c(){const ub=String.format(lb.a.instance.mb(178),this.columnTitle);return this.columnName?`${ub} (${this.columnName})`:ub}}Object(D.a)(Bb,"ColumnMetadata",null,[]);class Qb{constructor(ub,Vb,tc,Sc){this.nsf=[];this.ZFb=(jd,pb)=>{this.dataCleansingManager.GSd(pb.worksheetId,pb.tableName,this.oJe(pb))};this.NFb=(jd,pb)=>{this.azi(pb);this.dataCleansingManager.Vyj(pb.worksheetId)};this.czf=
(jd,pb)=>{this.dataCleansingManager.$Ld(pb.worksheetId,pb.tableName,this.oJe(pb)[0])};this.dataCleansingManager=ub;this.$=Sc;this.sg=tc;this.kE=Vb;this.kE.Qqe(this.ZFb);this.kE.Kqe(this.NFb);this.kE.wKg(this.czf)}dispose(){this.kE.iVf(this.ZFb);this.kE.XUf(this.NFb);this.kE.Yfj(this.czf)}azi(ub){this.nsf.includes(ub.worksheetId)||(this.nsf.push(ub.worksheetId),Y.ULS.sendTraceTag(510247816,0,50,`AnnotationsHandler.logAggregateAnnotationStatus aggregated information:
        ${JSON.stringify({["suggestionCount"]:ub.suggestionsCount,["errorsCount"]:ub.errorCount,["unsupportedFeaturesCount"]:ub.unsupportedFeaturesSet.length,["unsupportedFeatures"]:ub.unsupportedFeaturesSet.join(",")})}`))}oJe(ub){const Vb=[],tc=new Bb(ub.tableName,ub.columnName,ub.columnTitle,Fa(ub.tableRange));for(const Sc of ub.suggestions)(ub=gc(this.$,this.sg,Sc,tc))&&Vb.push(ub);return Vb}}Object(D.a)(Qb,"AnnotationsHandler",null,[2]);class sc extends Sys.EventArgs{constructor(ub,Vb){super();
this.sheetId=ub;this.yea=Vb}}Object(D.a)(sc,"DataCleansingSuggestionStatusChangedEventArgs",Sys.EventArgs,[]);class kb{constructor(ub){this.$=ub;this.dMe=!1}get isEnabled(){return J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingTeachingCallout",!1)}show(ub){this.isEnabled&&!this.dMe&&(2>ub?Y.ULS.sendTraceTag(509720201,0,50,`DataCleansing.showCallout: suggestion count(${ub}) is below threshold to show teaching callout`):(this.$.Xc(-847286761,aa.a.Db,0,{["SuggestionsCount"]:ub,
["CalloutName"]:16}),this.dMe=!0))}}Object(D.a)(kb,"TeachingCallout",null,[]);class Eb extends va.a{constructor(ub,Vb,tc){var Sc;super();this.b_c=[45];this.kE=this.Vte=this.oS=null;this.jlc=0;this.nzc=J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingDisableTaskPaneWhenALSessionClose",!1);this.timestamps={zdb:0,Jac:0,fDb:0,sfb:0};this.onSuggestionSelected=jd=>{(jd=this.w5a(jd))?(this.lcf(jd),this.iHi(jd)):Y.ULS.sendTraceTag(510247772,0,10,"DataCleansingManager.OnSuggestionSelected: Attempted to highlight missing suggestion")};
this.onSuggestionDeselected=()=>{this.hzb()};this.onSuggestionPreview=jd=>{(jd=this.w5a(jd))?this.lcf(jd):Y.ULS.sendTraceTag(510247771,0,10,"DataCleansingManager.OnSuggestionPreview: Attempted to highlight missing suggestion")};this.onCancelSuggestionPreview=()=>{this.hzb()};this.onSuggestionValuesChanged=jd=>{Y.ULS.sendTraceTag(510247770,0,50,`DataCleansingManager.OnSuggestionValuesChanged: Change in suggestion of type [${jd.type}]`);a:{var pb=this.$,Rb=this.sg;switch(jd.type){case 0:jd=new vb(pb,
jd);break a;case 2:jd=new Ia(pb,jd);break a;case 1:jd=new Ua(pb,Rb,jd);break a;default:Y.ULS.sendTraceTag(510247745,0,10,"DataCleansingEwaSuggestionFactory.CreateFromPaneSuggestion: suggestion type is not supported"),jd=null}}this.suggestions.HGi(jd.id,jd);this.onSuggestionSelected(jd.id);this.raiseEvent("oscek")};this.BLi=jd=>{const pb=this.w5a(jd);if(!pb)return Y.ULS.sendTraceTag(510247769,0,10,"DataCleansingManager.OnSuggestionApplied: Attempted to apply non-existant suggestion"),Promise.reject();
J.EwaSettings.isChangeGateEnabled("OfficeVSO:6808053_DCHiddenCellsTelemetry")&&void t(this.$,[pb.suggestionRange]).then(Rb=>{Rb.length&&Y.ULS.sendTraceTag(510247768,0,50,"DataCleansingManager.OnSuggestionApplied: suggestion with hidden cells applied")});jd=(J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingNewApply",!1)?v(this.$,pb.AI,pb.Jva()):pb.apply()).then(Rb=>{Rb.successful&&(this.hzb(),this.suggestions.applySuggestion(pb),pb.id===this.suggestions.sof?this.raiseEvent("osaek",
void 0,pb):this.raiseEvent("oscek"));return Rb.result});this.suggestions.onSuggestionApplied(pb.id);return jd};this.onCustomNumberFormatOptionChosen=jd=>this.w5a(jd)?new Promise(pb=>{b(this.$,Rb=>{pb(Rb);Y.ULS.sendTraceTag(510247766,0,50,`DataCleansingManager.onCustomNumberFormatOptionChosen: user closed the NumberFormatDialog while clicking on ${Rb?"OK":"Cancel"} button.`)})}):(Y.ULS.sendTraceTag(510247767,0,10,`DataCleansingManager.onCustomNumberFormatOptionChosen: Attempted to choose non-existant suggestion. suggestionId: ${jd}`),
Promise.reject(`Couldn't find the suggestion with the requested id. id: ${jd}`));this.RYi=()=>{const jd=this.suggestions.sof;return c(this.$).then(pb=>{pb&&(this.suggestions.QYi(jd),this.raiseEvent("oscek"))})};this.canApplySuggestion=jd=>{jd=this.w5a(jd);return jd?jd.Q0c():(Y.ULS.sendTraceTag(510247765,0,10,"DataCleansingManager.CanApplySuggestion: Did not find suggestion in collection"),!1)};this.onSuggestionRejected=()=>{};this.onTableSelected=jd=>{if(!this.v8a||this.oS!==jd){this.hzb();this.oS=
jd;this.v8a=!0;jd=this.suggestions.Bn(this.$.oa.sheetId,jd);if(!jd)throw Error.argument("Table does not exist in suggestion collection");Pb.h(this.$).gg(cb.v(jd,this.$),jd.topLeft,null,null,0,"DataCleansing");this.iMj();this.raiseEvent("oscek")}};this.Pc=()=>{this.E8c()};this.KZi=jd=>{jd instanceof xb?(Y.ULS.sendTraceTag(510247761,0,50,`DataCleansingManager.OnWorkbookChangedEventHandler: Suggestion applied with shouldSkipRefresh=${jd.$7f}`),jd=jd.$7f?6:5):(this.TPj(),Y.ULS.sendTraceTag(510247760,
0,50,"DataCleansingManager.OnWorkbookChangedEventHandler: Invalidating all existing suggestions since the workbook changed"),jd=2);for(let pb of this.suggestions.uMj)this.suggestions.o5f(jd,pb),this.raiseEvent("osscek",new sc(pb,this.suggestions.ejd(pb)))};this.I4d=(jd,pb)=>{jd=JSON.stringify(pb.coauthVersion);Y.ULS.sendTraceTag(510247759,0,50,`DataCleansingManager.WorkbookCoauthVersionChangedEventHandler: Workbook changed, revision record is now ${jd}`);this.KZi(pb.userContext)};this.G$a=(jd,pb)=>
{Y.ULS.sendTraceTag(510247757,0,50,`DataCleansingManager.onAugmentationLoopSessionClose: Received augmentation loop session close,
      closeReason = ${jd}, errorCode = ${pb}.`);this.nzc&&(this.Ymf=!0,this.raiseEvent("ueek"))};this.Gh=()=>{this.showCallout()};this.$=tc;this.augmentationLoopManager=ub;this.sg=Vb;this.suggestions=new Sa(tc);this.v8a=!1;this.Zta=this.augmentationLoopManager?0:2;this.Ymf=!1;this.Afb=new kb(tc);null===(Sc=this.augmentationLoopManager)||void 0===Sc?void 0:Sc.bpe(this.I4d);this.Afb.isEnabled&&this.$.Vn.Xf(this.Gh)}get status(){return this.Zta}get cpd(){return!this.Ymf}RMg(ub){this.addHandler("oscek",
ub)}Shj(ub){this.removeHandler("oscek",ub)}QMg(ub){this.addHandler("osaek",ub)}Rhj(ub){this.removeHandler("osaek",ub)}LNg(ub){this.addHandler("osscek",ub)}Hij(ub){this.removeHandler("osscek",ub)}SNg(ub){this.addHandler("ueek",ub)}Nij(ub){this.removeHandler("ueek",ub)}initialize(){2===this.Zta?Y.ULS.sendTraceTag(510247777,0,50,"DataCleansingManager.Initialize: skipping initialization since manager status is Error"):J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.TableLintExperiment",
!1)||J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingTaskPane",!1)?(Y.ULS.sendTraceTag(574408774,0,50,"DataCleansingManager.Initialize: activate tablelint events"),this.Zta=1,this.Zne()):J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.TableLintProdExperiment",!1)&&(Y.ULS.sendTraceTag(510247776,0,50,"DataCleansingManager.Initialize: Check license for activating tablelint events"),Tb.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(ub=>
{ub.isFeatureEnabled("ExcelIntelligence",!1).then(Vb=>{Vb&&(Y.ULS.sendTraceTag(510247775,0,50,"DataCleansingManager.Initialize: LicenseEnabled - activate tablelint events"),this.Zta=1,this.Zne());return Vb})}))}Ebc(){return 2===this.Zta?3:this.suggestions.mGg}Q_e(){this.Nri||this.o4f();const ub=J.EwaSettings.isChangeGateEnabled("OfficeVSO:7214848_PassAllSheetSuggestions")?this.suggestions.KMh():this.suggestions.P_e(this.oS);return new jb(ub,this.suggestions.loe,this.oS,Va.d(this.$.oa),this.$.oa.name)}p1f(){this.o4f();
if(this.oS)this.onTableSelected(this.oS)}GSd(ub,Vb,tc){if(0===this.Zta||1===this.Zta)Y.ULS.sendTraceTag(510247774,0,50,"DataCleansingManager.SetSuggestions: Setting data cleansing manager status to Ready"),this.Zta=3;6!==this.Ebc()&&(this.suggestions.GSd(ub,Vb,tc),this.raiseEvent("osscek",new sc(ub,this.suggestions.ejd(ub))))}$Ld(ub,Vb,tc){this.suggestions.$Ld(ub,Vb,tc);this.raiseEvent("oscek")}Vyj(ub){this.cCi();Y.ULS.sendTraceTag(510247773,0,50,`DataCleansingManager.SetSuggestionsReady: the suggestions of sheet id ${ub} are ready.`);
J.EwaSettings.isChangeGateEnabled("OfficeVSO:6443391_InfiniteLoadingOnSwitchingSheets")&&this.suggestions.MCe(ub);6!==this.Ebc()&&(this.suggestions.o5f(4,ub),this.raiseEvent("osscek",new sc(ub,this.suggestions.ejd(ub))));ub===this.$.oa.sheetId&&this.showCallout()}nkh(){this.v8a&&this.E8c();this.oS=null}k4b(){this.suggestions.k4b()}dispose(){this.augmentationLoopManager.dUf(this.I4d);this.v8a&&this.$&&this.shg();P.a.Ia(this.Vte);P.a.Ia(this.kE);super.dispose()}SPj(){this.timestamps.sfb?(Y.ULS.sendTraceTag(510247764,
0,50,'DataCleansingManager.timestampSeeNewChangesClicked "see new changes" clicked after suggestions were loaded'),this.timestamps.zdb=0):this.timestamps.zdb=performance.now()}TPj(){var ub;this.timestamps.zdb=0;this.timestamps.sfb=0;(ub=this.timestamps).Jac||(ub.Jac=performance.now());this.timestamps.fDb=performance.now()}cCi(){var ub;this.timestamps.sfb=performance.now();if(this.timestamps.fDb){const Vb=this.timestamps.sfb-(null!==(ub=this.timestamps.Jac)&&void 0!==ub?ub:this.timestamps.fDb);ub=
JSON.stringify({["timeElapsedSinceFirstManualChange"]:Vb,["timeElapsedSinceLastManualChange"]:this.timestamps.sfb-this.timestamps.fDb,["timeElapsedSinceSeeNewChangesClick"]:this.timestamps.zdb?this.timestamps.sfb-this.timestamps.zdb:0});Y.ULS.sendTraceTag(510247763,0,50,`DataCleansingManager.logTimeElapsedTillSuggestionsReady suggestion appears timers:
        ${ub}`)}this.timestamps.fDb=0;this.timestamps.Jac=0;this.timestamps.zdb=0}Zne(){this.kE=new Yb(this.augmentationLoopManager,this.G$a);this.Vte=new Qb(this,this.kE,this.sg,this.$);this.kE.UZb()}iMj(){Pb.h(this.$).ha.PE(this.Pc);Pb.h(this.$).FC(this.Pc)}shg(){Pb.h(this.$).ha.DI(this.Pc);Pb.h(this.$).bE(this.Pc)}jmh(){if(this.v8a){const ub=this.suggestions.Bn(this.$.oa.sheetId,this.oS).topLeft;Pb.h(this.$).ha.mx([ub],0,ub,0);this.E8c()}}E8c(){this.v8a=!1;this.shg()}iHi(ub){ub=ub.Jva();if(null===
ub||void 0===ub?0:ub.length)[{topLeft:ub}]=ub.sort((Vb,tc)=>Vb.top<tc.top?-1:Vb.top>tc.top?1:0),Pb.h(this.$).MK(ub)||(Y.ULS.sendTraceTag(510247762,0,50,"DataCleansingManager.moveViewportToSuggestionIfNeeded moving viewport"),Pb.h(this.$).Kt(ub,0,"DataCleansing"))}lcf(ub){this.jmh();this.hzb();ub.qmd(this.b_c)}hzb(){Pb.h(this.$).qb.Zg(this.b_c);Pb.h(this.$).qb.Ti(null,this.b_c,!1);Pb.h(this.$).qb.update(!1)}o4f(){this.oS=this.suggestions.loe[0]}get Nri(){return this.oS&&this.suggestions.Vsi(this.$.oa.sheetId,
this.oS)}w5a(ub){return this.suggestions.I2h(ub)}showCallout(){if(this.Afb.isEnabled){var ub=this.Ebc();if(6===ub||4===ub)ub=this.suggestions.L1h(this.$.oa.sheetId),this.Afb.show(ub)}}}Object(D.a)(Eb,"DataCleansingManager",va.a,[598,2]);class Gc extends wb.a{constructor(ub){super();this.$=ub;this.Fb()}create(){const ub=S.GetServiceTaskFactory.Oa(this.$.da,328,327,1),Vb=S.GetServiceTaskFactory.create(this.$.da,18,this.$.ka,1);X.TaskExtensions.za(X.TaskExtensions.Ed([ub,Vb],this.ka),()=>{let tc=this.$.da.Aa(411);
tc||(tc=new Eb(ub.result,Vb.result,this.$),this.$.da.Ga(411,tc),tc.initialize(),Y.ULS.sendTraceTag(510247755,0,50,"DataCleansingManagerFactory.Create: DataCleansingManager initialized successfully"));this.nb(tc)},this.ka,3)}static la(ub){ub.da.Ga(412,new Gc(ub))}}Object(D.a)(Gc,"DataCleansingManagerFactory",wb.a,[]);var zc=a(790),yb=a(224),gb=a(14),Kb=a(108),sd=a(4),Sb=a(85),yc=a(238),Fc=a(138);class Zc{}Zc.Dhh="DataCleansingPane";Zc.Fhh="DataCleansingPaneHeader";Zc.Ehh="DataCleansingPaneBody";Zc.Ghh=
"DataCleansingPaneTitle";Zc.Chh="DataCleansingCloseButton";Object(D.a)(Zc,"CssClassNames",null,[]);var Rd=a(19),Ed=a(259),ne=a(247),ze=a(12),Be=a(703);class td extends yc.a{constructor(ub,Vb){super(document.createElement("div"));this.Up=!1;this.ODe=this.Qd=null;this.vq=0;this.rk=()=>{this.yg(!1);this.raiseEvent("DCTPC");return!0};this.$=ub;this.taskPaneManager=Vb;this.Sdi();Ed.a(ub).di(this)}NP(ub){this.get_events().addHandler("DCTPR",ub)}ZR(ub){this.get_events().removeHandler("DCTPR",ub)}AM(ub){this.addHandler("DCTPC",
ub)}xO(ub){this.removeHandler("DCTPC",ub)}uXc(ub){this.addHandler("DCTPCO",ub)}yMd(ub){this.removeHandler("DCTPCO",ub)}vXc(ub){this.addHandler("DCTPC",ub)}zMd(ub){this.removeHandler("DCTPC",ub)}get isVisible(){return super.isVisible}set isVisible(ub){super.isVisible!==ub&&(super.isVisible=ub,this.raiseEvent(ub?"DCTPC":"DCTPCO"))}get Hf(){return this.isVisible}get de(){return ne.a.Hhh}get jh(){return 18}get Ek(){return Rd.a.RUe}get wN(){return lb.a.instance.ga(1071)}get Kp(){return 320}get isResizable(){return!1}get mc(){return this.domElement}get titleText(){return lb.a.instance.ga(1299)}nq(){return this.Up}Fs(){return this.Up}IR(){}VQ(){return!1}sj(){}dk(){}kg(){return!0}mh(ub){return ze.DOMElementExtensions.Af(this.mc,
ub)}yg(ub){this.isVisible=this.Up=ub;this.taskPaneManager.lA();ub&&0<this.taskPaneManager.$B.length&&(!this.taskPaneManager.oh||18!==this.taskPaneManager.oh.taskPane.jh||this.taskPaneManager.isCollapsed)&&this.taskPaneManager.oG(this,!0);this.$.df()}WM(){const ub=Be.b("div","DataCleansingPaneBodyId",Zc.Ehh),Vb=this.domElement;Vb.setAttribute(Fc.a.ariaLabel,lb.a.instance.ga(1300));Vb.appendChild(this.qH());Vb.appendChild(ub);return ub}dispose(){this.Qd&&(yb.a.instance.Ba(gb.a.click,this.Qd,this.rk),
Kb.KeyInputManager.instance.Tv(this.Qd,this.ODe),this.Qd=null);this.taskPaneManager=this.$=null;super.dispose()}Sdi(){const ub=this.domElement;ub.id="DataCleansingPaneId";document.getElementById(this.$.Eb+fa.a.AR).appendChild(ub);ub.classList.add(Zc.Dhh)}qH(){const ub=Be.b("div","DataCleansingPaneHeaderId",Zc.Fhh),Vb=Be.b("span","DataCleansingPaneTitleId",fa.a.JBc+Zc.Ghh);Vb.innerText=this.titleText;this.Qd=zc.a.pb("DataCleansingPaneCloseButtonId",fa.a.xfb+Zc.Chh,lb.a.instance.ga(10),"ClosePaneGlyph_16x16x32",
!1);this.Qd.classList.add(sd.AFrameworkApplication.isRtl?fa.a.Maa:fa.a.Naa);yb.a.instance.sa(gb.a.click,this.Qd,this.rk);this.ODe=Kb.KeyInputManager.instance.Ns(this.Qd,this.rk,Sb.a.Mh);ub.appendChild(Vb);ub.appendChild(this.Qd);return ub}}Object(D.a)(td,"DataCleansingTaskPane",yc.a,[624,2,472,34]);class Se extends wb.a{constructor(ub){super();this.$=ub;this.Fb()}create(){X.TaskExtensions.za(ja.a(this.$),ub=>{ub=ub.result;ub=this.$.da.Aa(415)||this.$.da.Ga(415,new td(this.$,ub));this.nb(ub)},this.ka,
3)}static la(ub){ub.da.Ga(416,new Se(ub))}}Object(D.a)(Se,"DataCleansingTaskPaneFactory",wb.a,[]);const $b={width:244,font:"12px sans-serif"},Xc={[0]:[45],[1]:[46]};class ed{constructor(ub,Vb){this.$=ub;this.sg=Vb;this.doUndo=()=>Object(Qa.a)(this,void 0,void 0,function*(){yield c(this.$)});this.highlightRangesOnGrid=(tc,Sc,jd)=>Object(Qa.a)(this,void 0,void 0,function*(){this.Cz(tc,Sc,Xc[jd])});this.selectRangeOnGrid=(tc,Sc={})=>Object(Qa.a)(this,void 0,void 0,function*(){this.selectRange(tc,Sc)});
this.openCustomNumberFormat=()=>Object(Qa.a)(this,void 0,void 0,function*(){return new Promise(tc=>{b(this.$,Sc=>{tc(Sc);Y.ULS.sendTraceTag(520942165,0,50,`HostAppCallbacks.openCustomNumberFormat: resolved with "${Sc?"OK":"Cancel"}"`)})})});this.openFeedback=tc=>Object(Qa.a)(this,void 0,void 0,function*(){e(this.$,tc)});this.sendOtelEvent=tc=>Object(Qa.a)(this,void 0,void 0,function*(){x(tc)});this.formatRanges=(tc=[])=>Object(Qa.a)(this,void 0,void 0,function*(){return tc.map(ka)});this.formatValues=
tc=>Object(Qa.a)(this,void 0,void 0,function*(){return tc.map(Sc=>A(this.sg,Sc.format,Sc.value))});this.containsHiddenCells=tc=>t(this.$,tc)}get grid(){return Pb.h(this.$)}Cz(ub,Vb,tc=[45]){const Sc=this.grid.qb;Sc.Zg(tc,!1,!0);Sc.Ti(null,tc,!1);if(null===ub||void 0===ub?0:ub.length){const jd=eb.a.Gea(Va.d(this.$.oa),ub.map(pb=>Pa(pb,!1)));Sc.lx(jd,tc,!0,void 0,!1);Vb&&this.hHi(ub)}Sc.update(!1)}hHi(ub){if(null===ub||void 0===ub?0:ub.length){const Vb=this.grid;[ub]=ub.sort((tc,Sc)=>tc.top<Sc.top?
-1:tc.top>Sc.top?1:0);ub=Oa.Range.Qc(ub.top,ub.left);Vb.MK(ub)||(Y.ULS.sendTraceTag(520660942,0,50,"HostAppCallbacks.moveViewportToRangeIfNeeded moving viewport"),Vb.Kt(ub,0,"DataCleansing"))}else Y.ULS.sendTraceTag(520660941,0,10,"HostAppCallbacks.moveViewportToRangeIfNeeded no ranges to move viewport")}selectRange(ub,Vb){const tc=this.grid;if(null===Vb||void 0===Vb?0:Vb.currentSelectedRange){Vb=Pa(Vb.currentSelectedRange,!1);const Sc=tc.ha.ra.selectedRanges;if(1<Sc.length){Y.ULS.sendTraceTag(520660940,
0,50,"HostAppCallbacks.selectRange: skipped - more than one range is currently selected");return}if(!Vb.equals(Sc[0])){Y.ULS.sendTraceTag(520660939,0,50,"HostAppCallbacks.selectRange: skipped - selected range is not equal to the range in the filter");return}}Y.ULS.sendTraceTag(520660938,0,50,"HostAppCallbacks.selectRange: selecting range");ub=Pa(ub,!1);Vb=Object(cb.v)(ub,this.$);tc.gg(Vb,ub.topLeft,void 0,null,0,"DataCleansing",void 0,void 0,void 0,void 0,!0)}}Object(D.a)(ed,"HostAppCallbacks",null,
[630]);class Rc{constructor(ub){this.$=ub;this.applySuggestion=(Vb,tc=[])=>Object(Qa.a)(this,void 0,void 0,function*(){const Sc=tc.map(jd=>Pa(jd,!1));return v(this.$,Vb,Sc)});this.refreshAnnotations=()=>{throw Error("Method not implemented.");};this.onPaneLifecycleEvent=Vb=>Object(Qa.a)(this,void 0,void 0,function*(){r(Vb)})}}Object(D.a)(Rc,"DataCleansingCallbacks",null,[628]);class Fd{constructor(){this.annotations=[];this.hostState=new Nd;this.worksheetState=new zd}}Object(D.a)(Fd,"DataCleansingHostState",
null,[]);class Nd{constructor(){this.isInCoauthoring=this.isInViewMode=this.isInErrorState=!1}}Object(D.a)(Nd,"HostState",null,[626]);class zd{constructor(){this.sheetId="";this.isProtected=this.isInNamedSheetView=!1;this.sheetName=""}}Object(D.a)(zd,"WorksheetState",null,[627]);var Sd=a(715);const se=J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingDisableTaskPaneWhenALSessionClose",!1);class He extends va.a{constructor(ub,Vb,tc){super();this.$=ub;this.f1b=Vb;this.xca=new Fd;
this.jIf=(Sc,jd)=>{J.EwaSettings.isChangeGateEnabled("OfficeVSO:7326762_DataCleansingLogPotentialSuggestionsInfo")&&this.hBi(jd.sheetId,jd.annotations);this.stateChanged();this.UPb()};this.Gh=(Sc,jd)=>{this.thg(jd.UD);this.Pbg(jd.oa);this.stateChanged();this.UPb()};this.FR=()=>{this.stateChanged()};this.LB=()=>{this.stateChanged()};this.BR=()=>{this.stateChanged()};this.cHb=()=>{Y.ULS.sendTraceTag(512492932,0,50,"DataCleansingHostManager.onUnrecoverableErrorOccurred: Received AL permanent session close.");
se&&(this.xca.hostState.isInErrorState=!0,this.stateChanged())};this.S6=(Sc,jd)=>{Va.m(jd.item)&&jd.item.ji!==this.xca.worksheetState.isProtected&&(Y.ULS.sendTraceTag(512492931,0,50,`DataCleansingHostManager.onSheetOptionsChanged: sheet protection has changed to ${jd.item.ji}.`),this.stateChanged())};this.callbacks=new Rc(this.$);this.iQg=new ed(this.$,tc);this.Afb=new kb(this.$);Vb.DNg(this.jIf);Vb.TNg(this.cHb);void Vb.UZb();ub.Vn.Xf(this.Gh);ub.ea.d$(this.LB);ub.ea.IY(this.BR);this.Pbg(this.$.oa)}Iob(ub){this.addHandler(He.kXd,
ub)}evc(ub){this.removeHandler(He.kXd,ub)}dispose(){this.f1b.Bij(this.jIf);this.f1b.Oij(this.cHb);this.$.Vn.Eg(this.Gh);this.$.ea.u7(this.LB);this.$.ea.B0(this.BR);this.thg(this.$.oa);super.dispose()}get state(){this.xca.annotations=this.f1b.pPg();if(Va.m(this.$.oa)){const ub=this.$.oa.ji,Vb=this.$.oa.sheetId,tc=this.$.oa.sheetName;this.xca.worksheetState.isInNamedSheetView=this.$.oa.Gd.Hv;this.xca.worksheetState.isProtected=ub;this.xca.worksheetState.sheetId=Vb;this.xca.worksheetState.sheetName=
tc}this.xca.hostState.isInViewMode=!this.$.ea.isEditMode;this.xca.hostState.isInCoauthoring=this.isInCoauthoring();return this.xca}isInCoauthoring(){return!1}stateChanged(){this.raiseEvent(He.kXd,this.state)}Pbg(ub){Va.m(ub)&&(ub.Gd.psa(this.FR),ub.MZa(this.S6))}thg(ub){Va.m(ub)&&(ub.Gd.wRa(this.FR),ub.dvc(this.S6))}UPb(){if(this.Afb.isEnabled){const ub=this.lGg();0<ub&&this.Afb.show(ub)}}lGg(){if(!Va.m(this.$.oa))return 0;var ub=this.f1b.F6f(this.$.oa.sheetId);const Vb=E(ub);if(!Vb)return 0;ub=I(ub).reduce((tc,
Sc)=>{var jd,pb;return tc+(null!==(pb=null===(jd=null===Sc||void 0===Sc?void 0:Sc.suggestions)||void 0===jd?void 0:jd.length)&&void 0!==pb?pb:0)},0);ub!==Vb.suggestionsCount&&Y.ULS.sendTraceTag(509702410,0,50,`DataCleansingHostManager suggestionsCount is ${Vb.suggestionsCount}, but we have ${ub} suggestions.`);return ub}hBi(ub,Vb){Vb=f(I(Vb));Y.ULS.sendTraceTag(509698241,0,50,`DataCleansingHostManager.logPotentialSuggestionsInfo: ${JSON.stringify({["sheetId"]:ub,["suggestionsInfo"]:Vb})}`)}}He.kXd=
"scek";Object(D.a)(He,"DataCleansingHostManager",va.a,[]);var Gd=a(974);class fe extends va.a{constructor(ub){super();this.$=ub;this.Xyc=new Map;this.z3c=new Map;this.y3c=new Map;this.G$a=(Vb="Unknown",tc)=>{Y.ULS.sendTraceTag(520987272,0,50,`DataCleansingAnnotationsManager.onAugmentationLoopSessionClose: Received augmentation loop session close. ${JSON.stringify({["closeReason"]:Gd.a[Vb],["errorCode"]:tc})}`);this.raiseEvent(fe.m0d)};this.ZFb=(Vb,tc)=>{this.z3c.set(tc.id,tc);Y.ULS.sendTraceTag(512354457,
0,50,`DataCleansingAnnotationsManager.onColumnAnnotationReceived: Received ${tc.id}`)};this.NFb=(Vb,tc)=>{Vb=this.Xyc.get(tc.worksheetId);Y.ULS.sendTraceTag(512354456,0,50,`DataCleansingAnnotationsManager.onAggregateAnnotationReceived: Received ${JSON.stringify({["id"]:tc.id,["sheetId"]:tc.worksheetId,["previous"]:null===Vb||void 0===Vb?void 0:Vb.id,["errorCount"]:tc.errorCount,["suggestionsCount"]:tc.suggestionsCount})}`);(null===Vb||void 0===Vb?void 0:Vb.id)===tc.id&&Y.ULS.sendTraceTag(512354455,
0,50,`DataCleansingAnnotationsManager.onAggregateAnnotationReceived: Received duplicate ${tc.id}`);this.Xyc.set(tc.worksheetId,tc);Vb=this.O_h(tc);Vb.forEach(Sc=>{this.z3c.delete(Sc.id)});this.y3c.set(tc.id,Vb);this.cQg(tc.worksheetId)}}DNg(ub){this.addHandler(fe.CTd,ub)}Bij(ub){this.removeHandler(fe.CTd,ub)}TNg(ub){this.addHandler(fe.m0d,ub)}Oij(ub){this.removeHandler(fe.m0d,ub)}dispose(){this.kE&&(this.kE.iVf(this.ZFb),this.kE.XUf(this.NFb),this.kE.dispose());super.dispose()}UZb(){return Object(Qa.a)(this,
void 0,void 0,function*(){const ub=yield S.GetServiceTaskFactory.aka(this.$.da,328,327,1);ub?(this.kE=new Yb(ub,this.G$a),this.kE.Qqe(this.ZFb),this.kE.Kqe(this.NFb),this.kE.UZb(),Y.ULS.sendTraceTag(520987274,0,50,"DataCleansingAnnotationsManager.activateEvents: events activated")):Y.ULS.sendTraceTag(520987273,0,10,"DataCleansingAnnotationsManager.activateEvents: no augmentationLoopManager")})}F6f(ub){var Vb;if(ub=this.Xyc.get(ub)){const tc=null!==(Vb=this.y3c.get(ub.id))&&void 0!==Vb?Vb:[];return[ub,
...tc]}return[]}pPg(){const ub=[];this.Xyc.forEach(Vb=>{var tc;const Sc=null!==(tc=this.y3c.get(Vb.id))&&void 0!==tc?tc:[];ub.push(Vb,...Sc)});return ub}cQg(ub){ub={sheetId:ub,annotations:this.F6f(ub)};this.raiseEvent(fe.CTd,ub)}O_h(ub){var Vb=Array.from(this.z3c.values()).filter(jd=>jd.worksheetId===ub.worksheetId);if(!J.EwaSettings.isChangeGateEnabled("OfficeVSO:7403186_DataCleansingUseAggregatedAnnotations"))return Vb;if(!Vb.length)return Y.ULS.sendTraceTag(509682374,0,50,"DataCleansingAnnotationsManager.getRelatedPendingAnnotations: No pending sheet annotations"),
[];if(!Array.isArray(ub.aggregatedAnnotations))return Y.ULS.sendTraceTag(509682373,0,20,"DataCleansingAnnotationsManager.getRelatedPendingAnnotations: No aggregated annotations IDs"),Vb;const tc=new Set(ub.aggregatedAnnotations),Sc=Vb.filter(jd=>tc.has(jd.id));Vb=Vb.filter(jd=>!tc.has(jd.id));Vb.length&&Y.ULS.sendTraceTag(509682372,0,15,`DataCleansingAnnotationsManager.getRelatedPendingAnnotations: Found ${Vb.length} unrelated annotations`);return Sc}}fe.CTd="sacek";fe.m0d="ueoek";Object(D.a)(fe,
"DataCleansingAnnotationsManager",va.a,[]);var $d=a(697);class qe extends wb.a{constructor(ub){super();this.$=ub;this.Fb()}create(){this.ych().then(ub=>{const Vb=Object($d.a)(this.$.da,494,()=>{const tc=new fe(this.$);return new He(this.$,tc,ub)});this.nb(Vb)},()=>{Y.ULS.sendTraceTag(512508561,0,10,"DataCleansingHostManagerFactory.Create: failed to create formatCellsAction")})}ych(){return da.d(S.GetServiceTaskFactory.create(this.$.da,18,this.$.ka,this.Ya))}static la(ub){ub.da.Ga(495,new qe(ub))}}
Object(D.a)(qe,"DataCleansingHostManagerFactory",wb.a,[]);var pe=a(132),Ne=a(133),Le;(function(ub){ub[ub.success=0]="success";ub[ub.featureDisabled=1]="featureDisabled";ub[ub.rangeNotInGrid=2]="rangeNotInGrid";ub[ub.emptyRange=3]="emptyRange";ub[ub.rangeTooLarge=4]="rangeTooLarge";ub[ub.successWithMergedCells=5]="successWithMergedCells"})(Le||(Le={}));Object(D.b)("ResultCode",Le);var gf=a(58),Ye=a(22),$e=a(187),Ya=a(92),ra=a(153),ya=a(161),mb;(function(ub){ub.OnDemand="OnDemand";ub.XLIM="XLIM"})(mb||
(mb={}));Object(D.b)("ApiType",mb);var Hb;(function(ub){ub.Table="Table";ub.OptOut="OptOut";ub.Formatting="Formatting"})(Hb||(Hb={}));Object(D.b)("SuggestionType",Hb);var Zb;(function(ub){ub.FormatAsTable="FormatAsTable";ub.ExplicitClose="ExplicitClose";ub.ESC="Dismiss";ub.CommandExecution="CommandExecution";ub.Undo="Undo";ub.SelectionEnd="SelectionEnd"})(Zb||(Zb={}));Object(D.b)("IgnoreSource",Zb);class mc{constructor(ub,Vb,tc){this.s_i=()=>{var Sc=new Ya.a(-859308420,aa.a.Db,this.$.Hc,9,null);this.$.Ja.Lb(Sc,
{[aa.a.og]:"HelpID=22118",["InputMethod"]:aa.a.Db,["ShouldCanvasTakeFocus"]:!0,[aa.a.Jc]:fa.a.wV,[fa.a.Loa]:!0});Sc=this.dataFields;Sc.suggestionType="table";Ne.b(this.$).ud(pe.a.XIj,Sc,{},!0);Ne.b(this.$).ud(pe.a.YIj,Sc,{},!0)};this.N9g=()=>{const Sc=cb.v(this.goe.Ioa,this.$);var jd=cb.D(Sc);this.SBb(jd)||this.grid.ha.mx([jd],0,jd.topLeft,0);Y.ULS.sendTraceTag(522806800,0,50,this.vi("convertToTable","Create table initiated"));L({level:50,methodName:"convertToTable",message:"Create table initiated",
dataFields:this.dataFields});jd={};jd.TableRange=Sc;jd.HasHeader=!0;this.$.Xc(71074531,aa.a.Db,9,jd).continueWith(pb=>{ra.b(pb)&&pb.result?(Y.ULS.sendTraceTag(522806799,0,50,this.vi("convertToTable","Create table complete")),L({level:50,methodName:"convertToTable",message:"Create table complete",dataFields:this.dataFields}),Ne.b(this.$).ud(pe.a.SIj,this.dataFields,{},!0),Ne.b(this.$).ud(pe.a.TIj,this.dataFields,{},!0),J.EwaSettings.isChangeGateEnabled("OfficeVSO:7221745_TableSuggestionSharedOnConsistentGrid")?
this.N$a(()=>{ya.a(this.$).Em.activateRibbonTab(fa.a.RQa)}):this.KV()?ya.a(this.$).Em.activateRibbonTab(fa.a.RQa):this.grid.HZa(this.P8f)):(Y.ULS.sendTraceTag(522806798,0,10,this.vi("convertToTable","Create table failed")),L({level:10,methodName:"convertToTable",message:"Create table failed",dataFields:this.dataFields}));this.hnd(Zb.FormatAsTable);this.Pwd()})};this.onClose=()=>{this.hnd(Zb.ExplicitClose);this.Pwd()};this.onDismiss=Sc=>{(Sc=Sc?new Sys.UI.DomEvent(Sc):null)&&"keydown"===Sc.type&&27===
Sc.keyCode&&this.hnd(Zb.ESC);Y.ULS.sendTraceTag(522806797,0,100,this.vi("onDismiss","OnDismiss called for Table Invitation"));L({level:50,methodName:"onDismiss",message:"OnDismiss called for Table Invitation",dataFields:this.dataFields})};this.P8f=()=>{this.KV()&&(ya.a(this.$).Em.activateRibbonTab(fa.a.RQa),this.grid.Fcb(this.P8f))};this.Pwd=()=>{Tb.a.instance.Ub("Common.ISystemInitiatedFeedback").execute(Sc=>{Sc.logActivity("Office_Excel_SmartView_FormatAsTableOnPasteFloodgate",null)})};this.$=ub;
this.hnd=tc;this.proactiveSuggestionCard=Vb;this.dataFields={["Class"]:"TableSuggestionCardUtil",["LaunchSource"]:"Default"};this.grid=Pb.h(this.$);this.isVisible=!1}MVd(ub,Vb){this.dataFields.LaunchSource=Vb;this.goe=ub;var tc=lb.a.instance.Ua(715);Vb=lb.a.instance.Ua(709);sd.AFrameworkApplication.Ip("XLS-SmartView-AlternateCardStrings-Treatment;XLS-SmartView-AlternateCardStrings-Control");J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.AlternateCardStrings",!1)&&(tc=lb.a.instance.Ua(717),
Vb=lb.a.instance.Ua(716));tc=[{key:"learnMessage",text:tc,onClick:this.s_i}];(this.isVisible=this.proactiveSuggestionCard.show(ub.Ioa,Vb,lb.a.instance.Ua(710),lb.a.instance.Ua(711),lb.a.instance.Ua(712),this.N9g,this.onClose,tc,()=>{this.kza(!0)},()=>{this.kza(!1)},"TableDesignIdeas",J.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?13:void 0,J.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?[10,11,8]:void 0,5,this.onDismiss,void 0,!0))?(Ne.b(this.$).ud(pe.a.$Ij,
this.dataFields,{},!0),Ne.b(this.$).ud(pe.a.aJj,this.dataFields,{},!0),Y.ULS.sendTraceTag(522806802,0,50,this.vi("showTableSuggestionCard","Proactive suggestion card displayed")),L({level:50,methodName:"showTableSuggestionCard",message:"Proactive suggestion card displayed",dataFields:this.dataFields})):(Y.ULS.sendTraceTag(522806801,0,15,this.vi("showTableSuggestionCard","Proactive suggestion card failed to show")),L({level:15,methodName:"showTableSuggestionCard",message:"Proactive suggestion card failed to show",
dataFields:this.dataFields}))}get visible(){return this.isVisible}hide(){this.proactiveSuggestionCard.hide();this.isVisible=!1}static Vni(ub){var Vb=ub.properties;ub=Vb.SourceControlId&&Vb.SourceControlId.includes("Sensitivity");Vb=Vb.ShouldCanvasTakeFocus;return ub&&!Vb}static Tni(ub){return[1928326585,1833782813,-1059615499,-1027730316,-1104934572,-28797232,71074531,1237877382,974713501].includes(ub)}static pNe(ub){return!(mc.Tni(ub.Wd.command)||mc.Vni(ub))}static aoh(ub,Vb){return Pb.h(ub).Bb.J5(Vb)?
(Y.ULS.sendTraceTag(526758983,306,50,"TableSuggestionCardUtil:doesRangeContainTable Last paste was a table."),L({level:50,methodName:"doesRangeContainTable",message:"Last paste was a table.",dataFields:this.dataFields}),!0):Pb.h(ub).Bb.H5(Vb)?(Y.ULS.sendTraceTag(526758982,306,50,"TableSuggestionCardUtil:doesRangeContainTable Last paste was a pivot table."),L({level:50,methodName:"doesRangeContainTable",message:"Last paste was a pivot table.",dataFields:this.dataFields}),!0):!1}N$a(ub){if(this.KV())ub();
else{const Vb=()=>{this.KV()&&(ub(),this.grid.Fcb(Vb))};this.grid.HZa(Vb)}}dispose(){this.proactiveSuggestionCard&&this.proactiveSuggestionCard.dispose()}kza(ub){ub?(ub=[],ub.push(this.goe.Ioa),ub=eb.a.Gea(Va.d(this.$.oa),ub),this.grid.qb.lx(ub,[0],!0)):this.grid.qb.mRa()}KV(){return this.grid.Da.HN(4,this.$.oa)}vi(ub,Vb,tc){let Sc=Object.assign({},this.dataFields);Sc.Method=ub;Sc.Message=Vb;tc&&(Sc.Fields=tc);return gf.a.hc(Sc)}SBb(ub){return ub.Cd(this.grid.ha.ra.activeRange)}}Object(D.a)(mc,"TableSuggestionCardUtil",
null,[]);class Pc{constructor(ub,Vb,tc,Sc){this.LEi=J.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.SmartView.MaxIntelligentMetadataDismissCount",3);this.Rwa=jd=>{this.udf.add(this.Rnb);this.$.Ja.yAa(this.ZN);J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.EnableRoamingServiceIntegration",!1)&&("FormatAsTable"===jd?this.Fna.Glj():(Ne.b(this.$).ud(pe.a.WIj,this.dataFields,{},!0),this.Fna.Qci()));this.$I.visible&&this.$I.hide()};this.Dg=()=>{this.$I.visible&&null!==this.Rnb&&
!this.SBb(this.Rnb)&&this.Rwa("SelectionEnd")};this.ZN=(jd,pb)=>{mc.pNe(pb)&&this.Rwa("CommandExecution")};this.$=ub;this.Rnb=null;this.tableIntelligenceManager=Vb;this.udf=new $e.a;this.dataFields={["Class"]:"IntelligentMetadataTableManager",["LaunchSource"]:"Default"};this.grid=Pb.h(this.$);this.hoe=null;this.dej();this.proactiveSuggestionCard=tc;this.$I=new mc(this.$,this.proactiveSuggestionCard,this.Rwa);this.zcg=.75;this.Fna=Sc}YRj(ub,Vb){var tc,Sc;return Object(Qa.a)(this,void 0,void 0,function*(){sd.AFrameworkApplication.Ip("XLS-IntelligentMetadataTableProactiveSuggestions-Treatment;XLS-IntelligentMetadataTableProactiveSuggestions-Control");
this.dataFields.LaunchSource=Vb;if(J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions",!1))if(sd.AFrameworkApplication.Ip("XLS-SmartView-EnableRoamingServiceIntegration-Treatment;XLS-SmartView-EnableRoamingServiceIntegration-Control"),J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.EnableRoamingServiceIntegration",!1)&&(yield this.Fna.LVh())>=this.LEi)Y.ULS.sendTraceTag(520135585,306,50,this.vi("triggerHandRaise","Exceeded maximum intelligent metadata dismiss count.")),
L({level:50,methodName:"triggerHandRaise",message:"Exceeded maximum intelligent metadata dismiss count.",dataFields:this.dataFields,eue:"XLIM"});else{for(var jd of this.udf)if(jd.sheetId===ub.sheetId&&jd.range.Cd(ub.range))return;if(J.EwaSettings.isChangeGateEnabled("OfficeVSO:7334505_FixLatePSCardFlightCheck")||this.Htd(Vb))if(jd=this.tableIntelligenceManager.y5a().zdc(ub,6),J.EwaSettings.isChangeGateEnabled("OfficeVSO:7221745_TableSuggestionSharedOnConsistentGrid")){if(1===jd.length){jd=null===
(tc=jd[0])||void 0===tc?void 0:tc.table;var pb=this.MTh(jd);if(pb){if(this.UVh(Vb)){const Rb=this.k4h(Vb,pb.Ioa);if(!Rb)return;pb.Ioa=Rb}this.Rnb=new eb.a(pb.Ioa,jd.SA.sheetId);this.$I.N$a(()=>{this.$I.MVd(pb,Vb);this.$.Ja.osa(this.ZN)})}}}else 1===jd.length&&this.Eci(null===(Sc=jd[0])||void 0===Sc?void 0:Sc.table)&&(this.$I.MVd(this.hoe,Vb),this.$.Ja.osa(this.ZN))}else Y.ULS.sendTraceTag(522740425,0,50,this.vi("triggerIntelligentMetadataTableHandRaise","Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions is disabled")),
L({level:50,methodName:"triggerIntelligentMetadataTableHandRaise",message:"Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions is disabled",dataFields:this.dataFields,eue:"XLIM"})})}dej(){this.grid.ha.TT(this.Dg)}k4h(ub,Vb){const tc=Vb.clone();switch(ub){case "InsertColumn":case "InsertCellShiftRight":tc.fea(4,tc.right+1);break;case "InsertRow":case "InsertCellShiftDown":tc.fea(2,tc.bottom+1);break;case "DeleteColumn":ub=Vb.right-1;if(1>ub||ub<Vb.left)return null;tc.fea(4,ub);break;
case "DeleteRow":ub=Vb.bottom-1;if(1>ub||ub<Vb.top)return null;tc.fea(2,ub)}return tc}UVh(ub){return"InsertColumn InsertRow InsertCellShiftDown InsertCellShiftRight DeleteColumn DeleteRow".split(" ").includes(ub)}Htd(ub){return"DeleteColumn"===ub||"DeleteRow"===ub?(sd.AFrameworkApplication.Ip("XLS-SmartView-DeleteRowColProactiveSuggestions-Treatment;XLS-SmartView-DeleteRowColProactiveSuggestions-Control"),J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.DeleteRowColProactiveSuggestions",
!1)):"InsertColumn"===ub||"InsertRow"===ub?(sd.AFrameworkApplication.Ip("XLS-SmartView-InsertRowColProactiveSuggestions-Treatment;XLS-SmartView-InsertRowColProactiveSuggestions-Control"),J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.InsertRowColProactiveSuggestions",!1)):"InsertCellShiftDown"===ub||"InsertCellShiftRight"===ub?(sd.AFrameworkApplication.Ip("XLS-SmartView-InsertCellTableProactiveSuggestions-Treatment;XLS-SmartView-InsertCellTableProactiveSuggestions-Control"),
J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.InsertCellTableProactiveSuggestions",!1)):"DeleteCellShiftUp"===ub||"DeleteCellShiftLeft"===ub?(sd.AFrameworkApplication.Ip("XLS-SmartView-DeleteCellTableProactiveSuggestions-Treatment;XLS-SmartView-DeleteCellTableProactiveSuggestions-Control"),J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.DeleteCellTableProactiveSuggestions",!1)):!0}Eci(ub){for(let Vb of ub.interpretations)if(Vb.confidence>=this.zcg&&2===
Vb.orientation&&1===Vb.headerRowCount&&!ub.tableName)return this.hoe=Vb,this.Rnb=ub.SA,!0;return!1}MTh(ub){for(let Vb of ub.interpretations)if(Vb.confidence>=this.zcg&&2===Vb.orientation&&1===Vb.headerRowCount&&!ub.tableName)return Vb;return null}vi(ub,Vb,tc){let Sc=Object.assign({},this.dataFields);Sc.Method=ub;Sc.Message=Vb;tc&&(Sc.Fields=tc);return gf.a.hc(Sc)}SBb(ub){return ub.range.contains(this.grid.ha.ra.activeRange)}dispose(){this.$I&&this.$I.dispose()}}Object(D.a)(Pc,"IntelligentMetadataTableManager",
null,[2]);var fd=a(282),id=a(215),Dd=a(116);const Zd={version:1,Zoc:0,Lgc:0};class bc{constructor(ub){this.Sci=()=>{this.smartViewTableHandRaiseSetting&&(this.smartViewTableHandRaiseSetting.Zoc++,this.sEc())};this.Qci=()=>{this.smartViewTableHandRaiseSetting&&(this.smartViewTableHandRaiseSetting.Lgc++,this.sEc())};this.Ilj=()=>{this.smartViewTableHandRaiseSetting&&(this.smartViewTableHandRaiseSetting.Zoc=0,this.sEc())};this.Glj=()=>{this.smartViewTableHandRaiseSetting&&(this.smartViewTableHandRaiseSetting.Lgc=
0,this.sEc())};this.cZf=()=>{Y.ULS.sendTraceTag(521007203,0,50,this.vi("retrieveSmartViewTableHandRaiseSettingFromRoamingService","Reading latest roaming setting."));L({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Reading latest roaming setting.",dataFields:this.dataFields});return new Promise(Vb=>{W.w(this.$.pa.ya,2,tc=>{Y.ULS.sendTraceTag(521007198,0,50,this.vi("retrieveSmartViewTableHandRaiseSettingFromRoamingService","OnReadRoamingStringSuccess called."));
L({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"OnReadRoamingStringSuccess called.",dataFields:this.dataFields});if(ua.a.dg(tc.Errors))tc={["errors"]:ua.a.sc(tc.Errors)},Y.ULS.sendTraceTag(521007197,0,10,this.vi("retrieveSmartViewTableHandRaiseSettingFromRoamingService","onReadRoamingSuccessCallback encountered an error.",tc)),L({level:10,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"onReadRoamingSuccessCallback encountered an error.",
dataFields:this.dataFields,fields:tc}),Vb(null);else if(tc.Result){if(tc=this.wkh(tc.Result)){let Sc={["version"]:tc.version};Y.ULS.sendTraceTag(521007196,0,50,this.vi("retrieveSmartViewTableHandRaiseSettingFromRoamingService","Successfully retrieved smartViewTableHandRaiseSetting.",Sc));L({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Successfully retrieved smartViewTableHandRaiseSetting.",dataFields:this.dataFields,fields:Sc});1>tc.version?Vb(Zd):Vb(tc)}}else Y.ULS.sendTraceTag(512304031,
0,50,this.vi("retrieveSmartViewTableHandRaiseSettingFromRoamingService","onReadRoamingSuccessCallback received null result. Returning default value.")),L({level:50,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"onReadRoamingSuccessCallback received null result. Returning default value.",dataFields:this.dataFields}),Vb(Zd)},tc=>{tc={["EwaErrors"]:Dd.a.Pe(tc.data)};Y.ULS.sendTraceTag(520135584,0,10,this.vi("retrieveSmartViewTableHandRaiseSettingFromRoamingService","Roaming operation failed.",
tc));L({level:10,methodName:"retrieveSmartViewTableHandRaiseSettingFromRoamingService",message:"Roaming operation failed.",dataFields:this.dataFields,fields:tc});Vb(null)},null,null)})};this.sEc=()=>{const Vb=this.gtj(this.smartViewTableHandRaiseSetting);Vb?(Y.ULS.sendTraceTag(521007199,0,50,this.vi("updateSmartViewTableHandRaiseSettingFromRoamingService","Updating roaming setting.")),L({level:50,methodName:"updateSmartViewTableHandRaiseSettingFromRoamingService",message:"Updating roaming setting.",
dataFields:this.dataFields}),W.C(this.$.pa.ya,2,Vb,tc=>{Y.ULS.sendTraceTag(521007189,0,50,this.vi("onWriteRoamingStringSuccess","OnWriteRoamingStringSuccess called."));L({level:50,methodName:"onWriteRoamingStringSuccess",message:"OnWriteRoamingStringSuccess called.",dataFields:this.dataFields});ua.a.dg(tc.Errors)?(tc={["errors"]:ua.a.sc(tc.Errors)},Y.ULS.sendTraceTag(521007188,0,10,this.vi("onWriteRoamingStringSuccess","onWriteRoamingStringSuccess encountered an error.",tc)),L({level:10,methodName:"onWriteRoamingStringSuccess",
message:"OnWriteRoamingStringSuccess encountered an error.",dataFields:this.dataFields,fields:tc})):tc.Result&&!tc.Result&&(Y.ULS.sendTraceTag(521007187,0,15,this.vi("onWriteRoamingStringSuccess","Failed to write to the roaming service.")),L({level:15,methodName:"onWriteRoamingStringSuccess",message:"Failed to write to the roaming service.",dataFields:this.dataFields}))},tc=>{tc={["EwaErrors"]:Dd.a.Pe(tc.data)};Y.ULS.sendTraceTag(520135583,0,10,this.vi("updateSmartViewTableHandRaiseSettingFromRoamingService",
"Roaming operation failed.",tc));L({level:10,methodName:"updateSmartViewTableHandRaiseSettingFromRoamingService",message:"Roaming operation failed.",dataFields:this.dataFields,fields:tc})},null,null)):(Y.ULS.sendTraceTag(521007200,0,15,this.vi("updateSmartViewTableHandRaiseSettingFromRoamingService","Empty serialized roaming setting.")),L({level:15,methodName:"updateSmartViewTableHandRaiseSettingFromRoamingService",message:"Empty serialized roaming setting.",dataFields:this.dataFields}))};this.wkh=
Vb=>{if(!Vb)return Y.ULS.sendTraceTag(521007195,0,15,this.vi("deserializeToSmartViewTableHandRaiseSetting","Received an empty roamingXml.")),L({level:15,methodName:"deserializeToSmartViewTableHandRaiseSetting",message:"Received an empty roamingXml.",dataFields:this.dataFields}),null;let tc;try{tc=gf.a.ki(Vb)}catch(Sc){return Vb={["errorMessage"]:Sc.message},Y.ULS.sendTraceTag(521007192,0,10,this.vi("deserializeToSmartViewTableHandRaiseSetting","Error while deserializing SmartViewTableHandRaiseSetting.",
Vb)),L({level:10,methodName:"deserializeToSmartViewTableHandRaiseSetting",message:"Error while deserializing SmartViewTableHandRaiseSetting.",dataFields:this.dataFields,fields:Vb}),null}return tc};this.gtj=Vb=>{if(!Vb)return Y.ULS.sendTraceTag(521007191,0,50,this.vi("updateSmartViewTableHandRaiseSettingFromRoamingService","Empty roaming setting.")),L({level:50,methodName:"serializeFromSmartViewTableHandRaiseSetting",message:"Empty roaming setting.",dataFields:this.dataFields}),null;Vb=gf.a.hc(Vb);
return 200<Vb.length?(Y.ULS.sendTraceTag(521007190,0,10,"serializeFromSmartViewTableHandRaiseSetting - Exceeded the MaxSize for smartViewTableHandRaiseSettingMaxSize."),L({level:10,methodName:"serializeFromSmartViewTableHandRaiseSetting",message:"Exceeded the MaxSize for smartViewTableHandRaiseSettingMaxSize.",dataFields:this.dataFields}),null):Vb};this.vi=(Vb,tc,Sc)=>{let jd=Object.assign({},this.dataFields);jd.Method=Vb;jd.Message=tc;Sc&&(jd.Fields=Sc);return gf.a.hc(jd)};this.$=ub;this.dataFields=
{["Class"]:"SmartViewTableHandRaiseRoamingHandler"};this.smartViewTableHandRaiseSetting=null}xYh(){return Object(Qa.a)(this,void 0,void 0,function*(){if(this.smartViewTableHandRaiseSetting)return this.smartViewTableHandRaiseSetting.Zoc;const ub=yield this.cZf();return ub?(this.smartViewTableHandRaiseSetting=ub,this.smartViewTableHandRaiseSetting.Zoc):Number.POSITIVE_INFINITY})}LVh(){return Object(Qa.a)(this,void 0,void 0,function*(){if(this.smartViewTableHandRaiseSetting)return this.smartViewTableHandRaiseSetting.Lgc;
const ub=yield this.cZf();return ub?(this.smartViewTableHandRaiseSetting=ub,this.smartViewTableHandRaiseSetting.Lgc):Number.POSITIVE_INFINITY})}}Object(D.a)(bc,"SmartViewTableHandRaiseRoamingHandler",null,[]);class Qc{constructor(ub,Vb,tc){this.Dsa=this.wDb=null;this.Lod=this.uOa=!1;this.RBa=this.P$a=null;this.BBb=this.Pkg=!1;this.WEi=J.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.SmartView.MaxOnDemandDismissCount",3);this.n9h=(Sc,jd)=>{Y.ULS.sendTraceTag(527983895,306,50,this.vi("handleSmartViewActivationCallback",
"handleSmartViewActivationCallback invoked."));L({level:50,methodName:"handleSmartViewActivationCallback",message:"handleSmartViewActivationCallback invoked.",dataFields:this.dataFields});if(!jd)return Y.ULS.sendTraceTag(527983894,306,10,this.vi("handleSmartViewActivationCallback","surveyParams is null.")),L({level:10,methodName:"handleSmartViewActivationCallback",message:"surveyParams is null.",dataFields:this.dataFields}),null;if(!jd.contextInfo||0===jd.contextInfo.length)return Sc={["contextInfo"]:jd.contextInfo},
Y.ULS.sendTraceTag(527983893,306,10,this.vi("handleSmartViewActivationCallback","no valid contextInfo in surveyParams.",Sc)),L({level:10,methodName:"handleSmartViewActivationCallback",message:"no valid contextInfo in surveyParams.",dataFields:this.dataFields,fields:Sc}),null;this.o5e(jd.contextInfo[jd.contextInfo.length-1].context);return null};this.sJf=()=>{this.Rwa("Undo");this.$.ea.jWf(this.sJf)};this.Dg=()=>{this.$I.visible&&null!=this.fza&&!this.SBb(this.fza.SA.range)?this.Rwa("SelectionEnd"):
this.BBb||this.l1d()};this.Rwa=Sc=>{this.tdf=this.fza.SA;this.l1d();this.Wvj();this.$.Ja.yAa(this.ZN);this.grid.ha.$R(this.Dg);J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.EnableRoamingServiceIntegration",!1)&&("FormatAsTable"===Sc?this.Fna.Ilj():this.Fna.Sci());"ExplicitClose"===Sc&&(Ne.b(this.$).ud(pe.a.UIj,this.dataFields,{},!0),Ne.b(this.$).ud(pe.a.VIj,this.dataFields,{},!0));Y.ULS.sendTraceTag(526165469,0,50,this.vi("ignoreActiveRange","Ignore Current Range",{["ignoreSource"]:Sc}));
L({level:50,methodName:"ignoreActiveRange",message:"Ignore Current Range",dataFields:this.dataFields,fields:{["ignoreSource"]:Sc}})};this.Pwd=()=>{Tb.a.instance.Ub("Common.ISystemInitiatedFeedback").execute(Sc=>{Sc.logActivity("Office_Excel_SmartView_FormatAsTableOnPasteFloodgate",null)})};this.ZN=(Sc,jd)=>{mc.pNe(jd)&&this.Rwa("CommandExecution")};this.Wvj=()=>{const Sc=this.grid.ha.ra.activeRange;this.grid.ha.updateSelection(Sc,Sc,0,0)};this.iza=()=>{this.KV()&&(this.getMetadata(this.e7c),this.e7c=
null,this.grid.Fcb(this.iza))};this.$=ub;this.tableIntelligenceManager=Vb;this.tdf=this.wGc=this.fza=null;this.dataFields={["Class"]:"IntelligentMetadataOverlayManager",["LaunchSource"]:"Default"};this.e7c=null;this.proactiveSuggestionCard=tc;this.grid=Pb.h(this.$);this.$I=new mc(this.$,this.proactiveSuggestionCard,this.Rwa);this.Fna=new bc(this.$);Tb.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(Sc=>{this.Dsa=Sc;void Sc.isFeatureEnabled("SmartViewTableHandRaise",
!1).then(jd=>this.uOa=jd);void Sc.isFeatureEnabled("SmartViewIntelligentMetadataTableHandRaise",!1).then(jd=>{this.Lod=jd;J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions",!1)&&jd&&!this.Wzb&&(this.Wzb=new Pc(this.$,this.tableIntelligenceManager,this.proactiveSuggestionCard,this.Fna));return jd});this.wDb=Sc.kna("SmartViewTableHandRaise",jd=>{this.uOa=jd.isEnabled});Sc.kna("SmartViewIntelligentMetadataTableHandRaise",jd=>{this.Lod=jd.isEnabled;
J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.IntelligentMetadataTableProactiveSuggestions",!1)&&this.Lod&&!this.Wzb&&(this.Wzb=new Pc(this.$,this.tableIntelligenceManager,this.proactiveSuggestionCard,this.Fna))})});this.Pkg=["en-US","en-GB","en-CA","en-AU","en_IN"].includes(this.$.mgb);(ub=Tb.a.instance.Ub("Common.ISystemInitiatedFeedback"))&&ub.execute(Sc=>{Sc.Wtc("SmartViewSuggestion",this.n9h)});this.$.Kb&&(this.P$a=this.$.Kb.Qg("WebServiceCall","onDemandStopWatch"),this.RBa=this.$.Kb.Qg("WebServiceCall",
"getTableInfoStopwatch"))}get jGg(){return this.wGc}CYj(ub){this.fza=null;ub.tableName||(this.fza=ub);ub={["Duration"]:-1};this.P$a&&(this.P$a.stop(),ub.Duration=this.P$a.Ac);Y.ULS.sendTraceTag(523622040,0,50,this.vi("updateOnDemandRecognizedTable","OnDemand request succeeded",ub));L({level:50,methodName:"updateOnDemandRecognizedTable",message:"OnDemand request succeeded",dataFields:this.dataFields,fields:ub});this.l1d();this.$.ea.tse(this.sJf)}Nea(ub,Vb){return Object(Qa.a)(this,void 0,void 0,function*(){if(!mc.aoh(this.$,
ub.range)){this.dataFields.LaunchSource=Vb;var tc=ub;tc||(Y.ULS.sendTraceTag(523530262,306,10,this.vi("triggerHandRaise","sheetRange is null or undefined")),L({level:10,methodName:"triggerHandRaise",message:"sheetRange is null or undefined",dataFields:this.dataFields}));if(J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DisableSmartViewLicenseCheck",!1)||this.uOa)if(this.Pkg)if(this.$.va.IsMeetingLiveSession)Y.ULS.sendTraceTag(520901637,306,50,this.vi("triggerHandRaise","User is in Teams live.")),
L({level:50,methodName:"triggerHandRaise",message:"User is in Teams live.",dataFields:this.dataFields});else if(id.a.uNa()||id.a.vxa())Y.ULS.sendTraceTag(520901636,306,50,this.vi("triggerHandRaise","User is in Excel hosted in Teams.")),L({level:50,methodName:"triggerHandRaise",message:"User is in Excel hosted in Teams.",dataFields:this.dataFields});else if(sd.AFrameworkApplication.Ip("XLS-SmartView-EnableRoamingServiceIntegration-Treatment;XLS-SmartView-EnableRoamingServiceIntegration-Control"),J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.EnableRoamingServiceIntegration",
!1)&&(yield this.Fna.xYh())>=this.WEi)Y.ULS.sendTraceTag(520135586,306,50,this.vi("triggerHandRaise","Exceeded maximum on demand dismiss count.")),L({level:50,methodName:"triggerHandRaise",message:"Exceeded maximum on demand dismiss count.",dataFields:this.dataFields});else{sd.AFrameworkApplication.Ip("XLS-SmartView-GetTableInfo-Treatment;XLS-SmartView-GetTableInfo-Control");if(!this.Rsi(tc)){Y.ULS.sendTraceTag(527229345,306,50,this.vi("triggerHandRaise","Surrounding Cells contain values, update boundary required"));
L({level:50,methodName:"triggerHandRaise",message:"Surrounding Cells contain values, update boundary required",dataFields:this.dataFields});if(!J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.GetTableInfo",!1))return;tc=yield this.Zod(tc);if(!tc){Y.ULS.sendTraceTag(522823200,306,50,this.vi("triggerHandRaise","Expanded Range is null or undefined"));L({level:50,methodName:"triggerHandRaise",message:"Expanded Range is null or undefined",dataFields:this.dataFields});return}}this.j8g(tc)?
(Y.ULS.sendTraceTag(520642720,306,50,this.vi("triggerHandRaise","Header contains links or formulas.")),L({level:50,methodName:"triggerHandRaise",message:"Header contains links or formulas.",dataFields:this.dataFields})):this.Gxa(tc.range)?(Y.ULS.sendTraceTag(523117070,306,50,this.vi("triggerHandRaise","Specified range is empty")),L({level:50,methodName:"triggerHandRaise",message:"Specified range is empty",dataFields:this.dataFields})):J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.DisableLPP",
!1)||J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PasteSmartViewTestOnly",!1)?(Y.ULS.sendTraceTag(522831705,306,50,this.vi("triggerHandRaise","LPP Disabled, requesting OnDemandMetadata")),L({level:50,methodName:"triggerHandRaise",message:"LPP Disabled, requesting OnDemandMetadata",dataFields:this.dataFields}),this.o5e(tc)):this.SBi(tc)}else Y.ULS.sendTraceTag(523544584,306,50,this.vi("triggerHandRaise","Invalid language for TriggerHandRaise.")),L({level:50,methodName:"triggerHandRaise",
message:"Invalid language for TriggerHandRaise.",dataFields:this.dataFields});else Y.ULS.sendTraceTag(527958875,306,50,this.vi("triggerHandRaise","License is not enabled.")),L({level:50,methodName:"triggerHandRaise",message:"License is not enabled.",dataFields:this.dataFields})}})}MCc(ub,Vb){return Object(Qa.a)(this,void 0,void 0,function*(){this.Wzb&&void this.Wzb.YRj(ub,Vb)})}SBi(ub){const Vb=Tb.a.instance.Ub("Common.ISystemInitiatedFeedback");Vb&&(Y.ULS.sendTraceTag(527983892,306,50,this.vi("logSmartViewEventToLpp",
"logged event to LPP")),L({level:50,methodName:"logSmartViewEventToLpp",message:"logged event to LPP",dataFields:this.dataFields}),Vb.execute(tc=>{tc.logActivity("SmartViewProactiveSuggestionActivity",null,ub)}))}o5e(ub){this.BBb||this.grid.ha.TT(this.Dg);J.EwaSettings.isChangeGateEnabled("OfficeVSO:7221745_TableSuggestionSharedOnConsistentGrid")?this.$I.N$a(()=>{this.getMetadata(ub)}):this.KV()?this.getMetadata(ub):(this.e7c=ub,this.grid.HZa(this.iza))}dispose(){this.$I&&this.$I.dispose()}l1d(){if(J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",
!1)&&null!=this.fza){var ub=this.fza.SA;if(this.tdf!==ub&&ub.sheetId===this.$.xa.oa.sheetId){ub=.5;let Vb=null;this.BBb=!1;for(let tc of this.fza.interpretations)tc.confidence>=ub&&2===tc.orientation&&(ub=tc.confidence,Vb=tc);Vb?1!==Vb.headerRowCount||Vb.headerColumnCount?(this.grid.ha.$R(this.Dg),this.BBb=!0,Y.ULS.sendTraceTag(527218011,0,50,this.vi("updateOnDemandActionButton","The recognition cannot be converted to a table")),L({level:50,methodName:"updateOnDemandActionButton",message:"The recognition cannot be converted to a table",
dataFields:this.dataFields})):this.wGc===Vb&&this.$I.visible||(this.wGc=Vb,this.$I.MVd(this.jGg,this.dataFields.LaunchSource),this.$.Ja.osa(this.ZN)):(this.grid.ha.$R(this.Dg),this.BBb=!0,Y.ULS.sendTraceTag(527958874,0,50,this.vi("updateOnDemandActionButton","The recognition contained no interpretations")),L({level:50,methodName:"updateOnDemandActionButton",message:"The recognition contained no interpretations",dataFields:this.dataFields}))}else this.$I.visible&&this.$I.hide()}}j8g(ub){ub=new Oa.Range(ub.range.top,
ub.range.left,ub.range.top,ub.range.right,!0,!1);for(ub=Pb.h(this.$).jk("IntelligenceMetadataOverlay.containsFormulasInHeader",ub,1);ub.$$mn();)if(ub.$$cu().rB)return!0;return!1}getMetadata(ub){this.P$a.start();ub=this.tableIntelligenceManager.lXh(ub,this.CYj.bind(this));Y.ULS.sendTraceTag(523622038,0,50,this.vi("getMetadata","OnDemand metadata requested"));L({level:50,methodName:"getMetadata",message:"OnDemand metadata requested",dataFields:this.dataFields});ub&&(Y.ULS.sendTraceTag(536953376,0,50,
this.vi("getMetadata","getMetadataForRange unsuccessful",{["resultCode"]:Le[ub]})),L({level:50,methodName:"getMetadata",message:"getMetadataForRange unsuccessful",dataFields:this.dataFields,fields:{["resultCode"]:Le[ub]}}),this.P$a.stop())}KV(){return this.grid.Da.HN(4,this.$.oa)}Rsi(ub){ub=new Oa.Range(1<ub.range.top-1?ub.range.top-1:1,1<ub.range.left-1?ub.range.left-1:1,ub.range.bottom+1,ub.range.right+1,!0,!1);const Vb=1===ub.top,tc=1===ub.left,Sc=Pb.h(this.$).jk("IntelligenceMetadataOverlay",
ub,1);for(;Sc.$$mn();){const jd=Sc.$$cu();if((jd.range.top===ub.top&&!Vb||jd.range.left===ub.left&&!tc||jd.range.bottom===ub.bottom||jd.range.right===ub.right)&&jd.qx.value)return!1}return!0}SBb(ub){return ub.Cd(this.grid.ha.ra.activeRange)}Gxa(ub){for(ub=Pb.h(this.$).jk("IntelligentMetadataOverlayManager.isRangeEmpty",ub,1);ub.$$mn();){const Vb=ub.$$cu();if(Vb&&(0!==Vb.qx.type||!Ye.a.Tq(Vb.qx.value)))return!1}return!0}vi(ub,Vb,tc){let Sc=Object.assign({},this.dataFields);Sc.Method=ub;Sc.Message=
Vb;tc&&(Sc.Fields=tc);return gf.a.hc(Sc)}Zod(ub){return Object(Qa.a)(this,void 0,void 0,function*(){this.RBa||(this.RBa=this.$.Kb.Qg("WebServiceCall","getTableInfoStopwatch"));this.RBa.start();const Vb=cb.v(ub.range.topLeft,this.$),tc=this.$.pa.ya.Wb(),Sc={Duration:-1};return new Promise(jd=>{const pb=new ta.a(260,0,(Rb,oc,Jc)=>wa.s(this.$.pa.ya,Vb,Object(Jb.b)(Rb,ud=>{!ud||fd.a(ud)?(Y.ULS.sendTraceTag(521249761,306,50,this.vi("invokeGetTableInfoAction","Result returned with errors")),L({level:50,
methodName:"invokeGetTableInfoAction",message:"Result returned with errors",dataFields:this.dataFields}),jd(null)):(ud=cb.D(ud.Result.TableRange),this.RBa.stop(),Sc.Duration=this.RBa.Ac,Y.ULS.sendTraceTag(522823199,306,50,this.vi("invokeGetTableInfoAction","GetTableRange Succeeded",Sc)),L({level:50,methodName:"invokeGetTableInfoAction",message:"GetTableRange Succeeded",dataFields:this.dataFields,fields:Sc}),jd(new eb.a(ud,ub.sheetId)))}),Object(Jb.a)(oc,()=>{this.RBa.stop();Sc.Duration=this.RBa.Ac;
Y.ULS.sendTraceTag(522823198,306,50,this.vi("invokeGetTableInfoAction","GetTableRange Failed",Sc));L({level:50,methodName:"invokeGetTableInfoAction",message:"GetTableRange Failed",dataFields:this.dataFields,fields:Sc});jd(null)}),Jc,null,tc),88);pb.kBa(()=>!0);this.$.userOperationManager.Ic(pb,null)})})}}Object(D.a)(Qc,"IntelligentMetadataOverlayManager",null,[631,2]);class pd extends wb.a{constructor(ub){super();this.$=ub;this.Fb();this.dataFields={["Class"]:"IntelligentMetadataOverlayManagerFactory"}}create(){const ub=
S.GetServiceTaskFactory.Oa(this.$.da,20,404,1),Vb=S.GetServiceTaskFactory.Oa(this.$.da,486,487,1);X.TaskExtensions.za(X.TaskExtensions.Ed([ub,Vb],this.$.ka),()=>{const tc=ub.result,Sc=Vb.result;if(tc&&Sc){let jd=this.$.da.Aa(426);jd||(jd=new Qc(this.$,tc,Sc),this.$.da.Ga(426,jd));this.nb(jd);Y.ULS.sendTraceTag(537155667,0,50,"IntelligentMetadataOverlayManagerFactory.Create: IntelligentMetadataOverlayManager initialized successfully");L({level:50,methodName:"Create",message:"Initialized successfully",
dataFields:this.dataFields})}else null==tc&&(Y.ULS.sendTraceTag(537155666,306,10,"IntelligentMetadataOverlayManagerFactory.Create: TableIntelligenceManager instance null."),L({level:10,methodName:"Create",message:"TableIntelligenceManager instance null.",dataFields:this.dataFields})),null==Sc&&(Y.ULS.sendTraceTag(525620054,306,10,"IntelligentMetadataOverlayManagerFactory.Create: ProactiveSuggestionCard instance null."),L({level:10,methodName:"Create",message:"ProactiveSuggestionCard instance null.",
dataFields:this.dataFields})),this.nb(null)},this.$.ka,3)}static la(ub){ub.da.Ga(427,new pd(ub))}}Object(D.a)(pd,"IntelligentMetadataOverlayManagerFactory",wb.a,[]);var ce=a(78),ke=a(462);class Oe{constructor(ub,Vb){this.text=this.cardViewManager=null;this.$=ub;this.ep=Vb}ieh(){const ub=this.jeh();ke.a(this.$,243,242,0,Vb=>{this.cardViewManager=Vb;Vb.z8f(this.ep,4,ub)})}Eai(){this.cardViewManager&&this.cardViewManager.oMa(-1,-1,this.ep)}jeh(){const ub={};ub.description=this.text;const Vb={fieldType:0};
Vb.display=this.text;ub.fields=[Vb];return ub}}Object(D.a)(Oe,"PivotTableHandRaiseCardManager",null,[]);var Fe=a(710);class Xe extends ce.a{constructor(ub,Vb,tc){super();this.b_b=null;this.isVisible=this.fnd=this.O_=this.NN=!1;this.ibb=null;this.kza=(Sc,jd)=>{jd?this.Reb():this.Dfc()};this.onKeyUp=Sc=>{const jd=Sc.Xs;Sc=Sc.Ca;switch(Sc.keyCode){case 27:return this.NN?(this.Dfc(),this.Sda(jd),!0):!1;case 121:return Sc.altKey&&Sc.shiftKey?(this.NN?(this.Dfc(),this.Sda(jd)):(this.Reb(),this.NMb(jd)),
!0):!1;case 17:return this.O_||this.fnd?!1:(this.fnd=!0,window.setTimeout(()=>{this.fnd=!1},30),this.NN?(this.Dfc(),this.Sda(jd)):(this.Reb(),this.NMb(jd)),!0);default:return!1}};this.onKeyDown=Sc=>{Sc=Sc.Ca;this.O_=Sc.ctrlKey&&17!==Sc.keyCode;return 13===Sc.keyCode&&this.NN?(this.qKf(),!0):!1};this.$=ub;this.wo=Vb.q6b(ub,tc,()=>{this.qKf()},"","","","PivotTableHandRaisePointerDown",lb.a.instance.ga(1819))}setRange(ub){this.b_b=ub}get Az(){return this.wo.Az}dispose(){this.wo.dispose();this.$=null;
super.dispose()}xBa(){this.hide();const ub=Pb.h(this.$),Vb=ub.ib.Mi(this.b_b),tc=ub.fg(this.b_b,Vb),Sc=ub.Df(Vb).Am;var jd=this.$.da.Aa(271);if((!jd||!jd.Sji())&&tc&&Sc&&0<=tc.x&&0<=tc.y&&Sc.width>tc.width+160){jd=tc.bottomRight.x+this.Az;const pb=tc.bottomRight.y;let Rb=!1;jd+160>Sc.bottomRight.x&&(jd=tc.topLeft.x-this.Az,Rb=!0);this.wo.Fig(Fe.a.yrj,null,Vb);this.wo.s9b(this.kza,Vb);this.Sp(jd,pb,ub.rtl,Vb,Rb);J.EwaSettings.isChangeGateEnabled("OfficeVSO:5449290_RichTooltip")||(this.wo.domElement(Vb).title=
lb.a.instance.Ua(690));this.$.frame.Zt.VR(gb.a.Fd,this.$.domElement,this.onKeyUp,Vb);this.$.frame.Zt.Ps(gb.a.Pb,this.$.domElement,this.onKeyDown,!0);this.$.da.$a(211,oc=>{const Jc=lb.a.instance.ga(1819)+" "+lb.a.instance.ga(1741);oc.setEnabled(!0);oc.readText(Jc)});this.isVisible=!0}}Reb(){Y.ULS.sendTraceTag(537154657,306,50,"PivotTableHandRaiseLaunchButton:ShowRichToolTip Show tooltip");J.EwaSettings.isChangeGateEnabled("OfficeVSO:5449290_RichTooltip")&&(this.ibb||(this.ibb=new Oe(this.$,this.wo.domElement(1)),
this.ibb.text=lb.a.instance.Ua(690)),this.ibb.ieh())}Dfc(){this.ibb&&this.ibb.Eai()}hide(){this.isVisible&&(this.wo.hide(),Y.ULS.sendTraceTag(537154656,306,50,"PivotTableHandRaiseLaunchButton:Hide Dismissing Pivot table hand rasie OOUI."),this.$.frame.Zt.Ba(gb.a.Fd,this.$.domElement,this.onKeyUp),this.$.frame.Zt.Ws(gb.a.Pb,this.$.domElement,this.onKeyDown,!0),this.isVisible=this.NN=this.O_=!1)}Sda(ub){this.wo.getButton(ub).$cb();this.NN=!1}NMb(ub){this.wo.getButton(ub).bIb();this.NN=!0;this.$.da.$a(211,
Vb=>{const tc=lb.a.instance.Ua(690)+" "+lb.a.instance.ga(1820);Vb.setEnabled(!0);Vb.readText(tc)})}qKf(){Y.ULS.sendTraceTag(537154655,306,50,"PivotTableHandRaiseLaunchButton:OpenPane Pivot table hand rasie OOUI clicked.");const ub={SourceControlId:"PivotTableHandRaise"};ub.StartingRanges=[this.b_b];this.$.Xc(2137617149,0,0,ub).continueWith(()=>{this.hide()})}Sp(ub,Vb,tc,Sc,jd){this.wo.Sp(ub,Vb,tc,Sc,!1,jd);Y.ULS.sendTraceTag(556615632,306,50,"PivotTableHandRaiseLaunchButton:ShowAt Pivot table hand raise OOUI shown.")}}
Object(D.a)(Xe,"PivotTableHandRaiseLaunchButton",ce.a,[]);var pf=a(316);class Ae{constructor(){this.oua=0;this.localStorage=new pf.a;this.oua=this.hSh()}ucc(){return this.oua}$Nd(){this.oua=0;this.N_f()}Ind(){this.oua++;this.N_f()}hSh(){try{if(!this.localStorage.te())return 0;const ub=this.localStorage.getItem("PivotTableHandRaiseDismissCount");return ub?Number.parseLocale(ub):0}catch(ub){return Y.ULS.sendTraceTag(522311635,306,10,"PivotTableHandRaiseLocalStorageLoaderSaver:getDismissCountFromCache failure"),
0}}N_f(){try{this.localStorage.te()&&this.localStorage.setItem("PivotTableHandRaiseDismissCount",this.oua.toString())}catch(ub){Y.ULS.sendTraceTag(522311634,306,10,"PivotTableHandRaiseLocalStorageLoaderSaver:saveDismissCountToCache failure")}}}Object(D.a)(Ae,"PivotTableHandRaiseLocalStorageLoaderSaver",null,[]);class Ie{constructor(ub){this.version=1;this.eRd=0;this.$=ub}ucc(){return Object(Qa.a)(this,void 0,void 0,function*(){this.EZf||(this.EZf=this.iSh());return(yield this.EZf)+this.eRd})}$Nd(){this.eRd=
0;this.X_f(0)}Ind(){Object(Qa.a)(this,void 0,void 0,function*(){this.eRd++;this.X_f(yield this.ucc())})}iSh(){return new Promise(ub=>{W.w(this.$.pa.ya,3,Vb=>{ua.a.dg(Vb.Errors)?(Y.ULS.sendTraceTag(520370311,0,10,`readRoamingString encountered an error. Errors: ${ua.a.sc(Vb.Errors)}`),ub(Number.POSITIVE_INFINITY)):Vb.Result?(Vb=JSON.parse(Vb.Result),!Vb||null==Vb.version||null==Vb.oua||Vb.version<this.version?ub(0):ub(Vb.oua)):(Y.ULS.sendTraceTag(520370310,0,50,"readRoamingString - Received null"),
ub(0))},(Vb,tc,Sc)=>{Vb=Dd.a.Pe(Vb.data);Y.ULS.sendTraceTag(520370309,0,10,`OnRoamingOperationFailure: Encountered errors for ${Sc}. Errors: ${ua.a.sc(Vb)}.`);ub(Number.POSITIVE_INFINITY)},null,null)})}X_f(ub){ub!==Number.POSITIVE_INFINITY&&(ub=JSON.stringify({version:this.version,oua:ub}),W.C(this.$.pa.ya,3,ub,Vb=>{ua.a.dg(Vb.Errors)?Y.ULS.sendTraceTag(520370308,0,10,`writeRoamingString encountered an error. Errors: ${ua.a.sc(Vb.Errors)}`):Vb.Result||Y.ULS.sendTraceTag(520370307,0,10,"writeRoamingString failed to write to roaming service.")},
(Vb,tc,Sc)=>{Vb=Dd.a.Pe(Vb.data);Y.ULS.sendTraceTag(520370306,0,10,`OnRoamingOperationFailure: Encountered errors for ${Sc}. Errors: ${ua.a.sc(Vb)}.`)},null,null))}}Object(D.a)(Ie,"PivotTableHandRaiseRoamingHandler",null,[634]);class Hf{constructor(ub,Vb,tc,Sc,jd=null){this.$Ei=J.EwaSettings.getIntFeatureGate("Microsoft.Office.ExcelOnline.MaxPivotTableHandRaiseCount",1);this.Iuf=J.EwaSettings.getIntFeatureGate("Microsoft.Office.ExcelOnline.MaxPivotTableHandRaiseDismissCount",20);this.Fh=null;this.uOa=
!1;this.Yrc=this.Xrc=null;this.v8h=(pb,Rb)=>{pb=this.u8h(Rb);a:{switch(pb){case "InvalidContextInfo":case "SurveyParamsNull":Rb="Error";break a;case "Success":Rb="Success";break a}Rb=void 0}Y.ULS.sendTraceTag(521441668,306,50,`PivotTableHandRaiseManager.handlePivotTableActivationCallback Results: ${JSON.stringify({result:pb,status:Rb})}`);return null};this.Pc=(pb,Rb)=>{Rb&&Rb.Kmf||(Pb.h(this.$).ha.kG(this.Pc),J.EwaSettings.isChangeGateEnabled("OfficeVSO:6238554_PTPSRemoveCardUXFlight")||J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseCardUX",
!1)?(Y.ULS.sendTraceTag(526984154,306,50,"PivotTableProactiveSuggestion: selection changed, hide hand raise card"),this.M8c()):this.Fh.hide())};this.$=ub;this.tableIntelligenceManager=Vb;this.Bee=this.a8d=0;J.EwaSettings.isChangeGateEnabled("OfficeVSO:6238554_PTPSRemoveCardUXFlight")||(this.Fh=new Xe(this.$,Sc,jd));this.proactiveSuggestionCard=tc;Tb.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(pb=>{pb.isFeatureEnabled("ExcelIdeasPivotTableHandRaise",!1).then(Rb=>
this.uOa=Rb);pb.kna("ExcelIdeasPivotTableHandRaise",Rb=>{this.uOa=Rb.isEnabled})});(ub=Tb.a.instance.Ub("Common.ISystemInitiatedFeedback"))&&ub.execute(pb=>{pb.Wtc("PivotTableHandRaiseSurface",this.v8h)});if(J.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",!1))this.Yrc=new Ie(this.$);J.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&(this.Xrc=new Ae)}get WJe(){return this.a8d}get Bsf(){return this.Bee}Nea(ub){return Object(Qa.a)(this,
void 0,void 0,function*(){const Vb=Date.now(),tc=yield this.WRj(ub);a:{switch(tc){case "Success":case "SuccessWithLppDisabled":var Sc="Success";break a;case "DismissCountAboveLimit":case "IncorrectLicense":case "NotInEditMode":case "NotPivotable":case "NoTableMetadata":case "RangeTooLarge":case "TriggerCountAboveMax":Sc="Aborted";break a;case "ActiveRangeNull":case "SystemInitiatedFeedbackNull":Sc="Error";break a}Sc=void 0}Y.ULS.sendTraceTag(521441669,306,50,`PivotTableHandRaiseManager.triggerHandRaise Results: ${JSON.stringify({result:tc,
status:Sc,duration:Date.now()-Vb})}`)})}WRj(ub){return Object(Qa.a)(this,void 0,void 0,function*(){J.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&Ne.b(this.$).ud(pe.a.N2i,{},void 0,!0);if(!this.uOa)return Y.ULS.sendTraceTag(537154654,306,50,"PivotTableHandRaiseManager:TriggerHandRaise License is not enabled."),"IncorrectLicense";if(!ub)return Y.ULS.sendTraceTag(537154653,306,10,"PivotTableHandRaiseManager:TriggerHandRaise activeRangeForHandRaise is null."),"ActiveRangeNull";
if(J.EwaSettings.isChangeGateEnabled("OfficeVSO:6212469_PTPSReadOnly")&&!this.$.ea.isEditMode)return Y.ULS.sendTraceTag(523100545,306,50,"PivotTableHandRaiseManager:TriggerHandRaise not in edit mode."),"NotInEditMode";if(J.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",!1)){if((yield this.Yrc.ucc())>=this.Iuf)return Y.ULS.sendTraceTag(520370312,306,50,"PivotTableHandRaiseManager:TriggerHandRaise dismiss count above limit"),
"DismissCountAboveLimit"}else if(J.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&this.Xrc.ucc()>=this.Iuf)return Y.ULS.sendTraceTag(522311633,306,50,"PivotTableHandRaiseManager:TriggerHandRaise dismiss count above limit"),"DismissCountAboveLimit";if(J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseTestOnly",!1))return this.WJe<this.$Ei?(this.o9f(new eb.a(ub,Va.d(this.$.xa.oa))),"SuccessWithLppDisabled"):"TriggerCountAboveMax";const Vb=this.T_h(ub);
return Vb?this.Wsi(Vb)?J.EwaSettings.isChangeGateEnabled("OfficeVSO:7188570_PTPSUseXLIMRange")?176E4<Vb.SA.range.RC?(Y.ULS.sendTraceTag(523776329,306,50,"PivotTableHandRaiseManager.triggerHandRaise range is too large to generate suggestions"),"RangeTooLarge"):this.krf(Vb.SA):this.krf(new eb.a(ub,Va.d(this.$.xa.oa))):(Y.ULS.sendTraceTag(537154652,306,50,"PivotTableHandRaiseManager:TriggerHandRaise table data is not pivotable."),"NotPivotable"):"NoTableMetadata"})}dispose(){this.Fh&&this.Fh.dispose();
this.proactiveSuggestionCard&&this.proactiveSuggestionCard.dispose()}T_h(ub){var Vb;Y.ULS.sendTraceTag(537154651,306,50,"PivotTableHandRaiseManager:GetRelevantRecognizedTable get table metadata info.");(ub=null===(Vb=this.tableIntelligenceManager.y5a().zdc(new eb.a(ub,Va.d(this.$.xa.oa)),6)[0])||void 0===Vb?void 0:Vb.table)&&Y.ULS.sendTraceTag(520147406,306,50,`PivotTableHandRaiseManager.getRelevantRecognizedTable Found metadata with ID: ${ub.id}`);return ub}krf(ub){return Object(Qa.a)(this,void 0,
void 0,function*(){const Vb=Tb.a.instance.Ub("Common.ISystemInitiatedFeedback");return Vb?(this.Bee=this.Bsf+1,Y.ULS.sendTraceTag(537154648,306,50,`PivotTableHandRaiseManager:TriggerHandRaise PivotTableHandRaiseActivity LPP activity log count: ${this.Bsf}`),(yield new Promise(tc=>{Vb.execute(tc)})).logActivity("PivotTableHandRaiseActivity",null,ub),"Success"):"SystemInitiatedFeedbackNull"})}u8h(ub){Y.ULS.sendTraceTag(537154647,306,50,"PivotTableHandRaiseManager:HandlePivotTableActivationCallback HandlePivotTableActivationCallback invoked.");
return ub?!ub.contextInfo||!ub.contextInfo.length||1<ub.contextInfo.length?(Y.ULS.sendTraceTag(537154645,306,10,"PivotTableHandRaiseManager:HandlePivotTableActivationCallback no valid contextInfo in surveyParams."),"InvalidContextInfo"):this.o9f(ub.contextInfo[0].context):(Y.ULS.sendTraceTag(537154646,306,10,"PivotTableHandRaiseManager:HandlePivotTableActivationCallback surveyParams is null."),"SurveyParamsNull")}o9f(ub){J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PTPSPreloadIdeas",
!1)&&void this.S4i();J.EwaSettings.isChangeGateEnabled("OfficeVSO:6238554_PTPSRemoveCardUXFlight")||J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseCardUX",!1)?(J.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&Ne.b(this.$).ud(pe.a.M2i,{},void 0,!0),Y.ULS.sendTraceTag(526984158,306,50,"PivotTableProactiveSuggestion: show pivot table hand raise."),this.proactiveSuggestionCard.show(ub.range,lb.a.instance.ga(1824),lb.a.instance.Ua(692),lb.a.instance.ga(1822),
lb.a.instance.ga(1823),()=>{var Vb,tc;J.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&Ne.b(this.$).ud(pe.a.L2i,{},void 0,!0);Y.ULS.sendTraceTag(526984157,306,50,"PivotTableProactiveSuggestion:OpenPane Pivot table hand raise OOUI clicked.");J.EwaSettings.isChangeGateEnabled("OfficeVSO:6423587_PTPSCardRaceConditionFix")&&this.proactiveSuggestionCard.hide();const Sc={SourceControlId:"PivotTableHandRaise"};J.EwaSettings.isChangeGateEnabled("OfficeVSO:7188570_PTPSUseXLIMRange")?
(Sc.Q4j=null!==(tc=null===(Vb=Pb.h(this.$).Bb.Bj(ub.range))||void 0===Vb?void 0:Vb.name)&&void 0!==tc?tc:Object(cb.x)(ub.range,this.$.xa.cjd(ub.sheetId).name,!0),Vb=-1444574190):(Sc.Fpg=[ub.range],Vb=2137617149);this.$.Xc(Vb,0,0,Sc).continueWith(()=>{J.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",!1)?this.Yrc.$Nd():J.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&
this.Xrc.$Nd();J.EwaSettings.isChangeGateEnabled("OfficeVSO:6423587_PTPSCardRaceConditionFix")||this.proactiveSuggestionCard.hide()})},()=>{J.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&Ne.b(this.$).ud(pe.a.K2i,{},void 0,!0);Y.ULS.sendTraceTag(526984156,306,50,"PivotTableProactiveSuggestion: Not Now clicked.");this.M8c()},void 0,void 0,void 0,void 0,J.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")?11:void 0,J.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")?
[13,8,10,6,4,2,0]:void 0,void 0,Vb=>{Vb=Vb?new Sys.UI.DomEvent(Vb):null;"keydown"===(null===Vb||void 0===Vb?void 0:Vb.type)&&27===Vb.keyCode&&(J.EwaSettings.isChangeGateEnabled("OfficeVSO:6176249_UserActionLogs")&&Ne.b(this.$).ud(pe.a.J2i,{},void 0,!0),this.M8c())},!1,!0)):(this.Fh.setRange(ub.range),this.Fh.xBa());Pb.h(this.$).ha.hH(this.Pc);this.a8d=this.WJe+1;return"Success"}S4i(){return Object(Qa.a)(this,void 0,void 0,function*(){(yield S.GetServiceTaskFactory.aka(this.$.da,374,375,1)).uNf()})}Wsi(ub){for(let Vb of ub.interpretations)if(.75<=
Vb.confidence&&2===Vb.orientation&&1===Vb.headerRowCount)return!0;return!1}M8c(){if(J.EwaSettings.isChangeGateEnabled("OfficeVSO:7071239_SwitchSheetWhenCardOpen")||!J.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")||this.proactiveSuggestionCard.isVisible)this.proactiveSuggestionCard.hide(),J.EwaSettings.isChangeGateEnabled("OfficeVSO:7062246_RemovePivotTableHandRaiseRoamingFlight")||J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PivotTableHandRaiseRoaming",!1)?this.Yrc.Ind():
J.EwaSettings.isChangeGateEnabled("OfficeVSO:6002302_PTPSOptOut")&&this.Xrc.Ind()}}Object(D.a)(Hf,"PivotTableHandRaiseManager",null,[629,2]);class xe extends wb.a{constructor(ub){super();this.$=ub;this.Fb()}create(){const ub=S.GetServiceTaskFactory.Oa(this.$.da,20,404,1),Vb=S.GetServiceTaskFactory.Oa(this.$.da,486,487,1);let tc=null;J.EwaSettings.isChangeGateEnabled("OfficeVSO:6238554_PTPSRemoveCardUXFlight")||(tc=S.GetServiceTaskFactory.Oa(this.$.da,12,477,1));let Sc=null;!J.EwaSettings.isChangeGateEnabled("OfficeVSO:6238554_PTPSRemoveCardUXFlight")&&
J.EwaSettings.ma(533)&&(Sc=S.GetServiceTaskFactory.Oa(this.$.da,388,387,1));const jd=[ub,Vb];tc&&jd.push(tc);Sc&&jd.push(Sc);X.TaskExtensions.za(Q.Task.jJ(...jd),()=>{if(!this.$.da.Aa(430)){var pb=ub.result;const Rb=Vb.result,oc=null===tc||void 0===tc?void 0:tc.result,Jc=null===Sc||void 0===Sc?void 0:Sc.result;pb&&Rb?(pb=new Hf(this.$,pb,Rb,oc,Jc),this.nb(pb),this.$.da.Ga(430,pb)):(null==pb&&Y.ULS.sendTraceTag(537154644,306,10,"PivotTableHandRaiseManagerFactory.Create: TableIntelligenceManager instance null."),
null==Rb&&Y.ULS.sendTraceTag(525620053,306,10,"PivotTableHandRaiseManagerFactory.Create: ProactiveSuggestionCard instance null."),this.nb(null))}},this.$.ka)}static la(ub){ub.da.Ga(431,new xe(ub))}dispose(){this.$=null;super.dispose()}}Object(D.a)(xe,"PivotTableHandRaiseManagerFactory",wb.a,[]);var Ze=a(1259),nf=a(1160),hf=a(27),bb=a(34),Lb=a(50),nc=a(28),Lc=a(47);class od extends yc.a{constructor(ub){super(document.createElement("div"));this.$=ub;this.isMac=hf.a.isMac;this.onKeyDown=Vb=>{Vb=Vb.Ca;
switch(Vb.keyCode){case 27:if(this.cn.onDismiss)this.cn.onDismiss(Vb);this.hide();return!0;default:return!1}};this.onKeyUp=Vb=>{Vb=Vb.Ca;switch(Vb.keyCode){case 121:return Vb.altKey&&Vb.shiftKey?(this.focus(),!0):!1;default:return!1}};this.Kgf=(Vb,tc)=>Vb.x==tc.x&&Vb.y==tc.y&&Vb.width==tc.width&&Vb.height==tc.height;this.L0e=(Vb,tc)=>{const Sc=Vb.topLeft.y,jd=Vb.bottomRight.y,pb=Vb.topLeft.x;Vb=Vb.bottomRight.x;switch(tc){case 0:return new Lb.a(pb+320,Sc-166);case 1:return new Lb.a(pb-(320-(Vb-pb))/
2,Sc-166);case 2:return new Lb.a(Vb-320,Sc-166);case 3:return new Lb.a(pb,Sc);case 4:return new Lb.a(pb+320,jd+166);case 5:return new Lb.a(pb-(320-(Vb-pb))/2,jd+166);case 6:return new Lb.a(Vb-320,jd+166);case 7:return new Lb.a(pb,jd);case 8:return new Lb.a(pb-320,Sc+166);case 9:return new Lb.a(pb-320,Sc-(166-(jd-Sc))/2);case 10:return new Lb.a(pb-320,jd-166);case 11:return new Lb.a(Vb+320,Sc+166);case 12:return new Lb.a(Vb+320,Sc-(166-(jd-Sc))/2);case 13:return new Lb.a(Vb+320,jd-166);default:throw Error(`Unhandled direction: ${tc}`);
}};this.L0d=()=>{this.isVisible?(this.j2j=nc.a.Qa.we.m,this.hide(),this.Qhg=Lc.a.instance.create(()=>{this.HWj()},this.Qlg,"ProactiveSuggestionCard.UpdateCardPosition",void 0,!0)):this.grid.view.er(this.L0d)};this.HWj=()=>{nc.a.Qa.we.m-this.j2j>=this.Qlg&&(this.kvc(),this.R0f++,Y.ULS.sendTraceTag(512266886,1,50,gf.a.hc({["message"]:"ProactiveSuggestionUIControl.updateCardPositionTick: calling AppChrome API to render card UI.",["updateCount"]:this.R0f})))};this.grid=Pb.h(ub);this.hId=null;this.L3b=
this.XU=!1;this.Qlg=250;this.Sxc=!1}show(ub,Vb,tc,Sc,jd,pb,Rb,oc,Jc,ud,Fb,pa,tb,Nb,vc,Ic,kd){this.rootBounds=Sys.UI.DomElement.getBounds(this.grid.Cwa.mc);this.Sxc=kd;this.Nli=!!pa;this.mKa=tb;this.R0f=0;this.cn={range:ub,container:this.domElement,title:Vb,description:tc,primaryButtonText:Sc,secondaryButtonText:jd,mVi:pb,NWi:Rb,menuItems:oc,yGb:Jc,L6:ud,icon:Fb,direction:pa,gapSpace:Nb,onDismiss:vc,qeh:xd=>{xd&&(this.hId=xd)},setInitialFocus:Ic,ariaLabel:this.isMac?Vb+" "+lb.a.instance.ga(1826):Vb+
" "+lb.a.instance.ga(1825)};ub=this.kvc();this.XU||(this.$.frame.Zt.sa(gb.a.Fd,this.$.domElement,this.onKeyUp),this.$.frame.Zt.Ps(gb.a.Pb,this.$.domElement,this.onKeyDown,!0),this.XU=!0);this.$.da.$a(211,xd=>{const ae=this.isMac?lb.a.instance.ga(1826):lb.a.instance.ga(1825);xd.setEnabled(!0);xd.readText(ae)});return ub}hide(){Y.ULS.sendTraceTag(527218006,1,50,"ProactiveSuggestionUIControl.Hide: calling AppChrome API to unmount card UI.");J.EwaSettings.isChangeGateEnabled("OfficeVSO:6423587_PTPSCardRaceConditionFix")&&
this.Qhg&&this.Qhg.cancel();appChrome.unmountReactComponent(this.domElement);this.isVisible=!1;this.grid.view.er(this.L0d);this.XU&&(this.$.frame.Zt.Ba(gb.a.Fd,this.$.domElement,this.onKeyUp),this.$.frame.Zt.Ws(gb.a.Pb,this.$.domElement,this.onKeyDown,!0),this.XU=!1)}focus(){this.hId&&this.hId.focus()}dispose(){super.dispose()}getDirectionalHint(ub){var Vb,tc,Sc=this.grid.ib.Mi(ub);ub=this.grid.fg(ub,Sc);Sc=this.grid.Df(Sc).Am;const jd=this.L0e(ub,null!==(Vb=this.cn.direction)&&void 0!==Vb?Vb:13);
if(Sc.mia(jd))return null!==(tc=this.cn.direction)&&void 0!==tc?tc:13;if(void 0===this.cn.direction)return 11;if(this.mKa&&0<this.mKa.length)for(Vb=0;Vb<this.mKa.length;Vb++){if(tc=this.L0e(ub,this.mKa[Vb]),Sc.mia(tc))return this.mKa[Vb]}else return this.cn.direction}getCellBounds(ub){if(ub=this.grid.Sb(ub))if(ub.cell.Pk)if(this.grid.aba(ub.cell.my.Ad)){if(!J.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon"))return{bounds:this.grid.getCellBounds(ub.cell,!0),direction:void 0};
var Vb=ub.range,tc=this.grid.ib.Mi(Vb),Sc=this.grid.fg(Vb,tc);if(this.grid.Df(tc).Am.Cd(Sc))if(Vb=this.getDirectionalHint(Vb),void 0===Vb)Y.ULS.sendTraceTag(512361876,1,15,"ProactiveSuggestionUIControl.GetCellBounds failed to show UI, direction is undefined");else return{bounds:this.grid.getCellBounds(ub.cell,!0),direction:Vb};else Y.ULS.sendTraceTag(512266887,0,15,"ProactiveSuggestionUIControl.GetCellBounds: Range not in visible area")}else Y.ULS.sendTraceTag(525341026,1,15,"ProactiveSuggestionUIControl.GetCellBounds failed to show UI, gridViewBlock not found");
else Y.ULS.sendTraceTag(527218009,1,15,"ProactiveSuggestionUIControl.GetCellBounds: failed to show UI, formattedActiveCell is not in view.");else Y.ULS.sendTraceTag(527218010,1,15,"ProactiveSuggestionUIControl.GetCellBounds: failed to show UI, formattedActiveCell is null.")}getRangeBounds(ub){var Vb=this.grid.ib.Mi(ub),tc=this.grid.fg(ub,Vb);const Sc=this.grid.Df(Vb);Vb=Sc.Am;if(!Vb.Cd(tc))return{bounds:this.rootBounds,direction:this.cn.direction};tc=Vb.Ie(tc);var jd=tc.topLeft.y;const pb=tc.bottomRight.y,
Rb=tc.topLeft.x,oc=tc.bottomRight.x;tc=this.cn.direction;if(J.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")){if(tc=this.getDirectionalHint(ub),void 0===tc)return{bounds:this.rootBounds,direction:this.cn.direction}}else ub=new Lb.a(oc,pb-134),this.L3b=!Vb.mia(ub);ub=Sys.UI.DomElement.getLocation(Sc.domElement);jd=new Sys.UI.Point(Rb+ub.x-Vb.topLeft.x,jd+ub.y-Vb.topLeft.y);Vb=new Sys.UI.Point(oc+ub.x-Vb.topLeft.x,pb+ub.y-Vb.topLeft.y);jd=bb.a(this.$).eka(jd);Vb=bb.a(this.$).eka(Vb);
return{bounds:new Sys.UI.Bounds(jd.x,jd.y,Vb.x-jd.x,Vb.y-jd.y),direction:tc}}iPh(){const ub=this.getRangeBounds(this.cn.range);return this.Sxc&&!this.Kgf(ub.bounds,this.rootBounds)?ub:this.Sxc?void 0:this.getCellBounds(this.cn.range)}kvc(){if(!this.cn)return!1;if(J.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")){var ub=this.iPh();if(!ub)return Y.ULS.sendTraceTag(512361875,1,15,"ProactiveSuggestionUIControl.renderCard: cardLayoutInfo is undefined"),!1;var Vb=ub.bounds;ub=
ub.direction;if(void 0===Vb)return Y.ULS.sendTraceTag(512361874,1,15,"ProactiveSuggestionUIControl.renderCard: bounds is undefined"),!1}else this.Sxc?(Vb=this.getRangeBounds(this.cn.range).bounds,J.EwaSettings.isChangeGateEnabled("OfficeVSO:6472403_FallbackCardLocation")?this.cn.direction=this.L3b&&null!=this.mKa?this.mKa[0]:this.cn.direction:this.cn.direction=this.Nli?this.cn.direction:this.L3b?11:13,this.L3b=!1):(Vb=this.getCellBounds(this.cn.range),Vb=null!=Vb?Vb[0]:void 0);if(this.Kgf(Vb,this.rootBounds))return Y.ULS.sendTraceTag(525341025,
1,15,"ProactiveSuggestionUIControl.RenderCard failed to show UI, targetBounds set to root"),!1;Y.ULS.shipAssertTag(527218008,1,!!Vb,"ProactiveSuggestionUIControl.RenderCard: target cell bounds should not be null.");Y.ULS.sendTraceTag(527218007,1,50,"ProactiveSuggestionUIControl.RenderCard: calling AppChrome API to render card UI.");appChrome.renderProactiveSuggestionCard(Vb.y,Vb.x,Vb.y+Vb.height,Vb.x+Vb.width,this.cn.container,this.cn.title,this.cn.description,this.cn.primaryButtonText,this.cn.secondaryButtonText,
this.cn.mVi,this.cn.NWi,this.cn.menuItems,this.cn.yGb,this.cn.L6,this.cn.icon,J.EwaSettings.isChangeGateEnabled("OfficeVSO:6837335_PTPSNotOverlapRibbon")?ub:this.cn.direction,this.cn.gapSpace,this.cn.onDismiss,this.cn.qeh,this.cn.setInitialFocus,this.cn.ariaLabel);this.isVisible=!0;this.grid.view.ot(this.L0d);return!0}}Object(D.a)(od,"ProactiveSuggestionCard",yc.a,[625]);class wd extends wb.a{constructor(ub){super();this.$=ub;this.Fb()}static la(ub){ub.da.Ga(487,new wd(ub))}create(){var ub;this.nb(null!==
(ub=this.$.da.Aa(486))&&void 0!==ub?ub:this.$.da.Ga(486,new od(this.$)))}dispose(){this.$=null;super.dispose()}}Object(D.a)(wd,"ProactiveSuggestionCardFactory",wb.a,[]);var Pd=a(117);class je{constructor(ub){ub.ky(Vb=>{void Vb.Taa(1).then(()=>{const tc=document.createElement("div"),Sc=Object(Pb.h)(ub).zj;appChrome.renderProactiveSuggestionDebugPane(tc,Sc,Pd.a.Ou)})});J.EwaSettings.ma(286)&&J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.TableIntelligence",!1)&&void S.GetServiceTaskFactory.aka(ub.da,
510,511,1)}}Object(D.a)(je,"ProactiveSuggestionDebugToolsManager",null,[]);class be extends wb.a{constructor(ub){super();this.$=ub;this.Fb()}static la(ub){ub.da.Ga(509,new be(ub))}create(){this.nb(Object($d.a)(this.$.da,508,()=>new je(this.$)))}}Object(D.a)(be,"ProactiveSuggestionDebugToolsManagerFactory",wb.a,[]);var Qe=a(1132);class jc{constructor(ub,Vb){this.$=ub;this.tableIntelligenceManager=Vb;ub.xa.Xf(()=>this.Y0d());this.tableIntelligenceManager.xZa("Valid",()=>{this.Y0d()});this.tableIntelligenceManager.xZa("Invalid",
()=>{this.Y0d()})}Y0d(){const ub=[],Vb=[],tc=[],Sc=this.$.xa.oa;if(Sc){var jd=this.tableIntelligenceManager.y5a().zdc(new eb.a(Object(cb.f)(),Sc.sheetId),2);for(const pb of jd){if(pb.table.SA.sheetId!==Sc.sheetId)continue;jd=this.$Nh(pb.table);if(!jd)continue;const Rb=jd.Ioa.clone();Rb.left+=jd.headerColumnCount;Rb.top+=jd.headerRowCount;let oc=!0,Jc=!0;for(let ud=0;ud<jd.fields.count;ud++){const Fb=Rb.clone();2===jd.orientation?(Fb.left+=ud,Fb.right=Fb.left):(Fb.top+=ud,Fb.bottom=Fb.top);1===jd.fields.na(ud).classification?
(this.Qpe(ub,Fb,Jc),Jc=!1):(this.Qpe(Vb,Fb,oc),oc=!1)}jd=this.dVh(jd);null!=jd&&tc.push(jd)}this.FLd();0<ub.length&&this.Cz(ub,[32]);0<Vb.length&&this.Cz(Vb,[33]);0<tc.length&&this.Cz(tc,[31])}else Y.ULS.sendTraceTag(520147412,0,50,"GridHighlighter.updateGridHighlights: Active sheet null")}FLd(){const ub=[33,32,31];Object(Pb.h)(this.$).qb.Zg(ub);Object(Pb.h)(this.$).qb.RSa(new eb.a(null,Va.d(this.$.oa)),ub)}Qpe(ub,Vb,tc){!ub.length||tc?ub.push(Vb.clone()):(tc=ub[ub.length-1],tc.right+1===Vb.left?
tc.right=Vb.right:tc.bottom+1===Vb.top?tc.bottom=Vb.bottom:ub.push(Vb.clone()))}$Nh(ub){var Vb=ub.interpretations;return 0===(null===Vb||void 0===Vb?void 0:Vb.count)?null:1===Vb.count?Vb.na(0):2===Vb.count?Vb.na(0).confidence===Vb.na(1).confidence?(ub=2===Vb.na(0).orientation?Vb.na(0):Vb.na(1),Vb=1===Vb.na(0).orientation?Vb.na(0):Vb.na(1),new Qe.a(ub.Ioa,ub.confidence,Vb.headerRowCount,ub.headerColumnCount,ub.orientation,ub.fields)):ub.interpretations.na(0).confidence>ub.interpretations.na(1).confidence?
ub.interpretations.na(0):ub.interpretations.na(1):null}Cz(ub,Vb){ub=eb.a.Gea(Va.d(this.$.oa),ub);Object(Pb.h)(this.$).qb.lx(ub,Vb,!0)}dVh(ub){const Vb=ub.Ioa.clone();if(2===ub.orientation){if(0===ub.headerRowCount)return null;Vb.bottom=Vb.top+ub.headerRowCount-1}else{if(0===ub.headerColumnCount)return null;Vb.right=Vb.left+ub.headerColumnCount-1}return Vb}}Object(D.a)(jc,"RecognizedTableGridHighlighter",null,[]);class Tc extends wb.a{constructor(ub){super();this.$=ub;this.Fb()}static la(ub){ub.da.Ga(511,
new Tc(ub))}create(){void S.GetServiceTaskFactory.aka(this.$.da,20,404,1).then(ub=>{this.nb(Object($d.a)(this.$.da,510,()=>new jc(this.$,ub)))})}}Object(D.a)(Tc,"RecognizedTableGridHighlighterFactory",wb.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.DataCleansing");Type.registerNamespace("_Ewa");V.a.Ni('.DataCleansingPane{background:#edebe9;height:100%;overflow:hidden;display:flex;flex-direction:column}.DataCleansingPaneHeader{position:relative;overflow:hidden;padding:16px 16px 16px 16px}.DataCleansingPaneBody{flex:auto;position:relative}.DataCleansingPaneTitle{position:relative !important;max-width:230px;display:inline-block;text-overflow:ellipsis;overflow:hidden;height:22px;font-weight:normal;background:#edebe9;font-size:16px;color:#252423;font-family:"Segoe UI Semibold","Segoe UI Web",Arial,Verdana,sans-serif}.DataCleansingCloseButton{display:inline-block;padding:0 5px;font-size:16px}');
(()=>{T.a.Fa(ub=>{J.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DataCleansingStatefulTaskPane",!1)?(qe.la(ub),dc.la(ub)):(Gc.la(ub),dc.la(ub),H.a.fd(ub)||Se.la(ub))})})();(()=>{T.a.Fa(ub=>{pd.la(ub)})})();(()=>{T.a.Fa(ub=>{xe.la(ub)})})();Object(Ze.a)();Object(nf.a)();(()=>{T.a.Fa(ub=>{wd.la(ub)})})();(()=>{T.a.Fa(ub=>{be.la(ub)})})();(()=>{T.a.Fa(ub=>{Tc.la(ub)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.datacleansing.js.map/b5cf6c985cacac0d12f27fd049f86774/EwaDSEsNext.datacleansing.js.map