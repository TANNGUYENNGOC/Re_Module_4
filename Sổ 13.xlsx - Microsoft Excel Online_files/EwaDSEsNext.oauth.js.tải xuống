'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[16],{1230:function(u,F,a){u=a(0);var c=a(946),b=a(4);class e{}Object(u.a)(e,"LokiTokenResult",null,[]);class f{constructor(r){this.wWb=r}yhd(){const r=this.TWh();return r?f.Trd?new Promise((y,t)=>{this.wWb.continueWith(()=>{this.wWb.qh||this.wWb.Pf?t(Error.create("Error downloading auth library")):this.wWb.result.UL("Loki",r).then(v=>{v=b.AFrameworkApplication.fa.qa("ForceLokiFallbackToACLPTokenIsEnabled")?this.WWh():
v.IsSuccess&&v.Token?Object.assign(new e,{isSuccess:!0,token:v.Token,errorMessage:null}):Object.assign(new e,{isSuccess:!1,token:null,errorMessage:JSON.stringify(v)});y(v);return v})})}):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",c.a.p0e())}))}WWh(){const r=
b.AFrameworkApplication.fa.Xa("LokiUserDataSignature")||"";return Object.assign(new e,{isSuccess:!0,token:r,errorMessage:null})}TWh(){let r=null;const y=c.a.Nbc();2===y?r=b.AFrameworkApplication.fa.Xa("LokiAADAppId"):1===y&&(r=b.AFrameworkApplication.fa.Xa("LokiMSAAppId"));return r}static get Trd(){return b.AFrameworkApplication.fa.qa("IsO365CommercialHost")||b.AFrameworkApplication.fa.qa("IsO365ConsumerHost")}}Object(u.a)(f,"LokiTokenManager",null,[568]);var d=a(248),h=a(82),n=a(520);class m{get name(){return"Common.App.LivePersonaUtils"}init(){h.a.instance.resolve("Common.ILokiTokenManager")}dispose(){}Xh(r){r.register(f,
"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").xc().Fc(()=>new f(n.a.jr(r.Ub("Common.App.OAuth.IOAuthManager"))))}static main(){d.a.instance.Ei(new m)}}Object(u.a)(m,"LivePersonaUtilsPackage",null,[3,4]);a.d(F,"a",function(){return x});const x=()=>{Type.registerNamespace("Common.App.LivePersonaUtils");m.main()}},1253:function(u,F,a){var c=a(9);u=a(0);var b=a(82),e=a(222),f=a(7),d=a(15),h=a(766);class n{constructor(y){this.oAuthManager=y}UL(y,t){return this.oAuthManager?
this.oAuthManager.UL(y,t).then(v=>{v.IsSuccess||d.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+v.ErrorMessage+" Error code: "+v.ErrorCode+" App name: "+y);return Object(f.a)(new h.a,{IsSuccess:v.IsSuccess,Token:v.Token,ErrorCode:v.ErrorCode,ErrorMessage:v.ErrorMessage})}):(d.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(f.a)(new h.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))}YMa(){return this.oAuthManager?
this.oAuthManager.YMa():null}}Object(u.a)(n,"OAuthManagerWrapper",null,[355]);var m=a(697);class x extends e.a{constructor(y){super();this.$=y;this.Fb()}create(){this.nb(Object(m.a)(this.$.da,349,()=>new n(b.a.instance.resolve("Common.App.OAuth.IOAuthManager"))))}static la(y){y.da.Ga(350,new x(y))}}Object(u.a)(x,"OAuthManagerFactory",e.a,[]);a.d(F,"a",function(){return r});const r=()=>{c.a.Fa(y=>{x.la(y)})}},1279:function(u,F,a){u=a(0);var c=a(15),b=a(842),e=a(923),f=a(4),d=a(98),h=a(731),n=a(248),
m=a(41),x=a(39),r=a(27),y=a(111),t=a(82),v=a(189);class w{get name(){return"Common.App.OAuth.OAuthPackage"}Xh(B){B.register(297,"Common.App.OAuth.IOAuthManager").xc().Fc(()=>new b.OAuthManager)}init(){const B=t.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.VTj(B)}VTj(B){const z=f.AFrameworkApplication.fa.Xa("FileSource");if(f.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||f.AFrameworkApplication.fa.qa("IsO365CommercialHost")||"WopiTest"===z){var A=h.a.e$g;if(A&&A.IsEnabled){var E=
A.Application,I=h.a.authority;if(void 0!==E&&null!==E&&E.length&&void 0!==I&&null!==I&&I.length){var L=e.a[B.VS],V=r.a.zHa,T=B.Av();try{var H=new Map;void 0!==H&&null!==H?(H.set("SupportStatus",L),H.set("Browser",V),H.set("AuthStrategy",T)):H=null}catch(G){H=null}d.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",H);var D=x.a.Ud();B.UL("Core",E).then(G=>{const J=Math.floor(x.a.Ud()-D);L=e.a[B.VS];V=r.a.zHa;T=B.Av();c.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',
J,G.IsSuccess,L,G.ErrorCode,z,V,T);H&&(H.set("SupportStatus",L),H.set("Browser",V),H.set("AuthStrategy",T));var M=Object.assign(new v.a,{durationMs:J,extendedProperties:H});if(G.IsSuccess){if(d.Health.instance.recordKpiSuccess("WacCorePFT",M),M=A.Endpoint){var Q=x.a.Ud();f.AFrameworkApplication.zd.oob(M,1,null,{["Authorization"]:"Bearer "+G.Token},"OAuthManagerValidateAccess",void 0,void 0,void 0,2E4).continueWith(U=>{var Z=Math.floor(x.a.Ud()-Q),P=null;U.qh?U="Canceled":U.Pf?U="Faulted":(P=U.result,
U=P.succeeded?"Completed":"Failed");Z={["TaskResult"]:U,["BrowserTokenDurationMS"]:J,["BrowserValidationDurationMS"]:Z};P&&(Z.HttpStatus=P.Kg.data.httpStatus,P.succeeded&&(P=m.a(P.Kg.data.ve),Z.ServerValidationDurationMS=P.ElapsedMilliseconds,Z.ServerValidationResult=P.ValidatedToken,Z.KMSI=P.KMSI,Z.Scopes=P.Scopes,Z.TokenExpirationS=Math.floor(parseInt(P.Expiration)-(new Date).getTime()/1E3)));c.ULS.sendTraceTag(520632322,3E3,"Completed"===U?50:15,y.a.toJSON(Z))})}}else d.Health.instance.recordKpiFailure("WacCorePFT",
G.ErrorCode,!1,!1,M)}).catch(G=>{var J=Math.floor(x.a.Ud()-D);J=Object.assign(new v.a,{durationMs:J,extendedProperties:H});d.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+G.toString(),!1,!1,J)})}}}}dispose(){}static main(){n.a.instance.Ei(new w)}static ndj(){n.a.instance.Ei(new w,0,!0)}}Object(u.a)(w,"OAuthPackage",null,[3,4]);a.d(F,"a",function(){return C});const C=B=>{Type.registerNamespace("Common.App.OAuth");B?w.ndj():w.main()}},1466:function(u,F,a){a.r(F);u=a(1279);F=a(1230);
a=a(1253);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(u.a)();Object(F.a)();Object(a.a)()},842:function(u,F,a){a.r(F);u=a(0);var c=a(15);const b=(Y,va)=>{var N=Y.Wqg;if(!N){N=[];for(var ea in Y)"string"===typeof ea&&N.push({key:ea,value:Y[ea]});N.sort((Ca,la)=>Ca.value-la.value);Y.Wqg=N}N=[];for(ea=1;0<va;)va&1&&Y[ea]&&N.push(Y[ea]),ea<<=1,va>>=1;if(N.length&&0===va)return N.reverse().join(", ")};var e=a(923),f;(function(Y){Y[Y.external=0]="external";
Y[Y.msa=1]="msa";Y[Y.aad=2]="aad"})(f||(f={}));Object(u.b)("AuthorityType",f);class d{}Object(u.a)(d,"OAuthResult",null,[]);class h{constructor(Y){this.mzg=Y}initialize(){return Promise.resolve(0)}Mlc(){return Promise.resolve(0)}UL(){c.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new d,{IsSuccess:!0,Token:this.mzg}))}VCc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",
ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}sBc(){return!1}Xxb(){return"MockAuthTokenStrategy"}}Object(u.a)(h,"MockAuthTokenStrategy",null,[430]);var n=a(946);class m{static get(Y,va,N){if(!N)return Y;let ea=0;return Promise.race([Y,new Promise(Ca=>{ea=window.setTimeout(()=>{Ca(va)},N)})]).then(Ca=>{window.clearTimeout(ea);return Promise.resolve(Ca)}).catch(()=>{window.clearTimeout(ea);return Promise.resolve(va)})}}Object(u.a)(m,"PromiseWithTimeout",
null,[]);var x=a(4),r=a(731);class y{constructor(Y,va,N,ea,Ca){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=Y;this.scope=va;this.silentLogin=N;this.options=ea;this.correlationId=Ca}}Object(u.a)(y,"TokenRequestParameters",null,[447]);var t=a(27),v=a(82);class w{constructor(){this.qne=null;let Y=x.AFrameworkApplication.fa.Xa(x.AFrameworkApplication.n8),va=x.AFrameworkApplication.fa.Xa(x.AFrameworkApplication.vgg);this.JYa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",
Y&&""!==Y?Y:"Unspecified",va&&""!==va?va:"Unspecified")}initialize(){return new Promise(Y=>{v.a.instance.Ub("Common.App.WopiIdentity.IWopiIdentity").execute(va=>{this.qne=va;Y(0)})})}Bi(Y){const va=["HTTPS:","API:"];let N=!1;const ea=Y.toLocaleUpperCase();for(const Ca of va)if(ea.startsWith(Ca)){N=!0;break}return N||this.Bni(Y)?Y+"/.default":Y}Bni(Y){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(Y)}Mlc(){return Promise.resolve(0)}UL(Y,va,N,ea,Ca,
la,Ra){if(t.a.Pxa){Ca=r.a.u2j;if(!Ca)return va=Object.assign(new d,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(va);if(!Array.contains(Ca,Y))return va=Object.assign(new d,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+Y}),Promise.resolve(va)}Y=this.Bi(N);N=new y(N,Y,!ea,null,x.AFrameworkApplication.userSessionId);return this.qne.getAccessToken(N,va,Ra).then(lb=>Object.assign(new d,{IsSuccess:!0,Token:lb.accessToken}),
lb=>Object.assign(new d,{IsSuccess:!1,ErrorCode:lb}))}VCc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}sBc(){return!1}Xxb(){return this.JYa}}Object(u.a)(w,"ParentFrameTokenStrategy",null,[430]);var C=a(84),B=a(850),z=a(187);class A{constructor(){this.reject=this.resolve=null;this.startTime=0;this.hPf=this.sxe=null}}Object(u.a)(A,"PromiseWrapper",
null,[]);class E{constructor(Y=0){this.lC=0;this.Klb=!1;this.Om=new z.a;this._timeout=Y}enqueue(Y){return new Promise((va,N)=>{this.Om.add(Object.assign(new A,{hPf:Y,resolve:va,reject:N}));this.process()})}process(){if(this.Klb||this.lC===this.Om.count)return!1;const Y=this.Om.na(this.lC++);try{this.Klb=!0,Y.hPf().then(va=>{this.Klb=!1;this.d4c(Y,va,null,!0)}).catch(va=>{this.Klb=!1;this.d4c(Y,null,va,!1)})}catch(va){this.Klb=!1,this.d4c(Y,null,va,!1)}return!0}d4c(Y,va,N,ea){if(ea){const Ca=()=>{Y.resolve(va);
this.process()};0<this._timeout?window.setTimeout(()=>{Ca()},this._timeout):Ca()}else{const Ca=()=>{Y.reject(N);this.process()};0<this._timeout?window.setTimeout(()=>{Ca()},this._timeout):Ca()}}}Object(u.a)(E,"PromiseQueue",null,[]);class I{constructor(){this.correlationId=this.resolve=null}}Object(u.a)(I,"ResolveWithCorrelation",null,[]);var L=a(83),V=a(146),T=a(823),H=a(164);class D extends V.a{constructor(Y,va,N,ea,Ca,la){super(!1,!1,!0);this.N8d=this.S1=null;this.uY=Y;this.PAg=N;this.Yv=ea;this.xEg=
Ca;this.AEa=la;this.jt=document.createElement("iframe");this.jt.id="SharedAuthInteractiveFrame";this.jt.setAttribute("name","SharedAuthInteractiveFrame");this.jt.setAttribute("title","SharedAuthInteractiveFrame");this.jt.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.jt.style.border="0";this.jt.style.height="48px";this.jt.style.width="190px";$addHandler(this.jt,"error",Object(C.a)(this,this.lXi,"onSharedAuthFrameError"));Y=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",
this.uY,va,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",x.AFrameworkApplication.userType);this.jt.src=Y;this.uug=new Promise(Ra=>{this.N8d=Ra});this.O8d=!1}Kzc(){this.S1={["id"]:"SharedAuthConsentDialog",["bodyControls"]:{["promptMessage"]:this.PAg,["errorText"]:CommonUIStrings.l_InternalError,["rtl"]:x.AFrameworkApplication.isRtl,["frameLoaded"]:!1,["createFrame"]:Object(C.a)(this,this.Zbh,"createFrame"),["resolveDialogStyles"]:this.N8d}};this.Rb=
5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(C.a)(this,this.NAj,"sharedAuthConsentDialogHandler"),this.S1)}kEc(Y=!1,va=!1,N=5){this.S1&&this.S1.bodyControls&&(Y!==Object(L.a)(Object,this.S1.bodyControls).frameLoaded&&(Object(L.a)(Object,this.S1.bodyControls).frameLoaded=Y),va!==Object(L.a)(Object,this.S1.bodyControls).frameLoadSuccess&&(Object(L.a)(Object,this.S1.bodyControls).frameLoadSuccess=va),N!==this.S1.dialogButtonsOption&&(this.S1.dialogButtonsOption=null,this.Rb=N),this.update(this.S1))}hHj(Y,
va){const N=new T.a(H.a.RAj);N.Values={["signInLabel"]:CommonUIStrings.l_SignIn,["cancelLabel"]:CommonUIStrings.l_DialogCancel,["rtl"]:x.AFrameworkApplication.isRtl,["messageCorrelationId"]:Y,["dialogStyles"]:va};this.Yv.BSa(N,this.jt.contentWindow,this.uY)}kZe(){this.kEc(!0,!1,6)}get t6f(){return this.jt}get Elh(){return this.uug.then(Y=>{this.O8d=!0;return Y})}get Flh(){return this.O8d}lXi(){this.kZe()}Zbh(){return this.jt}NAj(Y){0===Y&&(this.xEg.reject(Object.assign(new d,{ErrorCode:"UserCancelled",
ErrorMessage:"The interactive flow was cancelled by the user"})),this.AEa(null))}}Object(u.a)(D,"SharedAuthConsentDialog",V.a,[446]);var G=a(1240),J=a(98),M=a(136),Q=a(39),U=a(171),Z=a(189);class P{constructor(){this.jt=null;this.SUb=0;this.Ukb=this.YYa=this.lHc=this.AEa=this.tM=this.ome=null;this.Yv=new G.a(null,null);this.JYa="SharedAuthTokenStrategy Unloaded";this.uY=r.a.PAj;this.qke=r.a.OAj;this.y9d=r.a.enableConsoleLogging;this.Lug=x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",
!1);this.ZCg=x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",!1);this.ura={};this.lxg=new E(1500)}Xxb(){return this.JYa}initialize(){var {OAuthManager:Y}=a(842);if("loadFrame"in this.ura)return this.ura.loadFrame.sxe;if(!this.uY)return J.Health.instance.recordKpiFailure(Y.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),c.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);
Y=this.$Ac("loadFrame");this.SUb=Q.a.Ud();var va=this.uY+this.qke+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+x.AFrameworkApplication.userSessionId+"&WacUserType="+x.AFrameworkApplication.userType;this.jt=document.createElement("iframe");this.Xei(this.jt);this.jt.style.cssText="height:0;width:0;display:none;";this.jt.id="SharedAuthFrame";this.jt.setAttribute("name","SharedAuthFrame");this.jt.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");
this.jt.setAttribute("title","SharedAuthFrame");this.jt.src=va;document.body.appendChild(this.jt);va=Q.a.Ud()-this.SUb;c.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",va,this.jt.src);return Y}Mlc(Y){this.lHc=Y;const va=new T.a(H.a.w6f);va.Values=this.Vwe(Y);Y=this.$Ac("initFrame");this.Yv.BSa(va,this.jt.contentWindow,this.uY);c.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");
return Y}UL(Y,va,N,ea,Ca,la){const Ra=new T.a(H.a.SAj),lb=this.z6e();Ra.Values=this.Qfg(Y,va,N,ea,Ca,la,lb);Y=this.$Ac(lb);ea&&x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.lxg.enqueue(()=>new Promise(Aa=>{this.lTj(la,Ra,Aa,lb)})):(this.Yv.BSa(Ra,this.jt.contentWindow,this.uY),c.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",va));return Y}lTj(Y,va,N,ea){const Ca=this.ura[ea];
Ca&&(this.YYa=va,this.AEa=Object.assign(new I,{resolve:N,correlationId:ea}),this.tM=new D(this.uY,this.qke,Y,this.Yv,Ca,N),this.tM.Kzc())}z6e(){return U.a.create().toString()}Qfg(Y,va,N,ea,Ca,la,Ra){const lb={};lb.appName=Y;lb.appId=va;lb.target=N;lb.withPopup=ea;lb.claims=Ca;lb.promptMessage=la;lb.messageCorrelationId=Ra;return lb}Xei(Y){$addHandler(Y,"load",Object(C.a)(this,this.qSi,"onIFrameLoaded"));$addHandler(Y,"error",Object(C.a)(this,this.wpc,"onIFrameError"));this.Yv.vGa(this.uY);this.Yv.so(H.a.z6f);
this.Yv.dm(H.a.z6f,Object(C.a)(this,this.DWi,"onScriptLoaded"));this.Yv.so(H.a.y6f);this.Yv.dm(H.a.y6f,Object(C.a)(this,this.CWi,"onScriptInitialized"));this.Yv.so(H.a.u6f);this.Yv.dm(H.a.u6f,Object(C.a)(this,this.SRi,"onGetTokenResponse"));this.Yv.so(H.a.A6f);this.Yv.dm(H.a.A6f,Object(C.a)(this,this.KTi,"onLoginResponse"));this.Yv.so(H.a.x6f);this.Yv.dm(H.a.x6f,Object(C.a)(this,this.NSi,"onInteractiveFlowReady"));this.Yv.so(H.a.v6f);this.Yv.dm(H.a.v6f,Object(C.a)(this,this.jSi,"onHideDialog"));this.Yv.so(H.a.s6f);
this.Yv.dm(H.a.s6f,Object(C.a)(this,this.fNi,"onCloseDialog"))}$Ac(Y){const va=new A;va.startTime=Q.a.Ud();const N=new Promise((ea,Ca)=>{va.resolve=ea;va.reject=Ca});va.sxe=N;this.ura[Y]=va;return N}qSi(){const Y=Q.a.Ud()-this.SUb;c.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",Y)}wpc(Y){const {OAuthManager:va}=a(842),N=Q.a.Ud()-this.SUb,ea=Object.assign(new Z.a,{durationMs:N});J.Health.instance.recordKpiFailure(va.kpiName,"SharedAuthWACOAuthAspxFrameError",
!1,!0,ea);c.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",N,this.y9d?JSON.stringify(Y):"")}DWi(Y){const {OAuthManager:va}=a(842),N=this.ura.loadFrame;var ea=Q.a.Ud()-N.startTime,Ca=Y.Values.AuthLibrary.toString();Y=Y.Values.Success.toString();c.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",Y,Ca,ea);Ca&&(this.JYa="SharedAuthTokenStrategy "+Ca);Ca=Boolean.parse(Y);Ca||(Y=M.a.gs(),void 0!==
Y&&null!==Y&&(Y.set("AuthLibrary",this.Xxb()),ea=Object.assign(new Z.a,{durationMs:ea,extendedProperties:Y}),J.Health.instance.recordKpiFailure(va.kpiName,"SharedAuthStrategyInitFailed",!1,!0,ea)));N.resolve(Ca?0:1)}CWi(Y){if(Y.Values.interactive&&this.YYa&&this.YYa.Values.messageCorrelationId){const N=this.YYa.Values.messageCorrelationId.toString();if(Y.Values.interactive&&this.tM){this.tM.Elh.then(ea=>{this.Yv.BSa(this.YYa,this.tM.t6f.contentWindow,this.uY);this.tM.hHj(N,ea);this.tM.kEc(!0,!0);
this.YYa=null});return}}Y=this.ura.initFrame;const va=Q.a.Ud()-Y.startTime;c.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",va);Y.resolve(0)}SRi(Y){if(Y.Values.messageCorrelationId&&Y.Values.messageCorrelationId.toString()){var va=Y.Values.messageCorrelationId.toString(),N=this.ura[va];if(N){var ea=Q.a.Ud()-N.startTime;c.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",ea);Y.Values.isSuccess&&Y.Values.isSuccess?
N.resolve(Y.Values.response):N.reject(Y.Values.response);this.egg(va)}else c.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")}NSi(){if(this.tM.Flh)this.tM.kZe();else if(this.lHc&&this.tM){const Y=new T.a(H.a.w6f);Y.Values=this.Vwe(this.lHc,!0);this.Yv.BSa(Y,this.tM.t6f.contentWindow,this.uY)}}jSi(){this.tM&&
this.tM.gzb()}fNi(Y){Y.Values.cancelled&&Y.Values.cancelled&&Y.Values.messageCorrelationId&&this.egg(Y.Values.messageCorrelationId.toString());this.tM&&this.tM.hide()}Vwe(Y,va=!1){const N={};N.appIds=this.tNh();N.upn=Y.loginHint;N.authority=Y.authority;N.authorityType=b(f,Y.authorityType);N.tenantId=Y.tenantId;N.correlationId=x.AFrameworkApplication.userSessionId;N.enableConsoleLogging=this.y9d;N.enablePopupFlash=this.Lug;N.skipUpnCheck=this.ZCg;N.interactive=va;return N}tNh(){const Y=[],va=r.a.BYc;
for(let N in va)Array.add(Y,va[N]);return Y}VCc(Y,va,N,ea,Ca,la){const Ra=new T.a(H.a.QAj),lb=this.z6e();Ra.Values=this.Qfg(Y,va,N,ea,Ca,la,lb);this.ome=Ra;Y=this.$Ac(lb);c.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",va);this.REj();return Y}sBc(){return!0}REj(){this.Ukb||(this.Ukb=new B.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Ukb.id=16,this.Ukb.Mrd=!1,this.Ukb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,
()=>{c.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");this.Yv.BSa(this.ome,this.jt.contentWindow,this.uY)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),c.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))}KTi(Y){if(Y.Values.messageCorrelationId&&Y.Values.messageCorrelationId.toString()){var va=this.ura[Y.Values.messageCorrelationId.toString()];if(va){var N=Q.a.Ud()-va.startTime;c.ULS.sendTraceTag(555049441,
3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",N);Y.Values.isSuccess&&Y.Values.isSuccess?va.resolve(Y.Values.response):va.reject(Y.Values.response)}else c.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")}egg(Y){this.AEa&&this.AEa.correlationId===Y&&(this.AEa.resolve(null),this.AEa=null)}}
Object(u.a)(P,"SharedAuthTokenStrategy",null,[430]);class S{constructor(Y){this.DRc=Y;this.JYa="UnsupportedAuthTokenStrategy Reason="+e.a[this.DRc]}initialize(){return Promise.resolve(0)}Mlc(){return Promise.resolve(0)}UL(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:e.a[this.DRc],ErrorMessage:"Unable to get a token. Reason: ["+e.a[this.DRc]+"]"}))}VCc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}sBc(){return!1}Xxb(){return this.JYa}}
Object(u.a)(S,"UnsupportedAuthTokenStrategy",null,[430]);var ja=a(720);a.d(F,"OAuthManager",function(){return X});class X{constructor(Y=null){this.VS=0;this.sP=null;this.wBg=0;const va=Q.a.Ud();this.bxg=this.Skh(Y).then(N=>N?this.ndi():(c.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",this.Av(),Math.floor(Q.a.Ud()-va)),N=M.a.gs(),void 0!==N&&null!==N&&(N.set("AuthLibrary",this.Av()),N=Object.assign(new Z.a,{durationMs:Math.floor(Q.a.Ud()-
va),extendedProperties:N}),J.Health.instance.recordKpiFailure(X.kpiName,"StrategyPickFailed",!1,!0,N)),Promise.resolve(1))).then(N=>0!==N?Promise.resolve(N):this.byi())}Tkh(){var Y=r.a.yGi;Y&&0<Y.length?(this.VS=1,this.sP=new h(Y)):x.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||x.AFrameworkApplication.fa.qa("IsO365CommercialHost")?x.AFrameworkApplication.fa.qa("IsAnonymousUser")?(this.VS=2,this.sP=new S(this.VS)):(Y=n.a.getAuthContext().loginHint)&&Y.length?r.a.lzb?(this.VS=1,this.sP=new w):
(this.VS=1,this.sP=new P):(this.VS=3,this.sP=new S(this.VS)):(this.VS=4,this.sP=new S(this.VS))}Av(){return this.sP?this.sP.Xxb()||"Unknown":"None"}Skh(Y=null){c.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");const va=Q.a.Ud();return x.AFrameworkApplication.fa.Sgd().then(N=>{N?(this.Tkh(),Y&&(this.sP=Y),c.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",r.a.clientVersion,r.a.appVersion,r.a.Qnh,
this.Av(),Math.floor(Q.a.Ud()-va))):c.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(Q.a.Ud()-va));return Promise.resolve(N)},()=>{c.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(Q.a.Ud()-va));return Promise.resolve(!1)})}ndi(){c.ULS.sendTraceTag(573390991,3E3,50,
"Initializing {0}",this.Av());const Y=Q.a.Ud();return m.get(this.sP.initialize(),2,r.a.NId).then(va=>{if(0===va)c.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",this.Av(),Math.floor(Q.a.Ud()-Y));else if(1===va){c.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",this.Av(),Math.floor(Q.a.Ud()-Y));var N=M.a.gs();void 0!==N&&null!==N&&(N.set("AuthLibrary",this.Av()),N=Object.assign(new Z.a,{durationMs:Math.floor(Q.a.Ud()-
Y),extendedProperties:N}),J.Health.instance.recordKpiFailure(X.kpiName,"StrategyInitFailed",!1,!0,N))}else 2===va&&(c.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.Av(),Math.floor(Q.a.Ud()-Y)),N=M.a.gs(),void 0!==N&&null!==N&&(N.set("AuthLibrary",this.Av()),N=Object.assign(new Z.a,{durationMs:Math.floor(Q.a.Ud()-Y),extendedProperties:N}),J.Health.instance.recordKpiFailure(X.kpiName,"StrategyInitTimedOut",!1,!0,N)));
return Promise.resolve(va)},()=>{c.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.Av(),Math.floor(Q.a.Ud()-Y));return Promise.resolve(1)})}byi(){c.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.Av());const Y=Q.a.Ud();return m.get(this.sP.Mlc(n.a.getAuthContext()),2,r.a.NId).then(va=>{if(0===va)c.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",this.Av(),Math.floor(Q.a.Ud()-Y));else if(1===va){c.ULS.sendTraceTag(562128583,
3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.Av(),Math.floor(Q.a.Ud()-Y));var N=M.a.gs();void 0!==N&&null!==N&&(N.set("AuthLibrary",this.Av()),N=Object.assign(new Z.a,{durationMs:Math.floor(Q.a.Ud()-Y),extendedProperties:N}),J.Health.instance.recordKpiFailure(X.kpiName,"StrategyLoadFailed",!1,!0,N))}else 2===va&&(c.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.Av(),Math.floor(Q.a.Ud()-
Y)),N=M.a.gs(),void 0!==N&&null!==N&&(N.set("AuthLibrary",this.Av()),N=Object.assign(new Z.a,{durationMs:Math.floor(Q.a.Ud()-Y),extendedProperties:N}),J.Health.instance.recordKpiFailure(X.kpiName,"StrategyLoadTimedOut",!1,!0,N)));return Promise.resolve(va)},()=>{c.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.Av(),Math.floor(Q.a.Ud()-Y));return Promise.resolve(1)})}UL(Y,va,N=null){return this.TCc(Y,va,!1,null,"",N)}Rfg(Y,va,N,
ea,Ca=null){return this.TCc(Y,va,!0,N,ea,Ca)}TCc(Y,va,N,ea,Ca,la,Ra=0){Ra+=1;c.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",Y,this.hSa(Y,va),this.Av(),Ra);var lb=M.a.gs();void 0!==lb&&null!==lb&&(lb.set("AuthLibrary",this.Av()),lb.set("AppName",Y),lb.set("Target",this.hSa(Y,va)),J.Health.instance.recordKpiUsage(X.kpiName,0,"WacOAuthFC",lb));if(!r.a.isEnabled){var Aa;return this.Nwd((Aa=new d,Aa.IsSuccess=!1,Aa.Token=
null,Aa.ErrorCode="NotEnabled",Aa.ErrorMessage="OAuthManager is disabled.",Aa),Y)}const da=r.a.BYc[Y];if(void 0===da||null===da){c.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",Y);var aa;return this.Nwd((aa=new d,aa.IsSuccess=!1,aa.Token=null,aa.ErrorCode="DisallowedApp",aa.ErrorMessage="Disallowed appName: "+Y,aa),Y)}const fa=Q.a.Ud(),Oa=this;lb=this.bxg.then(Fa=>Oa.Xii(Y,da,va,N,ea,Ca,la,Fa));Aa=N?0:r.a.NId;
let ba;aa=(ba=new d,ba.IsSuccess=!1,ba.Token=null,ba.ErrorCode="authTokenStrategy_timeout",ba.ErrorMessage="Auth Strategy timed out after ["+Aa+"] ms when fetching token",ba);let ka=this,Pa=this;return m.get(lb,aa,Aa).then(Fa=>Ra<=X.eFi&&(Fa.ErrorCode===X.Xdg||Fa.ErrorCode===X.OLj)?(c.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Ra,Math.floor(Q.a.Ud()-fa)),ka.TCc(Y,va,N,ea,Ca,la,Ra)):Fa.ErrorCode===X.Dnf&&!N&&(c.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",
Ra,X.oPe),X.Qqh&&ka.sP.sBc()&&ka.sP.VCc(Y,da,va,N,ea,Ca).then(oa=>Promise.resolve(ka.dmc(oa,Y,va,da,fa))).catch(()=>{let oa;const La=(oa=new d,oa.IsSuccess=!1,oa.Token=null,oa.ErrorCode="authTokenStrategy_failure",oa.ErrorMessage="LoginPopup failed, GetToken could not be called",oa);return Promise.resolve(ka.dmc(La,Y,va,da,fa))}),X.oPe)?ka.TCc(Y,va,!0,ea,Ca,la,Ra):Promise.resolve(ka.dmc(Fa,Y,va,da,fa))).catch(()=>{let Fa;const oa=(Fa=new d,Fa.IsSuccess=!1,Fa.Token=null,Fa.ErrorCode="authTokenStrategy_failure",
Fa.ErrorMessage="Auth Strategy failed with an unknown error",Fa);return Promise.resolve(Pa.dmc(oa,Y,va,da,fa))})}Xii(Y,va,N,ea,Ca,la,Ra,lb){return 1===lb||2===lb?this.Nwd(Object.assign(new d,{IsSuccess:!1,Token:null,ErrorCode:1===lb?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),Y):this.sP.UL(Y,va,N,ea,Ca,la,Ra).then(Aa=>Promise.resolve(this.qxf(Aa,!0,Y))).catch(Aa=>Promise.resolve(this.qxf(Aa,!1,Y)))}dmc(Y,va,N,ea,Ca){const la={};Ca=Q.a.Ud()-Ca;la.IsSuccess=Y.IsSuccess;
la.ErrorCode=Y.IsSuccess?"Success":Y.ErrorCode||"";la.ErrorMessage=Y.IsSuccess?"Success":this.hSa(va,Y.ErrorMessage||"");la.Target=this.hSa(va,N||"");la.TimeInMS=Math.floor(Ca);la.AuthLibrary=this.Av();la.AppName=va;la.AuthorityType=b(f,n.a.Nbc());la.UserType=this.C4h(n.a.getAuthContext());la.IsAuthSupportedInSession=e.a[this.VS];la.RequestCount=++this.wBg;la.AppId=ea;c.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(la));Y.IsSuccess||(N=M.a.gs(),void 0!==N&&null!==N&&(N.set("AppName",va),N.set("AuthLibrary",
this.Av()),N.set("ErrorCode",Y.ErrorCode),N.set("ErrorMessage",this.hSa(va,Y.ErrorMessage)),va=Object.assign(new Z.a,{durationMs:Ca,extendedProperties:N}),J.Health.instance.recordKpiFailure(X.kpiName,"TryGetTokenFailure",!1,!0,va)));return Y}Nwd(Y,va){c.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",va,this.hSa(va,Y.ErrorMessage));const N=M.a.gs();void 0!==N&&null!==N&&(N.set("AppName",va),N.set("AuthLibrary",this.Av()),N.set("ErrorCode",
Y.ErrorCode),N.set("ErrorMessage",this.hSa(va,Y.ErrorMessage)),va=Object.assign(new Z.a,{extendedProperties:N}),J.Health.instance.recordKpiFailure(X.kpiName,"FailureBeforeGetToken",!1,!0,va));return Promise.resolve(Y)}Eif(Y){return Y===ja.a.eCc}hSa(Y,va){return this.Eif(Y)&&va?"REDACTED":va}C4h(Y){return x.AFrameworkApplication.fa.qa("IsAnonymousUser")?"anonymous":!Y.loginHint||1>Y.loginHint.length?"empty":-1<Y.loginHint.indexOf("guest#")?"guest":-1<Y.loginHint.indexOf("ext#")?"external":0>Y.upn.indexOf("@")?
"no-at":"supported"}YMa(){return 1===this.VS}qxf(Y,va,N){let ea=null,Ca=null,la=null,Ra=null;Y?Y.ErrorCode||Y.ErrorMessage?(Ca=Y.ErrorCode?Y.ErrorCode:X.IVe,la=Y.ErrorMessage?Y.ErrorMessage:"No message"):Y.Token?va?ea=Y.Token:(Ca=X.iej,la="A rejected promise returned a token."):(Ca=X.IVe,la=JSON.stringify(Y)):(Ca=X.SIi,la="No result came from Auth Token Strategy");Y&&Y.Telemetry&&!this.Eif(N)&&(Ra=Y.Telemetry,c.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Ra)));if(Ca===X.JGi||Ca===X.zQj)Ca=X.Xdg,
la="Auth Library Timed Out";Ca===X.mTg&&-1<la.indexOf(X.qFg)&&(Ca=X.Dnf);if(Ca||la)ea=null;return Object.assign(new d,{IsSuccess:!!ea,Token:ea,ErrorCode:Ca,ErrorMessage:la,Telemetry:Ra})}static get oPe(){return x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}static get Qqh(){return x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}X.zQj="token_renewal_error";X.IVe="Exception";
X.SIi="NoResult";X.iej="RejectToken";X.JGi="monitor_window_timeout";X.Xdg="Timeout";X.OLj="authTokenStrategy_timeout";X.mTg="login_required";X.qFg="AADSTS50058";X.Dnf="Cookies Disabled";X.kpiName="OAuthManager";X.eFi=2;Object(u.a)(X,"OAuthManager",null,[297])},923:function(u,F,a){a.d(F,"a",function(){return c});u=a(0);var c;(function(b){b[b.unknown=0]="unknown";b[b.supported=1]="supported";b[b.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";b[b.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";
b[b.hostUnsupported=4]="hostUnsupported"})(c||(c={}));Object(u.b)("SupportStatus",c)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.oauth.js.map/a0babde6e091cc7714654e9a9cf2b031/EwaDSEsNext.oauth.js.map